{"ast":null,"code":"import { ref, computed, onMounted, watch, onUnmounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { useAccountStore } from '@/stores/account';\nimport { membership } from '@/api/membership';\nimport { showToast } from '@/utils/toast';\nimport { SparklesIcon, CloudArrowUpIcon, ChatBubbleLeftRightIcon, QuestionMarkCircleIcon, CheckCircleIcon, GiftIcon, ClipboardDocumentListIcon, StarIcon, PencilSquareIcon, CalendarDaysIcon, DocumentTextIcon, CloudIcon, DocumentChartBarIcon, UserGroupIcon, CheckIcon, DocumentIcon, BoltIcon, HeartIcon, UserIcon, TrophyIcon, ChevronDownIcon, SparklesIcon as CrownIcon } from '@heroicons/vue/24/outline';\nimport SignInSuccessDialog from '@/components/SignInSuccessDialog.vue';\nimport { ElMessage } from 'element-plus';\n\n// 获取积分信息\n\nexport default {\n  __name: 'index',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const fetchPointsInfo = async () => {\n      try {\n        const response = await membership.getPoints();\n        if (response?.data?.code === 200) {\n          pointsInfo.value = response.data.data;\n        }\n      } catch (error) {\n        console.error('获取积分信息失败:', error);\n      }\n    };\n\n    // 获取积分记录\n    const fetchPointsRecords = async () => {\n      try {\n        const response = await membership.getPointRecords();\n        if (response?.data?.code === 200) {\n          pointsRecords.value = response.data.data;\n        }\n      } catch (error) {\n        console.error('获取积分记录失败:', error);\n      }\n    };\n\n    // 签到相关状态\n    const showSignInSuccess = ref(false);\n    const signInResult = ref({\n      points: 0,\n      signInDays: 0,\n      nextReward: null\n    });\n\n    // 处理签到\n    const handleSignIn = async () => {\n      if (!canSignIn.value) return;\n      try {\n        console.log('开始签到');\n        const response = await membership.checkIn();\n        console.log('签到响应:', response);\n        if (response?.data?.code === 200) {\n          const {\n            points,\n            balance,\n            sign_in_days,\n            next_reward\n          } = response.data.data;\n\n          // 更新积分信息\n          pointsInfo.value.balance = balance;\n          signInInfo.value.days = sign_in_days;\n          signInInfo.value.nextReward = next_reward;\n          canSignIn.value = false;\n\n          // 显示签到成功弹窗\n          signInResult.value = {\n            points,\n            signInDays: sign_in_days,\n            nextReward: next_reward\n          };\n          showSignInSuccess.value = true;\n\n          // 刷新积分记录\n          await fetchPointsRecords();\n        }\n      } catch (error) {\n        console.error('签到失败:', error);\n        if (error.response?.data?.code === 400) {\n          ElMessage.warning(error.response.data.message);\n          canSignIn.value = false;\n        } else {\n          ElMessage.error('签到失败，请稍后重试');\n        }\n      }\n    };\n\n    // 在组件挂载时获取数据\n    onMounted(async () => {\n      await Promise.all([fetchPointsInfo(), fetchPointsRecords()]);\n\n      // 获取签到状态\n      try {\n        const response = await membership.getSignInStatus();\n        if (response?.data?.code === 200) {\n          const {\n            can_sign_in,\n            sign_in_days,\n            next_reward\n          } = response.data.data;\n          canSignIn.value = can_sign_in;\n          signInInfo.value.days = sign_in_days;\n          signInInfo.value.nextReward = next_reward;\n        }\n      } catch (error) {\n        console.error('获取签到状态失败:', error);\n      }\n    });\n    const __returned__ = {\n      fetchPointsInfo,\n      fetchPointsRecords,\n      showSignInSuccess,\n      signInResult,\n      handleSignIn,\n      ref,\n      computed,\n      onMounted,\n      watch,\n      onUnmounted,\n      get useRouter() {\n        return useRouter;\n      },\n      get useAccountStore() {\n        return useAccountStore;\n      },\n      get membership() {\n        return membership;\n      },\n      get showToast() {\n        return showToast;\n      },\n      get SparklesIcon() {\n        return SparklesIcon;\n      },\n      get CloudArrowUpIcon() {\n        return CloudArrowUpIcon;\n      },\n      get ChatBubbleLeftRightIcon() {\n        return ChatBubbleLeftRightIcon;\n      },\n      get QuestionMarkCircleIcon() {\n        return QuestionMarkCircleIcon;\n      },\n      get CheckCircleIcon() {\n        return CheckCircleIcon;\n      },\n      get GiftIcon() {\n        return GiftIcon;\n      },\n      get ClipboardDocumentListIcon() {\n        return ClipboardDocumentListIcon;\n      },\n      get StarIcon() {\n        return StarIcon;\n      },\n      get PencilSquareIcon() {\n        return PencilSquareIcon;\n      },\n      get CalendarDaysIcon() {\n        return CalendarDaysIcon;\n      },\n      get DocumentTextIcon() {\n        return DocumentTextIcon;\n      },\n      get CloudIcon() {\n        return CloudIcon;\n      },\n      get DocumentChartBarIcon() {\n        return DocumentChartBarIcon;\n      },\n      get UserGroupIcon() {\n        return UserGroupIcon;\n      },\n      get CheckIcon() {\n        return CheckIcon;\n      },\n      get DocumentIcon() {\n        return DocumentIcon;\n      },\n      get BoltIcon() {\n        return BoltIcon;\n      },\n      get HeartIcon() {\n        return HeartIcon;\n      },\n      get UserIcon() {\n        return UserIcon;\n      },\n      get TrophyIcon() {\n        return TrophyIcon;\n      },\n      get ChevronDownIcon() {\n        return ChevronDownIcon;\n      },\n      get CrownIcon() {\n        return CrownIcon;\n      },\n      SignInSuccessDialog,\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","watch","onUnmounted","useRouter","useAccountStore","membership","showToast","SparklesIcon","CloudArrowUpIcon","ChatBubbleLeftRightIcon","QuestionMarkCircleIcon","CheckCircleIcon","GiftIcon","ClipboardDocumentListIcon","StarIcon","PencilSquareIcon","CalendarDaysIcon","DocumentTextIcon","CloudIcon","DocumentChartBarIcon","UserGroupIcon","CheckIcon","DocumentIcon","BoltIcon","HeartIcon","UserIcon","TrophyIcon","ChevronDownIcon","CrownIcon","SignInSuccessDialog","ElMessage","fetchPointsInfo","response","getPoints","data","code","pointsInfo","value","error","console","fetchPointsRecords","getPointRecords","pointsRecords","showSignInSuccess","signInResult","points","signInDays","nextReward","handleSignIn","canSignIn","log","checkIn","balance","sign_in_days","next_reward","signInInfo","days","warning","message","Promise","all","getSignInStatus","can_sign_in"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/Membership/index.vue"],"sourcesContent":["<template>\n  <!-- No changes to template section -->\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, watch, onUnmounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useAccountStore } from '@/stores/account'\nimport { membership } from '@/api/membership'\nimport { showToast } from '@/utils/toast'\nimport { \n  SparklesIcon, \n  CloudArrowUpIcon, \n  ChatBubbleLeftRightIcon, \n  QuestionMarkCircleIcon, \n  CheckCircleIcon, \n  GiftIcon, \n  ClipboardDocumentListIcon, \n  StarIcon, \n  PencilSquareIcon, \n  CalendarDaysIcon,\n  DocumentTextIcon,\n  CloudIcon,\n  DocumentChartBarIcon,\n  UserGroupIcon,\n  CheckIcon,\n  DocumentIcon,\n  BoltIcon,\n  HeartIcon,\n  UserIcon,\n  TrophyIcon,\n  ChevronDownIcon,\n  SparklesIcon as CrownIcon\n} from '@heroicons/vue/24/outline'\nimport SignInSuccessDialog from '@/components/SignInSuccessDialog.vue'\nimport { ElMessage } from 'element-plus'\n\n// 获取积分信息\nconst fetchPointsInfo = async () => {\n  try {\n    const response = await membership.getPoints()\n    if (response?.data?.code === 200) {\n      pointsInfo.value = response.data.data\n    }\n  } catch (error) {\n    console.error('获取积分信息失败:', error)\n  }\n}\n\n// 获取积分记录\nconst fetchPointsRecords = async () => {\n  try {\n    const response = await membership.getPointRecords()\n    if (response?.data?.code === 200) {\n      pointsRecords.value = response.data.data\n    }\n  } catch (error) {\n    console.error('获取积分记录失败:', error)\n  }\n}\n\n// 签到相关状态\nconst showSignInSuccess = ref(false)\nconst signInResult = ref({\n  points: 0,\n  signInDays: 0,\n  nextReward: null\n})\n\n// 处理签到\nconst handleSignIn = async () => {\n  if (!canSignIn.value) return\n  \n  try {\n    console.log('开始签到')\n    const response = await membership.checkIn()\n    console.log('签到响应:', response)\n    \n    if (response?.data?.code === 200) {\n      const { points, balance, sign_in_days, next_reward } = response.data.data\n      \n      // 更新积分信息\n      pointsInfo.value.balance = balance\n      signInInfo.value.days = sign_in_days\n      signInInfo.value.nextReward = next_reward\n      canSignIn.value = false\n      \n      // 显示签到成功弹窗\n      signInResult.value = {\n        points,\n        signInDays: sign_in_days,\n        nextReward: next_reward\n      }\n      showSignInSuccess.value = true\n      \n      // 刷新积分记录\n      await fetchPointsRecords()\n    }\n  } catch (error) {\n    console.error('签到失败:', error)\n    if (error.response?.data?.code === 400) {\n      ElMessage.warning(error.response.data.message)\n      canSignIn.value = false\n    } else {\n      ElMessage.error('签到失败，请稍后重试')\n    }\n  }\n}\n\n// 在组件挂载时获取数据\nonMounted(async () => {\n  await Promise.all([\n    fetchPointsInfo(),\n    fetchPointsRecords()\n  ])\n  \n  // 获取签到状态\n  try {\n    const response = await membership.getSignInStatus()\n    if (response?.data?.code === 200) {\n      const { can_sign_in, sign_in_days, next_reward } = response.data.data\n      canSignIn.value = can_sign_in\n      signInInfo.value.days = sign_in_days\n      signInInfo.value.nextReward = next_reward\n    }\n  } catch (error) {\n    console.error('获取签到状态失败:', error)\n  }\n})\n</script> \n\n<style scoped>\n/* No changes to style section */\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}