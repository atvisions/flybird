{"ast":null,"code":"import { ref, computed, nextTick, watch, onMounted } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport defaultAvatarImage from '@/assets/images/default-avatar.png';\nimport defaultBackground from '@/assets/images/default-background.jpg';\nimport { useStore } from 'vuex';\nimport { MEDIA_URL } from '@/config';\nimport { showToast } from '@/components/ToastMessage';\nimport { PencilIcon, PhoneIcon, EnvelopeIcon, MapPinIcon, BriefcaseIcon, ClockIcon, CurrencyYenIcon, DocumentTextIcon, CameraIcon, UserIcon, CalendarIcon, ChevronDownIcon, ChevronUpIcon, CakeIcon, PencilSquareIcon, LanguageIcon } from '@heroicons/vue/24/outline';\nimport profile from '@/api/profile';\nimport { eventBus } from '@/utils/eventBus';\nimport { Dialog, DialogPanel, DialogTitle, TransitionChild, TransitionRoot } from '@headlessui/vue';\nimport AvatarUploadDialog from '../dialogs/AvatarUploadDialog.vue';\nimport { updateBasicInfo } from '@/api/profile';\nimport useLoading from '@/composables/useLoading';\nimport EditBasicDialog from '../dialogs/EditBasicDialog.vue';\n\n// 1. 首先声明 props\n\nexport default {\n  __name: 'BasicInfo',\n  props: {\n    resumeData: {\n      type: Object,\n      default: () => ({})\n    },\n    language: {\n      type: String,\n      default: 'zh-Hans'\n    },\n    loading: {\n      type: Boolean,\n      default: false\n    },\n    bioExpanded: {\n      type: Boolean,\n      default: false\n    },\n    showBioExpandButton: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: ['update', 'edit', 'toggleBioExpand', 'language-change'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n\n    // 2. 声明 emits\n    const emit = __emit;\n\n    // 3. 导入和初始化其他变量\n    const store = useStore();\n    const basicInfo = ref({\n      name: '',\n      name_en: '',\n      gender: '',\n      birth_date: '',\n      phone: '',\n      email: '',\n      location: '',\n      location_en: '',\n      summary: '',\n      summary_en: '',\n      avatar: '',\n      background: '',\n      basic_info: {}\n    });\n\n    // 4. 计算属性\n    const userAvatar = computed(() => {\n      const avatar = props.resumeData?.avatar;\n      if (!avatar) return defaultAvatarImage;\n      return avatar.startsWith('http') || avatar.startsWith('data:') ? avatar : `${MEDIA_URL}${avatar}`;\n    });\n    const currentGender = computed(() => {\n      return props.resumeData?.gender;\n    });\n\n    // 5. 监听器\n    watch(() => props.resumeData, newData => {\n      if (newData) {\n        basicInfo.value = {\n          id: newData.id,\n          name: newData.name || '',\n          name_en: newData.name_en || '',\n          gender: newData.gender || '',\n          birth_date: newData.birth_date || '',\n          phone: newData.phone || '',\n          email: newData.email || '',\n          location: newData.location || '',\n          location_en: newData.location_en || '',\n          summary: newData.summary || '',\n          summary_en: newData.summary_en || '',\n          avatar: newData.avatar || '',\n          background: newData.background || '',\n          basic_info: newData.basic_info || {}\n        };\n      }\n    }, {\n      immediate: true,\n      deep: true\n    });\n\n    // 6. 生命周期钩子\n    onMounted(async () => {\n      try {\n        await store.dispatch('fetchCompleteness');\n      } catch (error) {\n        console.error('Failed to fetch completeness:', error);\n      }\n    });\n\n    // 7. 方法定义\n    const handleFileChange = async event => {\n      const file = event.target.files[0];\n      if (!file) return;\n\n      // 验证文件\n      if (!validateFile(file)) {\n        return;\n      }\n      await handleAvatarUpload(file);\n\n      // 清空文件选择器，以便能够选择同一个文件\n      event.target.value = '';\n    };\n    const handleEdit = () => {\n      console.log('\\n=== 打开编辑对话框 ===');\n      console.log('当前数据:', props.resumeData);\n      console.log('当前语言:', props.language);\n      showEditDialog.value = true;\n    };\n    const toggleBioExpand = () => {\n      emit('toggleBioExpand');\n    };\n\n    // 8. 工具函数\n    const calculateAge = birthDate => {\n      if (!birthDate) return null;\n      try {\n        const birth = new Date(birthDate);\n        const today = new Date();\n        let age = today.getFullYear() - birth.getFullYear();\n        const monthDiff = today.getMonth() - birth.getMonth();\n        if (monthDiff < 0 || monthDiff === 0 && today.getDate() < birth.getDate()) {\n          age--;\n        }\n        return age;\n      } catch (error) {\n        console.error('计算年龄出错:', error);\n        return null;\n      }\n    };\n    const formatGender = gender => {\n      if (!gender) return props.language === 'en' ? 'Not Set' : '未设置';\n      const genderMap = {\n        'zh-Hans': {\n          male: '男',\n          female: '女',\n          other: '其他'\n        },\n        'en': {\n          male: 'Male',\n          female: 'Female',\n          other: 'Other'\n        }\n      };\n\n      // 标准化语言代码\n      const lang = props.language === 'en' ? 'en' : 'zh-Hans';\n\n      // 如果没有对应的翻译，返回原值\n      return genderMap[lang]?.[gender] || gender;\n    };\n    const formatDate = dateString => {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleDateString('zh-CN', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      });\n    };\n\n    // 调试辅助函数\n    const logResumeData = () => {\n      const plainData = {\n        name: props.resumeData.name,\n        gender: props.resumeData.gender,\n        phone: props.resumeData.phone,\n        email: props.resumeData.email,\n        location: props.resumeData.location,\n        birth_date: props.resumeData.birth_date,\n        summary: props.resumeData.summary,\n        created_at: props.resumeData.created_at,\n        updated_at: props.resumeData.updated_at\n      };\n      console.log('BasicInfo data:', plainData);\n    };\n\n    // 添加头像上传处理函数\n    const handleAvatarUpload = async file => {\n      try {\n        await withLoading(async () => {\n          const formData = new FormData();\n          formData.append('avatar', file);\n          const response = await profile.uploadAvatar(formData);\n          if (response.data?.code === 200) {\n            showToast('头像上传成功', 'success');\n            emit('update');\n            const avatarUrl = response.data.data.avatar;\n            eventBus.emit('avatar-updated', avatarUrl);\n            if (props.resumeData) {\n              props.resumeData.avatar = avatarUrl;\n            }\n            showAvatarUpload.value = false; // 关闭弹窗\n          } else {\n            throw new Error(response.data?.message || '上传失败');\n          }\n        });\n      } catch (error) {\n        console.error('头像上传失败:', error);\n        showToast(error.message || '头像上传失败，请稍后重试', 'error');\n      }\n    };\n\n    // 添加触发文件选择的方法\n    const triggerUpload = () => {\n      showAvatarUpload.value = true;\n    };\n\n    // 添加图片加载错误处理\n    const handleImageError = e => {\n      e.target.src = defaultAvatarImage;\n    };\n\n    // 添加文件验证\n    const validateFile = file => {\n      // 验证文件类型\n      if (!file.type.startsWith('image/')) {\n        showToast('请选择图片文件', 'error');\n        return false;\n      }\n\n      // 验证文件大小（例如限制为 2MB）\n      const maxSize = 2 * 1024 * 1024; // 2MB\n      if (file.size > maxSize) {\n        showToast('图片大小不能超过 2MB', 'error');\n        return false;\n      }\n      return true;\n    };\n\n    // 背景图相关\n    const backgroundInput = ref(null);\n    const backgroundUrl = computed(() => {\n      const background = props.resumeData?.background;\n      if (!background) return defaultBackground;\n      if (background.startsWith('http') || background.startsWith('data:')) {\n        return background;\n      }\n      return `${MEDIA_URL}${background}`;\n    });\n    const triggerBackgroundUpload = () => {\n      backgroundInput.value.click();\n    };\n    const handleBackgroundChange = async event => {\n      const file = event.target.files[0];\n      if (!file) return;\n\n      // 验证文件\n      if (!validateFile(file)) {\n        return;\n      }\n      const formData = new FormData();\n      formData.append('background', file);\n      try {\n        await withLoading(async () => {\n          await store.dispatch('updateBackground', formData);\n          emit('update');\n          showToast('背景图更新成功', 'success');\n        });\n      } catch (error) {\n        console.error('Failed to update background:', error);\n        showToast('背景图更新失败', 'error');\n      } finally {\n        // 清空文件选择器\n        event.target.value = '';\n      }\n    };\n    const handleBackgroundError = e => {\n      e.target.src = defaultBackground;\n    };\n\n    // 添加状态\n    const showAvatarUpload = ref(false);\n\n    // 添加语言切换方法\n    const toggleLanguage = () => {\n      const newLang = props.language === 'zh-Hans' ? 'en' : 'zh-Hans';\n      emit('language-change', newLang);\n    };\n    const {\n      loading,\n      withLoading\n    } = useLoading();\n    const showEditDialog = ref(false);\n\n    // 处理提交\n    const handleSubmit = async data => {\n      try {\n        await withLoading(async () => {\n          const result = await updateBasicInfo(data, props.language);\n          if (result.code === 200) {\n            emit('update'); // 触发父组件更新数据\n            showEditDialog.value = false;\n            ElMessage.success(props.language === 'en' ? 'Saved successfully' : '保存成功');\n          } else {\n            throw new Error(result.message || '保存失败');\n          }\n        });\n      } catch (error) {\n        console.error('保存失败:', error);\n        ElMessage.error(error.message || (props.language === 'en' ? 'Save failed' : '保存失败'));\n      }\n    };\n\n    // 添加显示用的计算属性\n    const displayInfo = computed(() => {\n      const isEn = props.language === 'en';\n      const info = basicInfo.value;\n      const age = calculateAge(info.birth_date);\n      return {\n        name: isEn ? info.name_en || info.name || 'Not Set' : info.name || info.name_en || '未填写',\n        gender: formatGender(info.gender),\n        phone: info.phone || (isEn ? 'Not Set' : '未填写'),\n        email: info.email || (isEn ? 'Not Set' : '未填写'),\n        location: isEn ? info.location_en || info.location || 'Not Set' : info.location || info.location_en || '未填写',\n        age: age ? isEn ? `${age} years old` : `${age}岁` : isEn ? 'Not Set' : '未填写',\n        summary: isEn ? info.summary_en || info.summary || '' : info.summary || info.summary_en || ''\n      };\n    });\n    const __returned__ = {\n      props,\n      emit,\n      store,\n      basicInfo,\n      userAvatar,\n      currentGender,\n      handleFileChange,\n      handleEdit,\n      toggleBioExpand,\n      calculateAge,\n      formatGender,\n      formatDate,\n      logResumeData,\n      handleAvatarUpload,\n      triggerUpload,\n      handleImageError,\n      validateFile,\n      backgroundInput,\n      backgroundUrl,\n      triggerBackgroundUpload,\n      handleBackgroundChange,\n      handleBackgroundError,\n      showAvatarUpload,\n      toggleLanguage,\n      loading,\n      withLoading,\n      showEditDialog,\n      handleSubmit,\n      displayInfo,\n      ref,\n      computed,\n      nextTick,\n      watch,\n      onMounted,\n      get ElMessage() {\n        return ElMessage;\n      },\n      get defaultAvatarImage() {\n        return defaultAvatarImage;\n      },\n      get defaultBackground() {\n        return defaultBackground;\n      },\n      get useStore() {\n        return useStore;\n      },\n      get MEDIA_URL() {\n        return MEDIA_URL;\n      },\n      get showToast() {\n        return showToast;\n      },\n      get PencilIcon() {\n        return PencilIcon;\n      },\n      get PhoneIcon() {\n        return PhoneIcon;\n      },\n      get EnvelopeIcon() {\n        return EnvelopeIcon;\n      },\n      get MapPinIcon() {\n        return MapPinIcon;\n      },\n      get BriefcaseIcon() {\n        return BriefcaseIcon;\n      },\n      get ClockIcon() {\n        return ClockIcon;\n      },\n      get CurrencyYenIcon() {\n        return CurrencyYenIcon;\n      },\n      get DocumentTextIcon() {\n        return DocumentTextIcon;\n      },\n      get CameraIcon() {\n        return CameraIcon;\n      },\n      get UserIcon() {\n        return UserIcon;\n      },\n      get CalendarIcon() {\n        return CalendarIcon;\n      },\n      get ChevronDownIcon() {\n        return ChevronDownIcon;\n      },\n      get ChevronUpIcon() {\n        return ChevronUpIcon;\n      },\n      get CakeIcon() {\n        return CakeIcon;\n      },\n      get PencilSquareIcon() {\n        return PencilSquareIcon;\n      },\n      get LanguageIcon() {\n        return LanguageIcon;\n      },\n      get profile() {\n        return profile;\n      },\n      get eventBus() {\n        return eventBus;\n      },\n      get Dialog() {\n        return Dialog;\n      },\n      get DialogPanel() {\n        return DialogPanel;\n      },\n      get DialogTitle() {\n        return DialogTitle;\n      },\n      get TransitionChild() {\n        return TransitionChild;\n      },\n      get TransitionRoot() {\n        return TransitionRoot;\n      },\n      AvatarUploadDialog,\n      get updateBasicInfo() {\n        return updateBasicInfo;\n      },\n      get useLoading() {\n        return useLoading;\n      },\n      EditBasicDialog\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","nextTick","watch","onMounted","ElMessage","defaultAvatarImage","defaultBackground","useStore","MEDIA_URL","showToast","PencilIcon","PhoneIcon","EnvelopeIcon","MapPinIcon","BriefcaseIcon","ClockIcon","CurrencyYenIcon","DocumentTextIcon","CameraIcon","UserIcon","CalendarIcon","ChevronDownIcon","ChevronUpIcon","CakeIcon","PencilSquareIcon","LanguageIcon","profile","eventBus","Dialog","DialogPanel","DialogTitle","TransitionChild","TransitionRoot","AvatarUploadDialog","updateBasicInfo","useLoading","EditBasicDialog","props","__props","emit","__emit","store","basicInfo","name","name_en","gender","birth_date","phone","email","location","location_en","summary","summary_en","avatar","background","basic_info","userAvatar","resumeData","startsWith","currentGender","newData","value","id","immediate","deep","dispatch","error","console","handleFileChange","event","file","target","files","validateFile","handleAvatarUpload","handleEdit","log","language","showEditDialog","toggleBioExpand","calculateAge","birthDate","birth","Date","today","age","getFullYear","monthDiff","getMonth","getDate","formatGender","genderMap","male","female","other","lang","formatDate","dateString","date","toLocaleDateString","year","month","day","logResumeData","plainData","created_at","updated_at","withLoading","formData","FormData","append","response","uploadAvatar","data","code","avatarUrl","showAvatarUpload","Error","message","triggerUpload","handleImageError","e","src","type","maxSize","size","backgroundInput","backgroundUrl","triggerBackgroundUpload","click","handleBackgroundChange","handleBackgroundError","toggleLanguage","newLang","loading","handleSubmit","result","success","displayInfo","isEn","info"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/components/BasicInfo.vue"],"sourcesContent":["<!-- src/views/user/MyProfile/components/BasicInfo.vue -->\n<template>\n  <div class=\"bg-white rounded-lg shadow\">\n    <!-- 背景图部分 -->\n    <div class=\"relative h-48 rounded-t-lg overflow-hidden\">\n      <img\n        :src=\"backgroundUrl\"\n        class=\"w-full h-full object-cover\"\n        alt=\"背景图\"\n        @error=\"handleBackgroundError\"\n      />\n      <!-- 右上角只保留背景上传按钮 -->\n      <div class=\"absolute top-4 right-4\">\n        <button\n          @click=\"triggerBackgroundUpload\"\n          class=\"flex items-center px-3 py-2 space-x-2 bg-white/80 hover:bg-white/90 rounded-full shadow-lg backdrop-blur-sm transition-all duration-200 hover:shadow-xl\"\n        >\n          <CameraIcon class=\"w-4 h-4 text-gray-600\" />\n          <span class=\"text-sm font-medium text-gray-700\">\n            {{ props.language === 'en' ? 'Change Cover' : '更换封面' }}\n          </span>\n        </button>\n      </div>\n\n      <!-- 添加底部渐变遮罩 -->\n      <div \n        class=\"absolute inset-x-0 bottom-0 h-24 bg-gradient-to-t from-black/40 to-transparent pointer-events-none\"\n      ></div>\n\n      <!-- 隐藏的文件输入框 -->\n      <input\n        ref=\"backgroundInput\"\n        type=\"file\"\n        accept=\"image/*\"\n        class=\"hidden\"\n        @change=\"handleBackgroundChange\"\n      />\n    </div>\n\n    <!-- 个人信息卡片 -->\n    <div class=\"relative px-6 pb-6\">\n      <!-- 添加语言切换按钮 -->\n      <div class=\"absolute right-6 top-4\">\n        <button\n          @click=\"toggleLanguage\"\n          class=\"flex items-center px-3 py-1.5 bg-gray-900 hover:bg-gray-800 text-white rounded transition-colors duration-200\"\n        >\n          <LanguageIcon class=\"w-4 h-4 mr-1.5\" />\n          <span class=\"text-sm\">\n            {{ props.language === 'en' ? '中文' : 'EN' }}\n          </span>\n        </button>\n      </div>\n\n      <!-- 头像部分 - 上移到背景图上 -->\n      <div class=\"absolute -top-16 left-6\">\n        <div class=\"relative group\">\n          <img \n            :src=\"userAvatar\" \n            class=\"w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg\"\n            alt=\"用户头像\"\n            @error=\"handleImageError\"\n          />\n          <div \n            @click=\"triggerUpload\"\n            class=\"absolute inset-0 flex items-center justify-center rounded-full bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity duration-200\"\n          >\n            <CameraIcon class=\"w-8 h-8 text-white\" />\n          </div>\n          <!-- 性别标识 -->\n          <div class=\"absolute bottom-0 right-0 bg-white rounded-full p-2 shadow\">\n            <!-- 男性图标 -->\n            <svg \n              v-if=\"currentGender === 'male'\" \n              class=\"w-6 h-6 text-blue-500\" \n              viewBox=\"0 0 24 24\" \n              fill=\"none\" \n              stroke=\"currentColor\"\n            >\n              <circle cx=\"12\" cy=\"12\" r=\"5\" stroke-width=\"2\"/>\n              <path d=\"M16 8L21 3\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n              <path d=\"M21 3H16M21 3V8\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n            <!-- 女性图标 -->\n            <svg \n              v-else-if=\"currentGender === 'female'\" \n              class=\"w-6 h-6 text-pink-500\" \n              viewBox=\"0 0 24 24\" \n              fill=\"none\" \n              stroke=\"currentColor\"\n            >\n              <circle cx=\"12\" cy=\"10\" r=\"5\" stroke-width=\"2\"/>\n              <path d=\"M12 15V21\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n              <path d=\"M9 18H15\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n          </div>\n        </div>\n      </div>\n\n      <!-- 基本信息部分 -->\n      <div class=\"pt-20\">\n        <!-- 名字和编辑按钮 -->\n        <div class=\"flex items-center justify-between mb-4\">\n          <h1 class=\"text-2xl font-bold text-gray-900\">\n            <span :class=\"{ 'break-words': props.language === 'en' }\">\n              {{ displayInfo.name }}\n            </span>\n          </h1>\n          <button\n            @click=\"handleEdit\"\n            class=\"p-2 rounded-full hover:bg-gray-100 transition-colors\"\n            :title=\"props.language === 'en' ? 'Edit' : '编辑'\"\n          >\n            <PencilSquareIcon class=\"w-5 h-5 text-gray-500\" />\n          </button>\n        </div>\n\n        <!-- 个人简介 -->\n        <div class=\"mt-4 mb-8\">\n          <h2 class=\"text-sm font-semibold text-gray-900 mb-2\">\n            {{ props.language === 'en' ? 'Personal Summary' : '个人简介' }}\n          </h2>\n          <div \n            class=\"bg-gray-50 rounded-lg p-4\"\n            :class=\"{\n              'min-h-[100px] flex items-center justify-center': !displayInfo.summary\n            }\"\n          >\n            <p \n              v-if=\"displayInfo.summary\" \n              class=\"text-gray-700 text-sm whitespace-pre-wrap break-words\"\n              :class=\"{ 'line-clamp-3': !bioExpanded }\"\n            >\n              {{ displayInfo.summary }}\n            </p>\n            <p \n              v-else \n              class=\"text-gray-400 text-sm text-center\"\n            >\n              {{ props.language === 'en' ? 'No personal summary yet' : '暂无个人简介' }}\n            </p>\n          </div>\n          \n          <!-- 展开/收起按钮 -->\n          <div \n            v-if=\"showBioExpandButton && displayInfo.summary\" \n            class=\"mt-2 flex justify-center\"\n          >\n            <button\n              type=\"button\"\n              class=\"inline-flex items-center text-sm text-gray-500 hover:text-gray-700\"\n              @click=\"toggleBioExpand\"\n            >\n              <span>{{ bioExpanded ? (props.language === 'en' ? 'Show less' : '收起') : (props.language === 'en' ? 'Show more' : '展开') }}</span>\n              <component\n                :is=\"bioExpanded ? ChevronUpIcon : ChevronDownIcon\"\n                class=\"w-4 h-4 ml-1\"\n              />\n            </button>\n          </div>\n        </div>\n\n        <!-- 信息网格 -->\n        <div class=\"grid grid-cols-2 gap-6\">\n          <!-- 联系方式 -->\n          <div class=\"space-y-3\">\n            <h2 class=\"text-sm font-semibold text-gray-900 mb-2\">\n              {{ props.language === 'en' ? 'Contact Info' : '联系方式' }}\n            </h2>\n            <div class=\"flex items-center space-x-2\">\n              <PhoneIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ displayInfo.phone }}</span>\n            </div>\n            <div class=\"flex items-center space-x-2\">\n              <EnvelopeIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ displayInfo.email }}</span>\n            </div>\n          </div>\n\n          <!-- 基本资料 -->\n          <div class=\"space-y-3\">\n            <h2 class=\"text-sm font-semibold text-gray-900 mb-2\">\n              {{ props.language === 'en' ? 'Basic Info' : '基本资料' }}\n            </h2>\n            <div class=\"flex items-center space-x-2\">\n              <MapPinIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\"\n                :class=\"{ 'break-words': props.language === 'en' }\"\n              >\n                {{ displayInfo.location }}\n              </span>\n            </div>\n            <div class=\"flex items-center space-x-2\">\n              <CakeIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ displayInfo.age }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- 添加头像上传弹窗 -->\n  <AvatarUploadDialog\n    v-model=\"showAvatarUpload\"\n    :loading=\"loading\"\n    @upload=\"handleAvatarUpload\"\n  />\n\n  <EditBasicDialog\n    v-model=\"showEditDialog\"\n    :initial-data=\"props.resumeData\"\n    :language=\"props.language\"\n    :loading=\"loading\"\n    @submit=\"handleSubmit\"\n  />\n</template>\n\n<script setup>\nimport { ref, computed, nextTick, watch, onMounted } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport defaultAvatarImage from '@/assets/images/default-avatar.png'\nimport defaultBackground from '@/assets/images/default-background.jpg'\nimport { useStore } from 'vuex'\nimport { MEDIA_URL } from '@/config'\nimport { showToast } from '@/components/ToastMessage'\nimport {\n  PencilIcon,\n  PhoneIcon,\n  EnvelopeIcon,\n  MapPinIcon,\n  BriefcaseIcon,\n  ClockIcon,\n  CurrencyYenIcon,\n  DocumentTextIcon,\n  CameraIcon,\n  UserIcon,\n  CalendarIcon,\n  ChevronDownIcon,\n  ChevronUpIcon,\n  CakeIcon,\n  PencilSquareIcon,\n  LanguageIcon\n} from '@heroicons/vue/24/outline'\nimport profile from '@/api/profile'\nimport { eventBus } from '@/utils/eventBus'\nimport {\n  Dialog,\n  DialogPanel,\n  DialogTitle,\n  TransitionChild,\n  TransitionRoot\n} from '@headlessui/vue'\nimport AvatarUploadDialog from '../dialogs/AvatarUploadDialog.vue'\nimport { updateBasicInfo } from '@/api/profile'\nimport useLoading from '@/composables/useLoading'\nimport EditBasicDialog from '../dialogs/EditBasicDialog.vue'\n\n// 1. 首先声明 props\nconst props = defineProps({\n  resumeData: {\n    type: Object,\n    default: () => ({})\n  },\n  language: {\n    type: String,\n    default: 'zh-Hans'\n  },\n  loading: {\n    type: Boolean,\n    default: false\n  },\n  bioExpanded: {\n    type: Boolean,\n    default: false\n  },\n  showBioExpandButton: {\n    type: Boolean,\n    default: false\n  }\n})\n\n// 2. 声明 emits\nconst emit = defineEmits(['update', 'edit', 'toggleBioExpand', 'language-change'])\n\n// 3. 导入和初始化其他变量\nconst store = useStore()\nconst basicInfo = ref({\n  name: '',\n  name_en: '',\n  gender: '',\n  birth_date: '',\n  phone: '',\n  email: '',\n  location: '',\n  location_en: '',\n  summary: '',\n  summary_en: '',\n  avatar: '',\n  background: '',\n  basic_info: {}\n})\n\n// 4. 计算属性\nconst userAvatar = computed(() => {\n  const avatar = props.resumeData?.avatar\n  if (!avatar) return defaultAvatarImage\n  return avatar.startsWith('http') || avatar.startsWith('data:') ? avatar : `${MEDIA_URL}${avatar}`\n})\n\nconst currentGender = computed(() => {\n  return props.resumeData?.gender\n})\n\n// 5. 监听器\nwatch(\n  () => props.resumeData,\n  (newData) => {\n    if (newData) {\n      basicInfo.value = {\n        id: newData.id,\n        name: newData.name || '',\n        name_en: newData.name_en || '',\n        gender: newData.gender || '',\n        birth_date: newData.birth_date || '',\n        phone: newData.phone || '',\n        email: newData.email || '',\n        location: newData.location || '',\n        location_en: newData.location_en || '',\n        summary: newData.summary || '',\n        summary_en: newData.summary_en || '',\n        avatar: newData.avatar || '',\n        background: newData.background || '',\n        basic_info: newData.basic_info || {}\n      }\n    }\n  },\n  { immediate: true, deep: true }\n)\n\n// 6. 生命周期钩子\nonMounted(async () => {\n  try {\n    await store.dispatch('fetchCompleteness')\n  } catch (error) {\n    console.error('Failed to fetch completeness:', error)\n  }\n})\n\n// 7. 方法定义\nconst handleFileChange = async (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n\n  // 验证文件\n  if (!validateFile(file)) {\n    return\n  }\n\n  await handleAvatarUpload(file)\n  \n  // 清空文件选择器，以便能够选择同一个文件\n  event.target.value = ''\n}\n\nconst handleEdit = () => {\n  console.log('\\n=== 打开编辑对话框 ===')\n  console.log('当前数据:', props.resumeData)\n  console.log('当前语言:', props.language)\n  showEditDialog.value = true\n}\n\nconst toggleBioExpand = () => {\n  emit('toggleBioExpand')\n}\n\n// 8. 工具函数\nconst calculateAge = (birthDate) => {\n  if (!birthDate) return null\n  \n  try {\n    const birth = new Date(birthDate)\n    const today = new Date()\n    \n    let age = today.getFullYear() - birth.getFullYear()\n    const monthDiff = today.getMonth() - birth.getMonth()\n    \n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n      age--\n    }\n    \n    return age\n  } catch (error) {\n    console.error('计算年龄出错:', error)\n    return null\n  }\n}\n\nconst formatGender = (gender) => {\n  if (!gender) return props.language === 'en' ? 'Not Set' : '未设置'\n  \n  const genderMap = {\n    'zh-Hans': {\n      male: '男',\n      female: '女',\n      other: '其他'\n    },\n    'en': {\n      male: 'Male',\n      female: 'Female',\n      other: 'Other'\n    }\n  }\n  \n  // 标准化语言代码\n  const lang = props.language === 'en' ? 'en' : 'zh-Hans'\n  \n  // 如果没有对应的翻译，返回原值\n  return genderMap[lang]?.[gender] || gender\n}\n\nconst formatDate = (dateString) => {\n  if (!dateString) return ''\n  const date = new Date(dateString)\n  return date.toLocaleDateString('zh-CN', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  })\n}\n\n// 调试辅助函数\nconst logResumeData = () => {\n  const plainData = {\n    name: props.resumeData.name,\n    gender: props.resumeData.gender,\n    phone: props.resumeData.phone,\n    email: props.resumeData.email,\n    location: props.resumeData.location,\n    birth_date: props.resumeData.birth_date,\n    summary: props.resumeData.summary,\n    created_at: props.resumeData.created_at,\n    updated_at: props.resumeData.updated_at\n  }\n  console.log('BasicInfo data:', plainData)\n}\n\n// 添加头像上传处理函数\nconst handleAvatarUpload = async (file) => {\n  try {\n    await withLoading(async () => {\n      const formData = new FormData()\n      formData.append('avatar', file)\n      \n      const response = await profile.uploadAvatar(formData)\n      if (response.data?.code === 200) {\n        showToast('头像上传成功', 'success')\n        emit('update')\n        const avatarUrl = response.data.data.avatar\n        eventBus.emit('avatar-updated', avatarUrl)\n        if (props.resumeData) {\n          props.resumeData.avatar = avatarUrl\n        }\n        showAvatarUpload.value = false // 关闭弹窗\n      } else {\n        throw new Error(response.data?.message || '上传失败')\n      }\n    })\n  } catch (error) {\n    console.error('头像上传失败:', error)\n    showToast(error.message || '头像上传失败，请稍后重试', 'error')\n  }\n}\n\n// 添加触发文件选择的方法\nconst triggerUpload = () => {\n  showAvatarUpload.value = true\n}\n\n// 添加图片加载错误处理\nconst handleImageError = (e) => {\n  e.target.src = defaultAvatarImage\n}\n\n// 添加文件验证\nconst validateFile = (file) => {\n  // 验证文件类型\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return false\n  }\n\n  // 验证文件大小（例如限制为 2MB）\n  const maxSize = 2 * 1024 * 1024 // 2MB\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过 2MB', 'error')\n    return false\n  }\n\n  return true\n}\n\n// 背景图相关\nconst backgroundInput = ref(null)\nconst backgroundUrl = computed(() => {\n  const background = props.resumeData?.background\n  if (!background) return defaultBackground\n  \n  if (background.startsWith('http') || background.startsWith('data:')) {\n    return background\n  }\n  \n  return `${MEDIA_URL}${background}`\n})\n\nconst triggerBackgroundUpload = () => {\n  backgroundInput.value.click()\n}\n\nconst handleBackgroundChange = async (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n  \n  // 验证文件\n  if (!validateFile(file)) {\n    return\n  }\n  \n  const formData = new FormData()\n  formData.append('background', file)\n  \n  try {\n    await withLoading(async () => {\n      await store.dispatch('updateBackground', formData)\n      emit('update')\n      showToast('背景图更新成功', 'success')\n    })\n  } catch (error) {\n    console.error('Failed to update background:', error)\n    showToast('背景图更新失败', 'error')\n  } finally {\n    // 清空文件选择器\n    event.target.value = ''\n  }\n}\n\nconst handleBackgroundError = (e) => {\n  e.target.src = defaultBackground\n}\n\n// 添加状态\nconst showAvatarUpload = ref(false)\n\n// 添加语言切换方法\nconst toggleLanguage = () => {\n  const newLang = props.language === 'zh-Hans' ? 'en' : 'zh-Hans'\n  emit('language-change', newLang)\n}\n\nconst { loading, withLoading } = useLoading()\nconst showEditDialog = ref(false)\n\n// 处理提交\nconst handleSubmit = async (data) => {\n  try {\n    await withLoading(async () => {\n      const result = await updateBasicInfo(data, props.language)\n      if (result.code === 200) {\n        emit('update') // 触发父组件更新数据\n        showEditDialog.value = false\n        ElMessage.success(props.language === 'en' ? 'Saved successfully' : '保存成功')\n      } else {\n        throw new Error(result.message || '保存失败')\n      }\n    })\n  } catch (error) {\n    console.error('保存失败:', error)\n    ElMessage.error(error.message || (props.language === 'en' ? 'Save failed' : '保存失败'))\n  }\n}\n\n// 添加显示用的计算属性\nconst displayInfo = computed(() => {\n  const isEn = props.language === 'en'\n  const info = basicInfo.value\n  const age = calculateAge(info.birth_date)\n  \n  return {\n    name: isEn \n      ? (info.name_en || info.name || 'Not Set')\n      : (info.name || info.name_en || '未填写'),\n    gender: formatGender(info.gender),\n    phone: info.phone || (isEn ? 'Not Set' : '未填写'),\n    email: info.email || (isEn ? 'Not Set' : '未填写'),\n    location: isEn\n      ? (info.location_en || info.location || 'Not Set')\n      : (info.location || info.location_en || '未填写'),\n    age: age ? (isEn ? `${age} years old` : `${age}岁`) : (isEn ? 'Not Set' : '未填写'),\n    summary: isEn\n      ? (info.summary_en || info.summary || '')\n      : (info.summary || info.summary_en || '')\n  }\n})\n</script>\n\n<style scoped>\n/* 移除之前的语言切换按钮特效样式 */\n/* 保留其他必要的样式 */\n.line-clamp-3 {\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  position: relative;\n}\n\n.line-clamp-3::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 20px;\n  background: linear-gradient(to bottom, transparent, rgba(249, 250, 251, 0.9));\n  pointer-events: none;\n}\n\n.break-words {\n  word-wrap: break-word;\n  word-break: break-word;\n  overflow-wrap: break-word;\n  max-width: 100%;\n  display: inline-block;\n}\n\n/* 确保背景图片覆盖整个区域 */\n.h-48 {\n  min-height: 12rem;\n}\n\n/* 优化背景图加载时的过渡效果 */\nimg {\n  transition: opacity 0.3s ease;\n}\n\nimg[src=\"\"] {\n  opacity: 0;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}