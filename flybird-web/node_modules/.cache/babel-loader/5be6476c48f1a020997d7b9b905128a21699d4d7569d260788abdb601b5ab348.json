{"ast":null,"code":"import { createCommentVNode as _createCommentVNode } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _createCommentVNode(\" No changes to template section \");\n}","map":{"version":3,"names":["_createCommentVNode"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/components/UserHome.vue"],"sourcesContent":["<template>\n  <!-- No changes to template section -->\n</template>\n\n<script setup>\nimport { ref, onMounted, computed, watch, nextTick } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport { useAccountStore } from '@/stores/account'\nimport config from '@/config'\nimport defaultAvatarImage from '@/assets/images/default-avatar.png'\nimport defaultBackground from '@/assets/images/default-background.jpg'\nimport { showToast } from '@/components/ToastMessage'\nimport {\n  CameraIcon,        // 用于头像和背景上传\n  PhotoIcon,         // 作品集图标\n  PencilSquareIcon,  // 编辑图标\n  TrophyIcon,        // 会员图标\n  SparklesIcon,      // 升级会员图标\n  PencilIcon,        // 编辑昵称图标\n  ChevronRightIcon,  // 箭头图标\n  PlusIcon,          // 添加图标\n  TrashIcon,         // 删除图标\n  ChatBubbleLeftRightIcon,  // 话题图标\n  QuestionMarkCircleIcon,   // 问答图标\n  InboxArrowDownIcon,       // 草稿箱图标\n  EyeIcon,                  // 查看图标\n  BookmarkIcon,            // 收藏图标\n  ArrowTopRightOnSquareIcon, // 外链图标\n  GlobeAltIcon,            // 个人主页图标\n  XMarkIcon               // 关闭图标\n} from '@heroicons/vue/24/outline'\nimport { user } from '@/api/user'\nimport { eventBus } from '@/utils/eventBus'\n\nconst router = useRouter()\nconst route = useRoute()\nconst accountStore = useAccountStore()\nconst showEditModal = ref(false)\nconst editForm = ref({\n  username: '',\n  position: '',\n  bio: '',\n  avatar: null\n})\nconst avatarInput = ref(null)\nconst usernameError = ref('')\nconst creationSection = ref(null)\n\n// 使用 getters 获取用户信息\nconst userInfo = computed(() => ({\n  uid: accountStore.uid,\n  username: accountStore.username,\n  avatar: accountStore.avatar,\n  background: accountStore.background,\n  bio: accountStore.bio || null,\n  position: accountStore.position || null\n}))\n\n// 添加背景图 URL 的计算属性\nconst backgroundUrl = computed(() => {\n  const bgImage = userInfo.value?.background\n  return bgImage ? formatImageUrl(bgImage) : defaultBackground\n})\n\n// 格式化图片 URL\nconst formatImageUrl = (url) => {\n  if (!url || url === 'null') return defaultAvatarImage\n  return url.startsWith('http') ? url : `${process.env.VUE_APP_API_BASE_URL}${url}`\n}\n\n// 计算头像 URL\nconst userAvatar = computed(() => {\n  return formatImageUrl(userInfo.value?.avatar)\n})\n\n// 在编辑弹窗中显示头像\nconst editAvatarUrl = computed(() => {\n  return formatImageUrl(editForm.value.avatar || userInfo.value?.avatar)\n})\n\n// 获取用户信息\nconst fetchUserInfo = async () => {\n  try {\n    // 只在需要更新时请求接口\n    if (!accountStore.userInfo) {\n      await accountStore.fetchUserInfo()\n    }\n    \n    // 获取统计数据\n    const stats = {\n      following_count: 0,\n      followers_count: 0,\n      likes_count: 0,\n      views_count: 0\n    }\n    \n    statistics.value = [\n      { label: '关注', value: stats.following_count || '0' },\n      { label: '粉丝', value: stats.followers_count || '0' },\n      { label: '点赞', value: stats.likes_count || '0' },\n      { label: '访问', value: stats.views_count || '0' }\n    ]\n  } catch (error) {\n    console.error('获取用户信息失败:', error)\n  }\n}\n\n// 滚动到创作区域\nconst scrollToCreation = () => {\n  if (creationSection.value) {\n    const offset = 100 // 可以根据需要调整这个值\n    const elementPosition = creationSection.value.getBoundingClientRect().top\n    const offsetPosition = elementPosition + window.pageYOffset - offset\n    \n    window.scrollTo({\n      top: offsetPosition,\n      behavior: 'smooth'\n    })\n  }\n}\n\n// 监听路由参数变化\nwatch(\n  () => route.query.currentTab,\n  (newTab) => {\n    if (newTab === 'articles' || newTab === 'drafts') {\n      // 等待 DOM 更新后滚动\n      nextTick(() => {\n        scrollToCreation()\n      })\n    }\n  },\n  { immediate: true }\n)\n\n// 组件挂载时获取数据\nonMounted(async () => {\n  // 只在 store 中没有数据时获取\n  if (!accountStore.userInfo) {\n    await fetchUserInfo()\n  }\n  \n  // 如果当前是文章或草稿标签，滚动到创作区域\n  if (route.query.currentTab === 'articles' || route.query.currentTab === 'drafts') {\n    scrollToCreation()\n  }\n})\n\n// 头像上传相关\nconst showAvatarUpload = ref(false)\nconst loading = ref(false)\n\n// 处理头像错误\nconst handleImageError = (e) => {\n  e.target.src = defaultAvatarImage\n}\n\n// 处理背景图错误\nconst handleBackgroundError = (e) => {\n  e.target.src = defaultBackground\n}\n\nconst handleProfileUpdate = async () => {\n  if (!validateUsername()) return\n  \n  // 验证表单数据\n  if (!editForm.value.username.trim()) {\n    showToast('用户名不能为空', 'error')\n    return\n  }\n\n  try {\n    loading.value = true\n    // 准备更新数据\n    const updateData = {\n      username: editForm.value.username.trim(),\n      position: editForm.value.position?.trim() || '',\n      bio: editForm.value.bio?.trim() || ''\n    }\n    \n    console.log('Submitting update:', updateData)\n      \n    // 更新所有用户信息\n    await accountStore.updateUserInfo(updateData)\n    showToast('更新成功', 'success')\n    closeEditModal()\n  } catch (error) {\n    console.error('更新失败:', error)\n    if (error.response) {\n      console.error('Error details:', error.response.data)\n    }\n    showToast(error.message || '更新失败，请稍后重试', 'error')\n  } finally {\n    loading.value = false\n  }\n}\n\n// 昵称修改相关方法\nconst openEditModal = () => {\n  editForm.value = {\n    username: accountStore.username || '',\n    position: accountStore.position || '',\n    bio: accountStore.bio || '',\n    avatar: accountStore.avatar || null\n  }\n  showEditModal.value = true\n}\n\nconst closeEditModal = () => {\n  showEditModal.value = false\n  editForm.value = {\n    username: '',\n    position: '',\n    bio: ''\n  }\n  usernameError.value = ''\n}\n\n// 实时验证用户名\nconst validateUsername = () => {\n  const value = editForm.value.username\n  if (!value) {\n    usernameError.value = '用户名不能为空'\n  } else if (value.length < 4 || value.length > 8) {\n    usernameError.value = '用户名长度必须在4-8个字符之间'\n  } else if (!/^[\\u4e00-\\u9fa5a-zA-Z0-9]+$/.test(value)) {\n    usernameError.value = '用户名只能包含中文、英文字母和数字'\n  } else {\n    usernameError.value = ''\n  }\n  return !usernameError.value\n}\n\nconst handleAvatarChange = async (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n  \n  // 验证文件\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return\n  }\n  \n  const maxSize = 2 * 1024 * 1024 // 2MB\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过2MB', 'error')\n    return\n  }\n  \n  try {\n    loading.value = true\n    const formData = new FormData()\n    formData.append('avatar', file)\n    \n    // 使用 accountStore 更新头像\n    await accountStore.updateAvatar(formData)\n    editForm.value.avatar = accountStore.avatar\n    showToast('头像上传成功', 'success')\n  } catch (error) {\n    console.error('头像上传失败:', error)\n    showToast(error.message || '头像上传失败，请稍后重试', 'error')\n  } finally {\n    loading.value = false\n    // 清空文件选择器\n    event.target.value = ''\n  }\n}\n\n// 格式化存储空间大小\nconst formatStorage = (bytes) => {\n  if (!bytes) return '0 B'\n  const k = 1024\n  const sizes = ['B', 'KB', 'MB', 'GB', 'TB']\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`\n}\n\n// 存储空间使用数据\nconst storageUsed = ref(0)  // 字节数\nconst storageUsedPercent = computed(() => {\n  const maxStorage = 10 * 1024 * 1024 * 1024 // 10GB in bytes\n  return Math.round((storageUsed.value / maxStorage) * 100)\n})\n\n// 统计数据\nconst statistics = ref([\n  { label: '关注', value: '0' },\n  { label: '粉丝', value: '0' },\n  { label: '点赞', value: '0' },\n  { label: '访问', value: '0' }\n])\n\n// 内容相关数据\nconst currentTab = ref(route.query.currentTab || 'articles')\nconst articles = ref([])\nconst portfolios = ref([])\n\n// 收藏相关数据\nconst currentFavTab = ref('portfolios')\nconst favoritesTabs = [\n  { key: 'portfolios', label: '作品集' },\n  { key: 'articles', label: '文章' },\n  { key: 'topics', label: '话题' }\n]\n\n// 内容标签\nconst contentTabs = [\n  { key: 'articles', label: '文章', count: 0 },\n  { key: 'topics', label: '话题', count: 0 },\n  { key: 'qa', label: '问答', count: 0 },\n  { key: 'drafts', label: '草稿箱', count: 0 }\n]\n\n// 获取当前收藏标签的标签文本\nconst getCurrentFavTabLabel = () => {\n  const tab = favoritesTabs.find(tab => tab.key === currentFavTab.value)\n  return tab ? tab.label : ''\n}\n\n// 获取收藏探索路由\nconst getFavoritesExploreRoute = () => {\n  const routes = {\n    portfolios: '/explore/portfolios',\n    articles: '/explore/articles',\n    topics: '/explore/topics'\n  }\n  return routes[currentFavTab.value] || '/explore'\n}\n\n// 处理图片错误\nconst handlePortfolioImageError = (e) => {\n  e.target.src = defaultAvatarImage\n}\n\nconst handleArticleImageError = (e) => {\n  e.target.src = defaultAvatarImage\n}\n\n// 格式化日期\nconst formatDate = (date) => {\n  if (!date) return ''\n  return new Date(date).toLocaleDateString('zh-CN', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  })\n}\n\n// 处理背景图上传\nconst handleBackgroundUpload = async () => {\n  const input = document.createElement('input')\n  input.type = 'file'\n  input.accept = 'image/*'\n  \n  input.onchange = async (e) => {\n    const file = e.target.files[0]\n    if (!file) return\n    \n    try {\n      loading.value = true\n      const formData = new FormData()\n      formData.append('background', file)\n      \n      await accountStore.updateBackground(formData)\n      showToast('背景图上传成功', 'success')\n    } catch (error) {\n      console.error('背景图上传失败:', error)\n      showToast(error.message || '背景图上传失败，请稍后重试', 'error')\n    } finally {\n      loading.value = false\n      input.value = ''\n    }\n  }\n  \n  input.click()\n}\n\n// 用户主页链接\nconst userProfileUrl = computed(() => {\n  return `/u/${userInfo.value.uid}`\n})\n\n// 监听路由参数变化，更新当前标签页\nwatch(\n  () => route.query.currentTab,\n  (newTab) => {\n    if (newTab) {\n      currentTab.value = newTab\n    }\n  }\n)\n\n// 处理头像选择\nconst handleAvatarSelect = () => {\n  avatarInput.value?.click()\n}\n</script>\n\n<style scoped>\n/* No changes to style section */\n</style> "],"mappings":";;SACEA,mBAAA,oCAAuC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}