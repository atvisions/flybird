{"ast":null,"code":"import { defineStore } from 'pinia';\nimport profile from '@/api/profile';\nimport { ref, computed } from 'vue';\nexport const useProfileStore = defineStore('profile', () => {\n  const basicInfo = ref(null);\n  const avatarUpdateTime = ref(null);\n  const profileAvatar = computed(() => {\n    const url = basicInfo.value?.avatar;\n    return url ? `${import.meta.env.VITE_API_URL}${url}` : null;\n  });\n\n  // 获取档案基本信息\n  async function fetchBasicInfo() {\n    try {\n      const response = await profile.getData();\n      if (response?.data?.code === 200 && response?.data?.data?.basic_info) {\n        basicInfo.value = response.data.data.basic_info;\n        avatarUpdateTime.value = Date.now();\n        return basicInfo.value;\n      }\n      return null;\n    } catch (error) {\n      console.error('获取档案基本信息失败:', error);\n      throw error;\n    }\n  }\n\n  // 更新头像\n  async function updateAvatar(formData) {\n    try {\n      const response = await profile.uploadAvatar(formData);\n      if (response?.data?.code === 200) {\n        // 直接更新头像\n        if (basicInfo.value) {\n          basicInfo.value.avatar = response.data.data.avatar;\n          avatarUpdateTime.value = Date.now();\n        }\n        return response;\n      }\n      throw new Error('上传失败');\n    } catch (error) {\n      throw error;\n    }\n  }\n  return {\n    basicInfo,\n    avatarUpdateTime,\n    profileAvatar,\n    updateAvatar,\n    fetchBasicInfo\n  };\n});","map":{"version":3,"names":["defineStore","profile","ref","computed","useProfileStore","basicInfo","avatarUpdateTime","profileAvatar","url","value","avatar","import","meta","env","VITE_API_URL","fetchBasicInfo","response","getData","data","code","basic_info","Date","now","error","console","updateAvatar","formData","uploadAvatar","Error"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/profile.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport profile from '@/api/profile'\nimport { ref, computed } from 'vue'\n\nexport const useProfileStore = defineStore('profile', () => {\n  const basicInfo = ref(null)\n  const avatarUpdateTime = ref(null)\n\n  const profileAvatar = computed(() => {\n    const url = basicInfo.value?.avatar\n    return url ? `${import.meta.env.VITE_API_URL}${url}` : null\n  })\n\n  // 获取档案基本信息\n  async function fetchBasicInfo() {\n    try {\n      const response = await profile.getData()\n      if (response?.data?.code === 200 && response?.data?.data?.basic_info) {\n        basicInfo.value = response.data.data.basic_info\n        avatarUpdateTime.value = Date.now()\n        return basicInfo.value\n      }\n      return null\n    } catch (error) {\n      console.error('获取档案基本信息失败:', error)\n      throw error\n    }\n  }\n\n  // 更新头像\n  async function updateAvatar(formData) {\n    try {\n      const response = await profile.uploadAvatar(formData)\n      if (response?.data?.code === 200) {\n        // 直接更新头像\n        if (basicInfo.value) {\n          basicInfo.value.avatar = response.data.data.avatar\n          avatarUpdateTime.value = Date.now()\n        }\n        return response\n      }\n      throw new Error('上传失败')\n    } catch (error) {\n      throw error\n    }\n  }\n\n  return {\n    basicInfo,\n    avatarUpdateTime,\n    profileAvatar,\n    updateAvatar,\n    fetchBasicInfo\n  }\n}) "],"mappings":"AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,OAAOC,OAAO,MAAM,eAAe;AACnC,SAASC,GAAG,EAAEC,QAAQ,QAAQ,KAAK;AAEnC,OAAO,MAAMC,eAAe,GAAGJ,WAAW,CAAC,SAAS,EAAE,MAAM;EAC1D,MAAMK,SAAS,GAAGH,GAAG,CAAC,IAAI,CAAC;EAC3B,MAAMI,gBAAgB,GAAGJ,GAAG,CAAC,IAAI,CAAC;EAElC,MAAMK,aAAa,GAAGJ,QAAQ,CAAC,MAAM;IACnC,MAAMK,GAAG,GAAGH,SAAS,CAACI,KAAK,EAAEC,MAAM;IACnC,OAAOF,GAAG,GAAG,GAAGG,MAAM,CAACC,IAAI,CAACC,GAAG,CAACC,YAAY,GAAGN,GAAG,EAAE,GAAG,IAAI;EAC7D,CAAC,CAAC;;EAEF;EACA,eAAeO,cAAcA,CAAA,EAAG;IAC9B,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAMf,OAAO,CAACgB,OAAO,CAAC,CAAC;MACxC,IAAID,QAAQ,EAAEE,IAAI,EAAEC,IAAI,KAAK,GAAG,IAAIH,QAAQ,EAAEE,IAAI,EAAEA,IAAI,EAAEE,UAAU,EAAE;QACpEf,SAAS,CAACI,KAAK,GAAGO,QAAQ,CAACE,IAAI,CAACA,IAAI,CAACE,UAAU;QAC/Cd,gBAAgB,CAACG,KAAK,GAAGY,IAAI,CAACC,GAAG,CAAC,CAAC;QACnC,OAAOjB,SAAS,CAACI,KAAK;MACxB;MACA,OAAO,IAAI;IACb,CAAC,CAAC,OAAOc,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,aAAa,EAAEA,KAAK,CAAC;MACnC,MAAMA,KAAK;IACb;EACF;;EAEA;EACA,eAAeE,YAAYA,CAACC,QAAQ,EAAE;IACpC,IAAI;MACF,MAAMV,QAAQ,GAAG,MAAMf,OAAO,CAAC0B,YAAY,CAACD,QAAQ,CAAC;MACrD,IAAIV,QAAQ,EAAEE,IAAI,EAAEC,IAAI,KAAK,GAAG,EAAE;QAChC;QACA,IAAId,SAAS,CAACI,KAAK,EAAE;UACnBJ,SAAS,CAACI,KAAK,CAACC,MAAM,GAAGM,QAAQ,CAACE,IAAI,CAACA,IAAI,CAACR,MAAM;UAClDJ,gBAAgB,CAACG,KAAK,GAAGY,IAAI,CAACC,GAAG,CAAC,CAAC;QACrC;QACA,OAAON,QAAQ;MACjB;MACA,MAAM,IAAIY,KAAK,CAAC,MAAM,CAAC;IACzB,CAAC,CAAC,OAAOL,KAAK,EAAE;MACd,MAAMA,KAAK;IACb;EACF;EAEA,OAAO;IACLlB,SAAS;IACTC,gBAAgB;IAChBC,aAAa;IACbkB,YAAY;IACZV;EACF,CAAC;AACH,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}