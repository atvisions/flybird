{"ast":null,"code":"import { ref, onMounted, computed } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport { useStore } from 'vuex';\nimport { useNickname } from '@/composables/useNickname';\nimport { MEDIA_URL } from '@/config';\nimport defaultAvatarImage from '@/assets/images/default-avatar.png';\nimport defaultBackground from '@/assets/images/default-background.jpg';\nimport { showToast } from '@/components/ToastMessage';\nimport { UserIcon, UserCircleIcon, DocumentTextIcon, BriefcaseIcon, StarIcon, CameraIcon, PhotoIcon, FolderIcon, Cog6ToothIcon, IdentificationIcon, HomeIcon, MapPinIcon, QuoteIcon, PencilSquareIcon, CrownIcon, PhoneIcon, EnvelopeIcon, SparklesIcon, PencilIcon, DocumentIcon, ChevronRightIcon, PlusIcon, TrashIcon, ChatBubbleLeftRightIcon, QuestionMarkCircleIcon, InboxArrowDownIcon, EyeIcon, BookmarkIcon, ArrowTopRightOnSquareIcon, GlobeAltIcon } from '@heroicons/vue/24/outline';\nimport profile from '@/api/profile';\nimport { eventBus } from '@/utils/eventBus';\nimport EditBasicDialog from '../dialogs/EditBasicDialog.vue';\nimport AvatarUploadDialog from '../dialogs/AvatarUploadDialog.vue';\nexport default {\n  __name: 'UserHome',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const store = useStore();\n    const nickname = useNickname();\n\n    // 用户信息的计算属性\n    const userInfo = computed(() => {\n      return {\n        uid: store.state.userInfo?.data?.user?.uid,\n        nickname: store.state.userInfo?.data?.user?.username,\n        avatar: store.state.userInfo?.data?.user?.avatar,\n        isVip: store.state.userInfo?.data?.user?.is_vip,\n        coverImage: store.state.userInfo?.data?.user?.cover_image\n        // ... 其他需要的用户信息\n      };\n    });\n\n    // 格式化头像 URL\n    const formatImageUrl = url => {\n      if (!url) return defaultAvatarImage;\n      return url.startsWith('http') ? url : `${MEDIA_URL}${url}`;\n    };\n\n    // 计算头像 URL\n    const userAvatar = computed(() => {\n      return formatImageUrl(userInfo.value?.avatar);\n    });\n\n    // 获取用户信息\n    const fetchUserInfo = async () => {\n      try {\n        const response = await profile.getProfile();\n        if (response.data?.code === 200) {\n          store.commit('SET_USER_INFO', response.data);\n        }\n      } catch (error) {\n        console.error('获取用户信息失败:', error);\n      }\n    };\n\n    // 组件挂载时获取数据\n    onMounted(async () => {\n      await fetchUserInfo();\n    });\n\n    // 头像上传相关\n    const showAvatarUpload = ref(false);\n    const loading = ref(false);\n\n    // 处理头像错误\n    const handleImageError = e => {\n      e.target.src = defaultAvatarImage;\n    };\n\n    // 处理背景图错误\n    const handleBackgroundError = e => {\n      e.target.src = defaultBackground;\n    };\n    const handleNicknameUpdate = async () => {\n      const success = await nickname.handleUpdate();\n      if (success) {\n        closeNicknameModal();\n        // 重新获取用户信息\n        const response = await profile.getProfile();\n        if (response.data?.code === 200) {\n          store.commit('SET_USER_INFO', response.data);\n        }\n        // 触发全局事件，通知其他组件更新\n        eventBus.emit('user-info-updated');\n      }\n    };\n\n    // 实时验证昵称\n    const validateNickname = () => {\n      nickname.state.error = nickname.validateNickname(nickname.state.value);\n    };\n    const openNicknameModal = () => {\n      nickname.state.value = store.state.userInfo?.data?.user?.username || '';\n      showNicknameModal.value = true;\n    };\n    const handleAvatarUpload = async file => {\n      try {\n        loading.value = true;\n        const formData = new FormData();\n        formData.append('avatar', file);\n        const response = await profile.uploadAvatar(formData);\n        if (response.data?.code === 200) {\n          showToast('头像上传成功', 'success');\n          // 重新获取用户信息以更新头像\n          const profileResponse = await profile.getProfile();\n          if (profileResponse.data?.code === 200) {\n            store.commit('SET_USER_INFO', profileResponse.data);\n          }\n          showAvatarUpload.value = false;\n        } else {\n          throw new Error(response.data?.message || '上传失败');\n        }\n      } catch (error) {\n        console.error('头像上传失败:', error);\n        showToast(error.message || '头像上传失败，请稍后重试', 'error');\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // No changes to rest of the script section\n\n    const __returned__ = {\n      router,\n      store,\n      nickname,\n      userInfo,\n      formatImageUrl,\n      userAvatar,\n      fetchUserInfo,\n      showAvatarUpload,\n      loading,\n      handleImageError,\n      handleBackgroundError,\n      handleNicknameUpdate,\n      validateNickname,\n      openNicknameModal,\n      handleAvatarUpload,\n      ref,\n      onMounted,\n      computed,\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get useStore() {\n        return useStore;\n      },\n      get useNickname() {\n        return useNickname;\n      },\n      get MEDIA_URL() {\n        return MEDIA_URL;\n      },\n      get defaultAvatarImage() {\n        return defaultAvatarImage;\n      },\n      get defaultBackground() {\n        return defaultBackground;\n      },\n      get showToast() {\n        return showToast;\n      },\n      get UserIcon() {\n        return UserIcon;\n      },\n      get UserCircleIcon() {\n        return UserCircleIcon;\n      },\n      get DocumentTextIcon() {\n        return DocumentTextIcon;\n      },\n      get BriefcaseIcon() {\n        return BriefcaseIcon;\n      },\n      get StarIcon() {\n        return StarIcon;\n      },\n      get CameraIcon() {\n        return CameraIcon;\n      },\n      get PhotoIcon() {\n        return PhotoIcon;\n      },\n      get FolderIcon() {\n        return FolderIcon;\n      },\n      get Cog6ToothIcon() {\n        return Cog6ToothIcon;\n      },\n      get IdentificationIcon() {\n        return IdentificationIcon;\n      },\n      get HomeIcon() {\n        return HomeIcon;\n      },\n      get MapPinIcon() {\n        return MapPinIcon;\n      },\n      get QuoteIcon() {\n        return QuoteIcon;\n      },\n      get PencilSquareIcon() {\n        return PencilSquareIcon;\n      },\n      get CrownIcon() {\n        return CrownIcon;\n      },\n      get PhoneIcon() {\n        return PhoneIcon;\n      },\n      get EnvelopeIcon() {\n        return EnvelopeIcon;\n      },\n      get SparklesIcon() {\n        return SparklesIcon;\n      },\n      get PencilIcon() {\n        return PencilIcon;\n      },\n      get DocumentIcon() {\n        return DocumentIcon;\n      },\n      get ChevronRightIcon() {\n        return ChevronRightIcon;\n      },\n      get PlusIcon() {\n        return PlusIcon;\n      },\n      get TrashIcon() {\n        return TrashIcon;\n      },\n      get ChatBubbleLeftRightIcon() {\n        return ChatBubbleLeftRightIcon;\n      },\n      get QuestionMarkCircleIcon() {\n        return QuestionMarkCircleIcon;\n      },\n      get InboxArrowDownIcon() {\n        return InboxArrowDownIcon;\n      },\n      get EyeIcon() {\n        return EyeIcon;\n      },\n      get BookmarkIcon() {\n        return BookmarkIcon;\n      },\n      get ArrowTopRightOnSquareIcon() {\n        return ArrowTopRightOnSquareIcon;\n      },\n      get GlobeAltIcon() {\n        return GlobeAltIcon;\n      },\n      get profile() {\n        return profile;\n      },\n      get eventBus() {\n        return eventBus;\n      },\n      EditBasicDialog,\n      AvatarUploadDialog\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","useRouter","ElMessage","useStore","useNickname","MEDIA_URL","defaultAvatarImage","defaultBackground","showToast","UserIcon","UserCircleIcon","DocumentTextIcon","BriefcaseIcon","StarIcon","CameraIcon","PhotoIcon","FolderIcon","Cog6ToothIcon","IdentificationIcon","HomeIcon","MapPinIcon","QuoteIcon","PencilSquareIcon","CrownIcon","PhoneIcon","EnvelopeIcon","SparklesIcon","PencilIcon","DocumentIcon","ChevronRightIcon","PlusIcon","TrashIcon","ChatBubbleLeftRightIcon","QuestionMarkCircleIcon","InboxArrowDownIcon","EyeIcon","BookmarkIcon","ArrowTopRightOnSquareIcon","GlobeAltIcon","profile","eventBus","EditBasicDialog","AvatarUploadDialog","router","store","nickname","userInfo","uid","state","data","user","username","avatar","isVip","is_vip","coverImage","cover_image","formatImageUrl","url","startsWith","userAvatar","value","fetchUserInfo","response","getProfile","code","commit","error","console","showAvatarUpload","loading","handleImageError","e","target","src","handleBackgroundError","handleNicknameUpdate","success","handleUpdate","closeNicknameModal","emit","validateNickname","openNicknameModal","showNicknameModal","handleAvatarUpload","file","formData","FormData","append","uploadAvatar","profileResponse","Error","message"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/components/UserHome.vue"],"sourcesContent":["<template>\n  <!-- No changes to template section -->\n</template>\n\n<script setup>\nimport { ref, onMounted, computed } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport { useStore } from 'vuex'\nimport { useNickname } from '@/composables/useNickname'\nimport { MEDIA_URL } from '@/config'\nimport defaultAvatarImage from '@/assets/images/default-avatar.png'\nimport defaultBackground from '@/assets/images/default-background.jpg'\nimport { showToast } from '@/components/ToastMessage'\nimport {\n  UserIcon,\n  UserCircleIcon,\n  DocumentTextIcon,\n  BriefcaseIcon,\n  StarIcon,\n  CameraIcon,\n  PhotoIcon,\n  FolderIcon,\n  Cog6ToothIcon,\n  IdentificationIcon,\n  HomeIcon,\n  MapPinIcon,\n  QuoteIcon,\n  PencilSquareIcon,\n  CrownIcon,\n  PhoneIcon,\n  EnvelopeIcon,\n  SparklesIcon,\n  PencilIcon,\n  DocumentIcon,\n  ChevronRightIcon,\n  PlusIcon,\n  TrashIcon,\n  ChatBubbleLeftRightIcon,\n  QuestionMarkCircleIcon,\n  InboxArrowDownIcon,\n  EyeIcon,\n  BookmarkIcon,\n  ArrowTopRightOnSquareIcon,\n  GlobeAltIcon\n} from '@heroicons/vue/24/outline'\nimport profile from '@/api/profile'\nimport { eventBus } from '@/utils/eventBus'\nimport EditBasicDialog from '../dialogs/EditBasicDialog.vue'\nimport AvatarUploadDialog from '../dialogs/AvatarUploadDialog.vue'\n\nconst router = useRouter()\nconst store = useStore()\nconst nickname = useNickname()\n\n// 用户信息的计算属性\nconst userInfo = computed(() => {\n  return {\n    uid: store.state.userInfo?.data?.user?.uid,\n    nickname: store.state.userInfo?.data?.user?.username,\n    avatar: store.state.userInfo?.data?.user?.avatar,\n    isVip: store.state.userInfo?.data?.user?.is_vip,\n    coverImage: store.state.userInfo?.data?.user?.cover_image,\n    // ... 其他需要的用户信息\n  }\n})\n\n// 格式化头像 URL\nconst formatImageUrl = (url) => {\n  if (!url) return defaultAvatarImage\n  return url.startsWith('http') ? url : `${MEDIA_URL}${url}`\n}\n\n// 计算头像 URL\nconst userAvatar = computed(() => {\n  return formatImageUrl(userInfo.value?.avatar)\n})\n\n// 获取用户信息\nconst fetchUserInfo = async () => {\n  try {\n    const response = await profile.getProfile()\n    if (response.data?.code === 200) {\n      store.commit('SET_USER_INFO', response.data)\n    }\n  } catch (error) {\n    console.error('获取用户信息失败:', error)\n  }\n}\n\n// 组件挂载时获取数据\nonMounted(async () => {\n  await fetchUserInfo()\n})\n\n// 头像上传相关\nconst showAvatarUpload = ref(false)\nconst loading = ref(false)\n\n// 处理头像错误\nconst handleImageError = (e) => {\n  e.target.src = defaultAvatarImage\n}\n\n// 处理背景图错误\nconst handleBackgroundError = (e) => {\n  e.target.src = defaultBackground\n}\n\nconst handleNicknameUpdate = async () => {\n  const success = await nickname.handleUpdate()\n  if (success) {\n    closeNicknameModal()\n    // 重新获取用户信息\n    const response = await profile.getProfile()\n    if (response.data?.code === 200) {\n      store.commit('SET_USER_INFO', response.data)\n    }\n    // 触发全局事件，通知其他组件更新\n    eventBus.emit('user-info-updated')\n  }\n}\n\n// 实时验证昵称\nconst validateNickname = () => {\n  nickname.state.error = nickname.validateNickname(nickname.state.value)\n}\n\nconst openNicknameModal = () => {\n  nickname.state.value = store.state.userInfo?.data?.user?.username || ''\n  showNicknameModal.value = true\n}\n\nconst handleAvatarUpload = async (file) => {\n  try {\n    loading.value = true\n    const formData = new FormData()\n    formData.append('avatar', file)\n    \n    const response = await profile.uploadAvatar(formData)\n    if (response.data?.code === 200) {\n      showToast('头像上传成功', 'success')\n      // 重新获取用户信息以更新头像\n      const profileResponse = await profile.getProfile()\n      if (profileResponse.data?.code === 200) {\n        store.commit('SET_USER_INFO', profileResponse.data)\n      }\n      showAvatarUpload.value = false\n    } else {\n      throw new Error(response.data?.message || '上传失败')\n    }\n  } catch (error) {\n    console.error('头像上传失败:', error)\n    showToast(error.message || '头像上传失败，请稍后重试', 'error')\n  } finally {\n    loading.value = false\n  }\n}\n\n// No changes to rest of the script section\n</script>\n\n<style scoped>\n/* No changes to style section */\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}