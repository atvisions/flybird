{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, toDisplayString as _toDisplayString, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"space-y-6 p-4 lg:p-6 pb-24\"\n};\nconst _hoisted_2 = {\n  class: \"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 py-4 z-50\"\n};\nconst _hoisted_3 = {\n  class: \"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\"\n};\nconst _hoisted_4 = {\n  class: \"flex items-center justify-between\"\n};\nconst _hoisted_5 = {\n  class: \"text-sm text-gray-500\"\n};\nconst _hoisted_6 = {\n  class: \"flex items-center gap-4\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Listbox = _resolveComponent(\"Listbox\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_createCommentVNode(\" 标题 \"), _createElementVNode(\"div\", null, [_withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.form.title = $event),\n    class: \"block w-full text-xl font-medium border-0 focus:ring-0 p-0\",\n    placeholder: \"输入文章标题...\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.form.title]])]), _createCommentVNode(\" 分类 \"), _createElementVNode(\"div\", null, [_createVNode(_component_Listbox, {\n    modelValue: _ctx.selectedCategory,\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => _ctx.selectedCategory = $event)\n  }, {\n    default: _withCtx(() => [_createCommentVNode(\" ... Listbox 内容 ... \")]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"])]), _createCommentVNode(\" 编辑器 \"), _createElementVNode(\"div\", null, [_createVNode($setup[\"Toolbar\"], {\n    style: {\n      \"border-bottom\": \"1px solid #ccc\"\n    },\n    editor: $setup.editorRef,\n    defaultConfig: _ctx.toolbarConfig,\n    mode: \"default\"\n  }, null, 8 /* PROPS */, [\"editor\", \"defaultConfig\"]), _createVNode($setup[\"Editor\"], {\n    modelValue: $setup.form.content,\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.form.content = $event),\n    style: {\n      \"height\": \"500px\",\n      \"overflow-y\": \"hidden\"\n    },\n    defaultConfig: _ctx.editorConfig,\n    mode: \"default\",\n    onOnCreated: $setup.handleCreated,\n    onOnChange: $setup.handleChange\n  }, null, 8 /* PROPS */, [\"modelValue\", \"defaultConfig\"])])]), _createCommentVNode(\" 底部按钮 \"), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"span\", _hoisted_5, _toDisplayString($setup.lastSaveTime ? `上次保存: ${$setup.formatTime($setup.lastSaveTime)}` : '文章将自动保存'), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"button\", {\n    class: \"px-6 h-10 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors\",\n    onClick: _cache[3] || (_cache[3] = $event => _ctx.$router.back())\n  }, \" 取消 \"), _createElementVNode(\"button\", {\n    class: \"px-6 h-10 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors\",\n    onClick: $setup.handleSubmit\n  }, \" 发布文章 \")])])])])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","_createElementBlock","_Fragment","_createElementVNode","_hoisted_1","_createCommentVNode","type","_cache","$event","$setup","form","title","placeholder","_createVNode","_component_Listbox","modelValue","_ctx","selectedCategory","default","_withCtx","_","style","editor","editorRef","defaultConfig","toolbarConfig","mode","content","editorConfig","onOnCreated","handleCreated","onOnChange","handleChange","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","lastSaveTime","formatTime","_hoisted_6","onClick","$router","back","handleSubmit"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/community/components/ArticleForm.vue"],"sourcesContent":["<template>\n  <div class=\"space-y-6 p-4 lg:p-6 pb-24\">\n    <!-- 标题 -->\n    <div>\n      <input\n        type=\"text\"\n        v-model=\"form.title\"\n        class=\"block w-full text-xl font-medium border-0 focus:ring-0 p-0\"\n        placeholder=\"输入文章标题...\"\n      >\n    </div>\n\n    <!-- 分类 -->\n    <div>\n      <Listbox v-model=\"selectedCategory\">\n        <!-- ... Listbox 内容 ... -->\n      </Listbox>\n    </div>\n\n    <!-- 编辑器 -->\n    <div>\n      <Toolbar\n        style=\"border-bottom: 1px solid #ccc\"\n        :editor=\"editorRef\"\n        :defaultConfig=\"toolbarConfig\"\n        mode=\"default\"\n      />\n      <Editor\n        v-model=\"form.content\"\n        style=\"height: 500px; overflow-y: hidden;\"\n        :defaultConfig=\"editorConfig\"\n        mode=\"default\"\n        @onCreated=\"handleCreated\"\n        @onChange=\"handleChange\"\n      />\n    </div>\n  </div>\n\n  <!-- 底部按钮 -->\n  <div class=\"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 py-4 z-50\">\n    <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n      <div class=\"flex items-center justify-between\">\n        <span class=\"text-sm text-gray-500\">{{ lastSaveTime ? `上次保存: ${formatTime(lastSaveTime)}` : '文章将自动保存' }}</span>\n        <div class=\"flex items-center gap-4\">\n          <button \n            class=\"px-6 h-10 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors\"\n            @click=\"$router.back()\"\n          >\n            取消\n          </button>\n          <button \n            class=\"px-6 h-10 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors\"\n            @click=\"handleSubmit\"\n          >\n            发布文章\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, onBeforeUnmount } from 'vue'\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue'\nimport { formatTime } from '@/utils/time'\nimport { showToast } from '@/components/ToastMessage'\n\nconst props = defineProps({\n  modelValue: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'submit'])\n\n// 编辑器实例\nconst editorRef = ref(null)\n\n// 表单数据\nconst form = ref({\n  title: '',\n  category: '',\n  content: '',\n  tags: [],\n  cover: '',\n  summary: '',\n  isPublic: true,\n  allowComment: true\n})\n\n// 最后保存时间\nconst lastSaveTime = ref(null)\n\n// 自动保存相关\nlet autoSaveTimer = null\nconst AUTOSAVE_INTERVAL = 30000 // 30秒\nconst DRAFT_KEY = 'article_draft'\n\n// 保存草稿\nconst saveDraft = () => {\n  const draftData = {\n    ...form.value,\n    editorContent: editorRef.value?.getHtml() || '' // 保存编辑器的 HTML 内容\n  }\n  localStorage.setItem(DRAFT_KEY, JSON.stringify(draftData))\n  lastSaveTime.value = new Date()\n}\n\n// 加载草稿\nconst loadDraft = () => {\n  const draft = localStorage.getItem(DRAFT_KEY)\n  if (draft) {\n    try {\n      const draftData = JSON.parse(draft)\n      form.value = {\n        ...draftData,\n        content: draftData.editorContent // 恢复编辑器内容\n      }\n      lastSaveTime.value = new Date()\n      showToast('已恢复上次编辑的内容', 'info')\n    } catch (error) {\n      console.error('加载草稿失败:', error)\n    }\n  }\n}\n\n// 清除草稿\nconst clearDraft = () => {\n  localStorage.removeItem(DRAFT_KEY)\n}\n\n// 开始自动保存\nconst startAutoSave = () => {\n  stopAutoSave()\n  autoSaveTimer = setInterval(saveDraft, AUTOSAVE_INTERVAL)\n}\n\n// 停止自动保存\nconst stopAutoSave = () => {\n  if (autoSaveTimer) {\n    clearInterval(autoSaveTimer)\n    autoSaveTimer = null\n  }\n}\n\n// 编辑器创建完成\nconst handleCreated = (editor) => {\n  editorRef.value = editor\n}\n\n// 编辑器内容变化\nconst handleChange = () => {\n  form.value.content = editorRef.value.getHtml()\n  emit('update:modelValue', form.value)\n}\n\n// 提交表单\nconst handleSubmit = () => {\n  // 表单验证\n  if (!form.value.title) {\n    showToast('请输入文章标题', 'warning')\n    return\n  }\n  if (!form.value.category) {\n    showToast('请选择文章分类', 'warning')\n    return\n  }\n  if (!form.value.content) {\n    showToast('请输入文章内容', 'warning')\n    return\n  }\n\n  emit('submit', form.value)\n}\n\n// 监听父组件数据变化\nwatch(\n  () => props.modelValue,\n  (newVal) => {\n    if (newVal && Object.keys(newVal).length > 0) {\n      form.value = { ...newVal }\n    }\n  },\n  { deep: true }\n)\n\nonMounted(() => {\n  loadDraft()\n  startAutoSave()\n})\n\nonBeforeUnmount(() => {\n  stopAutoSave()\n  saveDraft() // 最后保存一次\n  if (editorRef.value) {\n    editorRef.value.destroy()\n  }\n})\n</script>\n\n<style src=\"@wangeditor/editor/dist/css/style.css\"></style> "],"mappings":";;EACOA,KAAK,EAAC;AAA4B;;EAsClCA,KAAK,EAAC;AAA2E;;EAC/EA,KAAK,EAAC;AAAwC;;EAC5CA,KAAK,EAAC;AAAmC;;EACtCA,KAAK,EAAC;AAAuB;;EAC9BA,KAAK,EAAC;AAAyB;;;uBA3C5CC,mBAAA,CAAAC,SAAA,SACEC,mBAAA,CAmCM,OAnCNC,UAmCM,GAlCJC,mBAAA,QAAW,EACXF,mBAAA,CAOM,c,gBANJA,mBAAA,CAKC;IAJCG,IAAI,EAAC,MAAM;IALnB,uBAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAMiBC,MAAA,CAAAC,IAAI,CAACC,KAAK,GAAAH,MAAA;IACnBR,KAAK,EAAC,4DAA4D;IAClEY,WAAW,EAAC;iDAFHH,MAAA,CAAAC,IAAI,CAACC,KAAK,E,KAMvBN,mBAAA,QAAW,EACXF,mBAAA,CAIM,cAHJU,YAAA,CAEUC,kBAAA;IAhBhBC,UAAA,EAcwBC,IAAA,CAAAC,gBAAgB;IAdxC,uBAAAV,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAcwBQ,IAAA,CAAAC,gBAAgB,GAAAT,MAAA;;IAdxCU,OAAA,EAAAC,QAAA,CAeQ,MAA2B,CAA3Bd,mBAAA,wBAA2B,C;IAfnCe,CAAA;uCAmBIf,mBAAA,SAAY,EACZF,mBAAA,CAeM,cAdJU,YAAA,CAKEJ,MAAA;IAJAY,KAAqC,EAArC;MAAA;IAAA,CAAqC;IACpCC,MAAM,EAAEb,MAAA,CAAAc,SAAS;IACjBC,aAAa,EAAER,IAAA,CAAAS,aAAa;IAC7BC,IAAI,EAAC;wDAEPb,YAAA,CAOEJ,MAAA;IAlCRM,UAAA,EA4BiBN,MAAA,CAAAC,IAAI,CAACiB,OAAO;IA5B7B,uBAAApB,MAAA,QAAAA,MAAA,MAAAC,MAAA,IA4BiBC,MAAA,CAAAC,IAAI,CAACiB,OAAO,GAAAnB,MAAA;IACrBa,KAA0C,EAA1C;MAAA;MAAA;IAAA,CAA0C;IACzCG,aAAa,EAAER,IAAA,CAAAY,YAAY;IAC5BF,IAAI,EAAC,SAAS;IACbG,WAAS,EAAEpB,MAAA,CAAAqB,aAAa;IACxBC,UAAQ,EAAEtB,MAAA,CAAAuB;gEAKjB3B,mBAAA,UAAa,EACbF,mBAAA,CAoBM,OApBN8B,UAoBM,GAnBJ9B,mBAAA,CAkBM,OAlBN+B,UAkBM,GAjBJ/B,mBAAA,CAgBM,OAhBNgC,UAgBM,GAfJhC,mBAAA,CAA+G,QAA/GiC,UAA+G,EAAAC,gBAAA,CAAxE5B,MAAA,CAAA6B,YAAY,YAAY7B,MAAA,CAAA8B,UAAU,CAAC9B,MAAA,CAAA6B,YAAY,iCACtFnC,mBAAA,CAaM,OAbNqC,UAaM,GAZJrC,mBAAA,CAKS;IAJPH,KAAK,EAAC,8FAA8F;IACnGyC,OAAK,EAAAlC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEQ,IAAA,CAAA0B,OAAO,CAACC,IAAI;KACrB,MAED,GACAxC,mBAAA,CAKS;IAJPH,KAAK,EAAC,qFAAqF;IAC1FyC,OAAK,EAAEhC,MAAA,CAAAmC;KACT,QAED,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}