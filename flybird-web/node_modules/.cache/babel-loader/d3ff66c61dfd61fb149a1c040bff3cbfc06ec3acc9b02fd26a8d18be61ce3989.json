{"ast":null,"code":"import _objectSpread from \"/Users/liuzhao/Documents/Projects/flybird/flybird-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nexport default {\n  __name: 'UserHome',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n\n    // No changes to imports or setup section\n\n    // 用户信息的计算属性\n    const userInfo = computed(() => {\n      return {\n        uid: store.state.userInfo?.data?.uid,\n        username: store.state.userInfo?.data?.username || '未设置用户名',\n        avatar: store.state.userInfo?.data?.avatar,\n        background_image: store.state.userInfo?.data?.background_image,\n        bio: store.state.userInfo?.data?.bio || null,\n        position: store.state.userInfo?.data?.position || null\n      };\n    });\n\n    // 计算背景图 URL\n    const backgroundUrl = computed(() => {\n      const bgImage = userInfo.value?.background_image;\n      return bgImage ? formatImageUrl(bgImage) : defaultBackground;\n    });\n\n    // 处理背景图上传\n    const handleBackgroundUpload = async () => {\n      // 创建文件输入框\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = 'image/*';\n\n      // 监听文件选择\n      input.onchange = async e => {\n        const file = e.target.files[0];\n        if (!file) return;\n\n        // 验证文件\n        if (!file.type.startsWith('image/')) {\n          showToast('请选择图片文件', 'error');\n          return;\n        }\n        const maxSize = 5 * 1024 * 1024; // 5MB\n        if (file.size > maxSize) {\n          showToast('图片大小不能超过5MB', 'error');\n          return;\n        }\n        try {\n          loading.value = true;\n          const response = await user.uploadBackground(file);\n          if (response.data?.code === 200) {\n            showToast('背景图上传成功', 'success');\n            // 更新 store 中的用户信息\n            store.commit('SET_USER_INFO', _objectSpread(_objectSpread({}, store.state.userInfo), {}, {\n              data: _objectSpread(_objectSpread({}, store.state.userInfo.data), {}, {\n                background_image: response.data.data.background_image\n              })\n            }));\n          } else {\n            throw new Error(response.data?.message || '上传失败');\n          }\n        } catch (error) {\n          console.error('背景图上传失败:', error);\n          showToast(error.message || '背景图上传失败，请稍后重试', 'error');\n        } finally {\n          loading.value = false;\n          input.value = ''; // 清空文件选择器\n        }\n      };\n\n      // 触发文件选择\n      input.click();\n    };\n\n    // No changes to rest of the script section\n\n    const __returned__ = {\n      userInfo,\n      backgroundUrl,\n      handleBackgroundUpload\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["userInfo","computed","uid","store","state","data","username","avatar","background_image","bio","position","backgroundUrl","bgImage","value","formatImageUrl","defaultBackground","handleBackgroundUpload","input","document","createElement","type","accept","onchange","e","file","target","files","startsWith","showToast","maxSize","size","loading","response","user","uploadBackground","code","commit","_objectSpread","Error","message","error","console","click"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/components/UserHome.vue"],"sourcesContent":["<template>\n  <!-- No changes to template section -->\n</template>\n\n<script setup>\n// No changes to imports or setup section\n\n// 用户信息的计算属性\nconst userInfo = computed(() => {\n  return {\n    uid: store.state.userInfo?.data?.uid,\n    username: store.state.userInfo?.data?.username || '未设置用户名',\n    avatar: store.state.userInfo?.data?.avatar,\n    background_image: store.state.userInfo?.data?.background_image,\n    bio: store.state.userInfo?.data?.bio || null,\n    position: store.state.userInfo?.data?.position || null\n  }\n})\n\n// 计算背景图 URL\nconst backgroundUrl = computed(() => {\n  const bgImage = userInfo.value?.background_image\n  return bgImage ? formatImageUrl(bgImage) : defaultBackground\n})\n\n// 处理背景图上传\nconst handleBackgroundUpload = async () => {\n  // 创建文件输入框\n  const input = document.createElement('input')\n  input.type = 'file'\n  input.accept = 'image/*'\n  \n  // 监听文件选择\n  input.onchange = async (e) => {\n    const file = e.target.files[0]\n    if (!file) return\n    \n    // 验证文件\n    if (!file.type.startsWith('image/')) {\n      showToast('请选择图片文件', 'error')\n      return\n    }\n    \n    const maxSize = 5 * 1024 * 1024 // 5MB\n    if (file.size > maxSize) {\n      showToast('图片大小不能超过5MB', 'error')\n      return\n    }\n    \n    try {\n      loading.value = true\n      const response = await user.uploadBackground(file)\n      if (response.data?.code === 200) {\n        showToast('背景图上传成功', 'success')\n        // 更新 store 中的用户信息\n        store.commit('SET_USER_INFO', {\n          ...store.state.userInfo,\n          data: {\n            ...store.state.userInfo.data,\n            background_image: response.data.data.background_image\n          }\n        })\n      } else {\n        throw new Error(response.data?.message || '上传失败')\n      }\n    } catch (error) {\n      console.error('背景图上传失败:', error)\n      showToast(error.message || '背景图上传失败，请稍后重试', 'error')\n    } finally {\n      loading.value = false\n      input.value = ''  // 清空文件选择器\n    }\n  }\n  \n  // 触发文件选择\n  input.click()\n}\n\n// No changes to rest of the script section\n</script>\n\n<style scoped>\n/* No changes to style section */\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}