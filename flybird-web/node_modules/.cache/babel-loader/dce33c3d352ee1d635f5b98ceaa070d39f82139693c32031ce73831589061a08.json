{"ast":null,"code":"import { defineStore } from 'pinia';\nimport { auth } from '@/api/auth';\nimport request from '@/utils/request';\nimport { useRouter } from 'vue-router';\nimport { useAccountStore } from '@/stores/account';\nimport { useUserStore } from '@/stores/user';\nimport { showToast } from '@/components/ToastMessage';\nimport { STORAGE_KEYS } from '@/utils/storage';\nexport const useAuthStore = defineStore('auth', {\n  state: () => ({\n    isLoggedIn: false,\n    token: localStorage.getItem('token') || null,\n    refreshToken: null,\n    tokenExpiresAt: null\n  }),\n  getters: {\n    isAuthenticated: state => {\n      return state.isLoggedIn && !!state.token;\n    }\n  },\n  actions: {\n    // 添加恢复状态的方法\n    restoreState() {\n      const token = localStorage.getItem('token');\n      if (token) {\n        this.token = token;\n        this.isLoggedIn = true;\n        request.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        return true;\n      }\n      return false;\n    },\n    clearAuth() {\n      this.isLoggedIn = false;\n      this.token = null;\n      this.refreshToken = null;\n      this.tokenExpiresAt = null;\n      localStorage.removeItem('token');\n      localStorage.removeItem('refresh_token');\n      delete request.defaults.headers.common['Authorization'];\n    }\n  }\n});","map":{"version":3,"names":["defineStore","auth","request","useRouter","useAccountStore","useUserStore","showToast","STORAGE_KEYS","useAuthStore","state","isLoggedIn","token","localStorage","getItem","refreshToken","tokenExpiresAt","getters","isAuthenticated","actions","restoreState","defaults","headers","common","clearAuth","removeItem"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/auth.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { auth } from '@/api/auth'\nimport request from '@/utils/request'\nimport { useRouter } from 'vue-router'\nimport { useAccountStore } from '@/stores/account'\nimport { useUserStore } from '@/stores/user'\nimport { showToast } from '@/components/ToastMessage'\nimport { STORAGE_KEYS } from '@/utils/storage'\n\nexport const useAuthStore = defineStore('auth', {\n  state: () => ({\n    isLoggedIn: false,\n    token: localStorage.getItem('token') || null,\n    refreshToken: null,\n    tokenExpiresAt: null\n  }),\n\n  getters: {\n    isAuthenticated: (state) => {\n      return state.isLoggedIn && !!state.token\n    }\n  },\n\n  actions: {\n    // 添加恢复状态的方法\n    restoreState() {\n      const token = localStorage.getItem('token')\n      if (token) {\n        this.token = token\n        this.isLoggedIn = true\n        request.defaults.headers.common['Authorization'] = `Bearer ${token}`\n        return true\n      }\n      return false\n    },\n\n    clearAuth() {\n      this.isLoggedIn = false\n      this.token = null\n      this.refreshToken = null\n      this.tokenExpiresAt = null\n      localStorage.removeItem('token')\n      localStorage.removeItem('refresh_token')\n      delete request.defaults.headers.common['Authorization']\n    }\n  }\n}) "],"mappings":"AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,SAASC,IAAI,QAAQ,YAAY;AACjC,OAAOC,OAAO,MAAM,iBAAiB;AACrC,SAASC,SAAS,QAAQ,YAAY;AACtC,SAASC,eAAe,QAAQ,kBAAkB;AAClD,SAASC,YAAY,QAAQ,eAAe;AAC5C,SAASC,SAAS,QAAQ,2BAA2B;AACrD,SAASC,YAAY,QAAQ,iBAAiB;AAE9C,OAAO,MAAMC,YAAY,GAAGR,WAAW,CAAC,MAAM,EAAE;EAC9CS,KAAK,EAAEA,CAAA,MAAO;IACZC,UAAU,EAAE,KAAK;IACjBC,KAAK,EAAEC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,IAAI,IAAI;IAC5CC,YAAY,EAAE,IAAI;IAClBC,cAAc,EAAE;EAClB,CAAC,CAAC;EAEFC,OAAO,EAAE;IACPC,eAAe,EAAGR,KAAK,IAAK;MAC1B,OAAOA,KAAK,CAACC,UAAU,IAAI,CAAC,CAACD,KAAK,CAACE,KAAK;IAC1C;EACF,CAAC;EAEDO,OAAO,EAAE;IACP;IACAC,YAAYA,CAAA,EAAG;MACb,MAAMR,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;MAC3C,IAAIF,KAAK,EAAE;QACT,IAAI,CAACA,KAAK,GAAGA,KAAK;QAClB,IAAI,CAACD,UAAU,GAAG,IAAI;QACtBR,OAAO,CAACkB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,GAAG,UAAUX,KAAK,EAAE;QACpE,OAAO,IAAI;MACb;MACA,OAAO,KAAK;IACd,CAAC;IAEDY,SAASA,CAAA,EAAG;MACV,IAAI,CAACb,UAAU,GAAG,KAAK;MACvB,IAAI,CAACC,KAAK,GAAG,IAAI;MACjB,IAAI,CAACG,YAAY,GAAG,IAAI;MACxB,IAAI,CAACC,cAAc,GAAG,IAAI;MAC1BH,YAAY,CAACY,UAAU,CAAC,OAAO,CAAC;MAChCZ,YAAY,CAACY,UAAU,CAAC,eAAe,CAAC;MACxC,OAAOtB,OAAO,CAACkB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC;IACzD;EACF;AACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}