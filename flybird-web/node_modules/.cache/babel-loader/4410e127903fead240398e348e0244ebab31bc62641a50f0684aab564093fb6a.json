{"ast":null,"code":"import { ref, computed } from 'vue';\nimport { Plus } from '@element-plus/icons-vue';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'ProfileAvatarUpload',\n  props: {\n    modelValue: Boolean\n  },\n  emits: ['update:modelValue', 'upload'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const visible = computed({\n      get: () => props.modelValue,\n      set: val => emit('update:modelValue', val)\n    });\n    const uploadRef = ref(null);\n    const imageUrl = ref('');\n    const uploading = ref(false);\n    const zoom = ref(100);\n    const rotation = ref(0);\n\n    // 预览样式\n    const previewStyle = computed(() => ({\n      transform: `scale(${zoom.value / 100}) rotate(${rotation.value}deg)`,\n      transformOrigin: 'center center'\n    }));\n\n    // 处理文件选择\n    const handleChange = file => {\n      if (!file) return;\n\n      // 验证文件类型\n      if (!file.raw.type.startsWith('image/')) {\n        ElMessage.error('请选择图片文件');\n        return;\n      }\n\n      // 验证文件大小 (5MB)\n      const maxSize = 5 * 1024 * 1024;\n      if (file.size > maxSize) {\n        ElMessage.error('图片大小不能超过 5MB');\n        return;\n      }\n\n      // 读取文件\n      const reader = new FileReader();\n      reader.onload = e => {\n        imageUrl.value = e.target.result;\n        // 重置缩放和旋转\n        zoom.value = 100;\n        rotation.value = 0;\n      };\n      reader.readAsDataURL(file.raw);\n    };\n\n    // 处理缩放\n    const handleZoom = value => {\n      zoom.value = value;\n    };\n\n    // 处理旋转\n    const rotateLeft = () => {\n      rotation.value = (rotation.value - 90) % 360;\n    };\n    const rotateRight = () => {\n      rotation.value = (rotation.value + 90) % 360;\n    };\n\n    // 处理上传\n    const handleUpload = async () => {\n      if (!imageUrl.value) return;\n      try {\n        uploading.value = true;\n\n        // 创建 canvas 以应用变换\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        const img = new Image();\n        await new Promise((resolve, reject) => {\n          img.onload = resolve;\n          img.onerror = reject;\n          img.src = imageUrl.value;\n        });\n\n        // 设置画布大小\n        canvas.width = 300;\n        canvas.height = 300;\n\n        // 应用变换\n        ctx.translate(canvas.width / 2, canvas.height / 2);\n        ctx.rotate(rotation.value * Math.PI / 180);\n        ctx.scale(zoom.value / 100, zoom.value / 100);\n        ctx.drawImage(img, -canvas.width / 2, -canvas.height / 2, canvas.width, canvas.height);\n\n        // 转换为 Blob\n        canvas.toBlob(async blob => {\n          const file = new File([blob], 'profile_avatar.png', {\n            type: 'image/png'\n          });\n          emit('upload', file);\n        }, 'image/png');\n      } catch (error) {\n        console.error('处理图片失败:', error);\n        ElMessage.error('处理图片失败，请重试');\n      } finally {\n        uploading.value = false;\n      }\n    };\n\n    // 处理关闭\n    const handleClose = () => {\n      visible.value = false;\n      imageUrl.value = '';\n      zoom.value = 100;\n      rotation.value = 0;\n      if (uploadRef.value) {\n        uploadRef.value.clearFiles();\n      }\n    };\n    const __returned__ = {\n      props,\n      emit,\n      visible,\n      uploadRef,\n      imageUrl,\n      uploading,\n      zoom,\n      rotation,\n      previewStyle,\n      handleChange,\n      handleZoom,\n      rotateLeft,\n      rotateRight,\n      handleUpload,\n      handleClose,\n      ref,\n      computed,\n      get Plus() {\n        return Plus;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","Plus","ElMessage","props","__props","emit","__emit","visible","get","modelValue","set","val","uploadRef","imageUrl","uploading","zoom","rotation","previewStyle","transform","value","transformOrigin","handleChange","file","raw","type","startsWith","error","maxSize","size","reader","FileReader","onload","e","target","result","readAsDataURL","handleZoom","rotateLeft","rotateRight","handleUpload","canvas","document","createElement","ctx","getContext","img","Image","Promise","resolve","reject","onerror","src","width","height","translate","rotate","Math","PI","scale","drawImage","toBlob","blob","File","console","handleClose","clearFiles"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/components/ProfileAvatarUpload.vue"],"sourcesContent":["<template>\n  <el-dialog\n    v-model=\"visible\"\n    title=\"更新职业头像\"\n    width=\"800px\"\n    :close-on-click-modal=\"false\"\n    :before-close=\"handleClose\"\n  >\n    <div class=\"flex\">\n      <!-- 左侧上传区域 -->\n      <div class=\"w-1/2 pr-4 border-r\">\n        <el-upload\n          ref=\"uploadRef\"\n          class=\"avatar-uploader\"\n          :show-file-list=\"false\"\n          :auto-upload=\"false\"\n          :on-change=\"handleChange\"\n          accept=\"image/*\"\n          drag\n        >\n          <template #trigger>\n            <div class=\"upload-trigger\">\n              <img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar-preview\" />\n              <el-icon v-else class=\"avatar-uploader-icon\"><Plus /></el-icon>\n              <div class=\"upload-text\">\n                <span>点击或拖拽图片到此处</span>\n                <p class=\"text-gray-400 text-xs mt-2\">支持 jpg、png 格式，建议尺寸 300x300px</p>\n              </div>\n            </div>\n          </template>\n        </el-upload>\n\n        <!-- 图片调整工具 -->\n        <div v-if=\"imageUrl\" class=\"mt-4 space-y-4\">\n          <div class=\"flex items-center justify-between\">\n            <span class=\"text-sm text-gray-600\">缩放</span>\n            <el-slider\n              v-model=\"zoom\"\n              :min=\"50\"\n              :max=\"200\"\n              :step=\"1\"\n              class=\"w-48\"\n              @input=\"handleZoom\"\n            />\n          </div>\n          <div class=\"flex justify-center space-x-4\">\n            <el-button @click=\"rotateLeft\">\n              <template #icon><i class=\"el-icon-refresh-left\" /></template>\n              向左旋转\n            </el-button>\n            <el-button @click=\"rotateRight\">\n              <template #icon><i class=\"el-icon-refresh-right\" /></template>\n              向右旋转\n            </el-button>\n          </div>\n        </div>\n      </div>\n\n      <!-- 右侧预览区域 -->\n      <div class=\"w-1/2 pl-4\">\n        <h4 class=\"text-gray-600 mb-4\">预览效果</h4>\n        <div class=\"space-y-6\">\n          <!-- 大尺寸预览 -->\n          <div class=\"preview-container\">\n            <div class=\"text-sm text-gray-500 mb-2\">大尺寸 (200x200px)</div>\n            <div class=\"preview-box large\">\n              <img v-if=\"imageUrl\" :src=\"imageUrl\" :style=\"previewStyle\" />\n            </div>\n          </div>\n\n          <!-- 小尺寸预览 -->\n          <div class=\"flex space-x-8\">\n            <div class=\"preview-container\">\n              <div class=\"text-sm text-gray-500 mb-2\">中尺寸 (100x100px)</div>\n              <div class=\"preview-box medium\">\n                <img v-if=\"imageUrl\" :src=\"imageUrl\" :style=\"previewStyle\" />\n              </div>\n            </div>\n            <div class=\"preview-container\">\n              <div class=\"text-sm text-gray-500 mb-2\">小尺寸 (50x50px)</div>\n              <div class=\"preview-box small\">\n                <img v-if=\"imageUrl\" :src=\"imageUrl\" :style=\"previewStyle\" />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <template #footer>\n      <div class=\"dialog-footer\">\n        <el-button @click=\"handleClose\">取消</el-button>\n        <el-button\n          type=\"primary\"\n          :loading=\"uploading\"\n          :disabled=\"!imageUrl\"\n          @click=\"handleUpload\"\n        >\n          确认上传\n        </el-button>\n      </div>\n    </template>\n  </el-dialog>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport { Plus } from '@element-plus/icons-vue'\nimport { ElMessage } from 'element-plus'\n\nconst props = defineProps({\n  modelValue: Boolean\n})\n\nconst emit = defineEmits(['update:modelValue', 'upload'])\n\nconst visible = computed({\n  get: () => props.modelValue,\n  set: (val) => emit('update:modelValue', val)\n})\n\nconst uploadRef = ref(null)\nconst imageUrl = ref('')\nconst uploading = ref(false)\nconst zoom = ref(100)\nconst rotation = ref(0)\n\n// 预览样式\nconst previewStyle = computed(() => ({\n  transform: `scale(${zoom.value / 100}) rotate(${rotation.value}deg)`,\n  transformOrigin: 'center center'\n}))\n\n// 处理文件选择\nconst handleChange = (file) => {\n  if (!file) return\n\n  // 验证文件类型\n  if (!file.raw.type.startsWith('image/')) {\n    ElMessage.error('请选择图片文件')\n    return\n  }\n\n  // 验证文件大小 (5MB)\n  const maxSize = 5 * 1024 * 1024\n  if (file.size > maxSize) {\n    ElMessage.error('图片大小不能超过 5MB')\n    return\n  }\n\n  // 读取文件\n  const reader = new FileReader()\n  reader.onload = (e) => {\n    imageUrl.value = e.target.result\n    // 重置缩放和旋转\n    zoom.value = 100\n    rotation.value = 0\n  }\n  reader.readAsDataURL(file.raw)\n}\n\n// 处理缩放\nconst handleZoom = (value) => {\n  zoom.value = value\n}\n\n// 处理旋转\nconst rotateLeft = () => {\n  rotation.value = (rotation.value - 90) % 360\n}\n\nconst rotateRight = () => {\n  rotation.value = (rotation.value + 90) % 360\n}\n\n// 处理上传\nconst handleUpload = async () => {\n  if (!imageUrl.value) return\n\n  try {\n    uploading.value = true\n\n    // 创建 canvas 以应用变换\n    const canvas = document.createElement('canvas')\n    const ctx = canvas.getContext('2d')\n    const img = new Image()\n\n    await new Promise((resolve, reject) => {\n      img.onload = resolve\n      img.onerror = reject\n      img.src = imageUrl.value\n    })\n\n    // 设置画布大小\n    canvas.width = 300\n    canvas.height = 300\n\n    // 应用变换\n    ctx.translate(canvas.width / 2, canvas.height / 2)\n    ctx.rotate((rotation.value * Math.PI) / 180)\n    ctx.scale(zoom.value / 100, zoom.value / 100)\n    ctx.drawImage(\n      img,\n      -canvas.width / 2,\n      -canvas.height / 2,\n      canvas.width,\n      canvas.height\n    )\n\n    // 转换为 Blob\n    canvas.toBlob(async (blob) => {\n      const file = new File([blob], 'profile_avatar.png', { type: 'image/png' })\n      emit('upload', file)\n    }, 'image/png')\n\n  } catch (error) {\n    console.error('处理图片失败:', error)\n    ElMessage.error('处理图片失败，请重试')\n  } finally {\n    uploading.value = false\n  }\n}\n\n// 处理关闭\nconst handleClose = () => {\n  visible.value = false\n  imageUrl.value = ''\n  zoom.value = 100\n  rotation.value = 0\n  if (uploadRef.value) {\n    uploadRef.value.clearFiles()\n  }\n}\n</script>\n\n<style scoped>\n.avatar-uploader {\n  @apply border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 transition-colors;\n}\n\n.upload-trigger {\n  @apply flex flex-col items-center justify-center p-8 cursor-pointer;\n}\n\n.avatar-preview {\n  @apply w-48 h-48 object-cover rounded-lg mb-4;\n}\n\n.avatar-uploader-icon {\n  @apply text-4xl text-gray-400 mb-4;\n}\n\n.preview-box {\n  @apply border border-gray-200 rounded-lg overflow-hidden bg-gray-50;\n}\n\n.preview-box.large {\n  @apply w-48 h-48;\n}\n\n.preview-box.medium {\n  @apply w-24 h-24;\n}\n\n.preview-box.small {\n  @apply w-12 h-12;\n}\n\n.preview-box img {\n  @apply w-full h-full object-cover transition-transform duration-200;\n}\n</style> "],"mappings":"AA0GA,SAASA,GAAG,EAAEC,QAAQ,QAAQ,KAAI;AAClC,SAASC,IAAI,QAAQ,yBAAwB;AAC7C,SAASC,SAAS,QAAQ,cAAa;;;;;;;;;;;;IAEvC,MAAMC,KAAK,GAAGC,OAAA;IAId,MAAMC,IAAI,GAAGC,MAAA;IAEb,MAAMC,OAAO,GAAGP,QAAQ,CAAC;MACvBQ,GAAG,EAAEA,CAAA,KAAML,KAAK,CAACM,UAAU;MAC3BC,GAAG,EAAGC,GAAG,IAAKN,IAAI,CAAC,mBAAmB,EAAEM,GAAG;IAC7C,CAAC;IAED,MAAMC,SAAS,GAAGb,GAAG,CAAC,IAAI;IAC1B,MAAMc,QAAQ,GAAGd,GAAG,CAAC,EAAE;IACvB,MAAMe,SAAS,GAAGf,GAAG,CAAC,KAAK;IAC3B,MAAMgB,IAAI,GAAGhB,GAAG,CAAC,GAAG;IACpB,MAAMiB,QAAQ,GAAGjB,GAAG,CAAC,CAAC;;IAEtB;IACA,MAAMkB,YAAY,GAAGjB,QAAQ,CAAC,OAAO;MACnCkB,SAAS,EAAE,SAASH,IAAI,CAACI,KAAK,GAAG,GAAG,YAAYH,QAAQ,CAACG,KAAK,MAAM;MACpEC,eAAe,EAAE;IACnB,CAAC,CAAC;;IAEF;IACA,MAAMC,YAAY,GAAIC,IAAI,IAAK;MAC7B,IAAI,CAACA,IAAI,EAAE;;MAEX;MACA,IAAI,CAACA,IAAI,CAACC,GAAG,CAACC,IAAI,CAACC,UAAU,CAAC,QAAQ,CAAC,EAAE;QACvCvB,SAAS,CAACwB,KAAK,CAAC,SAAS;QACzB;MACF;;MAEA;MACA,MAAMC,OAAO,GAAG,CAAC,GAAG,IAAI,GAAG,IAAG;MAC9B,IAAIL,IAAI,CAACM,IAAI,GAAGD,OAAO,EAAE;QACvBzB,SAAS,CAACwB,KAAK,CAAC,cAAc;QAC9B;MACF;;MAEA;MACA,MAAMG,MAAM,GAAG,IAAIC,UAAU,CAAC;MAC9BD,MAAM,CAACE,MAAM,GAAIC,CAAC,IAAK;QACrBnB,QAAQ,CAACM,KAAK,GAAGa,CAAC,CAACC,MAAM,CAACC,MAAK;QAC/B;QACAnB,IAAI,CAACI,KAAK,GAAG,GAAE;QACfH,QAAQ,CAACG,KAAK,GAAG;MACnB;MACAU,MAAM,CAACM,aAAa,CAACb,IAAI,CAACC,GAAG;IAC/B;;IAEA;IACA,MAAMa,UAAU,GAAIjB,KAAK,IAAK;MAC5BJ,IAAI,CAACI,KAAK,GAAGA,KAAI;IACnB;;IAEA;IACA,MAAMkB,UAAU,GAAGA,CAAA,KAAM;MACvBrB,QAAQ,CAACG,KAAK,GAAG,CAACH,QAAQ,CAACG,KAAK,GAAG,EAAE,IAAI,GAAE;IAC7C;IAEA,MAAMmB,WAAW,GAAGA,CAAA,KAAM;MACxBtB,QAAQ,CAACG,KAAK,GAAG,CAACH,QAAQ,CAACG,KAAK,GAAG,EAAE,IAAI,GAAE;IAC7C;;IAEA;IACA,MAAMoB,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI,CAAC1B,QAAQ,CAACM,KAAK,EAAE;MAErB,IAAI;QACFL,SAAS,CAACK,KAAK,GAAG,IAAG;;QAErB;QACA,MAAMqB,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ;QAC9C,MAAMC,GAAG,GAAGH,MAAM,CAACI,UAAU,CAAC,IAAI;QAClC,MAAMC,GAAG,GAAG,IAAIC,KAAK,CAAC;QAEtB,MAAM,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;UACrCJ,GAAG,CAACd,MAAM,GAAGiB,OAAM;UACnBH,GAAG,CAACK,OAAO,GAAGD,MAAK;UACnBJ,GAAG,CAACM,GAAG,GAAGtC,QAAQ,CAACM,KAAI;QACzB,CAAC;;QAED;QACAqB,MAAM,CAACY,KAAK,GAAG,GAAE;QACjBZ,MAAM,CAACa,MAAM,GAAG,GAAE;;QAElB;QACAV,GAAG,CAACW,SAAS,CAACd,MAAM,CAACY,KAAK,GAAG,CAAC,EAAEZ,MAAM,CAACa,MAAM,GAAG,CAAC;QACjDV,GAAG,CAACY,MAAM,CAAEvC,QAAQ,CAACG,KAAK,GAAGqC,IAAI,CAACC,EAAE,GAAI,GAAG;QAC3Cd,GAAG,CAACe,KAAK,CAAC3C,IAAI,CAACI,KAAK,GAAG,GAAG,EAAEJ,IAAI,CAACI,KAAK,GAAG,GAAG;QAC5CwB,GAAG,CAACgB,SAAS,CACXd,GAAG,EACH,CAACL,MAAM,CAACY,KAAK,GAAG,CAAC,EACjB,CAACZ,MAAM,CAACa,MAAM,GAAG,CAAC,EAClBb,MAAM,CAACY,KAAK,EACZZ,MAAM,CAACa,MACT;;QAEA;QACAb,MAAM,CAACoB,MAAM,CAAC,MAAOC,IAAI,IAAK;UAC5B,MAAMvC,IAAI,GAAG,IAAIwC,IAAI,CAAC,CAACD,IAAI,CAAC,EAAE,oBAAoB,EAAE;YAAErC,IAAI,EAAE;UAAY,CAAC;UACzEnB,IAAI,CAAC,QAAQ,EAAEiB,IAAI;QACrB,CAAC,EAAE,WAAW;MAEhB,CAAC,CAAC,OAAOI,KAAK,EAAE;QACdqC,OAAO,CAACrC,KAAK,CAAC,SAAS,EAAEA,KAAK;QAC9BxB,SAAS,CAACwB,KAAK,CAAC,YAAY;MAC9B,CAAC,SAAS;QACRZ,SAAS,CAACK,KAAK,GAAG,KAAI;MACxB;IACF;;IAEA;IACA,MAAM6C,WAAW,GAAGA,CAAA,KAAM;MACxBzD,OAAO,CAACY,KAAK,GAAG,KAAI;MACpBN,QAAQ,CAACM,KAAK,GAAG,EAAC;MAClBJ,IAAI,CAACI,KAAK,GAAG,GAAE;MACfH,QAAQ,CAACG,KAAK,GAAG;MACjB,IAAIP,SAAS,CAACO,KAAK,EAAE;QACnBP,SAAS,CAACO,KAAK,CAAC8C,UAAU,CAAC;MAC7B;IACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}