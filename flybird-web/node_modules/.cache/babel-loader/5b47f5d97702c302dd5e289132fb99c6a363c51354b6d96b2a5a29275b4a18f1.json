{"ast":null,"code":"import { defineStore } from 'pinia';\nimport profile from '@/api/profile';\nimport { ref, computed } from 'vue';\nexport const useProfileStore = defineStore('profile', {\n  state: () => ({\n    basicInfo: null,\n    avatarUpdateTime: null\n  }),\n  getters: {\n    profileAvatar: state => {\n      const url = state.basicInfo?.avatar;\n      return url ? `${import.meta.env.VITE_API_URL}${url}` : null;\n    }\n  },\n  actions: {\n    // 获取档案基本信息\n    async fetchBasicInfo() {\n      try {\n        const response = await profile.getData();\n        if (response?.data?.code === 200 && response?.data?.data?.basic_info) {\n          console.log('Fetched basicInfo:', response.data.data.basic_info);\n          this.basicInfo = response.data.data.basic_info;\n          this.avatarUpdateTime = Date.now();\n          console.log('Store state after fetch:', {\n            basicInfo: this.basicInfo,\n            avatarUpdateTime: this.avatarUpdateTime\n          });\n          return this.basicInfo;\n        }\n        return null;\n      } catch (error) {\n        console.error('获取档案基本信息失败:', error);\n        throw error;\n      }\n    },\n    // 更新头像\n    async updateAvatar(formData) {\n      try {\n        const response = await profile.uploadAvatar(formData);\n        if (response?.data?.code === 200) {\n          // 直接更新头像\n          if (this.basicInfo) {\n            console.log('Updating avatar:', response.data.data.avatar);\n            this.basicInfo.avatar = response.data.data.avatar;\n            this.avatarUpdateTime = Date.now();\n            console.log('Store state after update:', {\n              basicInfo: this.basicInfo,\n              avatarUpdateTime: this.avatarUpdateTime\n            });\n          }\n          return response;\n        }\n        throw new Error('上传失败');\n      } catch (error) {\n        throw error;\n      }\n    }\n  },\n  persist: {\n    enabled: true,\n    strategies: [{\n      key: 'profile',\n      storage: localStorage,\n      paths: ['basicInfo', 'avatarUpdateTime']\n    }]\n  }\n});","map":{"version":3,"names":["defineStore","profile","ref","computed","useProfileStore","state","basicInfo","avatarUpdateTime","getters","profileAvatar","url","avatar","import","meta","env","VITE_API_URL","actions","fetchBasicInfo","response","getData","data","code","basic_info","console","log","Date","now","error","updateAvatar","formData","uploadAvatar","Error","persist","enabled","strategies","key","storage","localStorage","paths"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/profile.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport profile from '@/api/profile'\nimport { ref, computed } from 'vue'\n\nexport const useProfileStore = defineStore('profile', {\n  state: () => ({\n    basicInfo: null,\n    avatarUpdateTime: null\n  }),\n\n  getters: {\n    profileAvatar: (state) => {\n      const url = state.basicInfo?.avatar\n      return url ? `${import.meta.env.VITE_API_URL}${url}` : null\n    }\n  },\n\n  actions: {\n    // 获取档案基本信息\n    async fetchBasicInfo() {\n      try {\n        const response = await profile.getData()\n        if (response?.data?.code === 200 && response?.data?.data?.basic_info) {\n          console.log('Fetched basicInfo:', response.data.data.basic_info)\n          this.basicInfo = response.data.data.basic_info\n          this.avatarUpdateTime = Date.now()\n          console.log('Store state after fetch:', {\n            basicInfo: this.basicInfo,\n            avatarUpdateTime: this.avatarUpdateTime\n          })\n          return this.basicInfo\n        }\n        return null\n      } catch (error) {\n        console.error('获取档案基本信息失败:', error)\n        throw error\n      }\n    },\n\n    // 更新头像\n    async updateAvatar(formData) {\n      try {\n        const response = await profile.uploadAvatar(formData)\n        if (response?.data?.code === 200) {\n          // 直接更新头像\n          if (this.basicInfo) {\n            console.log('Updating avatar:', response.data.data.avatar)\n            this.basicInfo.avatar = response.data.data.avatar\n            this.avatarUpdateTime = Date.now()\n            console.log('Store state after update:', {\n              basicInfo: this.basicInfo,\n              avatarUpdateTime: this.avatarUpdateTime\n            })\n          }\n          return response\n        }\n        throw new Error('上传失败')\n      } catch (error) {\n        throw error\n      }\n    }\n  },\n\n  persist: {\n    enabled: true,\n    strategies: [\n      {\n        key: 'profile',\n        storage: localStorage,\n        paths: ['basicInfo', 'avatarUpdateTime']\n      }\n    ]\n  }\n}) "],"mappings":"AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,OAAOC,OAAO,MAAM,eAAe;AACnC,SAASC,GAAG,EAAEC,QAAQ,QAAQ,KAAK;AAEnC,OAAO,MAAMC,eAAe,GAAGJ,WAAW,CAAC,SAAS,EAAE;EACpDK,KAAK,EAAEA,CAAA,MAAO;IACZC,SAAS,EAAE,IAAI;IACfC,gBAAgB,EAAE;EACpB,CAAC,CAAC;EAEFC,OAAO,EAAE;IACPC,aAAa,EAAGJ,KAAK,IAAK;MACxB,MAAMK,GAAG,GAAGL,KAAK,CAACC,SAAS,EAAEK,MAAM;MACnC,OAAOD,GAAG,GAAG,GAAGE,MAAM,CAACC,IAAI,CAACC,GAAG,CAACC,YAAY,GAAGL,GAAG,EAAE,GAAG,IAAI;IAC7D;EACF,CAAC;EAEDM,OAAO,EAAE;IACP;IACA,MAAMC,cAAcA,CAAA,EAAG;MACrB,IAAI;QACF,MAAMC,QAAQ,GAAG,MAAMjB,OAAO,CAACkB,OAAO,CAAC,CAAC;QACxC,IAAID,QAAQ,EAAEE,IAAI,EAAEC,IAAI,KAAK,GAAG,IAAIH,QAAQ,EAAEE,IAAI,EAAEA,IAAI,EAAEE,UAAU,EAAE;UACpEC,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEN,QAAQ,CAACE,IAAI,CAACA,IAAI,CAACE,UAAU,CAAC;UAChE,IAAI,CAAChB,SAAS,GAAGY,QAAQ,CAACE,IAAI,CAACA,IAAI,CAACE,UAAU;UAC9C,IAAI,CAACf,gBAAgB,GAAGkB,IAAI,CAACC,GAAG,CAAC,CAAC;UAClCH,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAE;YACtClB,SAAS,EAAE,IAAI,CAACA,SAAS;YACzBC,gBAAgB,EAAE,IAAI,CAACA;UACzB,CAAC,CAAC;UACF,OAAO,IAAI,CAACD,SAAS;QACvB;QACA,OAAO,IAAI;MACb,CAAC,CAAC,OAAOqB,KAAK,EAAE;QACdJ,OAAO,CAACI,KAAK,CAAC,aAAa,EAAEA,KAAK,CAAC;QACnC,MAAMA,KAAK;MACb;IACF,CAAC;IAED;IACA,MAAMC,YAAYA,CAACC,QAAQ,EAAE;MAC3B,IAAI;QACF,MAAMX,QAAQ,GAAG,MAAMjB,OAAO,CAAC6B,YAAY,CAACD,QAAQ,CAAC;QACrD,IAAIX,QAAQ,EAAEE,IAAI,EAAEC,IAAI,KAAK,GAAG,EAAE;UAChC;UACA,IAAI,IAAI,CAACf,SAAS,EAAE;YAClBiB,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEN,QAAQ,CAACE,IAAI,CAACA,IAAI,CAACT,MAAM,CAAC;YAC1D,IAAI,CAACL,SAAS,CAACK,MAAM,GAAGO,QAAQ,CAACE,IAAI,CAACA,IAAI,CAACT,MAAM;YACjD,IAAI,CAACJ,gBAAgB,GAAGkB,IAAI,CAACC,GAAG,CAAC,CAAC;YAClCH,OAAO,CAACC,GAAG,CAAC,2BAA2B,EAAE;cACvClB,SAAS,EAAE,IAAI,CAACA,SAAS;cACzBC,gBAAgB,EAAE,IAAI,CAACA;YACzB,CAAC,CAAC;UACJ;UACA,OAAOW,QAAQ;QACjB;QACA,MAAM,IAAIa,KAAK,CAAC,MAAM,CAAC;MACzB,CAAC,CAAC,OAAOJ,KAAK,EAAE;QACd,MAAMA,KAAK;MACb;IACF;EACF,CAAC;EAEDK,OAAO,EAAE;IACPC,OAAO,EAAE,IAAI;IACbC,UAAU,EAAE,CACV;MACEC,GAAG,EAAE,SAAS;MACdC,OAAO,EAAEC,YAAY;MACrBC,KAAK,EAAE,CAAC,WAAW,EAAE,kBAAkB;IACzC,CAAC;EAEL;AACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}