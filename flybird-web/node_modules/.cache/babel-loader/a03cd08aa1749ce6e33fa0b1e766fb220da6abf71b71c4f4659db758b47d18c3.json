{"ast":null,"code":"import \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport { defineStore } from 'pinia';\nimport { auth } from '@/api/auth';\nimport request from '@/utils/request';\nimport { useRouter } from 'vue-router';\nimport { useAccountStore } from '@/stores/account';\nimport { useUserStore } from '@/stores/user';\nimport { showToast } from '@/components/ToastMessage';\nimport { STORAGE_KEYS } from '@/utils/storage';\nexport const useAuthStore = defineStore('auth', {\n  state: () => ({\n    isLoggedIn: !!localStorage.getItem('token'),\n    rememberMe: false,\n    token: null,\n    refreshToken: null,\n    tokenExpiresAt: null\n  }),\n  getters: {\n    // 添加 getter，替代直接访问 isLoggedIn\n    isAuthenticated: state => state.isLoggedIn && !!state.token,\n    // 获取记住的账号\n    rememberedAccount: () => localStorage.getItem('remembered_account'),\n    // 获取当前 token\n    currentToken: state => state.token,\n    // 检查是否需要刷新 token\n    needsTokenRefresh: state => {\n      if (!state.tokenExpiresAt) return false;\n      // 如果 token 将在 5 分钟内过期，就需要刷新\n      const fiveMinutes = 5 * 60 * 1000;\n      return new Date().getTime() + fiveMinutes > state.tokenExpiresAt;\n    }\n  },\n  actions: {\n    async login(credentials, rememberMe = false) {\n      try {\n        console.log('Login attempt with:', {\n          account: credentials.account,\n          rememberMe\n        });\n        const response = await auth.loginWithPassword(credentials);\n        console.log('Login response:', response);\n        if (response) {\n          // 保存 token\n          this.token = response.token;\n          this.refreshToken = response.refresh;\n          localStorage.setItem('token', response.token);\n          localStorage.setItem('refresh_token', response.refresh);\n\n          // 设置请求头\n          request.defaults.headers.common['Authorization'] = `Bearer ${response.token}`;\n\n          // 设置登录状态\n          this.isLoggedIn = true;\n\n          // 登录成功后立即获取用户信息并存储\n          const accountStore = useAccountStore();\n          console.log('Fetching user info after login...');\n          await accountStore.fetchUserInfo();\n          console.log('User info fetched:', accountStore.userInfo);\n\n          // 记住账号功能\n          if (rememberMe) {\n            localStorage.setItem('remember_me', 'true');\n            localStorage.setItem('remembered_account', credentials.account);\n          }\n\n          // 显示登录成功提示\n          showToast('登录成功', 'success');\n\n          // 获取重定向地址\n          const urlParams = new URLSearchParams(window.location.search);\n          const redirect = urlParams.get('redirect');\n\n          // 如果有重定向地址，则跳转到重定向地址，否则跳转到用户中心\n          window.location.href = redirect || '/user?tab=home';\n          return true;\n        }\n        return false;\n      } catch (error) {\n        console.error('Login failed:', error);\n\n        // 更详细的错误处理\n        if (error.response?.status === 401) {\n          throw new Error('账号或密码错误');\n        } else if (error.response?.status === 429) {\n          throw new Error('登录尝试次数过多，请稍后再试');\n        } else if (error.response?.data?.message) {\n          throw new Error(error.response.data.message);\n        } else {\n          throw new Error('登录失败，请稍后重试');\n        }\n      }\n    },\n    async logout() {\n      try {\n        // 清除所有 localStorage - 移到最前面\n        localStorage.clear();\n        if (this.refreshToken) {\n          try {\n            await auth.logout();\n          } catch (error) {\n            console.error('Logout API error:', error);\n            // 即使 API 调用失败，继续清理本地状态\n          }\n        }\n\n        // 清除 store 状态\n        this.clearAuth();\n        const accountStore = useAccountStore();\n        const userStore = useUserStore();\n        accountStore.clearUserInfo();\n        userStore.clearUserInfo();\n\n        // 清除请求头中的 token\n        delete request.defaults.headers.common['Authorization'];\n\n        // 使用 window.location 强制跳转\n        window.location.href = '/login';\n        showToast('已退出登录', 'success');\n      } catch (error) {\n        console.error('Logout failed:', error);\n        showToast('退出登录失败，请重试', 'error');\n      }\n    },\n    clearAuth() {\n      // 清除请求头\n      delete request.defaults.headers.common['Authorization'];\n\n      // 重置状态\n      this.isLoggedIn = false;\n      this.token = null;\n      this.refreshToken = null;\n      this.tokenExpiresAt = null;\n      this.rememberMe = false;\n\n      // 确保清除所有认证相关的本地存储\n      Object.values(STORAGE_KEYS).forEach(key => {\n        localStorage.removeItem(key);\n      });\n    },\n    // 检查 token 是否过期\n    isTokenExpired() {\n      return !this.tokenExpiresAt || new Date().getTime() > this.tokenExpiresAt;\n    },\n    // 从 localStorage 恢复认证状态\n    restoreAuth() {\n      const token = localStorage.getItem('token');\n      const refreshToken = localStorage.getItem('refresh_token');\n      const tokenExpiresAt = localStorage.getItem('token_expires_at');\n      const rememberMe = localStorage.getItem('remember_me') === 'true';\n      if (token && refreshToken && tokenExpiresAt) {\n        this.token = token;\n        this.refreshToken = refreshToken;\n        this.tokenExpiresAt = parseInt(tokenExpiresAt);\n        this.rememberMe = rememberMe;\n        this.isLoggedIn = !this.isTokenExpired();\n        if (this.isLoggedIn) {\n          request.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        }\n      }\n    },\n    async register(data) {\n      try {\n        const response = await auth.register(data);\n        if (response?.data?.code === 200) {\n          const userData = response.data.data;\n          // 保存 token\n          this.token = userData.access;\n          this.refreshToken = userData.refresh;\n          localStorage.setItem('token', userData.access);\n          localStorage.setItem('refresh_token', userData.refresh);\n          localStorage.setItem('isLoggedIn', 'true');\n\n          // 设置请求头\n          request.defaults.headers.common['Authorization'] = `Bearer ${userData.access}`;\n\n          // 设置登录状态\n          this.isLoggedIn = true;\n\n          // 初始化用户数据\n          const accountStore = useAccountStore();\n          accountStore.userInfo = {\n            id: userData.id,\n            uid: userData.uid,\n            username: userData.username || `FB${userData.uid}`,\n            phone: userData.phone,\n            email: null,\n            avatar: null,\n            position: null,\n            bio: null,\n            is_vip: false,\n            is_staff: false,\n            background_image: null\n          };\n\n          // 保存到本地存储\n          localStorage.setItem('userInfo', JSON.stringify(accountStore.userInfo));\n          showToast('注册成功', 'success');\n\n          // 跳转到用户中心\n          window.location.replace('/user?tab=home');\n          return true;\n        }\n        return false;\n      } catch (error) {\n        console.error('Registration failed:', error);\n        this.clearAuth();\n        const accountStore = useAccountStore();\n        accountStore.clearUserInfo();\n        showToast(error.message || '注册失败，请稍后重试', 'error');\n        throw error;\n      }\n    },\n    async refreshAuthToken() {\n      try {\n        if (!this.refreshToken) {\n          throw new Error('No refresh token available');\n        }\n        const response = await auth.refreshToken(this.refreshToken);\n        if (response?.token) {\n          this.token = response.token;\n          localStorage.setItem('token', response.token);\n          request.defaults.headers.common['Authorization'] = `Bearer ${response.token}`;\n\n          // 更新过期时间\n          if (response.expires_in) {\n            this.tokenExpiresAt = new Date().getTime() + response.expires_in * 1000;\n            localStorage.setItem('token_expires_at', this.tokenExpiresAt.toString());\n          }\n          return true;\n        }\n        return false;\n      } catch (error) {\n        console.error('Token refresh failed:', error);\n        // 如果刷新失败，清除认证状态并重定向到登录页\n        this.clearAuth();\n        window.location.href = `/login?redirect=${encodeURIComponent(window.location.pathname)}`;\n        throw error;\n      }\n    },\n    async initialize() {\n      this.restoreAuth();\n      if (this.isAuthenticated) {\n        // 如果已登录，获取用户信息\n        try {\n          const accountStore = useAccountStore();\n          await accountStore.fetchUserInfo();\n        } catch (error) {\n          console.error('Failed to fetch user info during initialization:', error);\n          // 如果获取用户信息失败，可能是 token 已失效\n          this.clearAuth();\n        }\n      }\n    }\n  }\n});","map":{"version":3,"names":["defineStore","auth","request","useRouter","useAccountStore","useUserStore","showToast","STORAGE_KEYS","useAuthStore","state","isLoggedIn","localStorage","getItem","rememberMe","token","refreshToken","tokenExpiresAt","getters","isAuthenticated","rememberedAccount","currentToken","needsTokenRefresh","fiveMinutes","Date","getTime","actions","login","credentials","console","log","account","response","loginWithPassword","refresh","setItem","defaults","headers","common","accountStore","fetchUserInfo","userInfo","urlParams","URLSearchParams","window","location","search","redirect","get","href","error","status","Error","data","message","logout","clear","clearAuth","userStore","clearUserInfo","Object","values","forEach","key","removeItem","isTokenExpired","restoreAuth","parseInt","register","code","userData","access","id","uid","username","phone","email","avatar","position","bio","is_vip","is_staff","background_image","JSON","stringify","replace","refreshAuthToken","expires_in","toString","encodeURIComponent","pathname","initialize"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/auth.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { auth } from '@/api/auth'\nimport request from '@/utils/request'\nimport { useRouter } from 'vue-router'\nimport { useAccountStore } from '@/stores/account'\nimport { useUserStore } from '@/stores/user'\nimport { showToast } from '@/components/ToastMessage'\nimport { STORAGE_KEYS } from '@/utils/storage'\n\nexport const useAuthStore = defineStore('auth', {\n  state: () => ({\n    isLoggedIn: !!localStorage.getItem('token'),\n    rememberMe: false,\n    token: null,\n    refreshToken: null,\n    tokenExpiresAt: null\n  }),\n\n  getters: {\n    // 添加 getter，替代直接访问 isLoggedIn\n    isAuthenticated: (state) => state.isLoggedIn && !!state.token,\n    \n    // 获取记住的账号\n    rememberedAccount: () => localStorage.getItem('remembered_account'),\n    \n    // 获取当前 token\n    currentToken: (state) => state.token,\n    \n    // 检查是否需要刷新 token\n    needsTokenRefresh: (state) => {\n      if (!state.tokenExpiresAt) return false\n      // 如果 token 将在 5 分钟内过期，就需要刷新\n      const fiveMinutes = 5 * 60 * 1000\n      return new Date().getTime() + fiveMinutes > state.tokenExpiresAt\n    }\n  },\n\n  actions: {\n    async login(credentials, rememberMe = false) {\n      try {\n        console.log('Login attempt with:', { account: credentials.account, rememberMe })\n        const response = await auth.loginWithPassword(credentials)\n        console.log('Login response:', response)\n        \n        if (response) {\n          // 保存 token\n          this.token = response.token\n          this.refreshToken = response.refresh\n          localStorage.setItem('token', response.token)\n          localStorage.setItem('refresh_token', response.refresh)\n          \n          // 设置请求头\n          request.defaults.headers.common['Authorization'] = `Bearer ${response.token}`\n          \n          // 设置登录状态\n          this.isLoggedIn = true\n          \n          // 登录成功后立即获取用户信息并存储\n          const accountStore = useAccountStore()\n          console.log('Fetching user info after login...')\n          await accountStore.fetchUserInfo()\n          \n          console.log('User info fetched:', accountStore.userInfo)\n          \n          // 记住账号功能\n          if (rememberMe) {\n            localStorage.setItem('remember_me', 'true')\n            localStorage.setItem('remembered_account', credentials.account)\n          }\n          \n          // 显示登录成功提示\n          showToast('登录成功', 'success')\n          \n          // 获取重定向地址\n          const urlParams = new URLSearchParams(window.location.search)\n          const redirect = urlParams.get('redirect')\n          \n          // 如果有重定向地址，则跳转到重定向地址，否则跳转到用户中心\n          window.location.href = redirect || '/user?tab=home'\n          \n          return true\n        }\n        return false\n      } catch (error) {\n        console.error('Login failed:', error)\n        \n        // 更详细的错误处理\n        if (error.response?.status === 401) {\n          throw new Error('账号或密码错误')\n        } else if (error.response?.status === 429) {\n          throw new Error('登录尝试次数过多，请稍后再试')\n        } else if (error.response?.data?.message) {\n          throw new Error(error.response.data.message)\n        } else {\n          throw new Error('登录失败，请稍后重试')\n        }\n      }\n    },\n\n    async logout() {\n      try {\n        // 清除所有 localStorage - 移到最前面\n        localStorage.clear()\n        \n        if (this.refreshToken) {\n          try {\n            await auth.logout()\n          } catch (error) {\n            console.error('Logout API error:', error)\n            // 即使 API 调用失败，继续清理本地状态\n          }\n        }\n        \n        // 清除 store 状态\n        this.clearAuth()\n        const accountStore = useAccountStore()\n        const userStore = useUserStore()\n        accountStore.clearUserInfo()\n        userStore.clearUserInfo()\n        \n        // 清除请求头中的 token\n        delete request.defaults.headers.common['Authorization']\n        \n        // 使用 window.location 强制跳转\n        window.location.href = '/login'\n        \n        showToast('已退出登录', 'success')\n      } catch (error) {\n        console.error('Logout failed:', error)\n        showToast('退出登录失败，请重试', 'error')\n      }\n    },\n\n    clearAuth() {\n      // 清除请求头\n      delete request.defaults.headers.common['Authorization']\n      \n      // 重置状态\n      this.isLoggedIn = false\n      this.token = null\n      this.refreshToken = null\n      this.tokenExpiresAt = null\n      this.rememberMe = false\n      \n      // 确保清除所有认证相关的本地存储\n      Object.values(STORAGE_KEYS).forEach(key => {\n        localStorage.removeItem(key)\n      })\n    },\n\n    // 检查 token 是否过期\n    isTokenExpired() {\n      return !this.tokenExpiresAt || new Date().getTime() > this.tokenExpiresAt\n    },\n\n    // 从 localStorage 恢复认证状态\n    restoreAuth() {\n      const token = localStorage.getItem('token')\n      const refreshToken = localStorage.getItem('refresh_token')\n      const tokenExpiresAt = localStorage.getItem('token_expires_at')\n      const rememberMe = localStorage.getItem('remember_me') === 'true'\n\n      if (token && refreshToken && tokenExpiresAt) {\n        this.token = token\n        this.refreshToken = refreshToken\n        this.tokenExpiresAt = parseInt(tokenExpiresAt)\n        this.rememberMe = rememberMe\n        this.isLoggedIn = !this.isTokenExpired()\n        \n        if (this.isLoggedIn) {\n          request.defaults.headers.common['Authorization'] = `Bearer ${token}`\n        }\n      }\n    },\n\n    async register(data) {\n      try {\n        const response = await auth.register(data)\n        \n        if (response?.data?.code === 200) {\n          const userData = response.data.data\n          // 保存 token\n          this.token = userData.access\n          this.refreshToken = userData.refresh\n          localStorage.setItem('token', userData.access)\n          localStorage.setItem('refresh_token', userData.refresh)\n          localStorage.setItem('isLoggedIn', 'true')\n          \n          // 设置请求头\n          request.defaults.headers.common['Authorization'] = `Bearer ${userData.access}`\n          \n          // 设置登录状态\n          this.isLoggedIn = true\n          \n          // 初始化用户数据\n          const accountStore = useAccountStore()\n          accountStore.userInfo = {\n            id: userData.id,\n            uid: userData.uid,\n            username: userData.username || `FB${userData.uid}`,\n            phone: userData.phone,\n            email: null,\n            avatar: null,\n            position: null,\n            bio: null,\n            is_vip: false,\n            is_staff: false,\n            background_image: null\n          }\n          \n          // 保存到本地存储\n          localStorage.setItem('userInfo', JSON.stringify(accountStore.userInfo))\n          \n          showToast('注册成功', 'success')\n          \n          // 跳转到用户中心\n          window.location.replace('/user?tab=home')\n          \n          return true\n        }\n        return false\n      } catch (error) {\n        console.error('Registration failed:', error)\n        this.clearAuth()\n        const accountStore = useAccountStore()\n        accountStore.clearUserInfo()\n        showToast(error.message || '注册失败，请稍后重试', 'error')\n        throw error\n      }\n    },\n\n    async refreshAuthToken() {\n      try {\n        if (!this.refreshToken) {\n          throw new Error('No refresh token available')\n        }\n\n        const response = await auth.refreshToken(this.refreshToken)\n        \n        if (response?.token) {\n          this.token = response.token\n          localStorage.setItem('token', response.token)\n          request.defaults.headers.common['Authorization'] = `Bearer ${response.token}`\n          \n          // 更新过期时间\n          if (response.expires_in) {\n            this.tokenExpiresAt = new Date().getTime() + (response.expires_in * 1000)\n            localStorage.setItem('token_expires_at', this.tokenExpiresAt.toString())\n          }\n          \n          return true\n        }\n        return false\n      } catch (error) {\n        console.error('Token refresh failed:', error)\n        // 如果刷新失败，清除认证状态并重定向到登录页\n        this.clearAuth()\n        window.location.href = `/login?redirect=${encodeURIComponent(window.location.pathname)}`\n        throw error\n      }\n    },\n\n    async initialize() {\n      this.restoreAuth()\n      \n      if (this.isAuthenticated) {\n        // 如果已登录，获取用户信息\n        try {\n          const accountStore = useAccountStore()\n          await accountStore.fetchUserInfo()\n        } catch (error) {\n          console.error('Failed to fetch user info during initialization:', error)\n          // 如果获取用户信息失败，可能是 token 已失效\n          this.clearAuth()\n        }\n      }\n    }\n  }\n}) "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}