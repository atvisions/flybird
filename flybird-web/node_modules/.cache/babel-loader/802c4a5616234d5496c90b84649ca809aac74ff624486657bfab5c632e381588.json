{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, withCtx as _withCtx, Fragment as _Fragment, toDisplayString as _toDisplayString, createStaticVNode as _createStaticVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"min-h-screen bg-gray-50\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"max-w-3xl mx-auto px-4 py-16\"\n};\nconst _hoisted_3 = {\n  class: \"max-w-3xl mx-auto px-4 py-16\"\n};\nconst _hoisted_4 = {\n  class: \"text-center\"\n};\nconst _hoisted_5 = {\n  class: \"flex justify-center space-x-4\"\n};\nconst _hoisted_6 = {\n  class: \"max-w-3xl mx-auto px-4 py-16\"\n};\nconst _hoisted_7 = {\n  class: \"text-center\"\n};\nconst _hoisted_8 = {\n  class: \"text-gray-500 text-sm mb-8\"\n};\nconst _hoisted_9 = {\n  class: \"flex justify-center space-x-4\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_HeadView = _resolveComponent(\"HeadView\");\n  const _component_router_link = _resolveComponent(\"router-link\");\n  const _component_FootView = _resolveComponent(\"FootView\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_HeadView), _createCommentVNode(\" 等待状态 \"), $setup.status === 'pending' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, _cache[0] || (_cache[0] = [_createStaticVNode(\"<div class=\\\"text-center\\\"><div class=\\\"mb-8\\\"><svg class=\\\"mx-auto h-16 w-16 text-blue-500 animate-spin\\\" viewBox=\\\"0 0 24 24\\\"><circle class=\\\"opacity-25\\\" cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"10\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"4\\\" fill=\\\"none\\\"></circle><path class=\\\"opacity-75\\\" fill=\\\"currentColor\\\" d=\\\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\\\"></path></svg></div><h2 class=\\\"text-2xl font-bold text-gray-900 mb-4\\\">正在处理支付结果</h2><p class=\\\"text-gray-600\\\">请稍候，正在验证支付状态...</p></div>\", 1)]))) : $setup.status === 'success' ? (_openBlock(), _createElementBlock(_Fragment, {\n    key: 1\n  }, [_createCommentVNode(\" 成功状态 \"), _createElementVNode(\"div\", null, [_createElementVNode(\"div\", _hoisted_3, [_createCommentVNode(\" 支付成功 \"), _createElementVNode(\"div\", _hoisted_4, [_cache[3] || (_cache[3] = _createStaticVNode(\"<div class=\\\"mb-8\\\"><svg class=\\\"mx-auto h-16 w-16 text-green-500\\\" fill=\\\"none\\\" viewBox=\\\"0 0 24 24\\\" stroke=\\\"currentColor\\\"><path stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke-width=\\\"2\\\" d=\\\"M5 13l4 4L19 7\\\"></path></svg></div><h2 class=\\\"text-2xl font-bold text-gray-900 mb-4\\\">支付成功</h2><p class=\\\"text-gray-600 mb-8\\\">您的会员已经开通，立即开始享受会员权益吧！</p>\", 3)), _createElementVNode(\"div\", _hoisted_5, [_createVNode(_component_router_link, {\n    to: \"/member\",\n    class: \"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700\"\n  }, {\n    default: _withCtx(() => _cache[1] || (_cache[1] = [_createTextVNode(\" 查看会员信息 \")])),\n    _: 1 /* STABLE */\n  }), _createVNode(_component_router_link, {\n    to: \"/\",\n    class: \"inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n  }, {\n    default: _withCtx(() => _cache[2] || (_cache[2] = [_createTextVNode(\" 返回首页 \")])),\n    _: 1 /* STABLE */\n  })])])])])], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */)) : (_openBlock(), _createElementBlock(_Fragment, {\n    key: 2\n  }, [_createCommentVNode(\" 失败状态 \"), _createElementVNode(\"div\", null, [_createElementVNode(\"div\", _hoisted_6, [_createCommentVNode(\" 支付失败 \"), _createElementVNode(\"div\", _hoisted_7, [_cache[6] || (_cache[6] = _createStaticVNode(\"<div class=\\\"mb-8\\\"><svg class=\\\"mx-auto h-16 w-16 text-red-500\\\" fill=\\\"none\\\" viewBox=\\\"0 0 24 24\\\" stroke=\\\"currentColor\\\"><path stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke-width=\\\"2\\\" d=\\\"M6 18L18 6M6 6l12 12\\\"></path></svg></div><h2 class=\\\"text-2xl font-bold text-gray-900 mb-4\\\">支付失败</h2><p class=\\\"text-gray-600 mb-2\\\">抱歉，支付过程中出现了问题</p>\", 3)), _createElementVNode(\"p\", _hoisted_8, _toDisplayString($setup.errorMessage), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_9, [_createVNode(_component_router_link, {\n    to: \"/pro\",\n    class: \"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700\"\n  }, {\n    default: _withCtx(() => _cache[4] || (_cache[4] = [_createTextVNode(\" 重新支付 \")])),\n    _: 1 /* STABLE */\n  }), _createVNode(_component_router_link, {\n    to: \"/\",\n    class: \"inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n  }, {\n    default: _withCtx(() => _cache[5] || (_cache[5] = [_createTextVNode(\" 返回首页 \")])),\n    _: 1 /* STABLE */\n  })])])])])], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */)), _createVNode(_component_FootView)]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createVNode","_component_HeadView","_createCommentVNode","$setup","status","_hoisted_2","_cache","_createStaticVNode","_Fragment","_createElementVNode","_hoisted_3","_hoisted_4","_hoisted_5","_component_router_link","to","default","_withCtx","_createTextVNode","_","_hoisted_6","_hoisted_7","_hoisted_8","_toDisplayString","errorMessage","_hoisted_9","_component_FootView"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/payment/PaymentResult.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-gray-50\">\n    <HeadView />\n    \n    <!-- 等待状态 -->\n    <div v-if=\"status === 'pending'\" class=\"max-w-3xl mx-auto px-4 py-16\">\n      <div class=\"text-center\">\n        <div class=\"mb-8\">\n          <svg class=\"mx-auto h-16 w-16 text-blue-500 animate-spin\" viewBox=\"0 0 24 24\">\n            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\" fill=\"none\" />\n            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\n          </svg>\n        </div>\n        <h2 class=\"text-2xl font-bold text-gray-900 mb-4\">正在处理支付结果</h2>\n        <p class=\"text-gray-600\">请稍候，正在验证支付状态...</p>\n      </div>\n    </div>\n\n    <!-- 成功状态 -->\n    <div v-else-if=\"status === 'success'\">\n      <div class=\"max-w-3xl mx-auto px-4 py-16\">\n        <!-- 支付成功 -->\n        <div class=\"text-center\">\n          <div class=\"mb-8\">\n            <svg class=\"mx-auto h-16 w-16 text-green-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n            </svg>\n          </div>\n          <h2 class=\"text-2xl font-bold text-gray-900 mb-4\">支付成功</h2>\n          <p class=\"text-gray-600 mb-8\">您的会员已经开通，立即开始享受会员权益吧！</p>\n          <div class=\"flex justify-center space-x-4\">\n            <router-link \n              to=\"/member\" \n              class=\"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700\"\n            >\n              查看会员信息\n            </router-link>\n            <router-link \n              to=\"/\" \n              class=\"inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n            >\n              返回首页\n            </router-link>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 失败状态 -->\n    <div v-else>\n      <div class=\"max-w-3xl mx-auto px-4 py-16\">\n        <!-- 支付失败 -->\n        <div class=\"text-center\">\n          <div class=\"mb-8\">\n            <svg class=\"mx-auto h-16 w-16 text-red-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n            </svg>\n          </div>\n          <h2 class=\"text-2xl font-bold text-gray-900 mb-4\">支付失败</h2>\n          <p class=\"text-gray-600 mb-2\">抱歉，支付过程中出现了问题</p>\n          <p class=\"text-gray-500 text-sm mb-8\">{{ errorMessage }}</p>\n          <div class=\"flex justify-center space-x-4\">\n            <router-link \n              to=\"/pro\" \n              class=\"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700\"\n            >\n              重新支付\n            </router-link>\n            <router-link \n              to=\"/\" \n              class=\"inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n            >\n              返回首页\n            </router-link>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <FootView />\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { membership } from '@/api'\nimport { showToast } from '@/components/ToastMessage'\n\nconst route = useRoute()\nconst status = ref('pending')\nconst errorMessage = ref('')\nconst maxRetries = 5\nconst retryInterval = 2000\nlet retryCount = 0\n\nconst verifyPayment = async (orderNo) => {\n  try {\n    status.value = 'pending'\n    const response = await membership.verifyPayment(orderNo)\n    \n    if (response?.data?.code === 200) {\n      status.value = 'success'\n      showToast('支付成功', 'success')\n      window.dispatchEvent(new Event('payment-success'))\n      return true\n    } else if (response?.data?.code === 400) {\n      if (retryCount < maxRetries) {\n        retryCount++\n        console.log(`支付验证重试 ${retryCount}/${maxRetries}`)\n        await new Promise(resolve => setTimeout(resolve, retryInterval))\n        return await verifyPayment(orderNo)\n      }\n      status.value = 'fail'\n      errorMessage.value = response?.data?.message || '支付验证失败'\n      showToast(errorMessage.value, 'error')\n      return false\n    }\n    status.value = 'fail'\n    errorMessage.value = response?.data?.message || '支付验证失败'\n    showToast(errorMessage.value, 'error')\n    return false\n  } catch (error) {\n    console.error('支付验证失败:', error)\n    status.value = 'fail'\n    errorMessage.value = error?.response?.data?.message || '系统错误'\n    showToast('支付验证失败', 'error')\n    return false\n  }\n}\n\nonMounted(async () => {\n  // 从URL参数中获取支付状态\n  const reason = route.query.reason\n  if (reason) {\n    status.value = 'fail'\n    errorMessage.value = errorMessages[reason] || '支付失败，请重试'\n  } else {\n    // 处理支付宝回调\n    const orderNo = route.query.out_trade_no\n    if (orderNo) {\n      status.value = 'pending'\n      await verifyPayment(orderNo)\n    }\n  }\n})\n</script> "],"mappings":";;EACOA,KAAK,EAAC;AAAyB;;EADtCC,GAAA;EAKqCD,KAAK,EAAC;;;EAehCA,KAAK,EAAC;AAA8B;;EAElCA,KAAK,EAAC;AAAa;;EAQjBA,KAAK,EAAC;AAA+B;;EAoBzCA,KAAK,EAAC;AAA8B;;EAElCA,KAAK,EAAC;AAAa;;EAQnBA,KAAK,EAAC;AAA4B;;EAChCA,KAAK,EAAC;AAA+B;;;;;uBA5DlDE,mBAAA,CA+EM,OA/ENC,UA+EM,GA9EJC,YAAA,CAAYC,mBAAA,GAEZC,mBAAA,UAAa,EACFC,MAAA,CAAAC,MAAM,kB,cAAjBN,mBAAA,CAWM,OAXNO,UAWM,EAAAC,MAAA,QAAAA,MAAA,OAhBVC,kBAAA,ojB,MAmBoBJ,MAAA,CAAAC,MAAM,kB,cAAtBN,mBAAA,CA2BMU,SAAA;IA9CVX,GAAA;EAAA,IAkBIK,mBAAA,UAAa,EACbO,mBAAA,CA2BM,cA1BJA,mBAAA,CAyBM,OAzBNC,UAyBM,GAxBJR,mBAAA,UAAa,EACbO,mBAAA,CAsBM,OAtBNE,UAsBM,G,0BA5CdJ,kBAAA,oXA8BUE,mBAAA,CAaM,OAbNG,UAaM,GAZJZ,YAAA,CAKca,sBAAA;IAJZC,EAAE,EAAC,SAAS;IACZlB,KAAK,EAAC;;IAjCpBmB,OAAA,EAAAC,QAAA,CAkCa,MAEDV,MAAA,QAAAA,MAAA,OApCZW,gBAAA,CAkCa,UAED,E;IApCZC,CAAA;MAqCYlB,YAAA,CAKca,sBAAA;IAJZC,EAAE,EAAC,GAAG;IACNlB,KAAK,EAAC;;IAvCpBmB,OAAA,EAAAC,QAAA,CAwCa,MAEDV,MAAA,QAAAA,MAAA,OA1CZW,gBAAA,CAwCa,QAED,E;IA1CZC,CAAA;gFAiDIpB,mBAAA,CA4BMU,SAAA;IA7EVX,GAAA;EAAA,IAgDIK,mBAAA,UAAa,EACbO,mBAAA,CA4BM,cA3BJA,mBAAA,CA0BM,OA1BNU,UA0BM,GAzBJjB,mBAAA,UAAa,EACbO,mBAAA,CAuBM,OAvBNW,UAuBM,G,0BA3Edb,kBAAA,gXA4DUE,mBAAA,CAA4D,KAA5DY,UAA4D,EAAAC,gBAAA,CAAnBnB,MAAA,CAAAoB,YAAY,kBACrDd,mBAAA,CAaM,OAbNe,UAaM,GAZJxB,YAAA,CAKca,sBAAA;IAJZC,EAAE,EAAC,MAAM;IACTlB,KAAK,EAAC;;IAhEpBmB,OAAA,EAAAC,QAAA,CAiEa,MAEDV,MAAA,QAAAA,MAAA,OAnEZW,gBAAA,CAiEa,QAED,E;IAnEZC,CAAA;MAoEYlB,YAAA,CAKca,sBAAA;IAJZC,EAAE,EAAC,GAAG;IACNlB,KAAK,EAAC;;IAtEpBmB,OAAA,EAAAC,QAAA,CAuEa,MAEDV,MAAA,QAAAA,MAAA,OAzEZW,gBAAA,CAuEa,QAED,E;IAzEZC,CAAA;gEA+EIlB,YAAA,CAAYyB,mBAAA,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}