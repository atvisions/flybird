{"ast":null,"code":"import _objectSpread from \"/Users/liuzhao/Documents/Projects/flybird/flybird-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue';\nimport { useRouter, useRoute } from 'vue-router';\nimport { useAuthStore } from '@/stores/auth';\nimport { useAccountStore } from '@/stores/account';\nimport defaultAvatar from '@/assets/images/default-avatar.png';\nimport navigation from '@/config/navigation.json';\nimport { eventBus } from '@/utils/eventBus';\nimport { showToast } from '@/components/ToastMessage';\nimport request from '@/utils/request';\nimport { membership } from '@/api/membership';\nimport { storeToRefs } from 'pinia';\n\n// 导入所需的图标\nimport { DocumentTextIcon, DocumentIcon, UserIcon, Cog6ToothIcon, ArrowRightOnRectangleIcon, BellIcon, HeartIcon, ShieldCheckIcon, UserCircleIcon, WrenchScrewdriverIcon, MagnifyingGlassIcon, PhotoIcon, UserGroupIcon, XMarkIcon, Squares2X2Icon, SparklesIcon, StarIcon, ChevronRightIcon, ChevronDownIcon, Bars3Icon } from '@heroicons/vue/24/outline';\nimport { BellIcon as BellIconSolid } from '@heroicons/vue/24/solid';\n\n// 添加图标映射函数\n\nexport default {\n  __name: 'HeadView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const getIcon = menuKey => {\n      const iconMap = {\n        'home': Squares2X2Icon,\n        'profile': UserIcon,\n        'resumes': DocumentIcon,\n        'document': DocumentTextIcon,\n        'users': UserGroupIcon,\n        'photo': PhotoIcon,\n        'favorites': HeartIcon,\n        'notifications': BellIcon,\n        'settings': Cog6ToothIcon,\n        'security': ShieldCheckIcon,\n        'account': WrenchScrewdriverIcon,\n        'logout': ArrowRightOnRectangleIcon,\n        'crown': SparklesIcon\n      };\n      return iconMap[menuKey] || UserIcon; // 默认返回 UserIcon\n    };\n\n    // 状态管理 - 将所有状态管理放在一起\n    const router = useRouter();\n    const route = useRoute();\n    const authStore = useAuthStore();\n    const accountStore = useAccountStore();\n    const mobileMenuOpen = ref(false);\n    const showDropdown = ref(false);\n    const showMessageMenu = ref(false);\n    const resourceMenuOpen = ref(false);\n    const mobileSubmenuOpen = ref({});\n    const dropdownRef = ref(null);\n    const userBasicInfo = ref(null);\n\n    // 添加用户菜单状态\n    const userMenuOpen = ref(false);\n\n    // 切换菜单状态\n    const toggleUserMenu = () => {\n      userMenuOpen.value = !userMenuOpen.value;\n    };\n\n    // 点击外部时关闭菜单\n    const handleClickOutside = event => {\n      const target = event.target;\n\n      // 关闭用户菜单\n      const menu = document.querySelector('.user-menu');\n      const button = document.querySelector('.user-menu-button');\n      if (menu && !menu.contains(target) && !button.contains(target)) {\n        userMenuOpen.value = false;\n      }\n\n      // 关闭下拉菜单\n      if (dropdownRef.value && !dropdownRef.value.contains(target)) {\n        showDropdown.value = false;\n      }\n\n      // 关闭消息菜单\n      if (!target.closest('.message-menu')) {\n        showMessageMenu.value = false;\n      }\n\n      // 关闭资源菜单\n      if (!target.closest('.resource-menu')) {\n        resourceMenuOpen.value = false;\n      }\n    };\n\n    // 切换下拉菜单\n    const toggleDropdown = e => {\n      e.stopPropagation();\n      showDropdown.value = !showDropdown.value;\n      // 关闭其他菜单\n      showMessageMenu.value = false;\n      resourceMenuOpen.value = false;\n    };\n\n    // 模拟消息数据\n    const messages = ref([{\n      id: 1,\n      content: '您的简历被查看了',\n      time: '10分钟前',\n      isRead: false,\n      type: 'system'\n    }, {\n      id: 2,\n      content: '有新的职位推荐',\n      time: '1小时前',\n      isRead: true,\n      type: 'system'\n    }, {\n      id: 3,\n      content: '张三给你发送了一条私信',\n      time: '2小时前',\n      isRead: false,\n      type: 'private'\n    }]);\n\n    // 切换消息菜单\n    const toggleMessageMenu = e => {\n      e.stopPropagation();\n      showMessageMenu.value = !showMessageMenu.value;\n      if (showDropdown.value) {\n        showDropdown.value = false;\n      }\n    };\n\n    // 查看全部消息\n    const viewAllMessages = () => {\n      router.push('/messages');\n      showMessageMenu.value = false; // 关闭消息菜单\n    };\n\n    // 监听 accountStore 中的用户信息变化\n    watch([() => accountStore.userInfo, () => authStore.isLoggedIn], ([newUserInfo, isLoggedIn]) => {\n      if (newUserInfo && isLoggedIn) {\n        userBasicInfo.value = _objectSpread({}, newUserInfo);\n      } else {\n        userBasicInfo.value = null;\n      }\n    }, {\n      immediate: true,\n      deep: true\n    });\n\n    // 响应式状态\n    const windowWidth = ref(window?.innerWidth || 1024);\n\n    // 处理窗口大小变化\n    const handleResize = () => {\n      windowWidth.value = window.innerWidth;\n    };\n\n    // 响应式计算\n    const isMobile = computed(() => {\n      return windowWidth.value < 1024;\n    });\n\n    // 统一的菜单关闭处理\n    const closeMenus = e => {\n      if (!e.target.closest('.resource-menu')) {\n        resourceMenuOpen.value = false;\n      }\n      if (!e.target.closest('.message-menu') && !e.target.closest('.message-button')) {\n        showMessageMenu.value = false;\n      }\n      if (!e.target.closest('.user-dropdown') && !e.target.closest('.user-button')) {\n        showDropdown.value = false;\n      }\n    };\n\n    // 判断当前路由是否匹配\n    const isCurrentRoute = href => {\n      // 对于模板相关的路由，使用 startsWith 判断\n      if (href === '/templates') {\n        return route.path.startsWith('/templates');\n      }\n      // 对于社区相关的路由，使用 startsWith 判断\n      if (href === '/community') {\n        return route.path.startsWith('/community');\n      }\n      // 对于作品集相关的路由，使用 startsWith 判断\n      if (href === '/portfolio') {\n        return route.path.startsWith('/portfolio');\n      }\n      // 其他路由保持完全匹配\n      return route.path === href;\n    };\n\n    // 修改判断登录状态的逻辑\n    const isAuthenticated = computed(() => {\n      const status = authStore.isLoggedIn;\n      console.log('isAuthenticated computed:', {\n        isLoggedIn: authStore.isLoggedIn,\n        token: localStorage.getItem('token'),\n        status\n      });\n      return status;\n    });\n    const username = computed(() => {\n      if (!authStore.isLoggedIn) return '';\n      return accountStore.username;\n    });\n    const avatarUrl = computed(() => {\n      if (!authStore.isLoggedIn) return defaultAvatar;\n      const avatar = accountStore.avatar;\n      if (!avatar || avatar === 'null' || avatar === 'undefined') {\n        return defaultAvatar;\n      }\n      // 检查 avatar 是否是完整的 URL 或 base64 数据\n      if (avatar.startsWith('http') || avatar.startsWith('data:image')) {\n        return avatar;\n      }\n      // 如果是相对路径，则拼接基础 URL\n      return avatar.startsWith('/') ? `${process.env.VUE_APP_API_BASE_URL}${avatar}` : `${process.env.VUE_APP_API_BASE_URL}/${avatar}`;\n    });\n\n    // 判断是否在消息页面\n    const isMessageRoute = computed(() => {\n      return route.path.includes('/user') && route.query.tab === 'messages';\n    });\n\n    // 测试用：模拟未读消息数量\n    const unreadMessagesCount = ref(5);\n\n    // 获取未读消息数量\n    const fetchUnreadMessagesCount = async () => {\n      try {\n        // TODO: 调用 API 获取未读消息数量\n        // const response = await api.getUnreadMessagesCount()\n        // unreadMessagesCount.value = response.data.count\n        unreadMessagesCount.value = 5; // 临时测试数据\n      } catch (error) {\n        console.error('获取未读消息数量失败:', error);\n      }\n    };\n\n    // 在用户登录状态变化时获取未读消息数量\n    watch(() => authStore.isLoggedIn, newValue => {\n      if (newValue) {\n        fetchUnreadMessagesCount();\n      } else {\n        unreadMessagesCount.value = 0;\n      }\n    }, {\n      immediate: true\n    });\n\n    // 生命周期钩子\n    onMounted(async () => {\n      console.log('HeadView mounted - Initial state:', {\n        token: localStorage.getItem('token'),\n        isLoggedIn: authStore.isLoggedIn,\n        storeState: authStore.$state\n      });\n      document.addEventListener('click', closeMenus);\n      window.addEventListener('resize', handleResize);\n\n      // 检查登录状态\n      const token = localStorage.getItem('token');\n      console.log('Token check:', {\n        token\n      });\n      if (token) {\n        console.log('Setting up with token');\n        request.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        try {\n          console.log('Fetching user info...');\n          await accountStore.fetchUserInfo();\n          console.log('User info fetched:', accountStore.userInfo);\n          await Promise.all([fetchPointsInfo(), fetchSignInStatus()]);\n          console.log('Additional info fetched');\n        } catch (error) {\n          console.error('Error during initialization:', error);\n          if (error.response?.status === 401) {\n            console.log('401 error - logging out');\n            await authStore.logout();\n          }\n        }\n      } else {\n        console.log('No token found');\n      }\n      eventBus.on('avatar-updated', handleAvatarUpdate);\n\n      // 监听支付成功事件\n      window.addEventListener('payment-success', refreshUserInfo);\n    });\n\n    // 保持原有的事件清理\n    onUnmounted(() => {\n      eventBus.off('avatar-updated', handleAvatarUpdate);\n      // 移除支付成功事件监听\n      window.removeEventListener('payment-success', refreshUserInfo);\n    });\n\n    // 简化头像更新处理方法\n    const handleAvatarUpdate = newAvatar => {\n      if (accountStore.userInfo) {\n        accountStore.userInfo = _objectSpread(_objectSpread({}, accountStore.userInfo), {}, {\n          avatar: newAvatar\n        });\n      }\n    };\n\n    // 修改会员状态相关的计算属性\n    const isVip = computed(() => {\n      return accountStore.userInfo?.is_vip || false;\n    });\n\n    // 会员类型文本\n    const vipTypeText = computed(() => {\n      if (!isVip.value) return '普通用户';\n      return accountStore.userInfo?.vip_type === 'annual' ? '年度会员' : '月度会员';\n    });\n\n    // 剩余天数文本\n    const remainingDays = computed(() => {\n      if (!isVip.value || !accountStore.userInfo?.vip_expire_date) return '';\n      const expireDate = new Date(accountStore.userInfo.vip_expire_date);\n      const days = Math.ceil((expireDate - new Date()) / (1000 * 60 * 60 * 24));\n      return days > 0 ? `剩余 ${days} 天` : '即将到期';\n    });\n\n    // 会员按钮文本\n    const vipButtonText = computed(() => {\n      const userInfo = accountStore.userInfo;\n      if (!userInfo?.is_vip) return '升级会员';\n      if (userInfo.vip_type === 'lifetime') return '会员中心';\n      if (userInfo.vip_expire_time) {\n        const expireDate = new Date(userInfo.vip_expire_time);\n        const now = new Date();\n        const diffDays = Math.ceil((expireDate - now) / (1000 * 60 * 60 * 24));\n        return diffDays <= 30 ? '续费会员' : '会员中心';\n      }\n      return '会员中心';\n    });\n\n    // 会员状态相关的计算属性\n    const isExpiringSoon = computed(() => {\n      const userInfo = accountStore.userInfo;\n      if (!userInfo?.is_vip || userInfo.vip_type === 'lifetime') return false;\n      if (userInfo.vip_expire_time) {\n        const expireDate = new Date(userInfo.vip_expire_time);\n        const now = new Date();\n        const diffDays = Math.ceil((expireDate - now) / (1000 * 60 * 60 * 24));\n        return diffDays <= 30;\n      }\n      return false;\n    });\n\n    // 处理会员按钮点击\n    const handleVipButton = () => {\n      const userInfo = accountStore.userInfo;\n      if (!userInfo?.is_vip) {\n        router.push('/pro');\n      } else if (isExpiringSoon.value) {\n        router.push('/pro/renew');\n      } else {\n        router.push('/user?tab=membership');\n      }\n      showDropdown.value = false;\n    };\n\n    // 用户菜单选项\n    const mainMenuItems = computed(() => [{\n      key: 'templates',\n      label: '简历模板',\n      icon: 'document',\n      bgColor: 'bg-indigo-50',\n      iconColor: 'text-indigo-600',\n      action: () => {\n        router.push('/templates');\n        showDropdown.value = false;\n      }\n    }, {\n      key: 'community',\n      label: '社区',\n      icon: 'users',\n      bgColor: 'bg-pink-50',\n      iconColor: 'text-pink-600',\n      action: () => {\n        router.push('/community');\n        showDropdown.value = false;\n      }\n    }, {\n      key: 'portfolio',\n      label: '作品集',\n      icon: 'photo',\n      bgColor: 'bg-orange-50',\n      iconColor: 'text-orange-600',\n      action: () => {\n        router.push('/portfolio');\n        showDropdown.value = false;\n      }\n    }, {\n      key: 'home',\n      label: '创作管理',\n      icon: 'home',\n      bgColor: 'bg-blue-50',\n      iconColor: 'text-blue-600',\n      action: () => {\n        router.push('/user?tab=home');\n        showDropdown.value = false;\n      }\n    }, {\n      key: 'profile',\n      label: '我的档案',\n      icon: 'profile',\n      bgColor: 'bg-purple-50',\n      iconColor: 'text-purple-600',\n      action: () => {\n        router.push('/user?tab=profile');\n        showDropdown.value = false;\n      }\n    }, {\n      key: 'resumes',\n      label: '我的简历',\n      icon: 'resumes',\n      bgColor: 'bg-green-50',\n      iconColor: 'text-green-600',\n      action: () => {\n        router.push('/user?tab=resumes');\n        showDropdown.value = false;\n      }\n    }]);\n\n    // 添加账号操作菜单项\n    const accountMenuItems = computed(() => [{\n      key: 'settings',\n      label: '账号设置',\n      icon: 'settings',\n      bgColor: 'bg-amber-50',\n      iconColor: 'text-amber-600',\n      action: () => {\n        router.push('/user?tab=account');\n        showDropdown.value = false;\n      }\n    }]);\n\n    // 处理退出登录\n    const handleLogout = async () => {\n      try {\n        showDropdown.value = false;\n        await authStore.logout();\n        // 清除其他状态\n        userBasicInfo.value = null;\n        unreadMessagesCount.value = 0;\n        messages.value = [];\n        mobileMenuOpen.value = false;\n        showMessageMenu.value = false;\n        resourceMenuOpen.value = false;\n        showToast('退出成功', 'success');\n        const currentPath = router.currentRoute.value.fullPath;\n        router.push(`/login?redirect=${encodeURIComponent(currentPath)}`);\n      } catch (error) {\n        console.error('退出失败:', error);\n        showToast('退出失败，请重试', 'error');\n      }\n    };\n\n    // 搜索相关状态\n    const searchQuery = ref('');\n    const showSearchModal = ref(false);\n    const searchInput = ref(null);\n\n    // 监听 ESC 键关闭搜索弹窗\n    onMounted(() => {\n      document.addEventListener('keydown', e => {\n        if (e.key === 'Escape') {\n          showSearchModal.value = false;\n        }\n      });\n    });\n\n    // 修改搜索处理函数\n    const handleSearch = () => {\n      if (!searchQuery.value.trim()) return;\n      router.push({\n        path: '/search',\n        query: {\n          q: searchQuery.value\n        }\n      });\n      showSearchModal.value = false;\n    };\n    const handleSearchByType = type => {\n      if (!searchQuery.value.trim()) return;\n      router.push({\n        path: type.path,\n        query: {\n          q: searchQuery.value\n        }\n      });\n      showSearchModal.value = false;\n    };\n\n    // 搜索类型配置\n    const searchTypes = [{\n      label: '文章',\n      type: 'articles',\n      icon: DocumentTextIcon,\n      path: '/search/articles'\n    }, {\n      label: '作品集',\n      type: 'portfolio',\n      icon: PhotoIcon,\n      path: '/search/portfolio'\n    }, {\n      label: '用户',\n      type: 'users',\n      icon: UserGroupIcon,\n      path: '/search/users'\n    }];\n\n    // 监听点击事件，关闭搜索建议\n    onMounted(() => {\n      document.addEventListener('click', e => {\n        if (!e.target.closest('.search-container')) {\n          showSearchModal.value = false;\n        }\n      });\n    });\n    const refreshUserInfo = async () => {\n      try {\n        await accountStore.fetchUserInfo();\n        console.log('Refreshed User Info:', accountStore.userInfo);\n      } catch (error) {\n        console.error('Failed to refresh user info:', error);\n      }\n    };\n\n    // 积分信息\n    const pointsInfo = ref({\n      balance: 0,\n      level: 1,\n      sign_in_days: 0,\n      total_earned: 0,\n      signed_today: false\n    });\n\n    // 添加签到信息的数据结构\n    const signInInfo = ref({\n      can_sign_in: false,\n      sign_in_days: 0,\n      next_reward: null\n    });\n\n    // 获取签到状态\n    const fetchSignInStatus = async () => {\n      try {\n        const response = await membership.getSignInStatus();\n        if (response?.data?.code === 200) {\n          signInInfo.value = response.data.data;\n        }\n      } catch (error) {\n        console.error('获取签到状态失败:', error);\n      }\n    };\n\n    // 修改获取积分信息的方法\n    const fetchPointsInfo = async () => {\n      if (!authStore.isLoggedIn) return;\n      try {\n        const response = await membership.getPointsInfo();\n        if (response?.data?.code === 200) {\n          pointsInfo.value = response.data.data;\n          // 更新签到状态\n          await fetchSignInStatus();\n          console.log('积分信息更新:', {\n            pointsInfo: pointsInfo.value,\n            signInInfo: signInInfo.value\n          });\n        }\n      } catch (error) {\n        console.error('获取积分信息失败:', error);\n      }\n    };\n\n    // 修改签到处理方法\n    const handleSignIn = async () => {\n      if (!signInInfo.value.can_sign_in) return;\n      try {\n        const response = await membership.signIn();\n        if (response?.data?.code === 200) {\n          const {\n            points_earned\n          } = response.data.data;\n          showToast('签到成功', 'success');\n          showToast(`获得 ${points_earned} 积分`, 'success');\n          // 更新积分信息和签到状态\n          await Promise.all([fetchPointsInfo(), fetchSignInStatus()]);\n        }\n      } catch (error) {\n        console.error('签到失败:', error);\n        showToast(error.message || '签到失败，请稍后重试', 'error');\n      }\n    };\n\n    // 确保在移动端和桌面端都能正确初始化数据\n    onMounted(async () => {\n      document.addEventListener('click', handleClickOutside);\n      window.addEventListener('resize', handleResize);\n\n      // 只在已认证时获取数据\n      if (authStore.isLoggedIn) {\n        try {\n          // 先获取用户信息\n          await accountStore.fetchUserInfo();\n\n          // 确保在移动端也获取积分信息\n          if (isMobile.value) {\n            await fetchPointsInfo();\n          }\n\n          // 然后获取积分和签到信息\n          await Promise.all([fetchPointsInfo(), fetchSignInStatus()]);\n          console.log('初始化完成:', {\n            userInfo: accountStore.userInfo,\n            pointsInfo: pointsInfo.value,\n            signInInfo: signInInfo.value,\n            isMobile: isMobile.value\n          });\n        } catch (error) {\n          console.error('初始化数据失败:', error);\n          // 重置数据\n          pointsInfo.value = {\n            balance: 0,\n            level: 1,\n            sign_in_days: 0,\n            total_earned: 0\n          };\n          signInInfo.value = {\n            can_sign_in: false,\n            sign_in_days: 0,\n            next_reward: null\n          };\n        }\n      }\n    });\n\n    // 添加监听器确保用户登录状态变化时更新数据\n    watch(() => authStore.isLoggedIn, async newValue => {\n      if (newValue) {\n        await fetchPointsInfo();\n      } else {\n        // 重置数据\n        pointsInfo.value = {\n          balance: 0,\n          level: 1,\n          sign_in_days: 0,\n          total_earned: 0\n        };\n        signInInfo.value = {\n          can_sign_in: false,\n          sign_in_days: 0,\n          next_reward: null\n        };\n      }\n    }, {\n      immediate: true\n    });\n\n    // 处理菜单关闭\n    const closeDropdown = () => {\n      showDropdown.value = false;\n    };\n\n    // 处理点击详情按钮\n    const handleViewDetails = () => {\n      router.push('/user?tab=membership');\n      showDropdown.value = false;\n    };\n\n    // 修改积分详情按钮的点击处理\n    const handlePointsDetail = () => {\n      router.push('/user?tab=membership');\n      showDropdown.value = false;\n    };\n\n    // 添加子菜单切换函数\n    const toggleSubmenu = key => {\n      mobileSubmenuOpen.value[key] = !mobileSubmenuOpen.value[key];\n    };\n\n    // 添加对移动端状态的监听\n    watch(isMobile, async newValue => {\n      if (newValue && authStore.isLoggedIn) {\n        await fetchPointsInfo();\n      }\n    });\n\n    // 添加切换菜单的方法\n    const toggleMenu = () => {\n      mobileMenuOpen.value = !mobileMenuOpen.value;\n    };\n\n    // 监听登录状态变化\n    watch(() => authStore.isLoggedIn, (newValue, oldValue) => {\n      console.log('Auth state changed:', {\n        old: oldValue,\n        new: newValue,\n        token: localStorage.getItem('token')\n      });\n    }, {\n      immediate: true\n    });\n    const __returned__ = {\n      getIcon,\n      router,\n      route,\n      authStore,\n      accountStore,\n      mobileMenuOpen,\n      showDropdown,\n      showMessageMenu,\n      resourceMenuOpen,\n      mobileSubmenuOpen,\n      dropdownRef,\n      userBasicInfo,\n      userMenuOpen,\n      toggleUserMenu,\n      handleClickOutside,\n      toggleDropdown,\n      messages,\n      toggleMessageMenu,\n      viewAllMessages,\n      windowWidth,\n      handleResize,\n      isMobile,\n      closeMenus,\n      isCurrentRoute,\n      isAuthenticated,\n      username,\n      avatarUrl,\n      isMessageRoute,\n      unreadMessagesCount,\n      fetchUnreadMessagesCount,\n      handleAvatarUpdate,\n      isVip,\n      vipTypeText,\n      remainingDays,\n      vipButtonText,\n      isExpiringSoon,\n      handleVipButton,\n      mainMenuItems,\n      accountMenuItems,\n      handleLogout,\n      searchQuery,\n      showSearchModal,\n      searchInput,\n      handleSearch,\n      handleSearchByType,\n      searchTypes,\n      refreshUserInfo,\n      pointsInfo,\n      signInInfo,\n      fetchSignInStatus,\n      fetchPointsInfo,\n      handleSignIn,\n      closeDropdown,\n      handleViewDetails,\n      handlePointsDetail,\n      toggleSubmenu,\n      toggleMenu,\n      ref,\n      computed,\n      onMounted,\n      onUnmounted,\n      watch,\n      get useRouter() {\n        return useRouter;\n      },\n      get useRoute() {\n        return useRoute;\n      },\n      get useAuthStore() {\n        return useAuthStore;\n      },\n      get useAccountStore() {\n        return useAccountStore;\n      },\n      get defaultAvatar() {\n        return defaultAvatar;\n      },\n      get navigation() {\n        return navigation;\n      },\n      get eventBus() {\n        return eventBus;\n      },\n      get showToast() {\n        return showToast;\n      },\n      get request() {\n        return request;\n      },\n      get membership() {\n        return membership;\n      },\n      get storeToRefs() {\n        return storeToRefs;\n      },\n      get DocumentTextIcon() {\n        return DocumentTextIcon;\n      },\n      get DocumentIcon() {\n        return DocumentIcon;\n      },\n      get UserIcon() {\n        return UserIcon;\n      },\n      get Cog6ToothIcon() {\n        return Cog6ToothIcon;\n      },\n      get ArrowRightOnRectangleIcon() {\n        return ArrowRightOnRectangleIcon;\n      },\n      get BellIcon() {\n        return BellIcon;\n      },\n      get HeartIcon() {\n        return HeartIcon;\n      },\n      get ShieldCheckIcon() {\n        return ShieldCheckIcon;\n      },\n      get UserCircleIcon() {\n        return UserCircleIcon;\n      },\n      get WrenchScrewdriverIcon() {\n        return WrenchScrewdriverIcon;\n      },\n      get MagnifyingGlassIcon() {\n        return MagnifyingGlassIcon;\n      },\n      get PhotoIcon() {\n        return PhotoIcon;\n      },\n      get UserGroupIcon() {\n        return UserGroupIcon;\n      },\n      get XMarkIcon() {\n        return XMarkIcon;\n      },\n      get Squares2X2Icon() {\n        return Squares2X2Icon;\n      },\n      get SparklesIcon() {\n        return SparklesIcon;\n      },\n      get StarIcon() {\n        return StarIcon;\n      },\n      get ChevronRightIcon() {\n        return ChevronRightIcon;\n      },\n      get ChevronDownIcon() {\n        return ChevronDownIcon;\n      },\n      get Bars3Icon() {\n        return Bars3Icon;\n      },\n      get BellIconSolid() {\n        return BellIconSolid;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","onUnmounted","watch","useRouter","useRoute","useAuthStore","useAccountStore","defaultAvatar","navigation","eventBus","showToast","request","membership","storeToRefs","DocumentTextIcon","DocumentIcon","UserIcon","Cog6ToothIcon","ArrowRightOnRectangleIcon","BellIcon","HeartIcon","ShieldCheckIcon","UserCircleIcon","WrenchScrewdriverIcon","MagnifyingGlassIcon","PhotoIcon","UserGroupIcon","XMarkIcon","Squares2X2Icon","SparklesIcon","StarIcon","ChevronRightIcon","ChevronDownIcon","Bars3Icon","BellIconSolid","getIcon","menuKey","iconMap","router","route","authStore","accountStore","mobileMenuOpen","showDropdown","showMessageMenu","resourceMenuOpen","mobileSubmenuOpen","dropdownRef","userBasicInfo","userMenuOpen","toggleUserMenu","value","handleClickOutside","event","target","menu","document","querySelector","button","contains","closest","toggleDropdown","e","stopPropagation","messages","id","content","time","isRead","type","toggleMessageMenu","viewAllMessages","push","userInfo","isLoggedIn","newUserInfo","_objectSpread","immediate","deep","windowWidth","window","innerWidth","handleResize","isMobile","closeMenus","isCurrentRoute","href","path","startsWith","isAuthenticated","status","console","log","token","localStorage","getItem","username","avatarUrl","avatar","process","env","VUE_APP_API_BASE_URL","isMessageRoute","includes","query","tab","unreadMessagesCount","fetchUnreadMessagesCount","error","newValue","storeState","$state","addEventListener","defaults","headers","common","fetchUserInfo","Promise","all","fetchPointsInfo","fetchSignInStatus","response","logout","on","handleAvatarUpdate","refreshUserInfo","off","removeEventListener","newAvatar","isVip","is_vip","vipTypeText","vip_type","remainingDays","vip_expire_date","expireDate","Date","days","Math","ceil","vipButtonText","vip_expire_time","now","diffDays","isExpiringSoon","handleVipButton","mainMenuItems","key","label","icon","bgColor","iconColor","action","accountMenuItems","handleLogout","currentPath","currentRoute","fullPath","encodeURIComponent","searchQuery","showSearchModal","searchInput","handleSearch","trim","q","handleSearchByType","searchTypes","pointsInfo","balance","level","sign_in_days","total_earned","signed_today","signInInfo","can_sign_in","next_reward","getSignInStatus","data","code","getPointsInfo","handleSignIn","signIn","points_earned","message","closeDropdown","handleViewDetails","handlePointsDetail","toggleSubmenu","toggleMenu","oldValue","old","new"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/components/HeadView.vue"],"sourcesContent":["<template>\n  <header class=\"fixed w-full top-0 z-50 bg-white shadow\">\n    <!-- 主导航栏 -->\n    <nav class=\"mx-auto flex max-w-7xl items-center p-4 lg:px-8\" aria-label=\"Global\">\n      <!-- Logo 区域 -->\n      <div class=\"flex-shrink-0 flex items-center mr-8\">\n        <router-link to=\"/\" class=\"flex items-center space-x-2\">\n          <img src=\"@/assets/images/logo.png\" alt=\"\" class=\"w-8 h-8\">\n          <span class=\"hidden md:block text-gray-500 text-xl whitespace-nowrap\">飞鸟简历</span>\n        </router-link>\n      </div>\n\n      <!-- 桌面端导航菜单 -->\n      <div class=\"hidden lg:flex lg:gap-x-8\">\n        <template v-for=\"item in navigation.main\" :key=\"item.name\">\n          <!-- 普通菜单项 -->\n          <router-link v-if=\"!item.children\" :to=\"item.href\" :class=\"[\n            'text-base leading-6 py-2 border-b-2',\n            isCurrentRoute(item.href)\n              ? 'text-gray-900 font-medium border-gray-900'\n              : 'text-gray-500 hover:text-gray-900 border-transparent hover:border-gray-300'\n          ]\">\n            {{ item.name }}\n          </router-link>       \n        </template>\n\n        <router-link to=\"/pro\"\n          :class=\"[\n            'text-base leading-6 flex items-center py-2 border-b-2',\n            isCurrentRoute('/pro')\n              ? 'text-yellow-600 border-yellow-600'\n              : 'text-yellow-600 hover:text-yellow-500 border-transparent hover:border-yellow-500'\n          ]\">\n          <svg class=\"w-5 h-5 mr-1\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n            <path d=\"M5 16L3 5L8.5 10L12 4L15.5 10L21 5L19 16H5Z\" stroke-width=\"2\" stroke-linecap=\"round\"\n              stroke-linejoin=\"round\" />\n          </svg>\n          会员\n        </router-link>\n      </div>\n\n      <!-- 搜索框 -->\n      <div class=\"hidden lg:flex items-center justify-center ml-4\">\n        <!-- 搜索图标按钮 -->\n        <button \n          @click.stop=\"showSearchModal = true\"\n          class=\"p-2 text-gray-500 hover:text-gray-900 rounded-full hover:bg-gray-100\"\n        >\n          <MagnifyingGlassIcon class=\"w-5 h-5\" />\n        </button>\n      </div>\n\n      <!-- 右侧用户区域 -->\n      <div class=\"flex items-center ml-auto\">\n        <!-- 未登录状态 -->\n        <template v-if=\"!authStore.isAuthenticated\">\n          <div class=\"hidden lg:block\">\n            <router-link \n              :to=\"`/login?redirect=${encodeURIComponent($route.fullPath)}`\" \n              class=\"text-base leading-6 text-gray-900 hover:text-indigo-600\"\n            >\n              登录\n            </router-link>\n            <router-link \n              to=\"/register\"\n              class=\"ml-4 text-base leading-6 text-white bg-primary-500 px-3 py-2 rounded-md hover:bg-primary-500\"\n            >\n              注册\n            </router-link>\n          </div>\n        </template>\n\n        <!-- 已登录状态 -->\n        <template v-else>\n          <!-- 消息图标 -->\n          <button \n            @click.stop=\"toggleMessageMenu\"\n            class=\"p-1.5 text-gray-500 hover:text-[#1A56DB] relative message-menu mr-4 focus:outline-none\"\n            :class=\"{ 'text-[#1A56DB]': isMessageRoute || showMessageMenu }\"\n          >\n            <component \n              :is=\"showMessageMenu ? BellIconSolid : BellIcon\" \n              class=\"w-6 h-6 lg:w-6 lg:h-6 md:w-7 md:h-7\" \n              :class=\"{ 'text-[#1A56DB]': isMessageRoute || showMessageMenu }\" \n            />\n            <!-- 未读消息数量 -->\n            <span \n              v-if=\"unreadMessagesCount > 0\"\n              class=\"absolute -top-0.5 -right-0.5 min-w-[16px] h-4 bg-red-500 rounded-full text-[10px] font-medium text-white flex items-center justify-center px-1\"\n            >\n              {{ unreadMessagesCount > 99 ? '99+' : unreadMessagesCount }}\n            </span>\n          </button>\n\n          <!-- 消息下拉菜单 -->\n          <div v-if=\"showMessageMenu\" \n            class=\"fixed lg:absolute bg-white shadow-xl z-[100] overflow-hidden message-menu border border-gray-100\"\n            :class=\"[\n              isMobile ? 'w-full top-[60px] inset-x-0 bg-white' : 'w-80 top-[72px] rounded-xl'\n            ]\"\n            :style=\"{\n              right: isMobile ? '' : 'calc((100vw - 1280px) / 2 + 120px)'\n            }\"\n          >\n            <!-- 消息菜单头部 -->\n            <div class=\"px-4 py-3 border-b border-gray-100 bg-white\">\n              <div class=\"flex items-center justify-between\">\n                <h3 class=\"text-base font-medium text-gray-900\">消息通知</h3>\n                <button class=\"text-sm text-gray-500 hover:text-gray-700\">全部标记已读</button>\n              </div>\n            </div>\n            \n            <!-- 消息列表 -->\n            <div class=\"max-h-[400px] overflow-y-auto bg-white\">\n              <div v-if=\"messages.length === 0\" class=\"py-8 text-center text-gray-500\">\n                暂无消息\n              </div>\n              <div v-else class=\"divide-y divide-gray-100 py-1\">\n                <div v-for=\"message in messages\" :key=\"message.id\" \n                  @click.stop=\"viewMessageDetail(message)\"\n                  class=\"px-4 py-3 hover:bg-gray-50 cursor-pointer\"\n                >\n                  <div class=\"flex items-start space-x-3\">\n                    <div class=\"flex-shrink-0\">\n                      <div class=\"w-2 h-2 mt-2 rounded-full\" \n                        :class=\"message.isRead ? 'bg-gray-300' : 'bg-blue-500'\"\n                      ></div>\n                    </div>\n                    <div class=\"flex-1 min-w-0\">\n                      <div class=\"flex items-center justify-between mb-1\">\n                        <span \n                          class=\"text-xs px-1.5 py-0.5 rounded\"\n                          :class=\"{\n                            'bg-blue-100 text-blue-700': message.type === 'system',\n                            'bg-green-100 text-green-700': message.type === 'private'\n                          }\"\n                        >\n                          {{ message.type === 'system' ? '系统通知' : '私信' }}\n                        </span>\n                        <span class=\"text-xs text-gray-500\">{{ message.time }}</span>\n                      </div>\n                      <p class=\"text-sm text-gray-900\">{{ message.content }}</p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            <!-- 消息菜单底部 -->\n            <div class=\"px-4 py-3 border-t border-gray-100 text-center bg-white\">\n              <button \n                class=\"text-sm text-indigo-600 hover:text-indigo-700\"\n                @click=\"viewAllMessages\"\n              >\n                查看全部消息\n              </button>\n            </div>\n          </div>\n\n          <div class=\"relative\" ref=\"dropdownRef\">\n            <button \n              @click.stop=\"toggleDropdown\"\n              class=\"flex items-center cursor-pointer\"\n            >\n              <div class=\"relative\">\n                <img \n                  :src=\"avatarUrl\"\n                  class=\"h-7 w-7 lg:h-8 lg:w-8 rounded-full object-cover\"\n                  alt=\"用户头像\"\n                />\n                <!-- VIP 标识 -->\n                <div v-if=\"isVip\" \n                  class=\"absolute -top-1 -right-1 w-3.5 h-3.5 lg:w-4 lg:h-4 bg-[#FFB800] rounded-full flex items-center justify-center border border-white shadow-sm\"\n                >\n                  <span class=\"text-[9px] lg:text-[10px] font-bold text-white\">V</span>\n                </div>\n              </div>\n              <span class=\"hidden lg:inline ml-2\">{{ username }}</span>\n              <ChevronDownIcon \n                class=\"h-4 w-4 lg:h-5 lg:w-5 ml-1\"\n                :class=\"{ 'rotate-180': showDropdown }\"\n              />\n            </button>\n\n            <!-- 下拉菜单内容 -->\n            <div \n              v-if=\"showDropdown\"\n              class=\"fixed lg:absolute right-0 top-[60px] w-full lg:w-80 bg-white shadow-xl rounded-xl overflow-hidden border border-gray-100 z-50\"\n              :class=\"[\n                isMobile ? 'inset-x-0' : '',\n                isMobile ? 'h-[calc(100vh-60px)]' : '',\n                isMobile ? 'overflow-y-auto' : ''\n              ]\"\n              @click.stop\n            >\n              <!-- 用户信息头部 -->\n              <div class=\"px-4 lg:px-6 py-5 border-b border-gray-100\">\n                <div class=\"flex items-center space-x-3\">\n                  <div class=\"relative\">\n                    <img \n                      :src=\"avatarUrl\"\n                      :key=\"avatarUrl\"\n                      class=\"h-14 w-14 rounded-full object-cover\"\n                      alt=\"用户头像\" \n                      @error=\"handleImageError\" \n                    />\n                    <!-- VIP 标识 -->\n                    <div v-if=\"isVip\" \n                      class=\"absolute top-0 right-0 w-5 h-5 bg-[#FFB800] rounded-full flex items-center justify-center border border-white shadow-sm\"\n                    >\n                      <span class=\"text-[11px] font-bold text-white\">V</span>\n                    </div>\n                  </div>\n                  <div class=\"flex-1\">\n                    <div class=\"flex items-center justify-between\">\n                      <div>\n                        <div class=\"text-base lg:text-lg font-medium text-gray-900\">{{ username }}</div>\n                        <div class=\"text-sm flex flex-col\" :class=\"{\n                          'text-[#1A56DB]': isVip\n                        }\">\n                          <span>{{ vipTypeText }}</span>\n                          <span v-if=\"remainingDays\" class=\"mt-0.5 text-xs\">{{ remainingDays }}</span>\n                        </div>\n                      </div>\n                      <button\n                        @click=\"handleVipButton\"\n                        class=\"px-2.5 lg:px-3 py-1.5 text-xs lg:text-sm bg-gradient-to-r from-[#1A56DB] to-blue-500 text-white rounded-full hover:opacity-90 transition-opacity flex items-center whitespace-nowrap\"\n                      >\n                        <SparklesIcon class=\"w-3.5 h-3.5 mr-1\" />\n                        {{ vipButtonText }}\n                      </button>\n                    </div>\n                  </div>\n                </div>\n                <!-- 积分信息 -->\n                <div class=\"mt-4 bg-gray-50 rounded-lg p-4\">\n                  <!-- 积分和签到 -->\n                  <div class=\"flex items-center justify-between\">\n                    <div class=\"flex items-center space-x-2\">\n                      <StarIcon class=\"w-4 h-4 text-[#1A56DB]\" />\n                      <span class=\"text-sm text-gray-600\">我的积分</span>\n                    </div>\n                    <div class=\"flex items-center space-x-2 lg:space-x-4\">\n                      <span class=\"text-base lg:text-lg font-medium text-[#1A56DB]\">{{ pointsInfo?.balance || 0 }}</span>\n                      <button \n                        @click=\"handleSignIn\"\n                        class=\"px-2 py-1 text-xs rounded-full border whitespace-nowrap\"\n                        :class=\"[\n                          !signInInfo?.can_sign_in\n                            ? 'border-gray-200 text-gray-400 bg-gray-100 cursor-not-allowed' \n                            : 'border-blue-500 text-blue-600 hover:bg-blue-50'\n                        ]\"\n                        :disabled=\"!signInInfo?.can_sign_in\"\n                      >\n                        {{ !signInInfo?.can_sign_in ? '已签到' : '每日签到' }}\n                      </button>\n                    </div>\n                  </div>\n                  <!-- 签到进度 -->\n                  <div class=\"mt-3 flex items-center justify-between\">\n                    <div class=\"flex items-center\">\n                      <span class=\"text-xs text-gray-500\">\n                        已连续签到 {{ signInInfo?.sign_in_days || 0 }} 天\n                        <template v-if=\"signInInfo?.next_reward\">\n                          <span class=\"hidden lg:inline ml-2 text-blue-600\">\n                            再签到 {{ signInInfo?.next_reward?.days }} 天可获得 {{ signInInfo?.next_reward?.points }} 积分奖励\n                          </span>\n                        </template>\n                      </span>\n                    </div>\n                    <button \n                      @click=\"handlePointsDetail\"\n                      class=\"text-xs text-blue-600 hover:text-blue-700 flex items-center whitespace-nowrap ml-2\"\n                    >\n                      <span>积分明细</span>\n                      <ChevronRightIcon class=\"w-4 h-4 ml-0.5\" />\n                    </button>\n                  </div>\n                </div>\n              </div>\n\n              <!-- 菜单项 -->\n              <div class=\"p-4\">\n                <!-- 频道导航 -->\n                <div class=\"mb-4 pb-4 border-b border-gray-100\">\n                  <div class=\"grid grid-cols-3 gap-2\">\n                    <button v-for=\"item in mainMenuItems.slice(0, 3)\" :key=\"item.key\"\n                      class=\"flex flex-col items-center p-3 rounded-lg hover:bg-gray-50 transition-colors\"\n                      @click=\"item.action\"\n                    >\n                      <div :class=\"[\n                        'w-10 h-10 rounded-md flex items-center justify-center mb-1.5',\n                        item.bgColor\n                      ]\">\n                        <component \n                          :is=\"getIcon(item.icon)\" \n                          class=\"h-5 w-5\"\n                          :class=\"item.iconColor\" \n                        />\n                      </div>\n                      <span class=\"text-xs text-gray-600\">{{ item.label }}</span>\n                    </button>\n                  </div>\n                </div>\n\n                <!-- 管理中心 -->\n                <div class=\"mb-4 pb-4 border-b border-gray-100\">\n                  <div class=\"grid grid-cols-3 gap-2\">\n                    <button v-for=\"item in mainMenuItems.slice(3)\" :key=\"item.key\"\n                      class=\"flex flex-col items-center p-3 rounded-lg hover:bg-gray-50 transition-colors\"\n                      @click=\"item.action\"\n                    >\n                      <div :class=\"[\n                        'w-10 h-10 rounded-md flex items-center justify-center mb-1.5',\n                        item.bgColor\n                      ]\">\n                        <component \n                          :is=\"getIcon(item.icon)\" \n                          class=\"h-5 w-5\"\n                          :class=\"item.iconColor\" \n                        />\n                      </div>\n                      <span class=\"text-xs text-gray-600\">{{ item.label }}</span>\n                    </button>\n                  </div>\n                </div>\n\n                <!-- 账号操作 -->\n                <div class=\"pt-3\">\n                  <div class=\"grid grid-cols-2 gap-2\">\n                    <button v-for=\"item in accountMenuItems\" :key=\"item.key\"\n                      class=\"flex items-center justify-center px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors space-x-1\"\n                      @click=\"item.action\"\n                    >\n                      <div :class=\"['w-5 h-5 flex items-center justify-center', item.iconColor]\">\n                        <component :is=\"getIcon(item.icon)\" class=\"h-4 w-4\" :class=\"item.iconColor\" />\n                      </div>\n                      <span>{{ item.label }}</span>\n                    </button>\n                    <button\n                      class=\"flex items-center justify-center px-3 py-2 text-sm text-red-600 hover:bg-red-50/75 rounded-lg transition-colors space-x-1\"\n                      @click=\"handleLogout\"\n                    >\n                      <div class=\"w-5 h-5 flex items-center justify-center\">\n                        <ArrowRightOnRectangleIcon class=\"h-4 w-4 text-red-600\" />\n                      </div>\n                      <span>退出登录</span>\n                    </button>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n          </div>\n        </template>\n\n        <!-- 添加移动端汉堡菜单按钮 -->\n        <button \n          type=\"button\" \n          class=\"lg:hidden p-2 text-gray-500 hover:text-gray-900\"\n          @click=\"toggleMenu\"\n        >\n          <span class=\"sr-only\">打开菜单</span>\n          <Bars3Icon v-if=\"!mobileMenuOpen\" class=\"h-6 w-6\" />\n          <XMarkIcon v-else class=\"h-6 w-6\" />\n        </button>\n      </div>\n    </nav>\n\n    <!-- 移动端菜单抽屉 -->\n    <div v-if=\"mobileMenuOpen\" class=\"fixed inset-0 z-50\" @click=\"toggleMenu\">\n      <div class=\"fixed inset-0 bg-black/25\"></div>\n\n      <div class=\"fixed inset-y-0 right-0 z-50 w-full overflow-y-auto bg-white sm:max-w-sm\" @click.stop>\n        <!-- 移动端菜单头部 -->\n        <div class=\"flex items-center justify-between p-4 border-b border-gray-100\">\n          <router-link to=\"/\" class=\"flex items-center space-x-2\" @click=\"toggleMenu\">\n            <img src=\"@/assets/images/logo.png\" alt=\"\" class=\"w-8 h-8\">\n            <span class=\"text-gray-500 text-xl whitespace-nowrap\">飞鸟简历</span>\n          </router-link>\n          <!-- 关闭按钮 -->\n          <button type=\"button\" @click=\"toggleMenu\" class=\"p-2 text-gray-700\">\n            <span class=\"sr-only\">关闭菜单</span>\n            <XMarkIcon class=\"h-6 w-6\" />\n          </button>\n        </div>\n\n        <!-- 移动端用户信息 -->\n        <div v-if=\"authStore.isLoggedIn\" class=\"px-4 py-4 border-b border-gray-100\">\n          <div class=\"flex items-center space-x-3\">\n            <div class=\"relative\">\n              <img :src=\"avatarUrl\" class=\"w-12 h-12 rounded-full object-cover\" alt=\"用户头像\" />\n              <div v-if=\"isVip\" class=\"absolute -top-1 -right-1 w-4 h-4 bg-[#FFB800] rounded-full flex items-center justify-center border border-white shadow-sm\">\n                <span class=\"text-[10px] font-bold text-white\">V</span>\n              </div>\n            </div>\n            <div class=\"flex-1\">\n              <div class=\"text-base font-medium text-gray-900\">{{ username }}</div>\n              <div class=\"text-sm text-gray-500\">{{ vipTypeText }}</div>\n            </div>\n          </div>\n        </div>\n\n        <!-- 移动端积分信息 -->\n        <div v-if=\"authStore.isLoggedIn\" class=\"px-4 py-4 border-b border-gray-100\">\n          <div class=\"bg-gray-50 rounded-lg p-4\">\n            <div class=\"flex items-center justify-between\">\n              <div class=\"flex items-center space-x-2\">\n                <StarIcon class=\"w-4 h-4 text-[#1A56DB]\" />\n                <span class=\"text-sm text-gray-600\">我的积分</span>\n              </div>\n              <div class=\"flex items-center space-x-2\">\n                <span class=\"text-base font-medium text-[#1A56DB]\">{{ pointsInfo?.balance || 0 }}</span>\n                <button \n                  @click=\"handleSignIn\"\n                  class=\"px-2 py-1 text-xs rounded-full border whitespace-nowrap\"\n                  :class=\"[\n                    !signInInfo?.can_sign_in\n                      ? 'border-gray-200 text-gray-400 bg-gray-100 cursor-not-allowed' \n                      : 'border-blue-500 text-blue-600 hover:bg-blue-50'\n                  ]\"\n                  :disabled=\"!signInInfo?.can_sign_in\"\n                >\n                  {{ !signInInfo?.can_sign_in ? '已签到' : '每日签到' }}\n                </button>\n              </div>\n            </div>\n            <div class=\"mt-3 flex items-center justify-between\">\n              <span class=\"text-xs text-gray-500\">\n                已连续签到 {{ signInInfo?.sign_in_days || 0 }} 天\n              </span>\n              <button \n                @click=\"handlePointsDetail\"\n                class=\"text-xs text-blue-600 hover:text-blue-700 flex items-center whitespace-nowrap\"\n              >\n                <span>积分明细</span>\n                <ChevronRightIcon class=\"w-4 h-4 ml-0.5\" />\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <!-- 移动端菜单内容 -->\n        <div class=\"py-2\">\n          <!-- 导航菜单 -->\n          <div>\n            <template v-for=\"item in navigation.main\" :key=\"item.name\">\n              <!-- 普通菜单项 -->\n              <router-link v-if=\"!item.children\" :to=\"item.href\"\n                class=\"block px-4 py-3 text-base text-gray-900 border-b border-gray-100\"\n                :class=\"isCurrentRoute(item.href) ? 'text-indigo-600' : ''\" @click=\"toggleMenu\">\n                {{ item.name }}\n              </router-link>\n\n              <!-- 带子菜单的项 -->\n              <div v-else class=\"border-b border-gray-100\">\n                <button class=\"flex items-center justify-between w-full px-4 py-3 text-base text-gray-900\"\n                  @click=\"toggleMobileSubmenu(item.name)\">\n                  <span>{{ item.name }}</span>\n                  <svg class=\"w-5 h-5 transition-transform duration-200\"\n                    :class=\"{ 'rotate-180': mobileSubmenuOpen[item.name] }\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                    <path fill-rule=\"evenodd\"\n                      d=\"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z\"\n                      clip-rule=\"evenodd\" />\n                  </svg>\n                </button>\n\n                <div v-show=\"mobileSubmenuOpen[item.name]\" class=\"bg-gray-50\">\n                  <template v-for=\"category in item.children\" :key=\"category.name\">\n                    <div class=\"px-4 py-2\">\n                      <div class=\"font-medium text-gray-900\">{{ category.name }}</div>\n                      <div class=\"mt-1 space-y-1\">\n                        <router-link v-for=\"subItem in category.children\" :key=\"subItem.name\" :to=\"subItem.href\"\n                          class=\"block py-1 pl-3 text-sm text-gray-600 hover:text-indigo-600\" @click=\"toggleMenu\">\n                          {{ subItem.name }}\n                        </router-link>\n                      </div>\n                    </div>\n                  </template>\n                </div>\n              </div>\n            </template>\n          </div>\n\n          <!-- 未登录状态下显示登录注册按钮 -->\n          <div v-if=\"!authStore.isLoggedIn\" class=\"mt-4 px-4 space-y-3\">\n            <router-link \n              :to=\"`/login?redirect=${encodeURIComponent($route.fullPath)}`\"\n              class=\"block w-full text-center px-4 py-2.5 text-sm text-gray-900 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\n              @click=\"toggleMenu\"\n            >\n              登录\n            </router-link>\n            <router-link \n              to=\"/register\"\n              class=\"block w-full text-center px-4 py-2.5 text-sm text-white bg-primary-500 rounded-lg hover:bg-primary-600 transition-colors\"\n              @click=\"toggleMenu\"\n            >\n              注册\n            </router-link>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 搜索弹窗 -->\n    <Transition\n      enter-active-class=\"transition duration-200 ease-out\"\n      enter-from-class=\"opacity-0 scale-95\"\n      enter-to-class=\"opacity-100 scale-100\"\n      leave-active-class=\"transition duration-150 ease-in\"\n      leave-from-class=\"opacity-100 scale-100\"\n      leave-to-class=\"opacity-0 scale-95\"\n    >\n      <div v-if=\"showSearchModal\" class=\"fixed inset-0 z-[100]\">\n        <!-- 黑色遮罩 -->\n        <div \n          class=\"fixed inset-0 bg-black/50 transition-opacity\" \n          @click=\"showSearchModal = false\"\n        />\n        \n        <!-- 关闭按钮 -->\n        <button \n          @click=\"showSearchModal = false\"\n          class=\"fixed top-4 right-4 p-2 rounded-full bg-black/20 hover:bg-black/30 transition-colors z-[110]\"\n        >\n          <XMarkIcon class=\"w-6 h-6 text-white\" />\n        </button>\n\n        <!-- 搜索框容器 -->\n        <div class=\"relative min-h-screen flex items-start justify-center p-4 sm:p-6\" @click.stop>\n          <div class=\"w-full max-w-2xl mt-20\">\n            <!-- 搜索框 -->\n            <div class=\"bg-white rounded-xl shadow-2xl overflow-hidden\">\n              <div class=\"relative\">\n                <div class=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\n                  <MagnifyingGlassIcon class=\"h-5 w-5 text-gray-400\" />\n                </div>\n                <input\n                  ref=\"searchInput\"\n                  type=\"text\"\n                  v-model=\"searchQuery\"\n                  @keyup.enter=\"handleSearch\"\n                  @keyup.esc=\"showSearchModal = false\"\n                  placeholder=\"搜索文章、作品集、用户\"\n                  class=\"block w-full pl-12 pr-4 py-4 text-lg bg-transparent border-0 focus:ring-0 placeholder-gray-500\"\n                  autofocus\n                />\n              </div>\n              \n              <!-- 搜索建议 -->\n              <div v-if=\"searchQuery\" class=\"border-t border-gray-100\">\n                <div class=\"p-4\">\n                  <div class=\"text-xs font-medium text-gray-500 mb-3\">搜索建议</div>\n                  <div class=\"space-y-2\">\n                    <button\n                      v-for=\"(type, index) in searchTypes\"\n                      :key=\"index\"\n                      @click=\"handleSearchByType(type)\"\n                      class=\"w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 rounded-lg flex items-center transition-colors\"\n                    >\n                      <component :is=\"type.icon\" class=\"w-5 h-5 mr-3 text-gray-400\" />\n                      在{{ type.label }}中搜索\"{{ searchQuery }}\"\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </Transition>\n\n    <!-- 只在登录后显示积分信息 -->\n    <div v-if=\"authStore.isLoggedIn\" class=\"points-info\">\n      <!-- 积分相关内容 -->\n    </div>\n  </header>\n</template>\n<script setup>\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport { useAuthStore } from '@/stores/auth'\nimport { useAccountStore } from '@/stores/account'\nimport defaultAvatar from '@/assets/images/default-avatar.png'\nimport navigation from '@/config/navigation.json'\nimport { eventBus } from '@/utils/eventBus'\nimport { showToast } from '@/components/ToastMessage'\nimport request from '@/utils/request'\nimport { membership } from '@/api/membership'\nimport { storeToRefs } from 'pinia'\n\n// 导入所需的图标\nimport {\n  DocumentTextIcon,\n  DocumentIcon,\n  UserIcon,\n  Cog6ToothIcon,\n  ArrowRightOnRectangleIcon,\n  BellIcon,\n  HeartIcon,\n  ShieldCheckIcon,\n  UserCircleIcon,\n  WrenchScrewdriverIcon,\n  MagnifyingGlassIcon,\n  PhotoIcon,\n  UserGroupIcon,\n  XMarkIcon,\n  Squares2X2Icon,\n  SparklesIcon,\n  StarIcon,\n  ChevronRightIcon,\n  ChevronDownIcon,\n  Bars3Icon\n} from '@heroicons/vue/24/outline'\n\nimport { BellIcon as BellIconSolid } from '@heroicons/vue/24/solid'\n\n// 添加图标映射函数\nconst getIcon = (menuKey) => {\n  const iconMap = {  \n    'home': Squares2X2Icon,\n    'profile': UserIcon,\n    'resumes': DocumentIcon,\n    'document': DocumentTextIcon,\n    'users': UserGroupIcon,\n    'photo': PhotoIcon,\n    'favorites': HeartIcon,\n    'notifications': BellIcon,\n    'settings': Cog6ToothIcon,\n    'security': ShieldCheckIcon,\n    'account': WrenchScrewdriverIcon,\n    'logout': ArrowRightOnRectangleIcon,\n    'crown': SparklesIcon,\n  }\n  return iconMap[menuKey] || UserIcon // 默认返回 UserIcon\n}\n\n// 状态管理 - 将所有状态管理放在一起\nconst router = useRouter()\nconst route = useRoute()\nconst authStore = useAuthStore()\nconst accountStore = useAccountStore()\nconst mobileMenuOpen = ref(false)\nconst showDropdown = ref(false)\nconst showMessageMenu = ref(false)\nconst resourceMenuOpen = ref(false)\nconst mobileSubmenuOpen = ref({})\nconst dropdownRef = ref(null)\nconst userBasicInfo = ref(null)\n\n// 添加用户菜单状态\nconst userMenuOpen = ref(false)\n\n// 切换菜单状态\nconst toggleUserMenu = () => {\n  userMenuOpen.value = !userMenuOpen.value\n}\n\n// 点击外部时关闭菜单\nconst handleClickOutside = (event) => {\n  const target = event.target\n  \n  // 关闭用户菜单\n  const menu = document.querySelector('.user-menu')\n  const button = document.querySelector('.user-menu-button')\n  if (menu && !menu.contains(target) && !button.contains(target)) {\n    userMenuOpen.value = false\n  }\n  \n  // 关闭下拉菜单\n  if (dropdownRef.value && !dropdownRef.value.contains(target)) {\n    showDropdown.value = false\n  }\n  \n  // 关闭消息菜单\n  if (!target.closest('.message-menu')) {\n    showMessageMenu.value = false\n  }\n  \n  // 关闭资源菜单\n  if (!target.closest('.resource-menu')) {\n    resourceMenuOpen.value = false\n  }\n}\n\n// 切换下拉菜单\nconst toggleDropdown = (e) => {\n  e.stopPropagation()\n  showDropdown.value = !showDropdown.value\n  // 关闭其他菜单\n  showMessageMenu.value = false\n  resourceMenuOpen.value = false\n}\n\n// 模拟消息数据\nconst messages = ref([\n  {\n    id: 1,\n    content: '您的简历被查看了',\n    time: '10分钟前',\n    isRead: false,\n    type: 'system'\n  },\n  {\n    id: 2,\n    content: '有新的职位推荐',\n    time: '1小时前',\n    isRead: true,\n    type: 'system'\n  },\n  {\n    id: 3,\n    content: '张三给你发送了一条私信',\n    time: '2小时前',\n    isRead: false,\n    type: 'private'\n  }\n])\n\n// 切换消息菜单\nconst toggleMessageMenu = (e) => {\n  e.stopPropagation()\n  showMessageMenu.value = !showMessageMenu.value\n  if (showDropdown.value) {\n    showDropdown.value = false\n  }\n}\n\n// 查看全部消息\nconst viewAllMessages = () => {\n  router.push('/messages')\n  showMessageMenu.value = false // 关闭消息菜单\n}\n\n// 监听 accountStore 中的用户信息变化\nwatch(\n  [() => accountStore.userInfo, () => authStore.isLoggedIn],\n  ([newUserInfo, isLoggedIn]) => {\n    if (newUserInfo && isLoggedIn) {\n      userBasicInfo.value = {\n        ...newUserInfo\n      }\n    } else {\n      userBasicInfo.value = null\n    }\n  },\n  { immediate: true, deep: true }\n)\n\n// 响应式状态\nconst windowWidth = ref(window?.innerWidth || 1024)\n\n// 处理窗口大小变化\nconst handleResize = () => {\n  windowWidth.value = window.innerWidth\n}\n\n// 响应式计算\nconst isMobile = computed(() => {\n  return windowWidth.value < 1024\n})\n\n// 统一的菜单关闭处理\nconst closeMenus = (e) => {\n  if (!e.target.closest('.resource-menu')) {\n    resourceMenuOpen.value = false\n  }\n  if (!e.target.closest('.message-menu') && !e.target.closest('.message-button')) {\n    showMessageMenu.value = false\n  }\n  if (!e.target.closest('.user-dropdown') && !e.target.closest('.user-button')) {\n    showDropdown.value = false\n  }\n}\n\n// 判断当前路由是否匹配\nconst isCurrentRoute = (href) => {\n  // 对于模板相关的路由，使用 startsWith 判断\n  if (href === '/templates') {\n    return route.path.startsWith('/templates')\n  }\n  // 对于社区相关的路由，使用 startsWith 判断\n  if (href === '/community') {\n    return route.path.startsWith('/community')\n  }\n  // 对于作品集相关的路由，使用 startsWith 判断\n  if (href === '/portfolio') {\n    return route.path.startsWith('/portfolio')\n  }\n  // 其他路由保持完全匹配\n  return route.path === href\n}\n\n// 修改判断登录状态的逻辑\nconst isAuthenticated = computed(() => {\n  const status = authStore.isLoggedIn\n  console.log('isAuthenticated computed:', { \n    isLoggedIn: authStore.isLoggedIn,\n    token: localStorage.getItem('token'),\n    status \n  })\n  return status\n})\n\nconst username = computed(() => {\n  if (!authStore.isLoggedIn) return ''\n  return accountStore.username\n})\n\nconst avatarUrl = computed(() => {\n  if (!authStore.isLoggedIn) return defaultAvatar\n  const avatar = accountStore.avatar\n  if (!avatar || avatar === 'null' || avatar === 'undefined') {\n    return defaultAvatar\n  }\n  // 检查 avatar 是否是完整的 URL 或 base64 数据\n  if (avatar.startsWith('http') || avatar.startsWith('data:image')) {\n    return avatar\n  }\n  // 如果是相对路径，则拼接基础 URL\n  return avatar.startsWith('/') \n    ? `${process.env.VUE_APP_API_BASE_URL}${avatar}`\n    : `${process.env.VUE_APP_API_BASE_URL}/${avatar}`\n})\n\n// 判断是否在消息页面\nconst isMessageRoute = computed(() => {\n  return route.path.includes('/user') && route.query.tab === 'messages'\n})\n\n// 测试用：模拟未读消息数量\nconst unreadMessagesCount = ref(5)\n\n// 获取未读消息数量\nconst fetchUnreadMessagesCount = async () => {\n  try {\n    // TODO: 调用 API 获取未读消息数量\n    // const response = await api.getUnreadMessagesCount()\n    // unreadMessagesCount.value = response.data.count\n    unreadMessagesCount.value = 5 // 临时测试数据\n  } catch (error) {\n    console.error('获取未读消息数量失败:', error)\n  }\n}\n\n// 在用户登录状态变化时获取未读消息数量\nwatch(() => authStore.isLoggedIn, (newValue) => {\n  if (newValue) {\n    fetchUnreadMessagesCount()\n  } else {\n    unreadMessagesCount.value = 0\n  }\n}, { immediate: true })\n\n// 生命周期钩子\nonMounted(async () => {\n  console.log('HeadView mounted - Initial state:', {\n    token: localStorage.getItem('token'),\n    isLoggedIn: authStore.isLoggedIn,\n    storeState: authStore.$state\n  })\n\n  document.addEventListener('click', closeMenus)\n  window.addEventListener('resize', handleResize)\n  \n  // 检查登录状态\n  const token = localStorage.getItem('token')\n  console.log('Token check:', { token })\n  \n  if (token) {\n    console.log('Setting up with token')\n    request.defaults.headers.common['Authorization'] = `Bearer ${token}`\n    \n    try {\n      console.log('Fetching user info...')\n      await accountStore.fetchUserInfo()\n      console.log('User info fetched:', accountStore.userInfo)\n      \n      await Promise.all([\n        fetchPointsInfo(),\n        fetchSignInStatus()\n      ])\n      console.log('Additional info fetched')\n    } catch (error) {\n      console.error('Error during initialization:', error)\n      if (error.response?.status === 401) {\n        console.log('401 error - logging out')\n        await authStore.logout()\n      }\n    }\n  } else {\n    console.log('No token found')\n  }\n  \n  eventBus.on('avatar-updated', handleAvatarUpdate)\n  \n  // 监听支付成功事件\n  window.addEventListener('payment-success', refreshUserInfo)\n})\n\n// 保持原有的事件清理\nonUnmounted(() => {\n  eventBus.off('avatar-updated', handleAvatarUpdate)\n  // 移除支付成功事件监听\n  window.removeEventListener('payment-success', refreshUserInfo)\n})\n\n// 简化头像更新处理方法\nconst handleAvatarUpdate = (newAvatar) => {\n  if (accountStore.userInfo) {\n    accountStore.userInfo = {\n      ...accountStore.userInfo,\n      avatar: newAvatar\n    }\n  }\n}\n\n// 修改会员状态相关的计算属性\nconst isVip = computed(() => {\n  return accountStore.userInfo?.is_vip || false\n})\n\n// 会员类型文本\nconst vipTypeText = computed(() => {\n  if (!isVip.value) return '普通用户'\n  return accountStore.userInfo?.vip_type === 'annual' ? '年度会员' : '月度会员'\n})\n\n// 剩余天数文本\nconst remainingDays = computed(() => {\n  if (!isVip.value || !accountStore.userInfo?.vip_expire_date) return ''\n  const expireDate = new Date(accountStore.userInfo.vip_expire_date)\n  const days = Math.ceil((expireDate - new Date()) / (1000 * 60 * 60 * 24))\n  return days > 0 ? `剩余 ${days} 天` : '即将到期'\n})\n\n// 会员按钮文本\nconst vipButtonText = computed(() => {\n  const userInfo = accountStore.userInfo\n  if (!userInfo?.is_vip) return '升级会员'\n  \n  if (userInfo.vip_type === 'lifetime') return '会员中心'\n  \n  if (userInfo.vip_expire_time) {\n    const expireDate = new Date(userInfo.vip_expire_time)\n    const now = new Date()\n    const diffDays = Math.ceil((expireDate - now) / (1000 * 60 * 60 * 24))\n    return diffDays <= 30 ? '续费会员' : '会员中心'\n  }\n  \n  return '会员中心'\n})\n\n// 会员状态相关的计算属性\nconst isExpiringSoon = computed(() => {\n  const userInfo = accountStore.userInfo\n  if (!userInfo?.is_vip || userInfo.vip_type === 'lifetime') return false\n  \n  if (userInfo.vip_expire_time) {\n    const expireDate = new Date(userInfo.vip_expire_time)\n    const now = new Date()\n    const diffDays = Math.ceil((expireDate - now) / (1000 * 60 * 60 * 24))\n    return diffDays <= 30\n  }\n  return false\n})\n\n// 处理会员按钮点击\nconst handleVipButton = () => {\n  const userInfo = accountStore.userInfo\n  if (!userInfo?.is_vip) {\n    router.push('/pro')\n  } else if (isExpiringSoon.value) {\n    router.push('/pro/renew')\n  } else {\n    router.push('/user?tab=membership')\n  }\n  showDropdown.value = false\n}\n\n// 用户菜单选项\nconst mainMenuItems = computed(() => [\n  {\n    key: 'templates',\n    label: '简历模板',\n    icon: 'document',\n    bgColor: 'bg-indigo-50',\n    iconColor: 'text-indigo-600',\n    action: () => {\n      router.push('/templates')\n      showDropdown.value = false\n    }\n  },\n  {\n    key: 'community',\n    label: '社区',\n    icon: 'users',\n    bgColor: 'bg-pink-50',\n    iconColor: 'text-pink-600',\n    action: () => {\n      router.push('/community')\n      showDropdown.value = false\n    }\n  },\n  {\n    key: 'portfolio',\n    label: '作品集',\n    icon: 'photo',\n    bgColor: 'bg-orange-50',\n    iconColor: 'text-orange-600',\n    action: () => {\n      router.push('/portfolio')\n      showDropdown.value = false\n    }\n  },\n  {\n    key: 'home',\n    label: '创作管理',\n    icon: 'home',\n    bgColor: 'bg-blue-50',\n    iconColor: 'text-blue-600',\n    action: () => {\n      router.push('/user?tab=home')\n      showDropdown.value = false\n    }\n  },\n  {\n    key: 'profile',\n    label: '我的档案',\n    icon: 'profile',\n    bgColor: 'bg-purple-50',\n    iconColor: 'text-purple-600',\n    action: () => {\n      router.push('/user?tab=profile')\n      showDropdown.value = false\n    }\n  },\n  {\n    key: 'resumes',\n    label: '我的简历',\n    icon: 'resumes',\n    bgColor: 'bg-green-50',\n    iconColor: 'text-green-600',\n    action: () => {\n      router.push('/user?tab=resumes')\n      showDropdown.value = false\n    }\n  }\n])\n\n// 添加账号操作菜单项\nconst accountMenuItems = computed(() => [\n  {\n    key: 'settings',\n    label: '账号设置',\n    icon: 'settings',\n    bgColor: 'bg-amber-50',\n    iconColor: 'text-amber-600',\n    action: () => {\n      router.push('/user?tab=account')\n      showDropdown.value = false\n    }\n  }\n])\n\n// 处理退出登录\nconst handleLogout = async () => {\n  try {\n    showDropdown.value = false\n    await authStore.logout()\n    // 清除其他状态\n    userBasicInfo.value = null\n    unreadMessagesCount.value = 0\n    messages.value = []\n    mobileMenuOpen.value = false\n    showMessageMenu.value = false\n    resourceMenuOpen.value = false\n    \n    showToast('退出成功', 'success')\n    \n    const currentPath = router.currentRoute.value.fullPath\n    router.push(`/login?redirect=${encodeURIComponent(currentPath)}`)\n  } catch (error) {\n    console.error('退出失败:', error)\n    showToast('退出失败，请重试', 'error')\n  }\n}\n\n// 搜索相关状态\nconst searchQuery = ref('')\nconst showSearchModal = ref(false)\nconst searchInput = ref(null)\n\n// 监听 ESC 键关闭搜索弹窗\nonMounted(() => {\n  document.addEventListener('keydown', (e) => {\n    if (e.key === 'Escape') {\n      showSearchModal.value = false\n    }\n  })\n})\n\n// 修改搜索处理函数\nconst handleSearch = () => {\n  if (!searchQuery.value.trim()) return\n  router.push({\n    path: '/search',\n    query: { q: searchQuery.value }\n  })\n  showSearchModal.value = false\n}\n\nconst handleSearchByType = (type) => {\n  if (!searchQuery.value.trim()) return\n  router.push({\n    path: type.path,\n    query: { q: searchQuery.value }\n  })\n  showSearchModal.value = false\n}\n\n// 搜索类型配置\nconst searchTypes = [\n  { \n    label: '文章', \n    type: 'articles',\n    icon: DocumentTextIcon,\n    path: '/search/articles'\n  },\n  { \n    label: '作品集', \n    type: 'portfolio',\n    icon: PhotoIcon,\n    path: '/search/portfolio'\n  },\n  { \n    label: '用户', \n    type: 'users',\n    icon: UserGroupIcon,\n    path: '/search/users'\n  }\n]\n\n// 监听点击事件，关闭搜索建议\nonMounted(() => {\n  document.addEventListener('click', (e) => {\n    if (!e.target.closest('.search-container')) {\n      showSearchModal.value = false\n    }\n  })\n})\n\nconst refreshUserInfo = async () => {\n  try {\n    await accountStore.fetchUserInfo()\n    console.log('Refreshed User Info:', accountStore.userInfo)\n  } catch (error) {\n    console.error('Failed to refresh user info:', error)\n  }\n}\n\n// 积分信息\nconst pointsInfo = ref({\n  balance: 0,\n  level: 1,\n  sign_in_days: 0,\n  total_earned: 0,\n  signed_today: false\n})\n\n// 添加签到信息的数据结构\nconst signInInfo = ref({\n  can_sign_in: false,\n  sign_in_days: 0,\n  next_reward: null\n})\n\n// 获取签到状态\nconst fetchSignInStatus = async () => {\n  try {\n    const response = await membership.getSignInStatus()\n    if (response?.data?.code === 200) {\n      signInInfo.value = response.data.data\n    }\n  } catch (error) {\n    console.error('获取签到状态失败:', error)\n  }\n}\n\n// 修改获取积分信息的方法\nconst fetchPointsInfo = async () => {\n  if (!authStore.isLoggedIn) return\n  \n  try {\n    const response = await membership.getPointsInfo()\n    if (response?.data?.code === 200) {\n      pointsInfo.value = response.data.data\n      // 更新签到状态\n      await fetchSignInStatus()\n      console.log('积分信息更新:', {\n        pointsInfo: pointsInfo.value,\n        signInInfo: signInInfo.value\n      })\n    }\n  } catch (error) {\n    console.error('获取积分信息失败:', error)\n  }\n}\n\n// 修改签到处理方法\nconst handleSignIn = async () => {\n  if (!signInInfo.value.can_sign_in) return\n  \n  try {\n    const response = await membership.signIn()\n    if (response?.data?.code === 200) {\n      const { points_earned } = response.data.data\n      showToast('签到成功', 'success')\n      showToast(`获得 ${points_earned} 积分`, 'success')\n      // 更新积分信息和签到状态\n      await Promise.all([\n        fetchPointsInfo(),\n        fetchSignInStatus()\n      ])\n    }\n  } catch (error) {\n    console.error('签到失败:', error)\n    showToast(error.message || '签到失败，请稍后重试', 'error')\n  }\n}\n\n// 确保在移动端和桌面端都能正确初始化数据\nonMounted(async () => {\n  document.addEventListener('click', handleClickOutside)\n  window.addEventListener('resize', handleResize)\n  \n  // 只在已认证时获取数据\n  if (authStore.isLoggedIn) {\n    try {\n      // 先获取用户信息\n      await accountStore.fetchUserInfo()\n      \n      // 确保在移动端也获取积分信息\n      if (isMobile.value) {\n        await fetchPointsInfo()\n      }\n      \n      // 然后获取积分和签到信息\n      await Promise.all([\n        fetchPointsInfo(),\n        fetchSignInStatus()\n      ])\n      \n      console.log('初始化完成:', {\n        userInfo: accountStore.userInfo,\n        pointsInfo: pointsInfo.value,\n        signInInfo: signInInfo.value,\n        isMobile: isMobile.value\n      })\n    } catch (error) {\n      console.error('初始化数据失败:', error)\n      // 重置数据\n      pointsInfo.value = {\n        balance: 0,\n        level: 1,\n        sign_in_days: 0,\n        total_earned: 0\n      }\n      signInInfo.value = {\n        can_sign_in: false,\n        sign_in_days: 0,\n        next_reward: null\n      }\n    }\n  }\n})\n\n// 添加监听器确保用户登录状态变化时更新数据\nwatch(() => authStore.isLoggedIn, async (newValue) => {\n  if (newValue) {\n    await fetchPointsInfo()\n  } else {\n    // 重置数据\n    pointsInfo.value = {\n      balance: 0,\n      level: 1,\n      sign_in_days: 0,\n      total_earned: 0\n    }\n    signInInfo.value = {\n      can_sign_in: false,\n      sign_in_days: 0,\n      next_reward: null\n    }\n  }\n}, { immediate: true })\n\n// 处理菜单关闭\nconst closeDropdown = () => {\n  showDropdown.value = false\n}\n\n// 处理点击详情按钮\nconst handleViewDetails = () => {\n  router.push('/user?tab=membership')\n  showDropdown.value = false\n}\n\n// 修改积分详情按钮的点击处理\nconst handlePointsDetail = () => {\n  router.push('/user?tab=membership')\n  showDropdown.value = false\n}\n\n// 添加子菜单切换函数\nconst toggleSubmenu = (key) => {\n  mobileSubmenuOpen.value[key] = !mobileSubmenuOpen.value[key]\n}\n\n// 添加对移动端状态的监听\nwatch(isMobile, async (newValue) => {\n  if (newValue && authStore.isLoggedIn) {\n    await fetchPointsInfo()\n  }\n})\n\n// 添加切换菜单的方法\nconst toggleMenu = () => {\n  mobileMenuOpen.value = !mobileMenuOpen.value\n}\n\n// 监听登录状态变化\nwatch(() => authStore.isLoggedIn, (newValue, oldValue) => {\n  console.log('Auth state changed:', { \n    old: oldValue, \n    new: newValue,\n    token: localStorage.getItem('token')\n  })\n}, { immediate: true })\n\n</script>\n<style scoped>\n/* 添加过渡动画 */\n.aspect-h-9 {\n  position: relative;\n  padding-bottom: 56.25%;\n}\n\n.aspect-h-9 img {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  transition: opacity 0.3s ease;\n}\n\n/* 添加菜单hover效果 */\n.hover\\:bg-gray-100:hover {\n  background-color: rgba(243, 244, 246, 1);\n}\n\n/* 确保下拉菜单定位正确 */\n.resource-menu {\n  position: static;\n}\n\n@media (min-width: 1024px) {\n  .resource-menu {\n    position: relative;\n  }\n}\n\n/* 添加过渡动画 */\n.transition-transform {\n  transition-property: transform;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 200ms;\n}\n\n/* 移动端菜单动画 */\n.mobile-menu-enter-active,\n.mobile-menu-leave-active {\n  transition: transform 0.3s ease-in-out;\n}\n\n.mobile-menu-enter-from,\n.mobile-menu-leave-to {\n  transform: translateX(100%);\n}\n\n/* 下拉菜单动画 */\n.dropdown-enter-active,\n.dropdown-leave-active {\n  transition: opacity 0.2s, transform 0.2s;\n}\n\n.dropdown-enter-from,\n.dropdown-leave-to {\n  opacity: 0;\n  transform: translateY(-10px);\n}\n/* 确保下拉菜单始终最上层 */\n:deep(.el-dropdown-menu) {\n  z-index: 3000 !important;\n}\n\n/* 调整资源菜单定位 */\n.resource-menu {\n  position: static;\n}\n\n@media (min-width: 1024px) {\n  .resource-menu {\n    position: relative;\n  }\n}\n\n/* 消息图标动画 */\n@keyframes pulse {\n  0% { transform: scale(1); }\n  50% { transform: scale(1.1); }\n  100% { transform: scale(1); }\n}\n\n.animate-pulse {\n  animation: pulse 2s infinite;\n}\n\n/* 消息数量的动画效果 */\n@keyframes scaleIn {\n  from {\n    transform: scale(0);\n  }\n  to {\n    transform: scale(1);\n  }\n}\n\n.absolute {\n  animation: scaleIn 0.2s ease-out;\n}\n\n/* 添加积分数字动画 */\n@keyframes countUp {\n  from {\n    transform: translateY(10px);\n    opacity: 0;\n  }\n  to {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n\n.text-amber-500 {\n  animation: countUp 0.3s ease-out;\n}\n\n/* 添加阴影过渡效果 */\n.shadow-xl {\n  transition: box-shadow 0.2s ease;\n}\n\n/* 可以添加悬浮效果 */\n.message-menu:hover,\n.user-dropdown:hover {\n  box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);\n}\n\n/* 确保移动端下拉菜单底部圆角 */\n@media (max-width: 1024px) {\n  .fixed.inset-x-0 {\n    border-bottom-left-radius: 0;\n    border-bottom-right-radius: 0;\n  }\n}\n\n/* 添加移动端样式 */\n@media (max-width: 640px) {\n  .truncate {\n    max-width: 120px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n}\n\n/* 移除或修改消息按钮的hover效果 */\n.message-menu:hover {\n  background-color: transparent;\n}\n\n/* 移除点击时的背景色 */\n.message-menu:active,\n.message-menu:focus {\n  background-color: transparent;\n}\n\n/* 移除消息按钮的所有背景相关样式 */\n.message-menu {\n  transition: color 0.2s ease;\n}\n\n.message-menu:hover,\n.message-menu:active,\n.message-menu:focus {\n  background-color: transparent !important;\n}\n\n/* 确保消息菜单始终有白色背景 */\n.message-menu {\n  background-color: white !important;\n}\n\n/* 消息菜单的子元素也保持白色背景 */\n.message-menu > div {\n  background-color: white;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}