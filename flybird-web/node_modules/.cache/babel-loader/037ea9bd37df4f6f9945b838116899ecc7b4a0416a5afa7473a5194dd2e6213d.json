{"ast":null,"code":"import { defineStore } from 'pinia';\nimport { user } from '@/api/user';\nexport const useUserStore = defineStore('user', {\n  state: () => ({\n    userInfo: null,\n    preferences: null,\n    basicInfo: {\n      id: null,\n      uid: null,\n      username: null,\n      avatar: null\n    }\n  }),\n  getters: {\n    getUserInfo: state => state.userInfo,\n    getUsername: state => state.basicInfo?.username,\n    getAvatar: state => state.basicInfo?.avatar\n  },\n  actions: {\n    async getUserInfo() {\n      if (this.isLoadingUserInfo) return;\n      const now = Date.now();\n      if (this.userInfo && this.lastUserInfoFetch && now - this.lastUserInfoFetch < 5 * 60 * 1000) {\n        return this.userInfo;\n      }\n      try {\n        this.isLoadingUserInfo = true;\n        const response = await user.getUserInfo();\n        if (response?.data?.code === 200) {\n          this.userInfo = response.data.data;\n          this.lastUserInfoFetch = now;\n          return this.userInfo;\n        }\n        return null;\n      } catch (error) {\n        console.error('Get user info failed:', error);\n        throw error;\n      } finally {\n        this.isLoadingUserInfo = false;\n      }\n    },\n    clearUserInfo() {\n      this.userInfo = null;\n      this.lastUserInfoFetch = null;\n      // 清除相关的 localStorage 数据\n      localStorage.removeItem('userInfo');\n      localStorage.removeItem('lastUserInfoFetch');\n    }\n  }\n});","map":{"version":3,"names":["defineStore","user","useUserStore","state","userInfo","preferences","basicInfo","id","uid","username","avatar","getters","getUserInfo","getUsername","getAvatar","actions","isLoadingUserInfo","now","Date","lastUserInfoFetch","response","data","code","error","console","clearUserInfo","localStorage","removeItem"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/user.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { user } from '@/api/user'\n\nexport const useUserStore = defineStore('user', {\n  state: () => ({\n    userInfo: null,\n    preferences: null,\n    basicInfo: {\n      id: null,\n      uid: null,\n      username: null,\n      avatar: null\n    }\n  }),\n\n  getters: {\n    getUserInfo: (state) => state.userInfo,\n    getUsername: (state) => state.basicInfo?.username,\n    getAvatar: (state) => state.basicInfo?.avatar\n  },\n\n  actions: {\n    async getUserInfo() {\n      if (this.isLoadingUserInfo) return\n      \n      const now = Date.now()\n      if (this.userInfo && this.lastUserInfoFetch && \n          (now - this.lastUserInfoFetch) < 5 * 60 * 1000) {\n        return this.userInfo\n      }\n\n      try {\n        this.isLoadingUserInfo = true\n        const response = await user.getUserInfo()\n        if (response?.data?.code === 200) {\n          this.userInfo = response.data.data\n          this.lastUserInfoFetch = now\n          return this.userInfo\n        }\n        return null\n      } catch (error) {\n        console.error('Get user info failed:', error)\n        throw error\n      } finally {\n        this.isLoadingUserInfo = false\n      }\n    },\n\n    clearUserInfo() {\n      this.userInfo = null\n      this.lastUserInfoFetch = null\n      // 清除相关的 localStorage 数据\n      localStorage.removeItem('userInfo')\n      localStorage.removeItem('lastUserInfoFetch')\n    }\n  }\n}) "],"mappings":"AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,SAASC,IAAI,QAAQ,YAAY;AAEjC,OAAO,MAAMC,YAAY,GAAGF,WAAW,CAAC,MAAM,EAAE;EAC9CG,KAAK,EAAEA,CAAA,MAAO;IACZC,QAAQ,EAAE,IAAI;IACdC,WAAW,EAAE,IAAI;IACjBC,SAAS,EAAE;MACTC,EAAE,EAAE,IAAI;MACRC,GAAG,EAAE,IAAI;MACTC,QAAQ,EAAE,IAAI;MACdC,MAAM,EAAE;IACV;EACF,CAAC,CAAC;EAEFC,OAAO,EAAE;IACPC,WAAW,EAAGT,KAAK,IAAKA,KAAK,CAACC,QAAQ;IACtCS,WAAW,EAAGV,KAAK,IAAKA,KAAK,CAACG,SAAS,EAAEG,QAAQ;IACjDK,SAAS,EAAGX,KAAK,IAAKA,KAAK,CAACG,SAAS,EAAEI;EACzC,CAAC;EAEDK,OAAO,EAAE;IACP,MAAMH,WAAWA,CAAA,EAAG;MAClB,IAAI,IAAI,CAACI,iBAAiB,EAAE;MAE5B,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;MACtB,IAAI,IAAI,CAACb,QAAQ,IAAI,IAAI,CAACe,iBAAiB,IACtCF,GAAG,GAAG,IAAI,CAACE,iBAAiB,GAAI,CAAC,GAAG,EAAE,GAAG,IAAI,EAAE;QAClD,OAAO,IAAI,CAACf,QAAQ;MACtB;MAEA,IAAI;QACF,IAAI,CAACY,iBAAiB,GAAG,IAAI;QAC7B,MAAMI,QAAQ,GAAG,MAAMnB,IAAI,CAACW,WAAW,CAAC,CAAC;QACzC,IAAIQ,QAAQ,EAAEC,IAAI,EAAEC,IAAI,KAAK,GAAG,EAAE;UAChC,IAAI,CAAClB,QAAQ,GAAGgB,QAAQ,CAACC,IAAI,CAACA,IAAI;UAClC,IAAI,CAACF,iBAAiB,GAAGF,GAAG;UAC5B,OAAO,IAAI,CAACb,QAAQ;QACtB;QACA,OAAO,IAAI;MACb,CAAC,CAAC,OAAOmB,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;QAC7C,MAAMA,KAAK;MACb,CAAC,SAAS;QACR,IAAI,CAACP,iBAAiB,GAAG,KAAK;MAChC;IACF,CAAC;IAEDS,aAAaA,CAAA,EAAG;MACd,IAAI,CAACrB,QAAQ,GAAG,IAAI;MACpB,IAAI,CAACe,iBAAiB,GAAG,IAAI;MAC7B;MACAO,YAAY,CAACC,UAAU,CAAC,UAAU,CAAC;MACnCD,YAAY,CAACC,UAAU,CAAC,mBAAmB,CAAC;IAC9C;EACF;AACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}