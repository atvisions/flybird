{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, openBlock as _openBlock, createBlock as _createBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"space-y-8\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" No changes to template section \"), _createCommentVNode(\" 添加签到成功弹窗 \"), $setup.showSignInSuccess ? (_openBlock(), _createBlock($setup[\"SignInSuccessDialog\"], {\n    key: 0,\n    visible: $setup.showSignInSuccess,\n    \"onUpdate:visible\": _cache[0] || (_cache[0] = $event => $setup.showSignInSuccess = $event),\n    points: $setup.signInResult.points,\n    \"sign-in-days\": $setup.signInResult.signInDays,\n    \"next-reward\": $setup.signInResult.nextReward\n  }, null, 8 /* PROPS */, [\"visible\", \"points\", \"sign-in-days\", \"next-reward\"])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","$setup","showSignInSuccess","_createBlock","key","visible","_cache","$event","points","signInResult","signInDays","nextReward"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/Membership/index.vue"],"sourcesContent":["<template>\n  <div class=\"space-y-8\">\n    <!-- No changes to template section -->\n    \n    <!-- 添加签到成功弹窗 -->\n    <SignInSuccessDialog\n      v-if=\"showSignInSuccess\"\n      v-model:visible=\"showSignInSuccess\"\n      :points=\"signInResult.points\"\n      :sign-in-days=\"signInResult.signInDays\"\n      :next-reward=\"signInResult.nextReward\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, watch, onUnmounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useAccountStore } from '@/stores/account'\nimport { membership } from '@/api/membership'\nimport { showToast } from '@/utils/toast'\nimport { \n  SparklesIcon, \n  CloudArrowUpIcon, \n  ChatBubbleLeftRightIcon, \n  QuestionMarkCircleIcon, \n  CheckCircleIcon, \n  GiftIcon, \n  ClipboardDocumentListIcon, \n  StarIcon, \n  PencilSquareIcon, \n  CalendarDaysIcon,\n  DocumentTextIcon,\n  CloudIcon,\n  DocumentChartBarIcon,\n  UserGroupIcon,\n  CheckIcon,\n  DocumentIcon,\n  BoltIcon,\n  HeartIcon,\n  UserIcon,\n  TrophyIcon,\n  ChevronDownIcon,\n  SparklesIcon as CrownIcon\n} from '@heroicons/vue/24/outline'\nimport SignInSuccessDialog from '@/components/SignInSuccessDialog.vue'\nimport { ElMessage } from 'element-plus'\n\n// 获取积分信息\nconst fetchPointsInfo = async () => {\n  try {\n    const response = await membership.getPoints()\n    if (response?.data?.code === 200) {\n      pointsInfo.value = response.data.data\n    }\n  } catch (error) {\n    console.error('获取积分信息失败:', error)\n  }\n}\n\n// 获取积分记录\nconst fetchPointsRecords = async () => {\n  try {\n    const response = await membership.getPointRecords()\n    if (response?.data?.code === 200) {\n      pointsRecords.value = response.data.data\n    }\n  } catch (error) {\n    console.error('获取积分记录失败:', error)\n  }\n}\n\n// 签到相关状态\nconst showSignInSuccess = ref(false)\nconst signInResult = ref({\n  points: 0,\n  signInDays: 0,\n  nextReward: null\n})\n\n// 处理签到\nconst handleSignIn = async () => {\n  if (!canSignIn.value) return\n  \n  try {\n    console.log('开始签到')\n    const response = await membership.checkIn()\n    console.log('签到响应:', response)\n    \n    if (response?.data?.code === 200) {\n      const { points, balance, sign_in_days, next_reward } = response.data.data\n      \n      // 更新积分信息\n      pointsInfo.value.balance = balance\n      signInInfo.value.days = sign_in_days\n      signInInfo.value.nextReward = next_reward\n      canSignIn.value = false\n      \n      // 显示签到成功弹窗\n      signInResult.value = {\n        points,\n        signInDays: sign_in_days,\n        nextReward: next_reward\n      }\n      showSignInSuccess.value = true\n      \n      // 刷新积分记录\n      await fetchPointsRecords()\n    }\n  } catch (error) {\n    console.error('签到失败:', error)\n    if (error.response?.data?.code === 400) {\n      ElMessage.warning(error.response.data.message)\n      canSignIn.value = false\n    } else {\n      ElMessage.error('签到失败，请稍后重试')\n    }\n  }\n}\n\n// 在组件挂载时获取数据\nonMounted(async () => {\n  await Promise.all([\n    fetchPointsInfo(),\n    fetchPointsRecords()\n  ])\n  \n  // 获取签到状态\n  try {\n    const response = await membership.getSignInStatus()\n    if (response?.data?.code === 200) {\n      const { can_sign_in, sign_in_days, next_reward } = response.data.data\n      canSignIn.value = can_sign_in\n      signInInfo.value.days = sign_in_days\n      signInInfo.value.nextReward = next_reward\n    }\n  } catch (error) {\n    console.error('获取签到状态失败:', error)\n  }\n})\n</script> \n\n<style scoped>\n/* No changes to style section */\n</style> "],"mappings":";;EACOA,KAAK,EAAC;AAAW;;uBAAtBC,mBAAA,CAWM,OAXNC,UAWM,GAVJC,mBAAA,oCAAuC,EAEvCA,mBAAA,cAAiB,EAETC,MAAA,CAAAC,iBAAiB,I,cADzBC,YAAA,CAMEF,MAAA;IAXNG,GAAA;IAOcC,OAAO,EAAEJ,MAAA,CAAAC,iBAAiB;IAPxC,oBAAAI,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAOuBN,MAAA,CAAAC,iBAAiB,GAAAK,MAAA;IACjCC,MAAM,EAAEP,MAAA,CAAAQ,YAAY,CAACD,MAAM;IAC3B,cAAY,EAAEP,MAAA,CAAAQ,YAAY,CAACC,UAAU;IACrC,aAAW,EAAET,MAAA,CAAAQ,YAAY,CAACE;mFAVjCX,mBAAA,e","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}