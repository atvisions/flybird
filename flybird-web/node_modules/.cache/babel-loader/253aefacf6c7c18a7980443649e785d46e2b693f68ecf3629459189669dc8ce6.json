{"ast":null,"code":"import { reactive } from 'vue';\nimport { useStore } from 'vuex';\nimport { user } from '@/api/user';\nimport { auth } from '@/api/auth';\nimport { SMS_SCENE } from '@/constants';\nimport { showToast } from '@/components/ToastMessage';\nexport function usePhone() {\n  const store = useStore();\n  const state = reactive({\n    value: '',\n    code: '',\n    loading: false,\n    countdown: 0\n  });\n  const handleSendCode = async () => {\n    if (!/^1[3-9]\\d{9}$/.test(state.value)) {\n      showToast('请输入正确的手机号', 'error');\n      return;\n    }\n    state.loading = true;\n    try {\n      await auth.sendVerifyCode({\n        phone: state.value,\n        scene: SMS_SCENE.CHANGE_PHONE\n      });\n      showToast('验证码已发送', 'success');\n      state.countdown = 60;\n      const timer = setInterval(() => {\n        state.countdown--;\n        if (state.countdown <= 0) {\n          clearInterval(timer);\n        }\n      }, 1000);\n    } catch (error) {\n      showToast(error.response?.data?.message || '发送失败', 'error');\n    } finally {\n      state.loading = false;\n    }\n  };\n  const handleUpdate = async () => {\n    if (!state.value.trim() || !state.code.trim()) {\n      showToast('请输入手机号和验证码', 'error');\n      return false;\n    }\n    state.loading = true;\n    try {\n      await user.changePhone({\n        phone: state.value,\n        code: state.code\n      });\n      await store.dispatch('fetchUserInfo');\n      showToast('手机号修改成功', 'success');\n      return true;\n    } catch (error) {\n      showToast(error.message || '修改失败', 'error');\n      return false;\n    } finally {\n      state.loading = false;\n    }\n  };\n  return {\n    state,\n    handleSendCode,\n    handleUpdate\n  };\n}","map":{"version":3,"names":["reactive","useStore","user","auth","SMS_SCENE","showToast","usePhone","store","state","value","code","loading","countdown","handleSendCode","test","sendVerifyCode","phone","scene","CHANGE_PHONE","timer","setInterval","clearInterval","error","response","data","message","handleUpdate","trim","changePhone","dispatch"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/composables/usePhone.js"],"sourcesContent":["import { reactive } from 'vue'\nimport { useStore } from 'vuex'\nimport { user } from '@/api/user'\nimport { auth } from '@/api/auth'\nimport { SMS_SCENE } from '@/constants'\nimport { showToast } from '@/components/ToastMessage'\n\nexport function usePhone() {\n  const store = useStore()\n  const state = reactive({\n    value: '',\n    code: '',\n    loading: false,\n    countdown: 0\n  })\n\n  const handleSendCode = async () => {\n    if (!/^1[3-9]\\d{9}$/.test(state.value)) {\n      showToast('请输入正确的手机号', 'error')\n      return\n    }\n\n    state.loading = true\n    try {\n      await auth.sendVerifyCode({\n        phone: state.value,\n        scene: SMS_SCENE.CHANGE_PHONE\n      })\n      showToast('验证码已发送', 'success')\n      state.countdown = 60\n      const timer = setInterval(() => {\n        state.countdown--\n        if (state.countdown <= 0) {\n          clearInterval(timer)\n        }\n      }, 1000)\n    } catch (error) {\n      showToast(error.response?.data?.message || '发送失败', 'error')\n    } finally {\n      state.loading = false\n    }\n  }\n\n  const handleUpdate = async () => {\n    if (!state.value.trim() || !state.code.trim()) {\n      showToast('请输入手机号和验证码', 'error')\n      return false\n    }\n\n    state.loading = true\n    try {\n      await user.changePhone({\n        phone: state.value,\n        code: state.code\n      })\n      await store.dispatch('fetchUserInfo')\n      showToast('手机号修改成功', 'success')\n      return true\n    } catch (error) {\n      showToast(error.message || '修改失败', 'error')\n      return false\n    } finally {\n      state.loading = false\n    }\n  }\n\n  return {\n    state,\n    handleSendCode,\n    handleUpdate\n  }\n} "],"mappings":"AAAA,SAASA,QAAQ,QAAQ,KAAK;AAC9B,SAASC,QAAQ,QAAQ,MAAM;AAC/B,SAASC,IAAI,QAAQ,YAAY;AACjC,SAASC,IAAI,QAAQ,YAAY;AACjC,SAASC,SAAS,QAAQ,aAAa;AACvC,SAASC,SAAS,QAAQ,2BAA2B;AAErD,OAAO,SAASC,QAAQA,CAAA,EAAG;EACzB,MAAMC,KAAK,GAAGN,QAAQ,CAAC,CAAC;EACxB,MAAMO,KAAK,GAAGR,QAAQ,CAAC;IACrBS,KAAK,EAAE,EAAE;IACTC,IAAI,EAAE,EAAE;IACRC,OAAO,EAAE,KAAK;IACdC,SAAS,EAAE;EACb,CAAC,CAAC;EAEF,MAAMC,cAAc,GAAG,MAAAA,CAAA,KAAY;IACjC,IAAI,CAAC,eAAe,CAACC,IAAI,CAACN,KAAK,CAACC,KAAK,CAAC,EAAE;MACtCJ,SAAS,CAAC,WAAW,EAAE,OAAO,CAAC;MAC/B;IACF;IAEAG,KAAK,CAACG,OAAO,GAAG,IAAI;IACpB,IAAI;MACF,MAAMR,IAAI,CAACY,cAAc,CAAC;QACxBC,KAAK,EAAER,KAAK,CAACC,KAAK;QAClBQ,KAAK,EAAEb,SAAS,CAACc;MACnB,CAAC,CAAC;MACFb,SAAS,CAAC,QAAQ,EAAE,SAAS,CAAC;MAC9BG,KAAK,CAACI,SAAS,GAAG,EAAE;MACpB,MAAMO,KAAK,GAAGC,WAAW,CAAC,MAAM;QAC9BZ,KAAK,CAACI,SAAS,EAAE;QACjB,IAAIJ,KAAK,CAACI,SAAS,IAAI,CAAC,EAAE;UACxBS,aAAa,CAACF,KAAK,CAAC;QACtB;MACF,CAAC,EAAE,IAAI,CAAC;IACV,CAAC,CAAC,OAAOG,KAAK,EAAE;MACdjB,SAAS,CAACiB,KAAK,CAACC,QAAQ,EAAEC,IAAI,EAAEC,OAAO,IAAI,MAAM,EAAE,OAAO,CAAC;IAC7D,CAAC,SAAS;MACRjB,KAAK,CAACG,OAAO,GAAG,KAAK;IACvB;EACF,CAAC;EAED,MAAMe,YAAY,GAAG,MAAAA,CAAA,KAAY;IAC/B,IAAI,CAAClB,KAAK,CAACC,KAAK,CAACkB,IAAI,CAAC,CAAC,IAAI,CAACnB,KAAK,CAACE,IAAI,CAACiB,IAAI,CAAC,CAAC,EAAE;MAC7CtB,SAAS,CAAC,YAAY,EAAE,OAAO,CAAC;MAChC,OAAO,KAAK;IACd;IAEAG,KAAK,CAACG,OAAO,GAAG,IAAI;IACpB,IAAI;MACF,MAAMT,IAAI,CAAC0B,WAAW,CAAC;QACrBZ,KAAK,EAAER,KAAK,CAACC,KAAK;QAClBC,IAAI,EAAEF,KAAK,CAACE;MACd,CAAC,CAAC;MACF,MAAMH,KAAK,CAACsB,QAAQ,CAAC,eAAe,CAAC;MACrCxB,SAAS,CAAC,SAAS,EAAE,SAAS,CAAC;MAC/B,OAAO,IAAI;IACb,CAAC,CAAC,OAAOiB,KAAK,EAAE;MACdjB,SAAS,CAACiB,KAAK,CAACG,OAAO,IAAI,MAAM,EAAE,OAAO,CAAC;MAC3C,OAAO,KAAK;IACd,CAAC,SAAS;MACRjB,KAAK,CAACG,OAAO,GAAG,KAAK;IACvB;EACF,CAAC;EAED,OAAO;IACLH,KAAK;IACLK,cAAc;IACda;EACF,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}