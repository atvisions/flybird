{"ast":null,"code":"import { defineStore } from 'pinia';\nimport profile from '@/api/profile';\nimport { MEDIA_URL } from '@/config/index';\nexport const useProfileStore = defineStore({\n  id: 'profile',\n  state: () => ({\n    basicInfo: null,\n    avatarUpdateTime: null,\n    completeness: {\n      total_score: 0,\n      dimensions: {},\n      suggestions: []\n    }\n  }),\n  getters: {\n    // 获取职业头像的完整 URL\n    profileAvatarUrl: state => {\n      const avatar = state.basicInfo?.avatar;\n      if (!avatar) return null;\n      // 如果已经是完整的 URL，直接返回\n      if (avatar.startsWith('http')) return avatar;\n      // 如果是相对路径，需要去掉开头的 /media/\n      const cleanPath = avatar.replace(/^\\/media\\//, '');\n      return `${MEDIA_URL}/${cleanPath}`;\n    }\n  },\n  actions: {\n    // 设置基本信息\n    setBasicInfo(data) {\n      this.basicInfo = data;\n    },\n    // 更新头像\n    async updateAvatar(file) {\n      try {\n        const response = await profile.uploadAvatar(file);\n        if (response?.data?.code === 200) {\n          const avatarUrl = response.data.data.avatar;\n\n          // 更新 store 状态\n          if (!this.basicInfo) {\n            this.basicInfo = {};\n          }\n          this.basicInfo.avatar = avatarUrl;\n          this.avatarUpdateTime = Date.now();\n          console.log('Store updated:', {\n            avatar: this.basicInfo.avatar,\n            updateTime: this.avatarUpdateTime\n          });\n          return response;\n        }\n        throw new Error(response?.data?.message || '上传失败');\n      } catch (error) {\n        console.error('职业头像上传失败:', error);\n        throw error;\n      }\n    },\n    // 获取完整度数据\n    async fetchCompleteness() {\n      try {\n        const response = await profile.getCompleteness();\n        if (response?.data?.code === 200) {\n          this.completeness = {\n            total_score: response.data.data?.total_score || 0,\n            dimensions: response.data.data?.dimensions || {},\n            suggestions: response.data.data?.suggestions || []\n          };\n          return this.completeness;\n        }\n        throw new Error(response?.data?.message || '获取完整度数据失败');\n      } catch (error) {\n        console.error('获取完整度数据失败:', error);\n        throw error;\n      }\n    }\n  }\n});","map":{"version":3,"names":["defineStore","profile","MEDIA_URL","useProfileStore","id","state","basicInfo","avatarUpdateTime","completeness","total_score","dimensions","suggestions","getters","profileAvatarUrl","avatar","startsWith","cleanPath","replace","actions","setBasicInfo","data","updateAvatar","file","response","uploadAvatar","code","avatarUrl","Date","now","console","log","updateTime","Error","message","error","fetchCompleteness","getCompleteness"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/profile.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport profile from '@/api/profile'\nimport { MEDIA_URL } from '@/config/index'\n\nexport const useProfileStore = defineStore({\n  id: 'profile',\n  state: () => ({\n    basicInfo: null,\n    avatarUpdateTime: null,\n    completeness: {\n      total_score: 0,\n      dimensions: {},\n      suggestions: []\n    }\n  }),\n\n  getters: {\n    // 获取职业头像的完整 URL\n    profileAvatarUrl: (state) => {\n      const avatar = state.basicInfo?.avatar\n      if (!avatar) return null\n      // 如果已经是完整的 URL，直接返回\n      if (avatar.startsWith('http')) return avatar\n      // 如果是相对路径，需要去掉开头的 /media/\n      const cleanPath = avatar.replace(/^\\/media\\//, '')\n      return `${MEDIA_URL}/${cleanPath}`\n    }\n  },\n\n  actions: {\n    // 设置基本信息\n    setBasicInfo(data) {\n      this.basicInfo = data\n    },\n\n    // 更新头像\n    async updateAvatar(file) {\n      try {\n        const response = await profile.uploadAvatar(file)\n        if (response?.data?.code === 200) {\n          const avatarUrl = response.data.data.avatar\n          \n          // 更新 store 状态\n          if (!this.basicInfo) {\n            this.basicInfo = {}\n          }\n          this.basicInfo.avatar = avatarUrl\n          this.avatarUpdateTime = Date.now()\n          \n          console.log('Store updated:', {\n            avatar: this.basicInfo.avatar,\n            updateTime: this.avatarUpdateTime\n          })\n          \n          return response\n        }\n        throw new Error(response?.data?.message || '上传失败')\n      } catch (error) {\n        console.error('职业头像上传失败:', error)\n        throw error\n      }\n    },\n\n    // 获取完整度数据\n    async fetchCompleteness() {\n      try {\n        const response = await profile.getCompleteness()\n        if (response?.data?.code === 200) {\n          this.completeness = {\n            total_score: response.data.data?.total_score || 0,\n            dimensions: response.data.data?.dimensions || {},\n            suggestions: response.data.data?.suggestions || []\n          }\n          return this.completeness\n        }\n        throw new Error(response?.data?.message || '获取完整度数据失败')\n      } catch (error) {\n        console.error('获取完整度数据失败:', error)\n        throw error\n      }\n    }\n  }\n}) "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}