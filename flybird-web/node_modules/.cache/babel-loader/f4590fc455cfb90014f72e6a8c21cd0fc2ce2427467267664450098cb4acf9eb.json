{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, normalizeStyle as _normalizeStyle, createVNode as _createVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"avatar-cropper\"\n};\nconst _hoisted_2 = {\n  class: \"preview-container\"\n};\nconst _hoisted_3 = {\n  class: \"preview-box large mb-4\"\n};\nconst _hoisted_4 = {\n  class: \"flex gap-4\"\n};\nconst _hoisted_5 = {\n  class: \"preview-box small\"\n};\nconst _hoisted_6 = {\n  class: \"preview-box mini\"\n};\nconst _hoisted_7 = {\n  class: \"cropper-container\"\n};\nconst _hoisted_8 = {\n  class: \"operation-buttons mt-4 flex gap-2\"\n};\nconst _hoisted_9 = {\n  class: \"dialog-footer\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode(_component_el_dialog, {\n    modelValue: $setup.visible,\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.visible = $event),\n    title: \"上传头像\",\n    width: \"700px\",\n    \"close-on-click-modal\": false,\n    \"before-close\": $setup.handleClose\n  }, {\n    footer: _withCtx(() => [_createElementVNode(\"div\", _hoisted_9, [_createVNode(_component_el_button, {\n      onClick: $setup.handleClose\n    }, {\n      default: _withCtx(() => _cache[12] || (_cache[12] = [_createTextVNode(\"取消\")])),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_button, {\n      type: \"primary\",\n      loading: $setup.uploading,\n      onClick: $setup.handleUpload\n    }, {\n      default: _withCtx(() => _cache[13] || (_cache[13] = [_createTextVNode(\" 确认上传 \")])),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"loading\"])])]),\n    default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_1, [_createCommentVNode(\" 左侧预览区域 \"), _createElementVNode(\"div\", _hoisted_2, [_cache[3] || (_cache[3] = _createElementVNode(\"h4\", {\n      class: \"text-gray-600 mb-2\"\n    }, \"预览效果\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", {\n      class: \"preview\",\n      style: _normalizeStyle($setup.previewStyle)\n    }, null, 4 /* STYLE */)]), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"div\", {\n      class: \"preview\",\n      style: _normalizeStyle($setup.previewStyle)\n    }, null, 4 /* STYLE */)]), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"div\", {\n      class: \"preview\",\n      style: _normalizeStyle($setup.previewStyle)\n    }, null, 4 /* STYLE */)])])]), _createCommentVNode(\" 右侧裁剪区域 \"), _createElementVNode(\"div\", _hoisted_7, [_createVNode($setup[\"VueCropper\"], {\n      ref: \"cropper\",\n      img: $setup.imgUrl,\n      autoCrop: true,\n      fixedBox: true,\n      centerBox: true,\n      info: true,\n      full: true,\n      canMove: true,\n      canMoveBox: true,\n      original: false,\n      autoCropWidth: 200,\n      autoCropHeight: 200,\n      outputType: 'png',\n      onRealTime: $setup.realTime\n    }, null, 8 /* PROPS */, [\"img\"])])]), _createElementVNode(\"div\", _hoisted_8, [_createVNode(_component_el_button, {\n      size: \"small\",\n      onClick: $setup.rotateLeft\n    }, {\n      icon: _withCtx(() => _cache[4] || (_cache[4] = [_createElementVNode(\"i\", {\n        class: \"fas fa-undo\"\n      }, null, -1 /* HOISTED */)])),\n      default: _withCtx(() => [_cache[5] || (_cache[5] = _createTextVNode(\" 向左旋转 \"))]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_button, {\n      size: \"small\",\n      onClick: $setup.rotateRight\n    }, {\n      icon: _withCtx(() => _cache[6] || (_cache[6] = [_createElementVNode(\"i\", {\n        class: \"fas fa-redo\"\n      }, null, -1 /* HOISTED */)])),\n      default: _withCtx(() => [_cache[7] || (_cache[7] = _createTextVNode(\" 向右旋转 \"))]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_button, {\n      size: \"small\",\n      onClick: _cache[0] || (_cache[0] = $event => $setup.changeScale(1))\n    }, {\n      icon: _withCtx(() => _cache[8] || (_cache[8] = [_createElementVNode(\"i\", {\n        class: \"fas fa-search-plus\"\n      }, null, -1 /* HOISTED */)])),\n      default: _withCtx(() => [_cache[9] || (_cache[9] = _createTextVNode(\" 放大 \"))]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_button, {\n      size: \"small\",\n      onClick: _cache[1] || (_cache[1] = $event => $setup.changeScale(-1))\n    }, {\n      icon: _withCtx(() => _cache[10] || (_cache[10] = [_createElementVNode(\"i\", {\n        class: \"fas fa-search-minus\"\n      }, null, -1 /* HOISTED */)])),\n      default: _withCtx(() => [_cache[11] || (_cache[11] = _createTextVNode(\" 缩小 \"))]),\n      _: 1 /* STABLE */\n    })])]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"]), _createCommentVNode(\" 文件选择器 \"), _createElementVNode(\"input\", {\n    ref: \"fileInput\",\n    type: \"file\",\n    accept: \"image/*\",\n    class: \"hidden\",\n    onChange: $setup.handleFileChange\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","_createElementBlock","_Fragment","_createVNode","_component_el_dialog","modelValue","$setup","visible","_cache","$event","title","width","handleClose","footer","_withCtx","_createElementVNode","_hoisted_9","_component_el_button","onClick","default","_createTextVNode","_","type","loading","uploading","handleUpload","_hoisted_1","_createCommentVNode","_hoisted_2","_hoisted_3","style","_normalizeStyle","previewStyle","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","ref","img","imgUrl","autoCrop","fixedBox","centerBox","info","full","canMove","canMoveBox","original","autoCropWidth","autoCropHeight","outputType","onRealTime","realTime","_hoisted_8","size","rotateLeft","icon","rotateRight","changeScale","accept","onChange","handleFileChange"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/components/AvatarCropper.vue"],"sourcesContent":["<template>\n  <el-dialog\n    v-model=\"visible\"\n    title=\"上传头像\"\n    width=\"700px\"\n    :close-on-click-modal=\"false\"\n    :before-close=\"handleClose\"\n  >\n    <div class=\"avatar-cropper\">\n      <!-- 左侧预览区域 -->\n      <div class=\"preview-container\">\n        <h4 class=\"text-gray-600 mb-2\">预览效果</h4>\n        <div class=\"preview-box large mb-4\">\n          <div class=\"preview\" :style=\"previewStyle\"></div>\n        </div>\n        <div class=\"flex gap-4\">\n          <div class=\"preview-box small\">\n            <div class=\"preview\" :style=\"previewStyle\"></div>\n          </div>\n          <div class=\"preview-box mini\">\n            <div class=\"preview\" :style=\"previewStyle\"></div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 右侧裁剪区域 -->\n      <div class=\"cropper-container\">\n        <VueCropper\n          ref=\"cropper\"\n          :img=\"imgUrl\"\n          :autoCrop=\"true\"\n          :fixedBox=\"true\"\n          :centerBox=\"true\"\n          :info=\"true\"\n          :full=\"true\"\n          :canMove=\"true\"\n          :canMoveBox=\"true\"\n          :original=\"false\"\n          :autoCropWidth=\"200\"\n          :autoCropHeight=\"200\"\n          :outputType=\"'png'\"\n          @realTime=\"realTime\"\n        />\n      </div>\n    </div>\n\n    <!-- 操作按钮 -->\n    <div class=\"operation-buttons mt-4 flex gap-2\">\n      <el-button size=\"small\" @click=\"rotateLeft\">\n        <template #icon>\n          <i class=\"fas fa-undo\"></i>\n        </template>\n        向左旋转\n      </el-button>\n      <el-button size=\"small\" @click=\"rotateRight\">\n        <template #icon>\n          <i class=\"fas fa-redo\"></i>\n        </template>\n        向右旋转\n      </el-button>\n      <el-button size=\"small\" @click=\"changeScale(1)\">\n        <template #icon>\n          <i class=\"fas fa-search-plus\"></i>\n        </template>\n        放大\n      </el-button>\n      <el-button size=\"small\" @click=\"changeScale(-1)\">\n        <template #icon>\n          <i class=\"fas fa-search-minus\"></i>\n        </template>\n        缩小\n      </el-button>\n    </div>\n\n    <template #footer>\n      <div class=\"dialog-footer\">\n        <el-button @click=\"handleClose\">取消</el-button>\n        <el-button type=\"primary\" :loading=\"uploading\" @click=\"handleUpload\">\n          确认上传\n        </el-button>\n      </div>\n    </template>\n  </el-dialog>\n\n  <!-- 文件选择器 -->\n  <input\n    ref=\"fileInput\"\n    type=\"file\"\n    accept=\"image/*\"\n    class=\"hidden\"\n    @change=\"handleFileChange\"\n  >\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport 'vue-cropper/dist/index.css'\nimport { VueCropper } from 'vue-cropper'\nimport { showToast } from '@/components/ToastMessage'\n\nconst props = defineProps({\n  modelValue: Boolean\n})\n\nconst emit = defineEmits(['update:modelValue', 'upload'])\n\nconst visible = computed({\n  get: () => props.modelValue,\n  set: (val) => emit('update:modelValue', val)\n})\n\nconst cropper = ref(null)\nconst fileInput = ref(null)\nconst imgUrl = ref('')\nconst uploading = ref(false)\nconst previewStyle = ref({})\n\n// 打开文件选择器\nconst openFileSelector = () => {\n  fileInput.value.click()\n}\n\n// 处理文件选择\nconst handleFileChange = (e) => {\n  const file = e.target.files[0]\n  if (!file) return\n\n  // 验证文件类型和大小\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return\n  }\n\n  const maxSize = 5 * 1024 * 1024 // 5MB\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过5MB', 'error')\n    return\n  }\n\n  // 读取文件\n  const reader = new FileReader()\n  reader.onload = (e) => {\n    imgUrl.value = e.target.result\n  }\n  reader.readAsDataURL(file)\n}\n\n// 实时预览\nconst realTime = (data) => {\n  previewStyle.value = {\n    backgroundImage: `url(${data.url})`,\n    backgroundPosition: `${data.x}px ${data.y}px`,\n    backgroundSize: `${data.w}px ${data.h}px`\n  }\n}\n\n// 旋转操作\nconst rotateLeft = () => {\n  cropper.value.rotateLeft()\n}\n\nconst rotateRight = () => {\n  cropper.value.rotateRight()\n}\n\n// 缩放操作\nconst changeScale = (num) => {\n  cropper.value.changeScale(num)\n}\n\n// 上传处理\nconst handleUpload = async () => {\n  try {\n    uploading.value = true\n    // 获取裁剪后的图片 blob 数据\n    const blob = await new Promise((resolve) => {\n      cropper.value.getCropBlob((data) => {\n        resolve(data)\n      })\n    })\n\n    // 创建文件对象\n    const file = new File([blob], 'avatar.png', { type: 'image/png' })\n    \n    // 触发上传事件\n    emit('upload', file)\n    handleClose()\n  } catch (error) {\n    console.error('头像处理失败:', error)\n    showToast('头像处理失败，请重试', 'error')\n  } finally {\n    uploading.value = false\n  }\n}\n\n// 关闭处理\nconst handleClose = () => {\n  visible.value = false\n  imgUrl.value = ''\n  if (fileInput.value) {\n    fileInput.value.value = ''\n  }\n}\n\n// 暴露方法给父组件\ndefineExpose({\n  openFileSelector\n})\n</script>\n\n<style scoped>\n.avatar-cropper {\n  display: flex;\n  gap: 20px;\n}\n\n.preview-container {\n  width: 200px;\n}\n\n.cropper-container {\n  flex: 1;\n  height: 400px;\n}\n\n.preview-box {\n  border: 1px solid #dcdfe6;\n  overflow: hidden;\n  border-radius: 4px;\n}\n\n.preview-box.large {\n  width: 200px;\n  height: 200px;\n}\n\n.preview-box.small {\n  width: 100px;\n  height: 100px;\n}\n\n.preview-box.mini {\n  width: 50px;\n  height: 50px;\n}\n\n.preview {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background-position: center;\n  background-repeat: no-repeat;\n}\n\n:deep(.vue-cropper) {\n  height: 100%;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}