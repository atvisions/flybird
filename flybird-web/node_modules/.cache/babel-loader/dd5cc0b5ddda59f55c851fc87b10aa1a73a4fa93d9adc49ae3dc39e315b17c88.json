{"ast":null,"code":"import { ref, watch } from 'vue';\nimport { Cropper } from 'vue-advanced-cropper';\nimport 'vue-advanced-cropper/dist/style.css';\nimport { Dialog, DialogPanel, TransitionChild, TransitionRoot } from '@headlessui/vue';\nimport { InformationCircleIcon, PhotoIcon } from '@heroicons/vue/24/outline';\nimport { showToast } from '@/components/ToastMessage';\nexport default {\n  __name: 'ProfileAvatarCropper',\n  props: {\n    modelValue: Boolean\n  },\n  emits: ['update:modelValue', 'upload'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const cropperRef = ref(null);\n    const imageUrl = ref('');\n    const previewUrl = ref('');\n    const hasImage = ref(false);\n\n    // 处理文件选择\n    const handleFileChange = event => {\n      const file = event?.target?.files?.[0];\n      if (!file) return;\n      if (!file.type.startsWith('image/')) {\n        showToast('请选择图片文件', 'error');\n        return;\n      }\n      const maxSize = 2 * 1024 * 1024;\n      if (file.size > maxSize) {\n        showToast('图片大小不能超过 2MB', 'error');\n        return;\n      }\n      const reader = new FileReader();\n      reader.onload = e => {\n        imageUrl.value = e.target.result;\n        hasImage.value = true;\n      };\n      reader.readAsDataURL(file);\n    };\n\n    // 监听裁剪变化\n    const onCrop = ({\n      coordinates,\n      canvas\n    }) => {\n      previewUrl.value = canvas.toDataURL();\n    };\n\n    // 处理裁剪\n    const handleCrop = async () => {\n      if (!cropperRef.value || !hasImage.value) return;\n      try {\n        const {\n          canvas\n        } = cropperRef.value.getResult();\n        canvas.toBlob(async blob => {\n          const file = new File([blob], 'profile_avatar.png', {\n            type: 'image/png'\n          });\n          await emit('upload', file);\n          clearImage();\n        }, 'image/png', 0.9);\n      } catch (error) {\n        console.error('裁剪失败:', error);\n        showToast('图片处理失败，请重试', 'error');\n      }\n    };\n    const closeDialog = () => {\n      emit('update:modelValue', false);\n      clearImage();\n    };\n    const clearImage = () => {\n      imageUrl.value = '';\n      previewUrl.value = '';\n      hasImage.value = false;\n    };\n    watch(() => props.modelValue, newVal => {\n      if (!newVal) clearImage();\n    });\n    const __returned__ = {\n      props,\n      emit,\n      cropperRef,\n      imageUrl,\n      previewUrl,\n      hasImage,\n      handleFileChange,\n      onCrop,\n      handleCrop,\n      closeDialog,\n      clearImage,\n      ref,\n      watch,\n      get Cropper() {\n        return Cropper;\n      },\n      get Dialog() {\n        return Dialog;\n      },\n      get DialogPanel() {\n        return DialogPanel;\n      },\n      get TransitionChild() {\n        return TransitionChild;\n      },\n      get TransitionRoot() {\n        return TransitionRoot;\n      },\n      get InformationCircleIcon() {\n        return InformationCircleIcon;\n      },\n      get PhotoIcon() {\n        return PhotoIcon;\n      },\n      get showToast() {\n        return showToast;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","Cropper","Dialog","DialogPanel","TransitionChild","TransitionRoot","InformationCircleIcon","PhotoIcon","showToast","props","__props","emit","__emit","cropperRef","imageUrl","previewUrl","hasImage","handleFileChange","event","file","target","files","type","startsWith","maxSize","size","reader","FileReader","onload","e","value","result","readAsDataURL","onCrop","coordinates","canvas","toDataURL","handleCrop","getResult","toBlob","blob","File","clearImage","error","console","closeDialog","modelValue","newVal"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/components/ProfileAvatarCropper.vue"],"sourcesContent":["<template>\n  <TransitionRoot appear :show=\"modelValue\" as=\"template\">\n    <Dialog as=\"div\" class=\"relative z-50\" @close=\"closeDialog\">\n      <TransitionChild as=\"template\" enter=\"duration-300 ease-out\" enter-from=\"opacity-0\" enter-to=\"opacity-100\">\n        <div class=\"fixed inset-0 bg-black/25\" />\n      </TransitionChild>\n\n      <div class=\"fixed inset-0 overflow-y-auto\">\n        <div class=\"flex min-h-full items-center justify-center p-4\">\n          <TransitionChild\n            as=\"template\"\n            enter=\"duration-300 ease-out\"\n            enter-from=\"opacity-0 scale-95\"\n            enter-to=\"opacity-100 scale-100\"\n          >\n            <DialogPanel class=\"w-full max-w-sm transform overflow-hidden rounded-2xl bg-white shadow-xl transition-all\">\n              <!-- 头部提示 -->\n              <div class=\"px-4 py-3 bg-primary-50 border-b border-primary-100\">\n                <div class=\"flex items-start space-x-3\">\n                  <InformationCircleIcon class=\"h-5 w-5 text-primary-500 mt-0.5\" />\n                  <div class=\"flex-1\">\n                    <p class=\"text-sm text-primary-700\">上传一张专业的头像照片，让您的简历更加出众</p>\n                  </div>\n                </div>\n              </div>\n\n              <!-- 主要内容区 -->\n              <div class=\"p-4\">\n                <div v-if=\"!imageUrl\" class=\"flex flex-col items-center justify-center py-8\">\n                  <!-- 上传区域 -->\n                  <label class=\"w-full max-w-xs cursor-pointer\">\n                    <div class=\"flex flex-col items-center p-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-500 transition-colors\">\n                      <PhotoIcon class=\"w-12 h-12 text-gray-400\" />\n                      <div class=\"mt-4 text-center\">\n                        <p class=\"text-sm font-medium text-gray-900\">点击选择照片</p>\n                        <p class=\"mt-1 text-xs text-gray-500\">或将照片拖放到此处</p>\n                      </div>\n                      <input type=\"file\" class=\"hidden\" accept=\"image/*\" @change=\"handleFileChange\">\n                    </div>\n                  </label>\n                </div>\n\n                <div v-else class=\"space-y-4\">\n                  <!-- 裁剪区域 -->\n                  <div class=\"relative aspect-square rounded-lg overflow-hidden bg-gray-100\">\n                    <Cropper\n                      ref=\"cropperRef\"\n                      class=\"cropper\"\n                      :src=\"imageUrl\"\n                      :stencil-props=\"{\n                        aspectRatio: 1,\n                        previewClass: 'rounded-full'\n                      }\"\n                      :default-size=\"{ width: '80%', height: '80%' }\"\n                      image-restriction=\"stencil\"\n                      :default-boundaries=\"{ width: '100%', height: '100%' }\"\n                      :default-position=\"{ left: '50%', top: '50%' }\"\n                      @change=\"onCrop\"\n                    />\n                  </div>\n\n                  <!-- 预览和操作区 -->\n                  <div class=\"flex items-center justify-between\">\n                    <div class=\"flex items-center space-x-3\">\n                      <div class=\"w-16 h-16 rounded-full overflow-hidden border-2 border-gray-200\">\n                        <img v-if=\"previewUrl\" :src=\"previewUrl\" class=\"w-full h-full object-cover\" alt=\"预览\" />\n                      </div>\n                      <button\n                        type=\"button\"\n                        class=\"text-sm text-gray-600 hover:text-primary-500\"\n                        @click=\"handleFileChange\"\n                      >\n                        重新选择\n                      </button>\n                    </div>\n                    <button\n                      type=\"button\"\n                      class=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700\"\n                      :disabled=\"!hasImage\"\n                      @click=\"handleCrop\"\n                    >\n                      确认使用\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </DialogPanel>\n          </TransitionChild>\n        </div>\n      </div>\n    </Dialog>\n  </TransitionRoot>\n</template>\n\n<script setup>\nimport { ref, watch } from 'vue'\nimport { Cropper } from 'vue-advanced-cropper'\nimport 'vue-advanced-cropper/dist/style.css'\nimport { Dialog, DialogPanel, TransitionChild, TransitionRoot } from '@headlessui/vue'\nimport { InformationCircleIcon, PhotoIcon } from '@heroicons/vue/24/outline'\nimport { showToast } from '@/components/ToastMessage'\n\nconst props = defineProps({\n  modelValue: Boolean\n})\n\nconst emit = defineEmits(['update:modelValue', 'upload'])\n\nconst cropperRef = ref(null)\nconst imageUrl = ref('')\nconst previewUrl = ref('')\nconst hasImage = ref(false)\n\n// 处理文件选择\nconst handleFileChange = (event) => {\n  const file = event?.target?.files?.[0]\n  if (!file) return\n\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return\n  }\n\n  const maxSize = 2 * 1024 * 1024\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过 2MB', 'error')\n    return\n  }\n\n  const reader = new FileReader()\n  reader.onload = (e) => {\n    imageUrl.value = e.target.result\n    hasImage.value = true\n  }\n  reader.readAsDataURL(file)\n}\n\n// 监听裁剪变化\nconst onCrop = ({ coordinates, canvas }) => {\n  previewUrl.value = canvas.toDataURL()\n}\n\n// 处理裁剪\nconst handleCrop = async () => {\n  if (!cropperRef.value || !hasImage.value) return\n  \n  try {\n    const { canvas } = cropperRef.value.getResult()\n    canvas.toBlob(async (blob) => {\n      const file = new File([blob], 'profile_avatar.png', { type: 'image/png' })\n      await emit('upload', file)\n      clearImage()\n    }, 'image/png', 0.9)\n  } catch (error) {\n    console.error('裁剪失败:', error)\n    showToast('图片处理失败，请重试', 'error')\n  }\n}\n\nconst closeDialog = () => {\n  emit('update:modelValue', false)\n  clearImage()\n}\n\nconst clearImage = () => {\n  imageUrl.value = ''\n  previewUrl.value = ''\n  hasImage.value = false\n}\n\nwatch(() => props.modelValue, (newVal) => {\n  if (!newVal) clearImage()\n})\n</script>\n\n<style>\n.cropper {\n  height: 100%;\n  background: #f3f4f6;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}