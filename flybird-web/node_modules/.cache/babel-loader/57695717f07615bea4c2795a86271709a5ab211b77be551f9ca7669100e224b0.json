{"ast":null,"code":"import _objectSpread from \"/Users/liuzhao/Documents/Projects/flybird/flybird-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { ref, computed, onMounted } from 'vue';\nimport { useRouter, useRoute } from 'vue-router';\nimport { useStore } from 'vuex';\nimport { showToast } from '@/components/ToastMessage';\nimport defaultAvatarImage from '@/assets/images/default-avatar.png';\nimport defaultBackground from '@/assets/images/default-background.jpg';\nimport { CameraIcon, PencilIcon, XMarkIcon, InformationCircleIcon } from '@heroicons/vue/24/outline';\nimport { user } from '@/api/user';\nexport default {\n  __name: 'UserHome',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const route = useRoute();\n    const store = useStore();\n\n    // 用户信息的计算属性\n    const userInfo = computed(() => {\n      return {\n        uid: store.state.userInfo?.data?.uid,\n        username: store.state.userInfo?.data?.username || '未设置用户名',\n        avatar: store.state.userInfo?.data?.avatar,\n        background_image: store.state.userInfo?.data?.background_image,\n        bio: store.state.userInfo?.data?.bio || null,\n        position: store.state.userInfo?.data?.position || null\n      };\n    });\n\n    // 计算背景图 URL\n    const backgroundUrl = computed(() => {\n      const bgImage = userInfo.value?.background_image;\n      return bgImage ? formatImageUrl(bgImage) : defaultBackground;\n    });\n\n    // 处理背景图上传\n    const handleBackgroundUpload = async () => {\n      // 创建文件输入框\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = 'image/*';\n\n      // 监听文件选择\n      input.onchange = async e => {\n        const file = e.target.files[0];\n        if (!file) return;\n\n        // 验证文件\n        if (!file.type.startsWith('image/')) {\n          showToast('请选择图片文件', 'error');\n          return;\n        }\n        const maxSize = 5 * 1024 * 1024; // 5MB\n        if (file.size > maxSize) {\n          showToast('图片大小不能超过5MB', 'error');\n          return;\n        }\n        try {\n          loading.value = true;\n          const response = await user.uploadBackground(file);\n          if (response.data?.code === 200) {\n            showToast('背景图上传成功', 'success');\n            // 更新 store 中的用户信息\n            store.commit('SET_USER_INFO', _objectSpread(_objectSpread({}, store.state.userInfo), {}, {\n              data: _objectSpread(_objectSpread({}, store.state.userInfo.data), {}, {\n                background_image: response.data.data.background_image\n              })\n            }));\n          } else {\n            throw new Error(response.data?.message || '上传失败');\n          }\n        } catch (error) {\n          console.error('背景图上传失败:', error);\n          showToast(error.message || '背景图上传失败，请稍后重试', 'error');\n        } finally {\n          loading.value = false;\n          input.value = ''; // 清空文件选择器\n        }\n      };\n\n      // 触发文件选择\n      input.click();\n    };\n\n    // No changes to rest of the script section\n\n    const __returned__ = {\n      router,\n      route,\n      store,\n      userInfo,\n      backgroundUrl,\n      handleBackgroundUpload,\n      ref,\n      computed,\n      onMounted,\n      get useRouter() {\n        return useRouter;\n      },\n      get useRoute() {\n        return useRoute;\n      },\n      get useStore() {\n        return useStore;\n      },\n      get showToast() {\n        return showToast;\n      },\n      get defaultAvatarImage() {\n        return defaultAvatarImage;\n      },\n      get defaultBackground() {\n        return defaultBackground;\n      },\n      get CameraIcon() {\n        return CameraIcon;\n      },\n      get PencilIcon() {\n        return PencilIcon;\n      },\n      get XMarkIcon() {\n        return XMarkIcon;\n      },\n      get InformationCircleIcon() {\n        return InformationCircleIcon;\n      },\n      get user() {\n        return user;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useRouter","useRoute","useStore","showToast","defaultAvatarImage","defaultBackground","CameraIcon","PencilIcon","XMarkIcon","InformationCircleIcon","user","router","route","store","userInfo","uid","state","data","username","avatar","background_image","bio","position","backgroundUrl","bgImage","value","formatImageUrl","handleBackgroundUpload","input","document","createElement","type","accept","onchange","e","file","target","files","startsWith","maxSize","size","loading","response","uploadBackground","code","commit","_objectSpread","Error","message","error","console","click"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/components/UserHome.vue"],"sourcesContent":["<template>\n  <div class=\"user-home w-full\">\n    <!-- 顶部背景和用户信息 -->\n    <div class=\"relative\">\n      <!-- 背景图 -->\n      <div class=\"h-48 bg-gradient-to-r from-gray-900 to-gray-800 relative group rounded-t-lg overflow-hidden\">\n        <div class=\"absolute inset-0 rounded-t-lg overflow-hidden\">\n          <img\n            :src=\"backgroundUrl\"\n            class=\"w-full h-full object-cover opacity-70\"\n            alt=\"背景图\"\n            @error=\"handleBackgroundError\"\n          />\n        </div>\n        <!-- 背景图上传按钮 -->\n        <div \n          class=\"absolute top-4 right-4 p-2 rounded-full bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer\"\n          @click=\"handleBackgroundUpload\"\n        >\n          <CameraIcon class=\"w-5 h-5 text-white\" />\n        </div>\n      </div>\n      \n      <!-- 用户信息卡片 -->\n      <div class=\"-mt-10 relative z-10\">\n        <!-- 头像和基本身份信息区块 -->\n        <div \n          class=\"relative group w-20 h-20 mx-auto -mb-10 z-20 cursor-pointer\"\n          @click=\"openEditModal\"\n        >\n          <img\n            :src=\"userAvatar\"\n            class=\"w-20 h-20 rounded-full border-4 border-white object-cover shadow-lg\"\n            alt=\"头像\"\n            @error=\"handleImageError\"\n          />\n          <!-- 添加悬停效果 -->\n          <div class=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 rounded-full opacity-0 group-hover:opacity-100 transition-opacity\">\n            <CameraIcon class=\"w-6 h-6 text-white\" />\n          </div>\n        </div>\n\n        <div class=\"bg-white rounded-b-lg border border-gray-100 p-4 pb-6 transition-shadow hover:shadow-lg relative\">\n          <!-- 头像和基本身份信息区块 -->\n          <div class=\"flex flex-col items-center relative z-10\">\n            <!-- 编辑资料按钮 -->\n            <button \n              @click=\"openEditModal\"\n              class=\"absolute right-[-10px] top-[-30px] px-3 py-1 text-xs text-gray-500 hover:text-gray-900 border border-gray-200 rounded-full hover:bg-gray-50 transition-all flex items-center bg-white\"\n            >\n              <PencilIcon class=\"w-3.5 h-3.5 mr-1\" />\n              编辑资料\n            </button>\n\n            <!-- 用户基本信息 -->\n            <div class=\"flex flex-col items-center min-h-[5rem] pt-8\">\n              <div class=\"flex flex-col items-center space-y-3\">\n                <!-- 用户名 -->\n                <div class=\"text-center\">\n                  <div class=\"inline-flex items-center group relative\">\n                    <h2 class=\"text-xl font-bold text-gray-900\">{{ userInfo.username }}</h2>\n                  </div>\n                </div>\n                <!-- 当前岗位 -->\n                <div class=\"mt-1 flex items-center justify-center group\">\n                  <span v-if=\"userInfo.position\" class=\"text-sm text-gray-600\">{{ userInfo.position }}</span>\n                  <span v-else class=\"text-sm text-gray-400\">未设置职位</span>\n                </div>\n                <!-- 个人简介 -->\n                <div class=\"mt-2 group relative\">\n                  <div class=\"relative\">\n                    <!-- 左引号装饰 -->\n                    <span class=\"absolute -left-4 -top-2 text-gray-300 text-xl font-serif\">\"</span>\n                    <p v-if=\"userInfo.bio\" \n                      class=\"text-sm text-gray-500 max-w-xl px-6 py-3 bg-gray-50/80 rounded-lg\"\n                    >\n                      {{ userInfo.bio }}\n                    </p>\n                    <p v-else \n                      class=\"text-sm text-gray-400 italic px-6 py-3 bg-gray-50/80 rounded-lg\"\n                    >\n                      这个人还没有填写个人简介\n                    </p>\n                    <!-- 右引号装饰 -->\n                    <span class=\"absolute -right-4 -bottom-2 text-gray-300 text-xl font-serif\">\"</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- 编辑资料弹窗 -->\n    <div v-if=\"showEditModal\" class=\"modal-overlay\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h3>编辑个人资料</h3>\n          <button class=\"close-btn\" @click=\"closeEditModal\">\n            <XMarkIcon class=\"w-5 h-5\" />\n          </button>\n        </div>\n        <div class=\"modal-body\">\n          <!-- 头像上传 -->\n          <div class=\"form-group\">\n            <label class=\"form-label\">头像</label>\n            <div class=\"flex items-center space-x-4\">\n              <div class=\"relative group\">\n                <img\n                  :src=\"editAvatarUrl\"\n                  class=\"w-20 h-20 rounded-full object-cover border-2 border-gray-200\"\n                  alt=\"头像\"\n                  @error=\"handleImageError\"\n                />\n                <div \n                  @click=\"handleAvatarSelect\"\n                  class=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer\"\n                >\n                  <CameraIcon class=\"w-6 h-6 text-white\" />\n                </div>\n              </div>\n              <input\n                ref=\"avatarInput\"\n                type=\"file\"\n                accept=\"image/*\"\n                class=\"hidden\"\n                @change=\"handleAvatarChange\"\n              />\n              <div class=\"text-sm text-gray-500\">\n                <p>点击头像更换</p>\n                <p class=\"text-xs mt-1\">建议使用正面免冠证件照</p>\n              </div>\n            </div>\n          </div>\n          \n          <!-- 用户名 -->\n          <div class=\"form-group\">\n            <label class=\"form-label\">用户名</label>\n            <input \n              type=\"text\"\n              v-model=\"editForm.username\"\n              placeholder=\"请输入新用户名\"\n              :disabled=\"loading\"\n              @input=\"validateUsername\"\n              :class=\"{ 'error': usernameError }\"\n            />\n            <!-- 错误提示 -->\n            <div v-if=\"usernameError\" class=\"text-red-500 text-sm mt-1\">\n              {{ usernameError }}\n            </div>\n            <!-- 简单的提示文字 -->\n            <div class=\"text-gray-400 text-xs mt-1\">\n              用户名长度4-8个字符，可使用中文、英文字母、数字\n            </div>\n          </div>\n\n          <!-- 职位 -->\n          <div class=\"form-group\">\n            <label class=\"form-label\">当前职位</label>\n            <input \n              type=\"text\"\n              v-model=\"editForm.position\"\n              placeholder=\"请输入您的职位\"\n              :disabled=\"loading\"\n            />\n          </div>\n          \n          <!-- 个人简介 -->\n          <div class=\"form-group\">\n            <label class=\"form-label\">个人简介</label>\n            <textarea\n              v-model=\"editForm.bio\"\n              placeholder=\"请输入个人简介\"\n              :disabled=\"loading\"\n              rows=\"4\"\n              class=\"form-textarea\"\n            ></textarea>\n          </div>\n        </div>\n        <div class=\"modal-footer\">\n          <button \n            class=\"btn btn-default\" \n            @click=\"closeEditModal\"\n            :disabled=\"loading\"\n          >\n            取消\n          </button>\n          <button \n            class=\"btn btn-primary\" \n            @click=\"handleProfileUpdate\"\n            :disabled=\"loading\"\n          >\n            {{ loading ? '更新中...' : '确认' }}\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport { useStore } from 'vuex'\nimport { showToast } from '@/components/ToastMessage'\nimport defaultAvatarImage from '@/assets/images/default-avatar.png'\nimport defaultBackground from '@/assets/images/default-background.jpg'\nimport {\n  CameraIcon,\n  PencilIcon,\n  XMarkIcon,\n  InformationCircleIcon\n} from '@heroicons/vue/24/outline'\nimport { user } from '@/api/user'\n\nconst router = useRouter()\nconst route = useRoute()\nconst store = useStore()\n\n// 用户信息的计算属性\nconst userInfo = computed(() => {\n  return {\n    uid: store.state.userInfo?.data?.uid,\n    username: store.state.userInfo?.data?.username || '未设置用户名',\n    avatar: store.state.userInfo?.data?.avatar,\n    background_image: store.state.userInfo?.data?.background_image,\n    bio: store.state.userInfo?.data?.bio || null,\n    position: store.state.userInfo?.data?.position || null\n  }\n})\n\n// 计算背景图 URL\nconst backgroundUrl = computed(() => {\n  const bgImage = userInfo.value?.background_image\n  return bgImage ? formatImageUrl(bgImage) : defaultBackground\n})\n\n// 处理背景图上传\nconst handleBackgroundUpload = async () => {\n  // 创建文件输入框\n  const input = document.createElement('input')\n  input.type = 'file'\n  input.accept = 'image/*'\n  \n  // 监听文件选择\n  input.onchange = async (e) => {\n    const file = e.target.files[0]\n    if (!file) return\n    \n    // 验证文件\n    if (!file.type.startsWith('image/')) {\n      showToast('请选择图片文件', 'error')\n      return\n    }\n    \n    const maxSize = 5 * 1024 * 1024 // 5MB\n    if (file.size > maxSize) {\n      showToast('图片大小不能超过5MB', 'error')\n      return\n    }\n    \n    try {\n      loading.value = true\n      const response = await user.uploadBackground(file)\n      if (response.data?.code === 200) {\n        showToast('背景图上传成功', 'success')\n        // 更新 store 中的用户信息\n        store.commit('SET_USER_INFO', {\n          ...store.state.userInfo,\n          data: {\n            ...store.state.userInfo.data,\n            background_image: response.data.data.background_image\n          }\n        })\n      } else {\n        throw new Error(response.data?.message || '上传失败')\n      }\n    } catch (error) {\n      console.error('背景图上传失败:', error)\n      showToast(error.message || '背景图上传失败，请稍后重试', 'error')\n    } finally {\n      loading.value = false\n      input.value = ''  // 清空文件选择器\n    }\n  }\n  \n  // 触发文件选择\n  input.click()\n}\n\n// No changes to rest of the script section\n</script>\n\n<style scoped>\n/* No changes to style section */\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}