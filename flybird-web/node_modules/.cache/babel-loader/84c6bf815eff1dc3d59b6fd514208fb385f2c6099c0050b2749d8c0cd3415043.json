{"ast":null,"code":"import axios from 'axios';\nimport { ElMessage } from 'element-plus';\nimport { useAuthStore } from '@/stores/auth';\nimport router from '@/router';\n\n// 创建 axios 实例\nconst service = axios.create({\n  baseURL: process.env.VUE_APP_API_BASE_URL || 'http://192.168.3.16:8080',\n  timeout: 15000,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// 标记是否正在重定向\nlet isRedirecting = false;\n\n// 请求拦截器\nservice.interceptors.request.use(config => {\n  const authStore = useAuthStore();\n  const token = authStore.token;\n  if (token) {\n    config.headers['Authorization'] = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// 响应拦截器\nservice.interceptors.response.use(response => {\n  const res = response.data;\n  if (res.code === 401 && !isRedirecting) {\n    isRedirecting = true;\n    const authStore = useAuthStore();\n    authStore.logout();\n\n    // 如果不是登录页面，才显示提示并重定向\n    if (router.currentRoute.value.path !== '/login') {\n      ElMessage({\n        message: '登录已过期，请重新登录',\n        type: 'warning',\n        duration: 3000\n      });\n\n      // 记住当前路由，登录后可以跳回来\n      const redirect = router.currentRoute.value.fullPath;\n      router.push({\n        path: '/login',\n        query: {\n          redirect\n        }\n      });\n    }\n\n    // 重置重定向状态\n    setTimeout(() => {\n      isRedirecting = false;\n    }, 1000);\n    return Promise.reject(new Error('未登录或登录已过期'));\n  }\n  if (res.code !== 200) {\n    ElMessage({\n      message: res.message || '请求失败',\n      type: 'error',\n      duration: 3000\n    });\n    return Promise.reject(new Error(res.message || '请求失败'));\n  }\n  return response;\n}, error => {\n  if (error.response) {\n    switch (error.response.status) {\n      case 401:\n        if (!isRedirecting) {\n          isRedirecting = true;\n          const authStore = useAuthStore();\n          authStore.logout();\n          if (router.currentRoute.value.path !== '/login') {\n            ElMessage({\n              message: '未登录或登录已过期',\n              type: 'warning',\n              duration: 3000\n            });\n            const redirect = router.currentRoute.value.fullPath;\n            router.push({\n              path: '/login',\n              query: {\n                redirect\n              }\n            });\n          }\n          setTimeout(() => {\n            isRedirecting = false;\n          }, 1000);\n        }\n        break;\n      case 403:\n        ElMessage({\n          message: '没有权限访问',\n          type: 'error',\n          duration: 3000\n        });\n        break;\n      default:\n        ElMessage({\n          message: error.message || '请求失败',\n          type: 'error',\n          duration: 3000\n        });\n    }\n  } else if (error.request) {\n    ElMessage({\n      message: '网络连接失败',\n      type: 'error',\n      duration: 3000\n    });\n  }\n  return Promise.reject(error);\n});\nexport default service;","map":{"version":3,"names":["axios","ElMessage","useAuthStore","router","service","create","baseURL","process","env","VUE_APP_API_BASE_URL","timeout","headers","isRedirecting","interceptors","request","use","config","authStore","token","error","Promise","reject","response","res","data","code","logout","currentRoute","value","path","message","type","duration","redirect","fullPath","push","query","setTimeout","Error","status"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/utils/request.js"],"sourcesContent":["import axios from 'axios'\nimport { ElMessage } from 'element-plus'\nimport { useAuthStore } from '@/stores/auth'\nimport router from '@/router'\n\n// 创建 axios 实例\nconst service = axios.create({\n  baseURL: process.env.VUE_APP_API_BASE_URL || 'http://192.168.3.16:8080',\n  timeout: 15000,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n})\n\n// 标记是否正在重定向\nlet isRedirecting = false\n\n// 请求拦截器\nservice.interceptors.request.use(\n  config => {\n    const authStore = useAuthStore()\n    const token = authStore.token\n    \n    if (token) {\n      config.headers['Authorization'] = `Bearer ${token}`\n    }\n    \n    return config\n  },\n  error => {\n    return Promise.reject(error)\n  }\n)\n\n// 响应拦截器\nservice.interceptors.response.use(\n  response => {\n    const res = response.data\n\n    if (res.code === 401 && !isRedirecting) {\n      isRedirecting = true\n      const authStore = useAuthStore()\n      authStore.logout()\n      \n      // 如果不是登录页面，才显示提示并重定向\n      if (router.currentRoute.value.path !== '/login') {\n        ElMessage({\n          message: '登录已过期，请重新登录',\n          type: 'warning',\n          duration: 3000\n        })\n        \n        // 记住当前路由，登录后可以跳回来\n        const redirect = router.currentRoute.value.fullPath\n        router.push({\n          path: '/login',\n          query: { redirect }\n        })\n      }\n      \n      // 重置重定向状态\n      setTimeout(() => {\n        isRedirecting = false\n      }, 1000)\n      \n      return Promise.reject(new Error('未登录或登录已过期'))\n    }\n    \n    if (res.code !== 200) {\n      ElMessage({\n        message: res.message || '请求失败',\n        type: 'error',\n        duration: 3000\n      })\n      return Promise.reject(new Error(res.message || '请求失败'))\n    }\n    \n    return response\n  },\n  error => {\n    if (error.response) {\n      switch (error.response.status) {\n        case 401:\n          if (!isRedirecting) {\n            isRedirecting = true\n            const authStore = useAuthStore()\n            authStore.logout()\n            \n            if (router.currentRoute.value.path !== '/login') {\n              ElMessage({\n                message: '未登录或登录已过期',\n                type: 'warning',\n                duration: 3000\n              })\n              \n              const redirect = router.currentRoute.value.fullPath\n              router.push({\n                path: '/login',\n                query: { redirect }\n              })\n            }\n            \n            setTimeout(() => {\n              isRedirecting = false\n            }, 1000)\n          }\n          break\n        case 403:\n          ElMessage({\n            message: '没有权限访问',\n            type: 'error',\n            duration: 3000\n          })\n          break\n        default:\n          ElMessage({\n            message: error.message || '请求失败',\n            type: 'error',\n            duration: 3000\n          })\n      }\n    } else if (error.request) {\n      ElMessage({\n        message: '网络连接失败',\n        type: 'error',\n        duration: 3000\n      })\n    }\n    \n    return Promise.reject(error)\n  }\n)\n\nexport default service"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}