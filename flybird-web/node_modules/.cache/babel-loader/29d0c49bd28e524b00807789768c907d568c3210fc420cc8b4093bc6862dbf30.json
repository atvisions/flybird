{"ast":null,"code":"import _objectSpread from \"/Users/liuzhao/Documents/Projects/flybird/flybird-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { ref, computed } from 'vue';\nimport { GridLayout, GridItem } from 'vue-grid-layout';\nimport { ArrowUp, ArrowDown, Delete, Plus, Warning } from '@element-plus/icons-vue';\nimport ComponentRenderer from '../widgets/ComponentRenderer.vue';\n\n// 选中的组件ID\n\nexport default {\n  __name: 'EditorCanvas',\n  props: {\n    modelValue: {\n      type: Array,\n      required: true\n    },\n    styles: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  emits: ['update:modelValue', 'select', 'add-component'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const selectedId = ref(null);\n    const props = __props;\n    const emit = __emit;\n\n    // 布局数据\n    const layoutModel = computed({\n      get: () => {\n        console.log('Layout model value:', props.modelValue);\n        return props.modelValue || [];\n      },\n      set: value => {\n        console.log('Setting layout model:', value);\n        emit('update:modelValue', value);\n      }\n    });\n\n    // 容器样式\n    const containerStyle = computed(() => _objectSpread({\n      width: '210mm',\n      // A4 宽度\n      height: '297mm',\n      // A4 高度\n      margin: '0 auto',\n      background: '#fff',\n      boxShadow: '0 0 10px rgba(0, 0, 0, 0.1)'\n    }, props.styles));\n\n    // 拖放状态\n    const isDragOver = ref(false);\n\n    // 处理拖动经过\n    const handleDragOver = event => {\n      event.preventDefault();\n      isDragOver.value = true;\n    };\n\n    // 处理拖动离开\n    const handleDragLeave = event => {\n      event.preventDefault();\n      isDragOver.value = false;\n    };\n\n    // 处理组件拖放\n    const handleDrop = event => {\n      event.preventDefault();\n      isDragOver.value = false;\n      try {\n        const componentData = JSON.parse(event.dataTransfer.getData('text/plain'));\n        const rect = event.currentTarget.getBoundingClientRect();\n        const x = Math.floor((event.clientX - rect.left) / (rect.width / 12));\n        const y = Math.floor((event.clientY - rect.top) / 30);\n        console.log('Dropping component:', componentData, 'at position:', {\n          x,\n          y\n        });\n        emit('add-component', _objectSpread(_objectSpread({}, componentData), {}, {\n          position: {\n            x,\n            y\n          }\n        }));\n      } catch (error) {\n        console.error('Drop error:', error);\n      }\n    };\n\n    // 处理组件选中\n    const handleSelect = id => {\n      console.log('Selecting component:', id);\n      selectedId.value = id;\n      emit('select', id);\n    };\n\n    // 处理布局更新\n    const handleLayoutUpdate = layout => {\n      console.log('Layout updated:', layout);\n      emit('update:modelValue', layout);\n    };\n\n    // 处理组件调整大小\n    const handleResize = (i, newH, newW) => {\n      const index = layoutModel.value.findIndex(item => item.i === i);\n      if (index > -1) {\n        layoutModel.value[index].h = newH;\n        layoutModel.value[index].w = newW;\n      }\n    };\n\n    // 处理组件移动\n    const handleMoved = (i, newX, newY) => {\n      const index = layoutModel.value.findIndex(item => item.i === i);\n      if (index > -1) {\n        layoutModel.value[index].x = newX;\n        layoutModel.value[index].y = newY;\n      }\n    };\n\n    // 处理组件上移\n    const handleMoveUp = id => {\n      const index = layoutModel.value.findIndex(item => item.i === id);\n      if (index > 0) {\n        const temp = _objectSpread({}, layoutModel.value[index - 1]);\n        layoutModel.value[index - 1] = _objectSpread({}, layoutModel.value[index]);\n        layoutModel.value[index] = temp;\n      }\n    };\n\n    // 处理组件下移\n    const handleMoveDown = id => {\n      const index = layoutModel.value.findIndex(item => item.i === id);\n      if (index < layoutModel.value.length - 1) {\n        const temp = _objectSpread({}, layoutModel.value[index + 1]);\n        layoutModel.value[index + 1] = _objectSpread({}, layoutModel.value[index]);\n        layoutModel.value[index] = temp;\n      }\n    };\n\n    // 处理组件删除\n    const handleDelete = id => {\n      const index = layoutModel.value.findIndex(item => item.i === id);\n      if (index > -1) {\n        layoutModel.value.splice(index, 1);\n        selectedId.value = null;\n      }\n    };\n    const __returned__ = {\n      selectedId,\n      props,\n      emit,\n      layoutModel,\n      containerStyle,\n      isDragOver,\n      handleDragOver,\n      handleDragLeave,\n      handleDrop,\n      handleSelect,\n      handleLayoutUpdate,\n      handleResize,\n      handleMoved,\n      handleMoveUp,\n      handleMoveDown,\n      handleDelete,\n      ref,\n      computed,\n      get GridLayout() {\n        return GridLayout;\n      },\n      get GridItem() {\n        return GridItem;\n      },\n      get ArrowUp() {\n        return ArrowUp;\n      },\n      get ArrowDown() {\n        return ArrowDown;\n      },\n      get Delete() {\n        return Delete;\n      },\n      get Plus() {\n        return Plus;\n      },\n      get Warning() {\n        return Warning;\n      },\n      ComponentRenderer\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","GridLayout","GridItem","ArrowUp","ArrowDown","Delete","Plus","Warning","ComponentRenderer","selectedId","props","__props","emit","__emit","layoutModel","get","console","log","modelValue","set","value","containerStyle","_objectSpread","width","height","margin","background","boxShadow","styles","isDragOver","handleDragOver","event","preventDefault","handleDragLeave","handleDrop","componentData","JSON","parse","dataTransfer","getData","rect","currentTarget","getBoundingClientRect","x","Math","floor","clientX","left","y","clientY","top","position","error","handleSelect","id","handleLayoutUpdate","layout","handleResize","i","newH","newW","index","findIndex","item","h","w","handleMoved","newX","newY","handleMoveUp","temp","handleMoveDown","length","handleDelete","splice"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/template-editor/components/canvas/EditorCanvas.vue"],"sourcesContent":["<template>\n  <div \n    class=\"editor-canvas\"\n    @dragover=\"handleDragOver\"\n    @dragleave=\"handleDragLeave\"\n    @drop=\"handleDrop\"\n    :class=\"{ 'drag-over': isDragOver }\"\n  >\n    <div \n      class=\"canvas-container\"\n      :style=\"containerStyle\"\n    >\n      <div v-if=\"isDragOver\" class=\"drop-indicator\">\n        <el-icon class=\"text-3xl\"><Plus /></el-icon>\n        <span>释放鼠标添加组件</span>\n      </div>\n      \n      <GridLayout\n        v-model:layout=\"layoutModel\"\n        :col-num=\"12\"\n        :row-height=\"30\"\n        :is-draggable=\"true\"\n        :is-resizable=\"true\"\n        :vertical-compact=\"true\"\n        :use-css-transforms=\"true\"\n        :margin=\"[10, 10]\"\n        @layout-updated=\"handleLayoutUpdate\"\n      >\n        <GridItem\n          v-for=\"item in layoutModel\"\n          :key=\"item.i\"\n          :x=\"item.x\"\n          :y=\"item.y\"\n          :w=\"item.w\"\n          :h=\"item.h\"\n          :i=\"item.i\"\n          :min-w=\"3\"\n          :min-h=\"3\"\n          :is-draggable=\"true\"\n          :is-resizable=\"true\"\n          :class=\"{ active: selectedId === item.i }\"\n          @click=\"handleSelect(item.i)\"\n          @resize=\"handleResize\"\n          @moved=\"handleMoved\"\n        >\n          <template v-if=\"item && item.type\">\n            <ComponentRenderer\n              :type=\"item.type\"\n              :data=\"item.data\"\n              :styles=\"item.styles\"\n            />\n          </template>\n          <template v-else>\n            <div class=\"empty-component\">\n              <el-icon><Warning /></el-icon>\n              <span>组件加载失败</span>\n            </div>\n          </template>\n          <div class=\"component-actions\" v-if=\"selectedId === item.i\">\n            <el-button-group>\n              <el-button size=\"small\" @click=\"handleMoveUp(item.i)\">\n                <el-icon><ArrowUp /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleMoveDown(item.i)\">\n                <el-icon><ArrowDown /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleDelete(item.i)\">\n                <el-icon><Delete /></el-icon>\n              </el-button>\n            </el-button-group>\n          </div>\n        </GridItem>\n      </GridLayout>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport { GridLayout, GridItem } from 'vue-grid-layout'\nimport { ArrowUp, ArrowDown, Delete, Plus, Warning } from '@element-plus/icons-vue'\nimport ComponentRenderer from '../widgets/ComponentRenderer.vue'\n\n// 选中的组件ID\nconst selectedId = ref(null)\n\nconst props = defineProps({\n  modelValue: {\n    type: Array,\n    required: true\n  },\n  styles: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'select', 'add-component'])\n\n// 布局数据\nconst layoutModel = computed({\n  get: () => {\n    console.log('Layout model value:', props.modelValue)\n    return props.modelValue || []\n  },\n  set: (value) => {\n    console.log('Setting layout model:', value)\n    emit('update:modelValue', value)\n  }\n})\n\n// 容器样式\nconst containerStyle = computed(() => ({\n  width: '210mm', // A4 宽度\n  height: '297mm', // A4 高度\n  margin: '0 auto',\n  background: '#fff',\n  boxShadow: '0 0 10px rgba(0, 0, 0, 0.1)',\n  ...props.styles\n}))\n\n// 拖放状态\nconst isDragOver = ref(false)\n\n// 处理拖动经过\nconst handleDragOver = (event) => {\n  event.preventDefault()\n  isDragOver.value = true\n}\n\n// 处理拖动离开\nconst handleDragLeave = (event) => {\n  event.preventDefault()\n  isDragOver.value = false\n}\n\n// 处理组件拖放\nconst handleDrop = (event) => {\n  event.preventDefault()\n  isDragOver.value = false\n  \n  try {\n    const componentData = JSON.parse(event.dataTransfer.getData('text/plain'))\n    const rect = event.currentTarget.getBoundingClientRect()\n    const x = Math.floor((event.clientX - rect.left) / (rect.width / 12))\n    const y = Math.floor((event.clientY - rect.top) / 30)\n    \n    console.log('Dropping component:', componentData, 'at position:', { x, y })\n    \n    emit('add-component', {\n      ...componentData,\n      position: { x, y }\n    })\n  } catch (error) {\n    console.error('Drop error:', error)\n  }\n}\n\n// 处理组件选中\nconst handleSelect = (id) => {\n  console.log('Selecting component:', id)\n  selectedId.value = id\n  emit('select', id)\n}\n\n// 处理布局更新\nconst handleLayoutUpdate = (layout) => {\n  console.log('Layout updated:', layout)\n  emit('update:modelValue', layout)\n}\n\n// 处理组件调整大小\nconst handleResize = (i, newH, newW) => {\n  const index = layoutModel.value.findIndex(item => item.i === i)\n  if (index > -1) {\n    layoutModel.value[index].h = newH\n    layoutModel.value[index].w = newW\n  }\n}\n\n// 处理组件移动\nconst handleMoved = (i, newX, newY) => {\n  const index = layoutModel.value.findIndex(item => item.i === i)\n  if (index > -1) {\n    layoutModel.value[index].x = newX\n    layoutModel.value[index].y = newY\n  }\n}\n\n// 处理组件上移\nconst handleMoveUp = (id) => {\n  const index = layoutModel.value.findIndex(item => item.i === id)\n  if (index > 0) {\n    const temp = { ...layoutModel.value[index - 1] }\n    layoutModel.value[index - 1] = { ...layoutModel.value[index] }\n    layoutModel.value[index] = temp\n  }\n}\n\n// 处理组件下移\nconst handleMoveDown = (id) => {\n  const index = layoutModel.value.findIndex(item => item.i === id)\n  if (index < layoutModel.value.length - 1) {\n    const temp = { ...layoutModel.value[index + 1] }\n    layoutModel.value[index + 1] = { ...layoutModel.value[index] }\n    layoutModel.value[index] = temp\n  }\n}\n\n// 处理组件删除\nconst handleDelete = (id) => {\n  const index = layoutModel.value.findIndex(item => item.i === id)\n  if (index > -1) {\n    layoutModel.value.splice(index, 1)\n    selectedId.value = null\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.editor-canvas {\n  @apply flex-1 overflow-y-auto bg-gray-100 p-8;\n  \n  &.drag-over .canvas-container {\n    @apply ring-2 ring-blue-500 ring-opacity-50;\n  }\n  \n  .canvas-container {\n    @apply shadow-lg relative;\n    transform-origin: top center;\n    \n    // 拖放提示\n    .drop-indicator {\n      @apply absolute inset-0 flex flex-col items-center justify-center\n             bg-blue-50 bg-opacity-50 text-blue-500 pointer-events-none;\n      z-index: 100;\n    }\n  }\n  \n  .empty-component {\n    @apply flex flex-col items-center justify-center h-full\n           bg-gray-50 text-gray-400 space-y-2;\n  }\n  \n  .component-actions {\n    @apply absolute top-2 right-2 opacity-0 transition-opacity;\n  }\n  \n  .vue-grid-item {\n    &:hover .component-actions {\n      @apply opacity-100;\n    }\n    \n    &.active {\n      @apply ring-2 ring-blue-500;\n    }\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}