{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport { ref } from 'vue';\nimport 'vue-cropper/dist/index.css';\nimport { VueCropper } from 'vue-cropper';\nimport { Dialog, DialogPanel, DialogTitle, TransitionChild, TransitionRoot } from '@headlessui/vue';\nimport { XMarkIcon, PhotoIcon, InformationCircleIcon, ArrowPathIcon } from '@heroicons/vue/24/outline';\nimport { showToast } from '@/components/ToastMessage';\nexport default {\n  __name: 'AvatarUploadDialog',\n  props: {\n    modelValue: Boolean,\n    loading: Boolean\n  },\n  emits: ['update:modelValue', 'upload'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const imageUrl = ref('');\n    const cropper = ref(null);\n    const handleClose = () => {\n      imageUrl.value = '';\n      emit('update:modelValue', false);\n    };\n    const handleFileChange = e => {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      // 验证文件类型和大小\n      if (!file.type.startsWith('image/')) {\n        showToast('请选择图片文件', 'error');\n        return;\n      }\n      const maxSize = 2 * 1024 * 1024; // 2MB\n      if (file.size > maxSize) {\n        showToast('图片大小不能超过 2MB', 'error');\n        return;\n      }\n\n      // 读取文件\n      const reader = new FileReader();\n      reader.onload = e => {\n        imageUrl.value = e.target.result;\n      };\n      reader.readAsDataURL(file);\n    };\n    const rotateLeft = () => {\n      cropper.value.rotateLeft();\n    };\n    const rotateRight = () => {\n      cropper.value.rotateRight();\n    };\n    const handleUpload = async () => {\n      if (!cropper.value) return;\n\n      // 获取裁切后的图片 base64 数据\n      cropper.value.getCropData(data => {\n        // 将 base64 转换为文件对象\n        const arr = data.split(',');\n        const mime = arr[0].match(/:(.*?);/)[1];\n        const bstr = atob(arr[1]);\n        let n = bstr.length;\n        const u8arr = new Uint8Array(n);\n        while (n--) {\n          u8arr[n] = bstr.charCodeAt(n);\n        }\n        const file = new File([u8arr], 'avatar.png', {\n          type: mime\n        });\n\n        // 触发上传事件\n        emit('upload', file);\n      });\n    };\n\n    // 组件定义\n    const components = {\n      VueCropper\n    };\n    const __returned__ = {\n      props,\n      emit,\n      imageUrl,\n      cropper,\n      handleClose,\n      handleFileChange,\n      rotateLeft,\n      rotateRight,\n      handleUpload,\n      components,\n      ref,\n      get VueCropper() {\n        return VueCropper;\n      },\n      get Dialog() {\n        return Dialog;\n      },\n      get DialogPanel() {\n        return DialogPanel;\n      },\n      get DialogTitle() {\n        return DialogTitle;\n      },\n      get TransitionChild() {\n        return TransitionChild;\n      },\n      get TransitionRoot() {\n        return TransitionRoot;\n      },\n      get XMarkIcon() {\n        return XMarkIcon;\n      },\n      get PhotoIcon() {\n        return PhotoIcon;\n      },\n      get InformationCircleIcon() {\n        return InformationCircleIcon;\n      },\n      get ArrowPathIcon() {\n        return ArrowPathIcon;\n      },\n      get showToast() {\n        return showToast;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","VueCropper","Dialog","DialogPanel","DialogTitle","TransitionChild","TransitionRoot","XMarkIcon","PhotoIcon","InformationCircleIcon","ArrowPathIcon","showToast","props","__props","emit","__emit","imageUrl","cropper","handleClose","value","handleFileChange","e","file","target","files","type","startsWith","maxSize","size","reader","FileReader","onload","result","readAsDataURL","rotateLeft","rotateRight","handleUpload","getCropData","data","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","File","components"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/dialogs/AvatarUploadDialog.vue"],"sourcesContent":["<template>\n  <TransitionRoot appear :show=\"modelValue\" as=\"template\">\n    <Dialog as=\"div\" class=\"relative z-50\" @close=\"handleClose\">\n      <TransitionChild\n        as=\"template\"\n        enter=\"duration-300 ease-out\"\n        enter-from=\"opacity-0\"\n        enter-to=\"opacity-100\"\n        leave=\"duration-200 ease-in\"\n        leave-from=\"opacity-100\"\n        leave-to=\"opacity-0\"\n      >\n        <div class=\"fixed inset-0 bg-black/25\" />\n      </TransitionChild>\n\n      <div class=\"fixed inset-0 overflow-y-auto\">\n        <div class=\"flex min-h-full items-center justify-center p-4 text-center\">\n          <TransitionChild\n            as=\"template\"\n            enter=\"duration-300 ease-out\"\n            enter-from=\"opacity-0 scale-95\"\n            enter-to=\"opacity-100 scale-100\"\n            leave=\"duration-200 ease-in\"\n            leave-from=\"opacity-100 scale-100\"\n            leave-to=\"opacity-0 scale-95\"\n          >\n            <DialogPanel class=\"w-full max-w-md transform overflow-hidden rounded-xl bg-white text-left align-middle shadow-xl transition-all\">\n              <!-- 头部 -->\n              <DialogTitle as=\"div\" class=\"flex items-center justify-between px-6 py-4 border-b border-gray-200\">\n                <h3 class=\"text-lg font-medium text-gray-900\">更换头像</h3>\n                <button\n                  @click=\"handleClose\"\n                  class=\"rounded-full p-1 hover:bg-gray-100 transition-colors\"\n                >\n                  <XMarkIcon class=\"w-5 h-5 text-gray-400\" />\n                </button>\n              </DialogTitle>\n\n              <!-- 提示信息 -->\n              <div class=\"px-6 pt-4\">\n                <div class=\"bg-blue-50 rounded-lg p-4 mb-4\">\n                  <div class=\"flex\">\n                    <div class=\"flex-shrink-0\">\n                      <InformationCircleIcon class=\"h-5 w-5 text-blue-400\" />\n                    </div>\n                    <div class=\"ml-3\">\n                      <h3 class=\"text-sm font-medium text-blue-800\">上传提示</h3>\n                      <div class=\"mt-2 text-sm text-blue-700\">\n                        <ul class=\"list-disc pl-5 space-y-1\">\n                          <li>请上传真实头像照片</li>\n                          <li>图片将被裁剪为正方形</li>\n                          <li>支持 JPG、PNG 格式</li>\n                          <li>文件大小不超过 2MB</li>\n                        </ul>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <!-- 裁切区域 -->\n              <div class=\"px-6 py-4\">\n                <div v-if=\"!imageUrl\" class=\"border-2 border-dashed border-gray-300 rounded-lg p-8\">\n                  <div class=\"text-center\">\n                    <PhotoIcon class=\"mx-auto h-12 w-12 text-gray-400\" />\n                    <div class=\"mt-4 flex text-sm leading-6 text-gray-600\">\n                      <label\n                        class=\"relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none hover:text-indigo-500\"\n                      >\n                        <span>选择图片</span>\n                        <input \n                          type=\"file\" \n                          class=\"sr-only\" \n                          accept=\"image/*\"\n                          @change=\"handleFileChange\"\n                        >\n                      </label>\n                    </div>\n                  </div>\n                </div>\n                <div v-else class=\"aspect-square overflow-hidden rounded-lg\">\n                  <vue-cropper\n                    ref=\"cropper\"\n                    :img=\"imageUrl\"\n                    :auto-crop=\"true\"\n                    :fixed-box=\"true\"\n                    :center-box=\"true\"\n                    :fixed=\"true\"\n                    :fixed-number=\"[1, 1]\"\n                    :info=\"true\"\n                    :full=\"true\"\n                    :auto-crop-width=\"300\"\n                    :auto-crop-height=\"300\"\n                    :output-type=\"'png'\"\n                    :output-size=\"1\"\n                  />\n                </div>\n              </div>\n\n              <!-- 底部按钮 -->\n              <div class=\"px-6 py-4 bg-gray-50 border-t border-gray-200\">\n                <div class=\"flex justify-end space-x-3\">\n                  <button\n                    type=\"button\"\n                    @click=\"handleClose\"\n                    class=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50\"\n                  >\n                    取消\n                  </button>\n                  <button\n                    type=\"button\"\n                    @click=\"handleUpload\"\n                    :disabled=\"!imageUrl || loading\"\n                    class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    {{ loading ? '上传中...' : '确认' }}\n                  </button>\n                </div>\n              </div>\n            </DialogPanel>\n          </TransitionChild>\n        </div>\n      </div>\n    </Dialog>\n  </TransitionRoot>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport 'vue-cropper/dist/index.css'\nimport { VueCropper } from 'vue-cropper'\nimport {\n  Dialog,\n  DialogPanel,\n  DialogTitle,\n  TransitionChild,\n  TransitionRoot\n} from '@headlessui/vue'\nimport {\n  XMarkIcon,\n  PhotoIcon,\n  InformationCircleIcon,\n  ArrowPathIcon\n} from '@heroicons/vue/24/outline'\nimport { showToast } from '@/components/ToastMessage'\n\nconst props = defineProps({\n  modelValue: Boolean,\n  loading: Boolean\n})\n\nconst emit = defineEmits(['update:modelValue', 'upload'])\n\nconst imageUrl = ref('')\nconst cropper = ref(null)\n\nconst handleClose = () => {\n  imageUrl.value = ''\n  emit('update:modelValue', false)\n}\n\nconst handleFileChange = (e) => {\n  const file = e.target.files[0]\n  if (!file) return\n\n  // 验证文件类型和大小\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return\n  }\n\n  const maxSize = 2 * 1024 * 1024 // 2MB\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过 2MB', 'error')\n    return\n  }\n\n  // 读取文件\n  const reader = new FileReader()\n  reader.onload = (e) => {\n    imageUrl.value = e.target.result\n  }\n  reader.readAsDataURL(file)\n}\n\nconst rotateLeft = () => {\n  cropper.value.rotateLeft()\n}\n\nconst rotateRight = () => {\n  cropper.value.rotateRight()\n}\n\nconst handleUpload = async () => {\n  if (!cropper.value) return\n  \n  // 获取裁切后的图片 base64 数据\n  cropper.value.getCropData((data) => {\n    // 将 base64 转换为文件对象\n    const arr = data.split(',')\n    const mime = arr[0].match(/:(.*?);/)[1]\n    const bstr = atob(arr[1])\n    let n = bstr.length\n    const u8arr = new Uint8Array(n)\n    while (n--) {\n      u8arr[n] = bstr.charCodeAt(n)\n    }\n    const file = new File([u8arr], 'avatar.png', { type: mime })\n    \n    // 触发上传事件\n    emit('upload', file)\n  })\n}\n\n// 组件定义\nconst components = {\n  VueCropper\n}\n</script>\n\n<style>\n.vue-cropper {\n  height: 400px !important;\n  background-size: contain !important;\n}\n\n.cropper-view-box,\n.cropper-face {\n  border-radius: 0;\n}\n\n.cropper-crop-box {\n  border: 1px solid rgba(255, 255, 255, 0.8);\n}\n\n.cropper-point {\n  background-color: #fff;\n  width: 8px !important;\n  height: 8px !important;\n}\n</style> "],"mappings":";AAgIA,SAASA,GAAG,QAAQ,KAAI;AACxB,OAAO,4BAA2B;AAClC,SAASC,UAAU,QAAQ,aAAY;AACvC,SACEC,MAAM,EACNC,WAAW,EACXC,WAAW,EACXC,eAAe,EACfC,cAAa,QACR,iBAAgB;AACvB,SACEC,SAAS,EACTC,SAAS,EACTC,qBAAqB,EACrBC,aAAY,QACP,2BAA0B;AACjC,SAASC,SAAS,QAAQ,2BAA0B;;;;;;;;;;;;;IAEpD,MAAMC,KAAK,GAAGC,OAAA;IAKd,MAAMC,IAAI,GAAGC,MAAA;IAEb,MAAMC,QAAQ,GAAGhB,GAAG,CAAC,EAAE;IACvB,MAAMiB,OAAO,GAAGjB,GAAG,CAAC,IAAI;IAExB,MAAMkB,WAAW,GAAGA,CAAA,KAAM;MACxBF,QAAQ,CAACG,KAAK,GAAG,EAAC;MAClBL,IAAI,CAAC,mBAAmB,EAAE,KAAK;IACjC;IAEA,MAAMM,gBAAgB,GAAIC,CAAC,IAAK;MAC9B,MAAMC,IAAI,GAAGD,CAAC,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC;MAC7B,IAAI,CAACF,IAAI,EAAE;;MAEX;MACA,IAAI,CAACA,IAAI,CAACG,IAAI,CAACC,UAAU,CAAC,QAAQ,CAAC,EAAE;QACnCf,SAAS,CAAC,SAAS,EAAE,OAAO;QAC5B;MACF;MAEA,MAAMgB,OAAO,GAAG,CAAC,GAAG,IAAI,GAAG,IAAI,EAAC;MAChC,IAAIL,IAAI,CAACM,IAAI,GAAGD,OAAO,EAAE;QACvBhB,SAAS,CAAC,cAAc,EAAE,OAAO;QACjC;MACF;;MAEA;MACA,MAAMkB,MAAM,GAAG,IAAIC,UAAU,CAAC;MAC9BD,MAAM,CAACE,MAAM,GAAIV,CAAC,IAAK;QACrBL,QAAQ,CAACG,KAAK,GAAGE,CAAC,CAACE,MAAM,CAACS,MAAK;MACjC;MACAH,MAAM,CAACI,aAAa,CAACX,IAAI;IAC3B;IAEA,MAAMY,UAAU,GAAGA,CAAA,KAAM;MACvBjB,OAAO,CAACE,KAAK,CAACe,UAAU,CAAC;IAC3B;IAEA,MAAMC,WAAW,GAAGA,CAAA,KAAM;MACxBlB,OAAO,CAACE,KAAK,CAACgB,WAAW,CAAC;IAC5B;IAEA,MAAMC,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI,CAACnB,OAAO,CAACE,KAAK,EAAE;;MAEpB;MACAF,OAAO,CAACE,KAAK,CAACkB,WAAW,CAAEC,IAAI,IAAK;QAClC;QACA,MAAMC,GAAG,GAAGD,IAAI,CAACE,KAAK,CAAC,GAAG;QAC1B,MAAMC,IAAI,GAAGF,GAAG,CAAC,CAAC,CAAC,CAACG,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;QACtC,MAAMC,IAAI,GAAGC,IAAI,CAACL,GAAG,CAAC,CAAC,CAAC;QACxB,IAAIM,CAAC,GAAGF,IAAI,CAACG,MAAK;QAClB,MAAMC,KAAK,GAAG,IAAIC,UAAU,CAACH,CAAC;QAC9B,OAAOA,CAAC,EAAE,EAAE;UACVE,KAAK,CAACF,CAAC,CAAC,GAAGF,IAAI,CAACM,UAAU,CAACJ,CAAC;QAC9B;QACA,MAAMvB,IAAI,GAAG,IAAI4B,IAAI,CAAC,CAACH,KAAK,CAAC,EAAE,YAAY,EAAE;UAAEtB,IAAI,EAAEgB;QAAK,CAAC;;QAE3D;QACA3B,IAAI,CAAC,QAAQ,EAAEQ,IAAI;MACrB,CAAC;IACH;;IAEA;IACA,MAAM6B,UAAU,GAAG;MACjBlD;IACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}