{"ast":null,"code":"import { computed, defineAsyncComponent } from 'vue';\nimport { useComponentStore } from '../../store/component';\nexport default {\n  __name: 'ComponentRenderer',\n  props: {\n    component: {\n      type: Object,\n      required: true\n    },\n    data: {\n      type: Object,\n      default: () => ({})\n    },\n    styles: {\n      type: Object,\n      default: () => ({})\n    },\n    isPreview: {\n      type: Boolean,\n      default: false\n    }\n  },\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const props = __props;\n    const componentStore = useComponentStore();\n\n    // 获取组件模板\n    const template = computed(() => {\n      return componentStore.getComponentTemplate(props.component.type);\n    });\n\n    // 编译模板\n    const compileTemplate = (template, data) => {\n      try {\n        // 简单的模板变量替换\n        return template.replace(/\\{\\{\\s*([^}]+)\\s*\\}\\}/g, (_, key) => {\n          return data[key.trim()] || '';\n        });\n      } catch (error) {\n        console.error('Template compilation error:', error);\n        return '';\n      }\n    };\n\n    // 渲染的组件\n    const renderedComponent = computed(() => {\n      if (!template.value) return null;\n\n      // 创建组件定义\n      const componentDef = {\n        template: compileTemplate(template.value, props.data),\n        props: ['data', 'styles'],\n        setup() {\n          return {\n            componentData: props.data,\n            componentStyles: props.styles\n          };\n        }\n      };\n\n      // 返回异步组件\n      return defineAsyncComponent({\n        loader: () => Promise.resolve(componentDef),\n        // 加载失败时显示错误组件\n        error: () => ({\n          template: '<div class=\"error\">组件加载失败</div>'\n        }),\n        // 加载中显示加载组件\n        loading: () => ({\n          template: '<div class=\"loading\">加载中...</div>'\n        }),\n        delay: 200,\n        timeout: 3000\n      });\n    });\n\n    // 组件属性\n    const componentProps = computed(() => ({\n      data: props.data,\n      styles: props.styles\n    }));\n    const __returned__ = {\n      props,\n      componentStore,\n      template,\n      compileTemplate,\n      renderedComponent,\n      componentProps,\n      computed,\n      defineAsyncComponent,\n      get useComponentStore() {\n        return useComponentStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["computed","defineAsyncComponent","useComponentStore","props","__props","componentStore","template","getComponentTemplate","component","type","compileTemplate","data","replace","_","key","trim","error","console","renderedComponent","value","componentDef","setup","componentData","componentStyles","styles","loader","Promise","resolve","loading","delay","timeout","componentProps"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/template-editor/components/widgets/ComponentRenderer.vue"],"sourcesContent":["<template>\n  <div \n    class=\"component-renderer\"\n    :class=\"{ preview: isPreview }\"\n  >\n    <component\n      :is=\"renderedComponent\"\n      v-if=\"renderedComponent\"\n      v-bind=\"componentProps\"\n    />\n    <div v-else class=\"component-error\">\n      组件加载失败\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { computed, defineAsyncComponent } from 'vue'\nimport { useComponentStore } from '../../store/component'\n\nconst props = defineProps({\n  component: {\n    type: Object,\n    required: true\n  },\n  data: {\n    type: Object,\n    default: () => ({})\n  },\n  styles: {\n    type: Object,\n    default: () => ({})\n  },\n  isPreview: {\n    type: Boolean,\n    default: false\n  }\n})\n\nconst componentStore = useComponentStore()\n\n// 获取组件模板\nconst template = computed(() => {\n  return componentStore.getComponentTemplate(props.component.type)\n})\n\n// 编译模板\nconst compileTemplate = (template, data) => {\n  try {\n    // 简单的模板变量替换\n    return template.replace(/\\{\\{\\s*([^}]+)\\s*\\}\\}/g, (_, key) => {\n      return data[key.trim()] || ''\n    })\n  } catch (error) {\n    console.error('Template compilation error:', error)\n    return ''\n  }\n}\n\n// 渲染的组件\nconst renderedComponent = computed(() => {\n  if (!template.value) return null\n  \n  // 创建组件定义\n  const componentDef = {\n    template: compileTemplate(template.value, props.data),\n    props: ['data', 'styles'],\n    setup() {\n      return {\n        componentData: props.data,\n        componentStyles: props.styles\n      }\n    }\n  }\n  \n  // 返回异步组件\n  return defineAsyncComponent({\n    loader: () => Promise.resolve(componentDef),\n    // 加载失败时显示错误组件\n    error: () => ({\n      template: '<div class=\"error\">组件加载失败</div>'\n    }),\n    // 加载中显示加载组件\n    loading: () => ({\n      template: '<div class=\"loading\">加载中...</div>'\n    }),\n    delay: 200,\n    timeout: 3000\n  })\n})\n\n// 组件属性\nconst componentProps = computed(() => ({\n  data: props.data,\n  styles: props.styles\n}))\n</script>\n\n<style lang=\"scss\" scoped>\n.component-renderer {\n  @apply w-full h-full relative;\n  \n  &.preview {\n    @apply pointer-events-none;\n  }\n  \n  .component-error {\n    @apply w-full h-full flex items-center justify-center text-red-500;\n  }\n  \n  .loading {\n    @apply w-full h-full flex items-center justify-center text-gray-500;\n  }\n}\n</style> "],"mappings":"AAiBA,SAASA,QAAQ,EAAEC,oBAAoB,QAAQ,KAAI;AACnD,SAASC,iBAAiB,QAAQ,uBAAsB;;;;;;;;;;;;;;;;;;;;;;;;;IAExD,MAAMC,KAAK,GAAGC,OAAA;IAmBd,MAAMC,cAAc,GAAGH,iBAAiB,CAAC;;IAEzC;IACA,MAAMI,QAAQ,GAAGN,QAAQ,CAAC,MAAM;MAC9B,OAAOK,cAAc,CAACE,oBAAoB,CAACJ,KAAK,CAACK,SAAS,CAACC,IAAI;IACjE,CAAC;;IAED;IACA,MAAMC,eAAe,GAAGA,CAACJ,QAAQ,EAAEK,IAAI,KAAK;MAC1C,IAAI;QACF;QACA,OAAOL,QAAQ,CAACM,OAAO,CAAC,wBAAwB,EAAE,CAACC,CAAC,EAAEC,GAAG,KAAK;UAC5D,OAAOH,IAAI,CAACG,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAC;QAC9B,CAAC;MACH,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,6BAA6B,EAAEA,KAAK;QAClD,OAAO,EAAC;MACV;IACF;;IAEA;IACA,MAAME,iBAAiB,GAAGlB,QAAQ,CAAC,MAAM;MACvC,IAAI,CAACM,QAAQ,CAACa,KAAK,EAAE,OAAO,IAAG;;MAE/B;MACA,MAAMC,YAAY,GAAG;QACnBd,QAAQ,EAAEI,eAAe,CAACJ,QAAQ,CAACa,KAAK,EAAEhB,KAAK,CAACQ,IAAI,CAAC;QACrDR,KAAK,EAAE,CAAC,MAAM,EAAE,QAAQ,CAAC;QACzBkB,KAAKA,CAAA,EAAG;UACN,OAAO;YACLC,aAAa,EAAEnB,KAAK,CAACQ,IAAI;YACzBY,eAAe,EAAEpB,KAAK,CAACqB;UACzB;QACF;MACF;;MAEA;MACA,OAAOvB,oBAAoB,CAAC;QAC1BwB,MAAM,EAAEA,CAAA,KAAMC,OAAO,CAACC,OAAO,CAACP,YAAY,CAAC;QAC3C;QACAJ,KAAK,EAAEA,CAAA,MAAO;UACZV,QAAQ,EAAE;QACZ,CAAC,CAAC;QACF;QACAsB,OAAO,EAAEA,CAAA,MAAO;UACdtB,QAAQ,EAAE;QACZ,CAAC,CAAC;QACFuB,KAAK,EAAE,GAAG;QACVC,OAAO,EAAE;MACX,CAAC;IACH,CAAC;;IAED;IACA,MAAMC,cAAc,GAAG/B,QAAQ,CAAC,OAAO;MACrCW,IAAI,EAAER,KAAK,CAACQ,IAAI;MAChBa,MAAM,EAAErB,KAAK,CAACqB;IAChB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}