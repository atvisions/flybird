{"ast":null,"code":"import { createVNode as _createVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass, createBlock as _createBlock, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"drop-indicator\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"component-actions\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_button_group = _resolveComponent(\"el-button-group\");\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: _normalizeClass([\"editor-canvas\", {\n      'drag-over': $setup.isDragOver\n    }]),\n    onDragover: $setup.handleDragOver,\n    onDragleave: $setup.handleDragLeave,\n    onDrop: $setup.handleDrop\n  }, [_createElementVNode(\"div\", {\n    class: \"canvas-container\",\n    style: _normalizeStyle($setup.containerStyle)\n  }, [$setup.isDragOver ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_icon, {\n    class: \"text-3xl\"\n  }, {\n    default: _withCtx(() => [_createVNode($setup[\"Plus\"])]),\n    _: 1 /* STABLE */\n  }), _cache[1] || (_cache[1] = _createElementVNode(\"span\", null, \"释放鼠标添加组件\", -1 /* HOISTED */))])) : _createCommentVNode(\"v-if\", true), _createVNode($setup[\"GridLayout\"], {\n    layout: $setup.layoutModel,\n    \"onUpdate:layout\": _cache[0] || (_cache[0] = $event => $setup.layoutModel = $event),\n    \"col-num\": 12,\n    \"row-height\": 30,\n    \"is-draggable\": true,\n    \"is-resizable\": true,\n    \"vertical-compact\": true,\n    \"use-css-transforms\": true,\n    margin: [10, 10],\n    onLayoutUpdated: $setup.handleLayoutUpdate\n  }, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.layoutModel, item => {\n      return _openBlock(), _createBlock($setup[\"GridItem\"], {\n        key: item.id,\n        x: item.x,\n        y: item.y,\n        w: item.w,\n        h: item.h,\n        i: item.id,\n        \"min-w\": 3,\n        \"min-h\": 3,\n        \"is-draggable\": true,\n        \"is-resizable\": true,\n        class: _normalizeClass({\n          active: $setup.selectedId === item.id\n        }),\n        onClick: $event => $setup.handleSelect(item.id),\n        onResize: $setup.handleResize,\n        onMoved: $setup.handleMoved\n      }, {\n        default: _withCtx(() => [_createVNode($setup[\"ComponentRenderer\"], {\n          type: $props.components[item.id].type,\n          data: $props.components[item.id].data,\n          styles: $props.components[item.id].styles\n        }, null, 8 /* PROPS */, [\"type\", \"data\", \"styles\"]), $setup.selectedId === item.id ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createVNode(_component_el_button_group, null, {\n          default: _withCtx(() => [_createVNode(_component_el_button, {\n            size: \"small\",\n            onClick: $event => $setup.handleMoveUp(item.id)\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n              default: _withCtx(() => [_createVNode($setup[\"ArrowUp\"])]),\n              _: 1 /* STABLE */\n            })]),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]), _createVNode(_component_el_button, {\n            size: \"small\",\n            onClick: $event => $setup.handleMoveDown(item.id)\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n              default: _withCtx(() => [_createVNode($setup[\"ArrowDown\"])]),\n              _: 1 /* STABLE */\n            })]),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]), _createVNode(_component_el_button, {\n            size: \"small\",\n            onClick: $event => $setup.handleDelete(item.id)\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n              default: _withCtx(() => [_createVNode($setup[\"Delete\"])]),\n              _: 1 /* STABLE */\n            })]),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])]),\n          _: 2 /* DYNAMIC */\n        }, 1024 /* DYNAMIC_SLOTS */)])) : _createCommentVNode(\"v-if\", true)]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"x\", \"y\", \"w\", \"h\", \"i\", \"class\", \"onClick\"]);\n    }), 128 /* KEYED_FRAGMENT */))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"layout\"])], 4 /* STYLE */)], 34 /* CLASS, NEED_HYDRATION */);\n}","map":{"version":3,"names":["key","class","_createElementBlock","_normalizeClass","$setup","isDragOver","onDragover","handleDragOver","onDragleave","handleDragLeave","onDrop","handleDrop","_createElementVNode","style","_normalizeStyle","containerStyle","_hoisted_1","_createVNode","_component_el_icon","default","_withCtx","_","_createCommentVNode","layout","layoutModel","_cache","$event","margin","onLayoutUpdated","handleLayoutUpdate","_Fragment","_renderList","item","_createBlock","id","x","y","w","h","i","active","selectedId","onClick","handleSelect","onResize","handleResize","onMoved","handleMoved","type","$props","components","data","styles","_hoisted_2","_component_el_button_group","_component_el_button","size","handleMoveUp","handleMoveDown","handleDelete"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/template-editor/components/canvas/EditorCanvas.vue"],"sourcesContent":["<template>\n  <div \n    class=\"editor-canvas\"\n    @dragover=\"handleDragOver\"\n    @dragleave=\"handleDragLeave\"\n    @drop=\"handleDrop\"\n    :class=\"{ 'drag-over': isDragOver }\"\n  >\n    <div \n      class=\"canvas-container\"\n      :style=\"containerStyle\"\n    >\n      <div v-if=\"isDragOver\" class=\"drop-indicator\">\n        <el-icon class=\"text-3xl\"><Plus /></el-icon>\n        <span>释放鼠标添加组件</span>\n      </div>\n      \n      <GridLayout\n        v-model:layout=\"layoutModel\"\n        :col-num=\"12\"\n        :row-height=\"30\"\n        :is-draggable=\"true\"\n        :is-resizable=\"true\"\n        :vertical-compact=\"true\"\n        :use-css-transforms=\"true\"\n        :margin=\"[10, 10]\"\n        @layout-updated=\"handleLayoutUpdate\"\n      >\n        <GridItem\n          v-for=\"item in layoutModel\"\n          :key=\"item.id\"\n          :x=\"item.x\"\n          :y=\"item.y\"\n          :w=\"item.w\"\n          :h=\"item.h\"\n          :i=\"item.id\"\n          :min-w=\"3\"\n          :min-h=\"3\"\n          :is-draggable=\"true\"\n          :is-resizable=\"true\"\n          :class=\"{ active: selectedId === item.id }\"\n          @click=\"handleSelect(item.id)\"\n          @resize=\"handleResize\"\n          @moved=\"handleMoved\"\n        >\n          <ComponentRenderer\n            :type=\"components[item.id].type\"\n            :data=\"components[item.id].data\"\n            :styles=\"components[item.id].styles\"\n          />\n          <div class=\"component-actions\" v-if=\"selectedId === item.id\">\n            <el-button-group>\n              <el-button size=\"small\" @click=\"handleMoveUp(item.id)\">\n                <el-icon><ArrowUp /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleMoveDown(item.id)\">\n                <el-icon><ArrowDown /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleDelete(item.id)\">\n                <el-icon><Delete /></el-icon>\n              </el-button>\n            </el-button-group>\n          </div>\n        </GridItem>\n      </GridLayout>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport { GridLayout, GridItem } from 'vue-grid-layout'\nimport { ArrowUp, ArrowDown, Delete, Plus } from '@element-plus/icons-vue'\nimport ComponentRenderer from '../widgets/ComponentRenderer.vue'\n\n// 选中的组件ID\nconst selectedId = ref(null)\n\nconst props = defineProps({\n  modelValue: {\n    type: Array,\n    required: true\n  },\n  components: {\n    type: Object,\n    required: true\n  },\n  styles: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'select', 'add-component'])\n\n// 布局数据\nconst layoutModel = computed({\n  get: () => props.modelValue,\n  set: (value) => emit('update:modelValue', value)\n})\n\n// 容器样式\nconst containerStyle = computed(() => ({\n  width: '210mm', // A4 宽度\n  height: '297mm', // A4 高度\n  margin: '0 auto',\n  background: '#fff',\n  boxShadow: '0 0 10px rgba(0, 0, 0, 0.1)',\n  ...props.styles\n}))\n\n// 拖放状态\nconst isDragOver = ref(false)\n\n// 处理拖动经过\nconst handleDragOver = (event) => {\n  event.preventDefault()\n  isDragOver.value = true\n}\n\n// 处理拖动离开\nconst handleDragLeave = (event) => {\n  event.preventDefault()\n  isDragOver.value = false\n}\n\n// 处理组件拖放\nconst handleDrop = (event) => {\n  event.preventDefault()\n  isDragOver.value = false\n  \n  try {\n    const componentData = JSON.parse(event.dataTransfer.getData('text/plain'))\n    const rect = event.currentTarget.getBoundingClientRect()\n    const x = Math.floor((event.clientX - rect.left) / (rect.width / 12))\n    const y = Math.floor((event.clientY - rect.top) / 30)\n    \n    console.log('Dropping component:', componentData, 'at position:', { x, y })\n    \n    emit('add-component', {\n      ...componentData,\n      position: { x, y }\n    })\n  } catch (error) {\n    console.error('Drop error:', error)\n  }\n}\n\n// 处理组件选中\nconst handleSelect = (id) => {\n  selectedId.value = id\n  emit('select', id)\n}\n\n// 处理布局更新\nconst handleLayoutUpdate = (layout) => {\n  emit('update:modelValue', layout)\n}\n\n// 处理组件调整大小\nconst handleResize = (i, newH, newW) => {\n  const index = layoutModel.value.findIndex(item => item.id === i)\n  if (index > -1) {\n    layoutModel.value[index].h = newH\n    layoutModel.value[index].w = newW\n  }\n}\n\n// 处理组件移动\nconst handleMoved = (i, newX, newY) => {\n  const index = layoutModel.value.findIndex(item => item.id === i)\n  if (index > -1) {\n    layoutModel.value[index].x = newX\n    layoutModel.value[index].y = newY\n  }\n}\n\n// 处理组件上移\nconst handleMoveUp = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  if (index > 0) {\n    const temp = { ...layoutModel.value[index - 1] }\n    layoutModel.value[index - 1] = { ...layoutModel.value[index] }\n    layoutModel.value[index] = temp\n  }\n}\n\n// 处理组件下移\nconst handleMoveDown = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  if (index < layoutModel.value.length - 1) {\n    const temp = { ...layoutModel.value[index + 1] }\n    layoutModel.value[index + 1] = { ...layoutModel.value[index] }\n    layoutModel.value[index] = temp\n  }\n}\n\n// 处理组件删除\nconst handleDelete = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  layoutModel.value.splice(index, 1)\n  selectedId.value = null\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.editor-canvas {\n  @apply flex-1 overflow-y-auto bg-gray-100 p-8;\n  \n  &.drag-over .canvas-container {\n    @apply ring-2 ring-blue-500 ring-opacity-50;\n  }\n  \n  .canvas-container {\n    @apply shadow-lg relative;\n    transform-origin: top center;\n    \n    // 拖放提示\n    .drop-indicator {\n      @apply absolute inset-0 flex flex-col items-center justify-center\n             bg-blue-50 bg-opacity-50 text-blue-500 pointer-events-none;\n      z-index: 100;\n    }\n    \n    // 添加页面参考线\n    &::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      border: 1px solid #e0e0e0;\n      pointer-events: none;\n    }\n  }\n  \n  .grid-item {\n    @apply relative border border-transparent;\n    \n    &.active {\n      @apply border-blue-500;\n    }\n    \n    .component-actions {\n      @apply absolute top-2 right-2 z-10;\n    }\n  }\n}\n\n// 网格布局样式\n.vue-grid-layout {\n  @apply bg-white;\n  min-height: 297mm !important;\n}\n\n.vue-grid-item {\n  @apply touch-none;\n  \n  &.vue-grid-placeholder {\n    @apply bg-blue-100 border-2 border-blue-300 border-dashed;\n  }\n  \n  &.vue-draggable-dragging {\n    @apply z-50;\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}