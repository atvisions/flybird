{"ast":null,"code":"import { createCommentVNode as _createCommentVNode } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _createCommentVNode(\" No changes to template section \");\n}","map":{"version":3,"names":["_createCommentVNode"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/components/UserHome.vue"],"sourcesContent":["<template>\n  <!-- No changes to template section -->\n</template>\n\n<script setup>\nimport { ref, onMounted, computed } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport { useStore } from 'vuex'\nimport { useNickname } from '@/composables/useNickname'\nimport { MEDIA_URL } from '@/config'\nimport defaultAvatarImage from '@/assets/images/default-avatar.png'\nimport defaultBackground from '@/assets/images/default-background.jpg'\nimport { showToast } from '@/components/ToastMessage'\nimport {\n  UserIcon,\n  UserCircleIcon,\n  DocumentTextIcon,\n  BriefcaseIcon,\n  StarIcon,\n  CameraIcon,\n  PhotoIcon,\n  FolderIcon,\n  Cog6ToothIcon,\n  IdentificationIcon,\n  HomeIcon,\n  MapPinIcon,\n  QuoteIcon,\n  PencilSquareIcon,\n  CrownIcon,\n  PhoneIcon,\n  EnvelopeIcon,\n  SparklesIcon,\n  PencilIcon,\n  DocumentIcon,\n  ChevronRightIcon,\n  PlusIcon,\n  TrashIcon,\n  ChatBubbleLeftRightIcon,\n  QuestionMarkCircleIcon,\n  InboxArrowDownIcon,\n  EyeIcon,\n  BookmarkIcon,\n  ArrowTopRightOnSquareIcon,\n  GlobeAltIcon\n} from '@heroicons/vue/24/outline'\nimport profile from '@/api/profile'\nimport { eventBus } from '@/utils/eventBus'\nimport EditBasicDialog from '../dialogs/EditBasicDialog.vue'\nimport AvatarUploadDialog from '../dialogs/AvatarUploadDialog.vue'\n\nconst router = useRouter()\nconst store = useStore()\nconst nickname = useNickname()\n\n// 用户信息的计算属性\nconst userInfo = computed(() => {\n  return {\n    uid: store.state.userInfo?.data?.user?.uid,\n    nickname: store.state.userInfo?.data?.user?.username,\n    avatar: store.state.userInfo?.data?.user?.avatar,\n    isVip: store.state.userInfo?.data?.user?.is_vip,\n    coverImage: store.state.userInfo?.data?.user?.cover_image,\n    // ... 其他需要的用户信息\n  }\n})\n\n// 格式化头像 URL\nconst formatImageUrl = (url) => {\n  if (!url) return defaultAvatarImage\n  return url.startsWith('http') ? url : `${MEDIA_URL}${url}`\n}\n\n// 计算头像 URL\nconst userAvatar = computed(() => {\n  return formatImageUrl(userInfo.value?.avatar)\n})\n\n// 获取用户信息\nconst fetchUserInfo = async () => {\n  try {\n    const response = await profile.getUserInfo()\n    if (response.data?.code === 200) {\n      store.commit('SET_USER_INFO', response.data)\n    }\n  } catch (error) {\n    console.error('获取用户信息失败:', error)\n  }\n}\n\n// 组件挂载时获取数据\nonMounted(async () => {\n  await fetchUserInfo()\n})\n\n// 头像上传相关\nconst showAvatarUpload = ref(false)\nconst loading = ref(false)\n\n// 处理头像错误\nconst handleImageError = (e) => {\n  e.target.src = defaultAvatarImage\n}\n\n// 处理背景图错误\nconst handleBackgroundError = (e) => {\n  e.target.src = defaultBackground\n}\n\nconst handleNicknameUpdate = async () => {\n  const success = await nickname.handleUpdate()\n  if (success) {\n    closeNicknameModal()\n    // 重新获取用户信息\n    const response = await profile.getUserInfo()\n    if (response.data?.code === 200) {\n      store.commit('SET_USER_INFO', response.data)\n    }\n    // 触发全局事件，通知其他组件更新\n    eventBus.emit('user-info-updated')\n  }\n}\n\n// 实时验证昵称\nconst validateNickname = () => {\n  nickname.state.error = nickname.validateNickname(nickname.state.value)\n}\n\nconst openNicknameModal = () => {\n  nickname.state.value = store.state.userInfo?.data?.user?.username || ''\n  showNicknameModal.value = true\n}\n\nconst handleAvatarUpload = async (file) => {\n  try {\n    loading.value = true\n    const formData = new FormData()\n    formData.append('avatar', file)\n    \n    const response = await profile.uploadAvatar(formData)\n    if (response.data?.code === 200) {\n      showToast('头像上传成功', 'success')\n      // 重新获取用户信息以更新头像\n      await fetchUserInfo()\n      showAvatarUpload.value = false\n    } else {\n      throw new Error(response.data?.message || '上传失败')\n    }\n  } catch (error) {\n    console.error('头像上传失败:', error)\n    showToast(error.message || '头像上传失败，请稍后重试', 'error')\n  } finally {\n    loading.value = false\n  }\n}\n\n// No changes to rest of the script section\n</script>\n\n<style scoped>\n/* No changes to style section */\n</style> "],"mappings":";;SACEA,mBAAA,oCAAuC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}