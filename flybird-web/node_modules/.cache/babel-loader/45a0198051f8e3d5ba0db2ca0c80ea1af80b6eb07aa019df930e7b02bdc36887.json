{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createVNode as _createVNode, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"avatar-upload-container\"\n};\nconst _hoisted_2 = {\n  class: \"dialog-footer\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n  return _openBlock(), _createBlock(_component_el_dialog, {\n    modelValue: $setup.visible,\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.visible = $event),\n    title: \"上传头像\",\n    width: \"500px\",\n    \"close-on-click-modal\": false,\n    \"close-on-press-escape\": false\n  }, {\n    footer: _withCtx(() => [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_el_button, {\n      onClick: $setup.handleCancel\n    }, {\n      default: _withCtx(() => _cache[1] || (_cache[1] = [_createTextVNode(\"取消\")])),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: $setup.handleConfirm,\n      loading: $setup.uploading\n    }, {\n      default: _withCtx(() => _cache[2] || (_cache[2] = [_createTextVNode(\" 确认上传 \")])),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"loading\"])])]),\n    default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_1, [_createCommentVNode(\" 图片裁剪组件 \"), _createVNode($setup[\"VueCropper\"], {\n      ref: \"cropperRef\",\n      img: $setup.cropImg,\n      info: true,\n      autoCrop: true,\n      fixedBox: true,\n      centerBox: true,\n      fixed: true,\n      fixedNumber: [1, 1],\n      canScale: false,\n      full: false,\n      outputType: 'png',\n      onRealTime: $setup.cropImage\n    }, null, 8 /* PROPS */, [\"img\"])])]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"]);\n}","map":{"version":3,"names":["class","_createBlock","_component_el_dialog","modelValue","$setup","visible","_cache","$event","title","width","footer","_withCtx","_createElementVNode","_hoisted_2","_createVNode","_component_el_button","onClick","handleCancel","default","_createTextVNode","_","type","handleConfirm","loading","uploading","_hoisted_1","_createCommentVNode","ref","img","cropImg","info","autoCrop","fixedBox","centerBox","fixed","fixedNumber","canScale","full","outputType","onRealTime","cropImage"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/dialogs/AvatarUploadDialog.vue"],"sourcesContent":["<template>\n  <el-dialog\n    v-model=\"visible\"\n    title=\"上传头像\"\n    width=\"500px\"\n    :close-on-click-modal=\"false\"\n    :close-on-press-escape=\"false\"\n  >\n    <div class=\"avatar-upload-container\">\n      <!-- 图片裁剪组件 -->\n      <vue-cropper\n        ref=\"cropperRef\"\n        :img=\"cropImg\"\n        :info=\"true\"\n        :autoCrop=\"true\"\n        :fixedBox=\"true\"\n        :centerBox=\"true\"\n        :fixed=\"true\"\n        :fixedNumber=\"[1, 1]\"\n        :canScale=\"false\"\n        :full=\"false\"\n        :outputType=\"'png'\"\n        @realTime=\"cropImage\"\n      />\n    </div>\n    <template #footer>\n      <div class=\"dialog-footer\">\n        <el-button @click=\"handleCancel\">取消</el-button>\n        <el-button type=\"primary\" @click=\"handleConfirm\" :loading=\"uploading\">\n          确认上传\n        </el-button>\n      </div>\n    </template>\n  </el-dialog>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { VueCropper } from 'vue-cropper'\nimport 'vue-cropper/dist/index.css'\nimport { useAccountStore } from '@/stores/account'\nimport { profile } from '@/api/profile'\nimport { showToast } from '@/components/ToastMessage'\n\nconst props = defineProps({\n  modelValue: Boolean\n})\n\nconst emit = defineEmits(['update:modelValue', 'success'])\n\nconst visible = computed({\n  get: () => props.modelValue,\n  set: (val) => emit('update:modelValue', val)\n})\n\nconst accountStore = useAccountStore()\nconst cropperRef = ref(null)\nconst cropImg = ref('')\nconst uploading = ref(false)\n\n// 选择图片\nconst handleSelectImage = (e) => {\n  const file = e.target.files[0]\n  if (!file) return\n  \n  if (!file.type.includes('image/')) {\n    showToast('请选择图片文件', 'warning')\n    return\n  }\n  \n  const reader = new FileReader()\n  reader.onload = (e) => {\n    cropImg.value = e.target.result\n  }\n  reader.readAsDataURL(file)\n}\n\n// 裁剪图片\nconst cropImage = () => {\n  // 实时预览\n}\n\n// 上传裁剪后的图片\nconst handleCropUpload = async () => {\n  try {\n    uploading.value = true\n    // 获取裁剪后的图片 blob 数据\n    const blob = await new Promise((resolve) => {\n      cropperRef.value.getCropBlob((data) => {\n        resolve(data)\n      })\n    })\n    \n    // 构建 FormData\n    const formData = new FormData()\n    formData.append('avatar', blob, 'avatar.png')\n    \n    const response = await profile.uploadAvatar(formData)\n    \n    if (response?.data?.code === 200) {\n      accountStore.userInfo = {\n        ...accountStore.userInfo,\n        avatar: response.data.data.avatar\n      }\n      localStorage.setItem('userInfo', JSON.stringify(accountStore.userInfo))\n      showToast('头像上传成功', 'success')\n      accountStore.avatarUpdateTime = Date.now()\n      emit('success')\n      visible.value = false\n    }\n  } catch (error) {\n    console.error('头像上传失败:', error)\n    showToast(error.response?.data?.message || '头像上传失败', 'error')\n  } finally {\n    uploading.value = false\n  }\n}\n\n// 取消\nconst handleCancel = () => {\n  visible.value = false\n}\n\n// 确认上传\nconst handleConfirm = () => {\n  if (!cropImg.value) {\n    showToast('请先选择图片', 'warning')\n    return\n  }\n  handleCropUpload()\n}\n</script>\n\n<style scoped>\n.avatar-upload-container {\n  width: 100%;\n  height: 400px;\n}\n</style> "],"mappings":";;EAQSA,KAAK,EAAC;AAAyB;;EAkB7BA,KAAK,EAAC;AAAe;;;;uBAzB9BC,YAAA,CAgCYC,oBAAA;IAjCdC,UAAA,EAEaC,MAAA,CAAAC,OAAO;IAFpB,uBAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAEaH,MAAA,CAAAC,OAAO,GAAAE,MAAA;IAChBC,KAAK,EAAC,MAAM;IACZC,KAAK,EAAC,OAAO;IACZ,sBAAoB,EAAE,KAAK;IAC3B,uBAAqB,EAAE;;IAmBbC,MAAM,EAAAC,QAAA,CACf,MAKM,CALNC,mBAAA,CAKM,OALNC,UAKM,GAJJC,YAAA,CAA+CC,oBAAA;MAAnCC,OAAK,EAAEZ,MAAA,CAAAa;IAAY;MA3BvCC,OAAA,EAAAP,QAAA,CA2ByC,MAAEL,MAAA,QAAAA,MAAA,OA3B3Ca,gBAAA,CA2ByC,IAAE,E;MA3B3CC,CAAA;QA4BQN,YAAA,CAEYC,oBAAA;MAFDM,IAAI,EAAC,SAAS;MAAEL,OAAK,EAAEZ,MAAA,CAAAkB,aAAa;MAAGC,OAAO,EAAEnB,MAAA,CAAAoB;;MA5BnEN,OAAA,EAAAP,QAAA,CA4B8E,MAEtEL,MAAA,QAAAA,MAAA,OA9BRa,gBAAA,CA4B8E,QAEtE,E;MA9BRC,CAAA;;IAAAF,OAAA,EAAAP,QAAA,CAQI,MAgBM,CAhBNC,mBAAA,CAgBM,OAhBNa,UAgBM,GAfJC,mBAAA,YAAe,EACfZ,YAAA,CAaEV,MAAA;MAZAuB,GAAG,EAAC,YAAY;MACfC,GAAG,EAAExB,MAAA,CAAAyB,OAAO;MACZC,IAAI,EAAE,IAAI;MACVC,QAAQ,EAAE,IAAI;MACdC,QAAQ,EAAE,IAAI;MACdC,SAAS,EAAE,IAAI;MACfC,KAAK,EAAE,IAAI;MACXC,WAAW,EAAE,MAAM;MACnBC,QAAQ,EAAE,KAAK;MACfC,IAAI,EAAE,KAAK;MACXC,UAAU,EAAE,KAAK;MACjBC,UAAQ,EAAEnC,MAAA,CAAAoC;;IAtBnBpB,CAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}