{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, resolveDynamicComponent as _resolveDynamicComponent, openBlock as _openBlock, createBlock as _createBlock, createTextVNode as _createTextVNode, withCtx as _withCtx, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = {\n  class: \"canvas-container\"\n};\nconst _hoisted_2 = {\n  class: \"canvas-wrapper\"\n};\nconst _hoisted_3 = {\n  class: \"layout-wrapper\"\n};\nconst _hoisted_4 = {\n  class: \"layout-actions\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"placeholder\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_v_btn = _resolveComponent(\"v-btn\");\n  const _component_v_icon = _resolveComponent(\"v-icon\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", {\n    class: \"canvas-content\",\n    style: _normalizeStyle({\n      transform: `scale(${$props.scale})`\n    })\n  }, [_createVNode($setup[\"draggable\"], {\n    modelValue: $setup.layouts,\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.layouts = $event),\n    group: {\n      name: 'layouts',\n      pull: false,\n      put: true\n    },\n    \"item-key\": \"id\",\n    class: _normalizeClass([\"canvas-drop-area\", {\n      'drag-over': $setup.isDragOver\n    }]),\n    animation: 200,\n    \"ghost-class\": \"ghost\",\n    onStart: $setup.handleDragStart,\n    onEnd: $setup.handleDragEnd,\n    onChange: $setup.handleChange,\n    onDragenter: $setup.handleDragEnter,\n    onDragleave: $setup.handleDragLeave,\n    onDragover: $setup.handleDragOver\n  }, {\n    item: _withCtx(({\n      element\n    }) => [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_v_btn, {\n      icon: \"mdi-delete\",\n      size: \"small\",\n      color: \"error\",\n      variant: \"text\",\n      onClick: $event => $setup.removeLayout(element)\n    }, null, 8 /* PROPS */, [\"onClick\"])]), (_openBlock(), _createBlock(_resolveDynamicComponent($setup.getLayoutComponent(element)), {\n      config: element.config\n    }, null, 8 /* PROPS */, [\"config\"]))])]),\n    header: _withCtx(() => [$setup.layouts.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createVNode(_component_v_icon, {\n      size: \"32\",\n      class: \"mb-2\"\n    }, {\n      default: _withCtx(() => _cache[1] || (_cache[1] = [_createTextVNode(\"mdi-plus\")])),\n      _: 1 /* STABLE */\n    }), _cache[2] || (_cache[2] = _createElementVNode(\"span\", null, \"拖拽布局到此处\", -1 /* HOISTED */))])) : _createCommentVNode(\"v-if\", true)]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\", \"class\"])], 4 /* STYLE */)])]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","style","_normalizeStyle","transform","$props","scale","_createVNode","$setup","modelValue","layouts","_cache","$event","group","name","pull","put","_normalizeClass","isDragOver","animation","onStart","handleDragStart","onEnd","handleDragEnd","onChange","handleChange","onDragenter","handleDragEnter","onDragleave","handleDragLeave","onDragover","handleDragOver","item","_withCtx","element","_hoisted_3","_hoisted_4","_component_v_btn","icon","size","color","variant","onClick","removeLayout","_createBlock","_resolveDynamicComponent","getLayoutComponent","config","header","length","_hoisted_5","_component_v_icon","default","_createTextVNode","_","_createCommentVNode"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/resume-editor/components/Canvas.vue"],"sourcesContent":["<template>\n  <div class=\"canvas-container\">\n    <div class=\"canvas-wrapper\">\n      <div class=\"canvas-content\" :style=\"{ transform: `scale(${scale})` }\">\n        <draggable\n          v-model=\"layouts\"\n          :group=\"{ name: 'layouts', pull: false, put: true }\"\n          item-key=\"id\"\n          class=\"canvas-drop-area\"\n          :class=\"{ 'drag-over': isDragOver }\"\n          :animation=\"200\"\n          ghost-class=\"ghost\"\n          @start=\"handleDragStart\"\n          @end=\"handleDragEnd\"\n          @change=\"handleChange\"\n          @dragenter=\"handleDragEnter\"\n          @dragleave=\"handleDragLeave\"\n          @dragover=\"handleDragOver\"\n        >\n          <template #item=\"{ element }\">\n            <div class=\"layout-wrapper\">\n              <div class=\"layout-actions\">\n                <v-btn\n                  icon=\"mdi-delete\"\n                  size=\"small\"\n                  color=\"error\"\n                  variant=\"text\"\n                  @click=\"removeLayout(element)\"\n                ></v-btn>\n              </div>\n              <component\n                :is=\"getLayoutComponent(element)\"\n                :config=\"element.config\"\n              ></component>\n            </div>\n          </template>\n\n          <template #header>\n            <div v-if=\"layouts.length === 0\" class=\"placeholder\">\n              <v-icon size=\"32\" class=\"mb-2\">mdi-plus</v-icon>\n              <span>拖拽布局到此处</span>\n            </div>\n          </template>\n        </draggable>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport draggable from 'vuedraggable'\nimport SingleLayout from '../layouts/SingleLayout.vue'\nimport DoubleLayout from '../layouts/DoubleLayout.vue'\nimport TripleLayout from '../layouts/TripleLayout.vue'\n\nconst props = defineProps({\n  scale: {\n    type: Number,\n    default: 1\n  }\n})\n\nconst layouts = ref([])\nconst isDragOver = ref(false)\nconst isDragging = ref(false)\n\n// 处理拖拽开始\nconst handleDragStart = () => {\n  isDragging.value = true\n}\n\n// 处理拖拽结束\nconst handleDragEnd = () => {\n  isDragging.value = false\n  isDragOver.value = false\n}\n\n// 处理拖拽进入\nconst handleDragEnter = (event) => {\n  event.preventDefault()\n  if (!isDragging.value) {\n    isDragOver.value = true\n  }\n}\n\n// 处理拖拽离开\nconst handleDragLeave = (event) => {\n  event.preventDefault()\n  isDragOver.value = false\n}\n\n// 处理拖拽悬停\nconst handleDragOver = (event) => {\n  event.preventDefault()\n}\n\nconst processComponentData = (component) => {\n  return {\n    id: Date.now(),\n    type: component.type,\n    name: component.name,\n    config: {\n      ...component.config,\n      type: component.name === '单栏布局' ? 'single' : \n            component.name === '双栏布局' ? 'double' : 'triple',\n      layout: component.name === '单栏布局' ? 1 : \n             component.name === '双栏布局' ? 2 : 3,\n      styles: component.styles || {},\n      components: []\n    }\n  }\n}\n\n// 处理组件变化\nconst handleChange = (event) => {\n  isDragOver.value = false\n  console.log('Canvas - handleChange:', event)\n  if (event.added) {\n    try {\n      const component = event.added.element\n      console.log('Canvas - Added component:', component)\n      if (component.type === 'layout') {\n        const newLayout = processComponentData(component)\n        console.log('Canvas - Creating new layout:', newLayout)\n        layouts.value.splice(event.added.newIndex, 1, newLayout)\n      }\n    } catch (error) {\n      console.error('Canvas - 处理组件时出错:', error)\n    }\n  } else if (event.removed) {\n    isDragOver.value = false\n  }\n}\n\nconst getLayoutComponent = (layout) => {\n  const layoutMap = {\n    'grid': layout.config.columns === 12 ? SingleLayout : \n           layout.config.areas.length === 2 ? DoubleLayout : TripleLayout,\n    'single': SingleLayout,\n    'double': DoubleLayout,\n    'triple': TripleLayout\n  }\n  return layoutMap[layout.config.type] || SingleLayout\n}\n\nconst removeLayout = (layout) => {\n  const index = layouts.value.findIndex(l => l.id === layout.id)\n  if (index > -1) {\n    layouts.value.splice(index, 1)\n    isDragOver.value = false\n  }\n}\n\nconst updateLayoutConfig = (layoutId, config) => {\n  const layout = layouts.value.find(l => l.id === layoutId)\n  if (layout) {\n    layout.config = {\n      ...layout.config,\n      ...config\n    }\n  }\n}\n\nconst addComponentToLayout = (layoutId, component, column) => {\n  const layout = layouts.value.find(l => l.id === layoutId)\n  if (layout) {\n    if (!layout.config.components) {\n      layout.config.components = []\n    }\n    layout.config.components.push({\n      id: Date.now(),\n      type: component.type,\n      name: component.name,\n      column,\n      config: component.config || {}\n    })\n  }\n}\n\nconst exportLayoutData = () => {\n  return layouts.value.map(layout => ({\n    id: layout.id,\n    type: layout.type,\n    name: layout.name,\n    config: layout.config\n  }))\n}\n\n// 加载模板\nconst loadTemplate = (template, profileData) => {\n  console.log('加载模板:', template)\n  console.log('加载档案数据:', profileData)\n  if (!template) return\n\n  // 清空现有布局\n  layouts.value = []\n\n  // 创建布局组件\n  const layoutComponent = {\n    id: Date.now(),\n    type: 'layout',\n    name: template.name,\n    config: {\n      type: template.layout.type || 'grid',\n      areas: template.layout.areas || [],\n      columns: template.layout.columns || 12,\n      gap: template.layout.gap || '20px',\n      styles: template.theme || {},\n      // 根据模板配置和档案数据创建组件\n      components: template.components.map(comp => {\n        const componentData = {\n          id: comp.id || Date.now(),\n          type: comp.type,\n          name: comp.type,\n          config: {\n            ...comp.config,\n            // 根据组件类型注入相应的档案数据\n            fields: {\n              ...comp.config?.fields,\n              ...mapProfileDataToComponent(comp.type, profileData)\n            },\n            styles: comp.config?.styles || {}\n          }\n        }\n        return componentData\n      })\n    }\n  }\n\n  // 添加布局到画布\n  layouts.value.push(layoutComponent)\n  console.log('更新后的布局:', layouts.value)\n}\n\n// 将档案数据映射到组件\nconst mapProfileDataToComponent = (componentType, profileData) => {\n  if (!profileData) return {}\n\n  const mappings = {\n    'BasicInfo': {\n      name: profileData.basic_info?.name,\n      title: profileData.basic_info?.title,\n      email: profileData.basic_info?.email,\n      phone: profileData.basic_info?.phone,\n      location: profileData.basic_info?.location,\n      summary: profileData.basic_info?.personal_summary,\n      avatar: profileData.basic_info?.avatar\n    },\n    'Education': profileData.education?.map(edu => ({\n      school: edu.school,\n      major: edu.major,\n      degree: edu.degree,\n      startDate: edu.start_date,\n      endDate: edu.end_date,\n      description: edu.description,\n      achievements: edu.achievements\n    })) || [],\n    'Experience': profileData.work_experience?.map(exp => ({\n      company: exp.company,\n      position: exp.position,\n      department: exp.department,\n      startDate: exp.start_date,\n      endDate: exp.end_date,\n      description: exp.description,\n      achievements: exp.achievements,\n      technologies: exp.technologies,\n      duration: exp.duration\n    })) || [],\n    'Skills': profileData.skill?.map(skill => ({\n      name: skill.name,\n      level: skill.level,\n      description: skill.description\n    })) || [],\n    'Projects': profileData.project?.map(proj => ({\n      name: proj.name,\n      role: proj.role,\n      startDate: proj.start_date,\n      endDate: proj.end_date,\n      description: proj.description,\n      achievement: proj.achievement\n    })) || [],\n    'Contact': {\n      phone: profileData.basic_info?.phone,\n      email: profileData.basic_info?.email,\n      location: profileData.basic_info?.location,\n      social_links: profileData.social_link || []\n    }\n  }\n\n  return mappings[componentType] || {}\n}\n\n// 暴露方法给父组件\ndefineExpose({\n  loadTemplate,\n  exportLayoutData,\n  updateLayoutConfig,\n  addComponentToLayout,\n  removeLayout\n})\n\nconst padding = computed(() => {\n  return props.scale < 1 ? `${Math.round(38 * props.scale)}px` : '38px'\n})\n</script>\n\n<style scoped>\n.canvas-container {\n  flex: 1;\n  height: 100%;\n  background: #f5f7fa;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  overflow: hidden;\n}\n\n.canvas-wrapper {\n  height: 100%;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  overflow: auto;\n  padding: v-bind(\"scale >= 1 ? '40px' : 0\");\n}\n\n.canvas-wrapper::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n.canvas-wrapper::-webkit-scrollbar-track {\n  background: #f5f7fa;\n}\n\n.canvas-wrapper::-webkit-scrollbar-thumb {\n  background: #dcdfe6;\n  border-radius: 4px;\n}\n\n.canvas-wrapper::-webkit-scrollbar-thumb:hover {\n  background: #c0c4cc;\n}\n\n.canvas-content {\n  width: 595px;\n  height: 842px;\n  background: #ffffff;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n  transform-origin: center center;\n  overflow: hidden;\n  padding: v-bind(padding);\n  position: relative;\n  flex-shrink: 0;\n  max-height: v-bind(\"scale < 1 ? '100%' : 'none'\");\n  max-width: v-bind(\"scale < 1 ? '100%' : 'none'\");\n}\n\n.canvas-drop-area {\n  height: 100%;\n  width: 100%;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.canvas-drop-area.drag-over {\n  background: #ecf5ff;\n  border: 2px dashed #409eff;\n  border-radius: 4px;\n}\n\n.placeholder {\n  height: 100%;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #909399;\n  font-size: 14px;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n}\n\n.layout-wrapper {\n  position: relative;\n  width: 100%;\n  flex: 1;\n  min-height: 100px;\n  background: #f5f7fa;\n  border: 1px solid #e4e7ed;\n  border-radius: 4px;\n}\n\n.layout-wrapper:last-child {\n  margin-bottom: 0;\n}\n\n.layout-actions {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  display: flex;\n  gap: 4px;\n  opacity: 0;\n  transition: opacity 0.3s;\n  z-index: 10;\n  background: rgba(255, 255, 255, 0.9);\n  border-radius: 4px;\n  padding: 2px;\n}\n\n.layout-wrapper:hover .layout-actions {\n  opacity: 1;\n}\n\n.ghost {\n  opacity: 0.5;\n  background: #c8ebfb;\n}\n\n.layout-wrapper.dragging {\n  opacity: 0.5;\n}\n</style> "],"mappings":";;EACOA,KAAK,EAAC;AAAkB;;EACtBA,KAAK,EAAC;AAAgB;;EAkBdA,KAAK,EAAC;AAAgB;;EACpBA,KAAK,EAAC;AAAgB;;EArBzCC,GAAA;EAsC6CD,KAAK,EAAC;;;;;uBArCjDE,mBAAA,CA6CM,OA7CNC,UA6CM,GA5CJC,mBAAA,CA2CM,OA3CNC,UA2CM,GA1CJD,mBAAA,CAyCM;IAzCDJ,KAAK,EAAC,gBAAgB;IAAEM,KAAK,EAHxCC,eAAA;MAAAC,SAAA,WAGgEC,MAAA,CAAAC,KAAK;IAAA;MAC7DC,YAAA,CAuCYC,MAAA;IA3CpBC,UAAA,EAKmBD,MAAA,CAAAE,OAAO;IAL1B,uBAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAKmBJ,MAAA,CAAAE,OAAO,GAAAE,MAAA;IACfC,KAAK,EAAE;MAAAC,IAAA;MAAAC,IAAA;MAAAC,GAAA;IAAA,CAA2C;IACnD,UAAQ,EAAC,IAAI;IACbpB,KAAK,EARfqB,eAAA,EAQgB,kBAAkB;MAAA,aACDT,MAAA,CAAAU;IAAU;IAChCC,SAAS,EAAE,GAAG;IACf,aAAW,EAAC,OAAO;IAClBC,OAAK,EAAEZ,MAAA,CAAAa,eAAe;IACtBC,KAAG,EAAEd,MAAA,CAAAe,aAAa;IAClBC,QAAM,EAAEhB,MAAA,CAAAiB,YAAY;IACpBC,WAAS,EAAElB,MAAA,CAAAmB,eAAe;IAC1BC,WAAS,EAAEpB,MAAA,CAAAqB,eAAe;IAC1BC,UAAQ,EAAEtB,MAAA,CAAAuB;;IAEAC,IAAI,EAAAC,QAAA,CACb,CAcM;MAfWC;IAAO,OACxBlC,mBAAA,CAcM,OAdNmC,UAcM,GAbJnC,mBAAA,CAQM,OARNoC,UAQM,GAPJ7B,YAAA,CAMS8B,gBAAA;MALPC,IAAI,EAAC,YAAY;MACjBC,IAAI,EAAC,OAAO;MACZC,KAAK,EAAC,OAAO;MACbC,OAAO,EAAC,MAAM;MACbC,OAAK,EAAA9B,MAAA,IAAEJ,MAAA,CAAAmC,YAAY,CAACT,OAAO;2DAGhCU,YAAA,CAGaC,wBAjC3B,CA+BqBrC,MAAA,CAAAsC,kBAAkB,CAACZ,OAAO;MAC9Ba,MAAM,EAAEb,OAAO,CAACa;;IAKZC,MAAM,EAAAf,QAAA,CACf,MAGM,CAHKzB,MAAA,CAAAE,OAAO,CAACuC,MAAM,U,cAAzBnD,mBAAA,CAGM,OAHNoD,UAGM,GAFJ3C,YAAA,CAAgD4C,iBAAA;MAAxCZ,IAAI,EAAC,IAAI;MAAC3C,KAAK,EAAC;;MAvCtCwD,OAAA,EAAAnB,QAAA,CAuC6C,MAAQtB,MAAA,QAAAA,MAAA,OAvCrD0C,gBAAA,CAuC6C,UAAQ,E;MAvCrDC,CAAA;kCAwCctD,mBAAA,CAAoB,cAAd,SAAO,qB,KAxC3BuD,mBAAA,e;IAAAD,CAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}