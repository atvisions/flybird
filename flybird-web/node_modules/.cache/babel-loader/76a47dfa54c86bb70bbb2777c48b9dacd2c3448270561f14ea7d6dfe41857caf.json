{"ast":null,"code":"import { defineStore } from 'pinia';\nimport profile from '@/api/profile';\nimport { MEDIA_URL } from '@/config/index';\nexport const useProfileStore = defineStore({\n  id: 'profile',\n  state: () => ({\n    basicInfo: null,\n    avatarUpdateTime: null\n  }),\n  getters: {\n    // 获取职业头像的完整 URL\n    profileAvatarUrl: state => {\n      const avatar = state.basicInfo?.avatar;\n      if (!avatar) return null;\n      // 如果已经是完整的 URL，直接返回\n      if (avatar.startsWith('http')) return avatar;\n      // 如果是相对路径，需要去掉开头的 /media/\n      const cleanPath = avatar.replace(/^\\/media\\//, '');\n      return `${MEDIA_URL}/${cleanPath}`;\n    }\n  },\n  actions: {\n    // 更新头像\n    async updateAvatar(file) {\n      try {\n        const response = await profile.uploadAvatar(file);\n        if (response?.data?.code === 200) {\n          const avatarUrl = response.data.data.avatar;\n\n          // 更新 store 状态\n          if (!this.basicInfo) {\n            this.basicInfo = {};\n          }\n          this.basicInfo.avatar = avatarUrl;\n          this.avatarUpdateTime = Date.now();\n          console.log('Store updated:', {\n            avatar: this.basicInfo.avatar,\n            updateTime: this.avatarUpdateTime\n          });\n          return response;\n        }\n        throw new Error(response?.data?.message || '上传失败');\n      } catch (error) {\n        console.error('职业头像上传失败:', error);\n        throw error;\n      }\n    }\n  }\n});","map":{"version":3,"names":["defineStore","profile","MEDIA_URL","useProfileStore","id","state","basicInfo","avatarUpdateTime","getters","profileAvatarUrl","avatar","startsWith","cleanPath","replace","actions","updateAvatar","file","response","uploadAvatar","data","code","avatarUrl","Date","now","console","log","updateTime","Error","message","error"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/profile.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport profile from '@/api/profile'\nimport { MEDIA_URL } from '@/config/index'\n\nexport const useProfileStore = defineStore({\n  id: 'profile',\n  state: () => ({\n    basicInfo: null,\n    avatarUpdateTime: null\n  }),\n\n  getters: {\n    // 获取职业头像的完整 URL\n    profileAvatarUrl: (state) => {\n      const avatar = state.basicInfo?.avatar\n      if (!avatar) return null\n      // 如果已经是完整的 URL，直接返回\n      if (avatar.startsWith('http')) return avatar\n      // 如果是相对路径，需要去掉开头的 /media/\n      const cleanPath = avatar.replace(/^\\/media\\//, '')\n      return `${MEDIA_URL}/${cleanPath}`\n    }\n  },\n\n  actions: {\n    // 更新头像\n    async updateAvatar(file) {\n      try {\n        const response = await profile.uploadAvatar(file)\n        if (response?.data?.code === 200) {\n          const avatarUrl = response.data.data.avatar\n          \n          // 更新 store 状态\n          if (!this.basicInfo) {\n            this.basicInfo = {}\n          }\n          this.basicInfo.avatar = avatarUrl\n          this.avatarUpdateTime = Date.now()\n          \n          console.log('Store updated:', {\n            avatar: this.basicInfo.avatar,\n            updateTime: this.avatarUpdateTime\n          })\n          \n          return response\n        }\n        throw new Error(response?.data?.message || '上传失败')\n      } catch (error) {\n        console.error('职业头像上传失败:', error)\n        throw error\n      }\n    }\n  }\n}) "],"mappings":"AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,OAAOC,OAAO,MAAM,eAAe;AACnC,SAASC,SAAS,QAAQ,gBAAgB;AAE1C,OAAO,MAAMC,eAAe,GAAGH,WAAW,CAAC;EACzCI,EAAE,EAAE,SAAS;EACbC,KAAK,EAAEA,CAAA,MAAO;IACZC,SAAS,EAAE,IAAI;IACfC,gBAAgB,EAAE;EACpB,CAAC,CAAC;EAEFC,OAAO,EAAE;IACP;IACAC,gBAAgB,EAAGJ,KAAK,IAAK;MAC3B,MAAMK,MAAM,GAAGL,KAAK,CAACC,SAAS,EAAEI,MAAM;MACtC,IAAI,CAACA,MAAM,EAAE,OAAO,IAAI;MACxB;MACA,IAAIA,MAAM,CAACC,UAAU,CAAC,MAAM,CAAC,EAAE,OAAOD,MAAM;MAC5C;MACA,MAAME,SAAS,GAAGF,MAAM,CAACG,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC;MAClD,OAAO,GAAGX,SAAS,IAAIU,SAAS,EAAE;IACpC;EACF,CAAC;EAEDE,OAAO,EAAE;IACP;IACA,MAAMC,YAAYA,CAACC,IAAI,EAAE;MACvB,IAAI;QACF,MAAMC,QAAQ,GAAG,MAAMhB,OAAO,CAACiB,YAAY,CAACF,IAAI,CAAC;QACjD,IAAIC,QAAQ,EAAEE,IAAI,EAAEC,IAAI,KAAK,GAAG,EAAE;UAChC,MAAMC,SAAS,GAAGJ,QAAQ,CAACE,IAAI,CAACA,IAAI,CAACT,MAAM;;UAE3C;UACA,IAAI,CAAC,IAAI,CAACJ,SAAS,EAAE;YACnB,IAAI,CAACA,SAAS,GAAG,CAAC,CAAC;UACrB;UACA,IAAI,CAACA,SAAS,CAACI,MAAM,GAAGW,SAAS;UACjC,IAAI,CAACd,gBAAgB,GAAGe,IAAI,CAACC,GAAG,CAAC,CAAC;UAElCC,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAE;YAC5Bf,MAAM,EAAE,IAAI,CAACJ,SAAS,CAACI,MAAM;YAC7BgB,UAAU,EAAE,IAAI,CAACnB;UACnB,CAAC,CAAC;UAEF,OAAOU,QAAQ;QACjB;QACA,MAAM,IAAIU,KAAK,CAACV,QAAQ,EAAEE,IAAI,EAAES,OAAO,IAAI,MAAM,CAAC;MACpD,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdL,OAAO,CAACK,KAAK,CAAC,WAAW,EAAEA,KAAK,CAAC;QACjC,MAAMA,KAAK;MACb;IACF;EACF;AACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}