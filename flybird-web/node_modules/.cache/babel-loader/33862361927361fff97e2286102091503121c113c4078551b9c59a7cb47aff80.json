{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, createVNode as _createVNode, Fragment as _Fragment, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = {\n  class: \"bg-white rounded-lg shadow\"\n};\nconst _hoisted_2 = {\n  class: \"relative h-48 overflow-hidden rounded-t-lg\"\n};\nconst _hoisted_3 = [\"src\"];\nconst _hoisted_4 = {\n  class: \"relative px-6 pb-6\"\n};\nconst _hoisted_5 = {\n  class: \"absolute -top-16 left-6\"\n};\nconst _hoisted_6 = {\n  class: \"relative group\"\n};\nconst _hoisted_7 = [\"src\"];\nconst _hoisted_8 = {\n  class: \"absolute bottom-0 right-0 bg-white rounded-full p-2 shadow\"\n};\nconst _hoisted_9 = {\n  key: 0,\n  class: \"w-6 h-6 text-blue-500\",\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  stroke: \"currentColor\"\n};\nconst _hoisted_10 = {\n  class: \"pt-20\"\n};\nconst _hoisted_11 = {\n  class: \"flex items-center justify-between mb-4\"\n};\nconst _hoisted_12 = {\n  class: \"text-2xl font-bold text-gray-900\"\n};\nconst _hoisted_13 = {\n  class: \"text-gray-600 mb-6\"\n};\nconst _hoisted_14 = {\n  class: \"grid grid-cols-2 gap-6 mb-6\"\n};\nconst _hoisted_15 = {\n  class: \"space-y-3\"\n};\nconst _hoisted_16 = {\n  class: \"flex items-center space-x-2\"\n};\nconst _hoisted_17 = {\n  class: \"text-gray-600\"\n};\nconst _hoisted_18 = {\n  class: \"flex items-center space-x-2\"\n};\nconst _hoisted_19 = {\n  class: \"text-gray-600\"\n};\nconst _hoisted_20 = {\n  class: \"space-y-3\"\n};\nconst _hoisted_21 = {\n  class: \"flex items-center space-x-2\"\n};\nconst _hoisted_22 = {\n  class: \"text-gray-600\"\n};\nconst _hoisted_23 = {\n  class: \"flex items-center space-x-2\"\n};\nconst _hoisted_24 = {\n  class: \"text-gray-600\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_createCommentVNode(\" 背景图部分 \"), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"img\", {\n    src: $setup.backgroundUrl,\n    class: \"w-full h-full object-cover\",\n    onError: $setup.handleBackgroundError\n  }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_3), _createElementVNode(\"div\", {\n    class: \"absolute top-4 right-4\"\n  }, [_createElementVNode(\"button\", {\n    onClick: $setup.triggerBackgroundUpload,\n    class: \"flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-white bg-opacity-90 rounded-lg hover:bg-opacity-100 transition-all shadow-sm\"\n  }, _cache[1] || (_cache[1] = [_createElementVNode(\"svg\", {\n    class: \"w-4 h-4 mr-1.5 text-gray-600\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    viewBox: \"0 0 24 24\"\n  }, [_createElementVNode(\"path\", {\n    \"stroke-linecap\": \"round\",\n    \"stroke-linejoin\": \"round\",\n    \"stroke-width\": \"2\",\n    d: \"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\n  })], -1 /* HOISTED */), _createTextVNode(\" 更换背景 \")]))]), _createElementVNode(\"input\", {\n    ref: \"backgroundInput\",\n    type: \"file\",\n    accept: \"image/*\",\n    class: \"hidden\",\n    onChange: $setup.handleBackgroundChange\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)]), _createCommentVNode(\" 个人信息卡片 \"), _createElementVNode(\"div\", _hoisted_4, [_createCommentVNode(\" 头像部分 - 上移到背景图上 \"), _createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"img\", {\n    src: $setup.userAvatar,\n    class: \"w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg\",\n    alt: \"用户头像\",\n    onError: $setup.handleImageError\n  }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_7), _createElementVNode(\"div\", {\n    onClick: $setup.triggerUpload,\n    class: \"absolute inset-0 flex items-center justify-center rounded-full bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity duration-200\"\n  }, [_createVNode($setup[\"CameraIcon\"], {\n    class: \"w-8 h-8 text-white\"\n  })]), _createCommentVNode(\" 性别标识 \"), _createElementVNode(\"div\", _hoisted_8, [_createCommentVNode(\" 男性图标 \"), $setup.currentGender === 'male' ? (_openBlock(), _createElementBlock(\"svg\", _hoisted_9, _cache[2] || (_cache[2] = [_createElementVNode(\"circle\", {\n    cx: \"12\",\n    cy: \"12\",\n    r: \"5\",\n    \"stroke-width\": \"2\"\n  }, null, -1 /* HOISTED */), _createElementVNode(\"path\", {\n    d: \"M16 8L21 3\",\n    \"stroke-width\": \"2\",\n    \"stroke-linecap\": \"round\"\n  }, null, -1 /* HOISTED */), _createElementVNode(\"path\", {\n    d: \"M21 3H16M21 3V8\",\n    \"stroke-width\": \"2\",\n    \"stroke-linecap\": \"round\"\n  }, null, -1 /* HOISTED */)]))) : $setup.currentGender === 'female' ? (_openBlock(), _createElementBlock(_Fragment, {\n    key: 1\n  }, [_createCommentVNode(\" 女性图标 \"), _cache[3] || (_cache[3] = _createElementVNode(\"svg\", {\n    class: \"w-6 h-6 text-pink-500\",\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: \"currentColor\"\n  }, [_createElementVNode(\"circle\", {\n    cx: \"12\",\n    cy: \"10\",\n    r: \"5\",\n    \"stroke-width\": \"2\"\n  }), _createElementVNode(\"path\", {\n    d: \"M12 15V21\",\n    \"stroke-width\": \"2\",\n    \"stroke-linecap\": \"round\"\n  }), _createElementVNode(\"path\", {\n    d: \"M9 18H15\",\n    \"stroke-width\": \"2\",\n    \"stroke-linecap\": \"round\"\n  })], -1 /* HOISTED */))], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */)) : _createCommentVNode(\"v-if\", true)])])]), _createCommentVNode(\" 基本信息部分 \"), _createElementVNode(\"div\", _hoisted_10, [_createCommentVNode(\" 名字和编辑按钮 \"), _createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"h1\", _hoisted_12, _toDisplayString($setup.formatBasicInfo.name), 1 /* TEXT */), _createElementVNode(\"button\", {\n    onClick: $setup.handleEdit,\n    class: \"p-2 rounded-full hover:bg-gray-100 transition-colors\"\n  }, [_createVNode($setup[\"PencilSquareIcon\"], {\n    class: \"w-5 h-5 text-gray-500\"\n  })])]), _createCommentVNode(\" 个人简介 \"), _createElementVNode(\"p\", _hoisted_13, _toDisplayString($setup.formatBasicInfo.personal_summary || '这个人很懒，还没有填写个人简介'), 1 /* TEXT */), _createCommentVNode(\" 信息网格 \"), _createElementVNode(\"div\", _hoisted_14, [_createCommentVNode(\" 联系方式 \"), _createElementVNode(\"div\", _hoisted_15, [_cache[4] || (_cache[4] = _createElementVNode(\"h2\", {\n    class: \"text-sm font-semibold text-gray-900 mb-2\"\n  }, \"联系方式\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_16, [_createVNode($setup[\"PhoneIcon\"], {\n    class: \"w-5 h-5 text-gray-400\"\n  }), _createElementVNode(\"span\", _hoisted_17, _toDisplayString($setup.formatBasicInfo.phone), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_18, [_createVNode($setup[\"EnvelopeIcon\"], {\n    class: \"w-5 h-5 text-gray-400\"\n  }), _createElementVNode(\"span\", _hoisted_19, _toDisplayString($setup.formatBasicInfo.email), 1 /* TEXT */)])]), _createCommentVNode(\" 基本资料 \"), _createElementVNode(\"div\", _hoisted_20, [_cache[5] || (_cache[5] = _createElementVNode(\"h2\", {\n    class: \"text-sm font-semibold text-gray-900 mb-2\"\n  }, \"基本资料\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_21, [_createVNode($setup[\"MapPinIcon\"], {\n    class: \"w-5 h-5 text-gray-400\"\n  }), _createElementVNode(\"span\", _hoisted_22, _toDisplayString($setup.formatBasicInfo.location), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_23, [_createVNode($setup[\"CakeIcon\"], {\n    class: \"w-5 h-5 text-gray-400\"\n  }), _createElementVNode(\"span\", _hoisted_24, _toDisplayString($setup.formatBasicInfo.age), 1 /* TEXT */)])])])])])]), _createCommentVNode(\" 添加头像上传弹窗 \"), _createVNode($setup[\"AvatarUploadDialog\"], {\n    modelValue: $setup.showAvatarUpload,\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.showAvatarUpload = $event),\n    loading: $setup.loading,\n    onUpload: $setup.handleAvatarUpload\n  }, null, 8 /* PROPS */, [\"modelValue\", \"loading\"])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","key","viewBox","fill","stroke","_createElementBlock","_Fragment","_createElementVNode","_hoisted_1","_createCommentVNode","_hoisted_2","src","$setup","backgroundUrl","onError","handleBackgroundError","_hoisted_3","onClick","triggerBackgroundUpload","d","_createTextVNode","ref","type","accept","onChange","handleBackgroundChange","_hoisted_4","_hoisted_5","_hoisted_6","userAvatar","alt","handleImageError","_hoisted_7","triggerUpload","_createVNode","_hoisted_8","currentGender","_hoisted_9","_cache","cx","cy","r","_hoisted_10","_hoisted_11","_hoisted_12","_toDisplayString","formatBasicInfo","name","handleEdit","_hoisted_13","personal_summary","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","phone","_hoisted_18","_hoisted_19","email","_hoisted_20","_hoisted_21","_hoisted_22","location","_hoisted_23","_hoisted_24","age","modelValue","showAvatarUpload","$event","loading","onUpload","handleAvatarUpload"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/components/BasicInfo.vue"],"sourcesContent":["<!-- src/views/user/MyProfile/components/BasicInfo.vue -->\n<template>\n  <div class=\"bg-white rounded-lg shadow\">\n    <!-- 背景图部分 -->\n    <div class=\"relative h-48 overflow-hidden rounded-t-lg\">\n      <img \n        :src=\"backgroundUrl\" \n        class=\"w-full h-full object-cover\"\n        @error=\"handleBackgroundError\"\n      >\n      <div class=\"absolute top-4 right-4\">\n        <button\n          @click=\"triggerBackgroundUpload\"\n          class=\"flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-white bg-opacity-90 rounded-lg hover:bg-opacity-100 transition-all shadow-sm\"\n        >\n          <svg \n            class=\"w-4 h-4 mr-1.5 text-gray-600\" \n            fill=\"none\" \n            stroke=\"currentColor\" \n            viewBox=\"0 0 24 24\"\n          >\n            <path \n              stroke-linecap=\"round\" \n              stroke-linejoin=\"round\" \n              stroke-width=\"2\" \n              d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\n            />\n          </svg>\n          更换背景\n        </button>\n      </div>\n      <input\n        ref=\"backgroundInput\"\n        type=\"file\"\n        accept=\"image/*\"\n        class=\"hidden\"\n        @change=\"handleBackgroundChange\"\n      >\n    </div>\n\n    <!-- 个人信息卡片 -->\n    <div class=\"relative px-6 pb-6\">\n      <!-- 头像部分 - 上移到背景图上 -->\n      <div class=\"absolute -top-16 left-6\">\n        <div class=\"relative group\">\n          <img \n            :src=\"userAvatar\" \n            class=\"w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg\"\n            alt=\"用户头像\"\n            @error=\"handleImageError\"\n          />\n          <div \n            @click=\"triggerUpload\"\n            class=\"absolute inset-0 flex items-center justify-center rounded-full bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity duration-200\"\n          >\n            <CameraIcon class=\"w-8 h-8 text-white\" />\n          </div>\n          <!-- 性别标识 -->\n          <div class=\"absolute bottom-0 right-0 bg-white rounded-full p-2 shadow\">\n            <!-- 男性图标 -->\n            <svg \n              v-if=\"currentGender === 'male'\" \n              class=\"w-6 h-6 text-blue-500\" \n              viewBox=\"0 0 24 24\" \n              fill=\"none\" \n              stroke=\"currentColor\"\n            >\n              <circle cx=\"12\" cy=\"12\" r=\"5\" stroke-width=\"2\"/>\n              <path d=\"M16 8L21 3\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n              <path d=\"M21 3H16M21 3V8\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n            <!-- 女性图标 -->\n            <svg \n              v-else-if=\"currentGender === 'female'\" \n              class=\"w-6 h-6 text-pink-500\" \n              viewBox=\"0 0 24 24\" \n              fill=\"none\" \n              stroke=\"currentColor\"\n            >\n              <circle cx=\"12\" cy=\"10\" r=\"5\" stroke-width=\"2\"/>\n              <path d=\"M12 15V21\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n              <path d=\"M9 18H15\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n          </div>\n        </div>\n      </div>\n\n      <!-- 基本信息部分 -->\n      <div class=\"pt-20\">\n        <!-- 名字和编辑按钮 -->\n        <div class=\"flex items-center justify-between mb-4\">\n          <h1 class=\"text-2xl font-bold text-gray-900\">{{ formatBasicInfo.name }}</h1>\n          <button\n            @click=\"handleEdit\"\n            class=\"p-2 rounded-full hover:bg-gray-100 transition-colors\"\n          >\n            <PencilSquareIcon class=\"w-5 h-5 text-gray-500\" />\n          </button>\n        </div>\n\n        <!-- 个人简介 -->\n        <p class=\"text-gray-600 mb-6\">{{ formatBasicInfo.personal_summary || '这个人很懒，还没有填写个人简介' }}</p>\n\n        <!-- 信息网格 -->\n        <div class=\"grid grid-cols-2 gap-6 mb-6\">\n          <!-- 联系方式 -->\n          <div class=\"space-y-3\">\n            <h2 class=\"text-sm font-semibold text-gray-900 mb-2\">联系方式</h2>\n            <div class=\"flex items-center space-x-2\">\n              <PhoneIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ formatBasicInfo.phone }}</span>\n            </div>\n            <div class=\"flex items-center space-x-2\">\n              <EnvelopeIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ formatBasicInfo.email }}</span>\n            </div>\n          </div>\n\n          <!-- 基本资料 -->\n          <div class=\"space-y-3\">\n            <h2 class=\"text-sm font-semibold text-gray-900 mb-2\">基本资料</h2>\n            <div class=\"flex items-center space-x-2\">\n              <MapPinIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ formatBasicInfo.location }}</span>\n            </div>\n            <div class=\"flex items-center space-x-2\">\n              <CakeIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ formatBasicInfo.age }}</span>\n            </div>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n\n  <!-- 添加头像上传弹窗 -->\n  <AvatarUploadDialog\n    v-model=\"showAvatarUpload\"\n    :loading=\"loading\"\n    @upload=\"handleAvatarUpload\"\n  />\n</template>\n\n<script setup>\nimport { ref, computed, nextTick, watch, onMounted } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport defaultAvatarImage from '@/assets/images/default-avatar.png'\nimport defaultBackground from '@/assets/images/default-background.jpg'\nimport { useStore } from 'vuex'\nimport { MEDIA_URL } from '@/config'\nimport { showToast } from '@/components/ToastMessage'\nimport {\n  PencilIcon,\n  PhoneIcon,\n  EnvelopeIcon,\n  MapPinIcon,\n  BriefcaseIcon,\n  ClockIcon,\n  CurrencyYenIcon,\n  DocumentTextIcon,\n  CameraIcon,\n  UserIcon,\n  CalendarIcon,\n  ChevronDownIcon,\n  ChevronUpIcon,\n  CakeIcon,\n  PencilSquareIcon\n} from '@heroicons/vue/24/outline'\nimport profile from '@/api/profile'\nimport { eventBus } from '@/utils/eventBus'\nimport {\n  Dialog,\n  DialogPanel,\n  DialogTitle,\n  TransitionChild,\n  TransitionRoot\n} from '@headlessui/vue'\nimport AvatarUploadDialog from '../dialogs/AvatarUploadDialog.vue'\n\n// 1. 首先声明 props\nconst props = defineProps({\n  resumeData: {\n    type: Object,\n    default: () => ({})\n  },\n  loading: {\n    type: Boolean,\n    default: false\n  },\n  bioExpanded: {\n    type: Boolean,\n    default: false\n  },\n  showBioExpandButton: {\n    type: Boolean,\n    default: false\n  }\n})\n\n// 2. 声明 emits\nconst emit = defineEmits(['update', 'edit', 'toggleBioExpand'])\n\n// 3. 导入和初始化其他变量\nconst store = useStore()\nconst loading = ref(true)\nconst basicInfo = ref({})\n\n// 4. 计算属性\nconst formatBasicInfo = computed(() => {\n  // 优先使用父组件传入的 resumeData\n  const info = props.resumeData || {}\n  \n  return {\n    name: info.name || info.username || '未填写',  // 添加 username 作为备选\n    gender: formatGender(info.gender),\n    phone: info.phone || '未填写',\n    email: info.email || '未填写',\n    location: info.location || '未填写',\n    age: calculateAge(info.birth_date) || '未填写',\n    personal_summary: info.personal_summary || '未填写'\n  }\n})\n\nconst userAvatar = computed(() => {\n  const avatar = props.resumeData?.avatar\n  if (!avatar) return defaultAvatarImage\n  return avatar.startsWith('http') || avatar.startsWith('data:') ? avatar : `${MEDIA_URL}${avatar}`\n})\n\nconst currentGender = computed(() => {\n  return props.resumeData?.gender\n})\n\n// 5. 监听器\nwatch(\n  () => props.resumeData,\n  (newVal) => {\n    if (newVal && Object.keys(newVal).length > 0) {\n      loading.value = false\n    }\n  },\n  { immediate: true }\n)\n\n// 6. 生命周期钩子\nonMounted(async () => {\n  try {\n    loading.value = true\n    // 不需要在这里获取数据，因为父组件会处理\n  } catch (error) {\n    console.error('初始化失败:', error)\n  } finally {\n    loading.value = false\n  }\n})\n\nonMounted(async () => {\n  try {\n    await store.dispatch('fetchCompleteness')\n  } catch (error) {\n    console.error('Failed to fetch completeness:', error)\n  }\n})\n\n// 7. 方法定义\nconst handleFileChange = async (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n\n  // 验证文件\n  if (!validateFile(file)) {\n    return\n  }\n\n  await handleAvatarUpload(file)\n  \n  // 清空文件选择器，以便能够选择同一个文件\n  event.target.value = ''\n}\n\nconst handleEdit = () => {\n  console.log('BasicInfo handleEdit - 当前数据:', props.resumeData)\n  // 确保传递正确的数据结构\n  const editData = {\n    name: props.resumeData.name,\n    gender: props.resumeData.gender,\n    birth_date: props.resumeData.birth_date,\n    phone: props.resumeData.phone,\n    email: props.resumeData.email,\n    location: props.resumeData.location,\n    personal_summary: props.resumeData.personal_summary\n  }\n  emit('edit', 'basic_info', editData)\n}\n\nconst toggleBioExpand = () => {\n  emit('toggleBioExpand')\n}\n\n// 8. 工具函数\nconst calculateAge = (birthDate) => {\n  if (!birthDate) return ''\n  \n  const birth = new Date(birthDate)\n  const today = new Date()\n  \n  let age = today.getFullYear() - birth.getFullYear()\n  const monthDiff = today.getMonth() - birth.getMonth()\n  \n  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n    age--\n  }\n  \n  return `${age}岁`\n}\n\nconst formatGender = (gender) => {\n  const genderMap = {\n    male: '男',\n    female: '女',\n    other: '其他'\n  }\n  return genderMap[gender] || '未填写'\n}\n\nconst formatDate = (dateString) => {\n  if (!dateString) return ''\n  const date = new Date(dateString)\n  return date.toLocaleDateString('zh-CN', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  })\n}\n\n// 调试辅助函数\nconst logResumeData = () => {\n  const plainData = {\n    name: props.resumeData.name,\n    gender: props.resumeData.gender,\n    phone: props.resumeData.phone,\n    email: props.resumeData.email,\n    location: props.resumeData.location,\n    birth_date: props.resumeData.birth_date,\n    personal_summary: props.resumeData.personal_summary,\n    created_at: props.resumeData.created_at,\n    updated_at: props.resumeData.updated_at\n  }\n  console.log('BasicInfo data:', plainData)\n}\n\n// 添加头像上传处理函数\nconst handleAvatarUpload = async (file) => {\n  try {\n    loading.value = true\n    const formData = new FormData()\n    formData.append('avatar', file)\n    \n    const response = await profile.uploadAvatar(formData)\n    if (response.data?.code === 200) {\n      showToast('头像上传成功', 'success')\n      emit('update')\n      const avatarUrl = response.data.data.avatar\n      eventBus.emit('avatar-updated', avatarUrl)\n      if (props.resumeData) {\n        props.resumeData.avatar = avatarUrl\n      }\n      showAvatarUpload.value = false // 关闭弹窗\n    } else {\n      throw new Error(response.data?.message || '上传失败')\n    }\n  } catch (error) {\n    console.error('头像上传失败:', error)\n    showToast(error.message || '头像上传失败，请稍后重试', 'error')\n  } finally {\n    loading.value = false\n  }\n}\n\n// 添加触发文件选择的方法\nconst triggerUpload = () => {\n  showAvatarUpload.value = true\n}\n\n// 添加图片加载错误处理\nconst handleImageError = (e) => {\n  e.target.src = defaultAvatarImage\n}\n\n// 添加文件验证\nconst validateFile = (file) => {\n  // 验证文件类型\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return false\n  }\n\n  // 验证文件大小（例如限制为 2MB）\n  const maxSize = 20 * 1024 * 1024 // 2MB\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过 2MB', 'error')\n    return false\n  }\n\n  return true\n}\n\n// 背景图相关\nconst backgroundInput = ref(null)\nconst backgroundUrl = computed(() => {\n  const background = store.state.userInfo?.data?.basic_info?.background\n  if (!background) return defaultBackground\n  return background.startsWith('http') ? background : `${MEDIA_URL}${background}`\n})\n\nconst triggerBackgroundUpload = () => {\n  backgroundInput.value.click()\n}\n\nconst handleBackgroundChange = async (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n  \n  if (!validateFile(file)) {\n    return\n  }\n  \n  const formData = new FormData()\n  formData.append('background', file)\n  \n  try {\n    loading.value = true\n    const response = await profile.uploadBackground(formData)\n    if (response.data?.code === 200) {\n      showToast('背景图更新成功', 'success')\n      emit('update')  // 通知父组件更新\n      const backgroundUrl = response.data.data.background\n      // 更新本地数据\n      if (props.resumeData && props.resumeData.basic_info) {\n        props.resumeData.basic_info.background = backgroundUrl\n      }\n      // 更新 store\n      store.commit('UPDATE_BACKGROUND', backgroundUrl)\n    }\n  } catch (error) {\n    console.error('Failed to update background:', error)\n    showToast('背景图更新失败', 'error')\n  } finally {\n    loading.value = false\n    event.target.value = ''\n  }\n}\n\nconst handleBackgroundError = (e) => {\n  e.target.src = defaultBackground\n}\n\n// 添加状态\nconst showAvatarUpload = ref(false)\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}