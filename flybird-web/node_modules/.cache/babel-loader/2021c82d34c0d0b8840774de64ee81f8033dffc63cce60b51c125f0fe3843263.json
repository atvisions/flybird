{"ast":null,"code":"import _objectSpread from \"/Users/liuzhao/Documents/Projects/flybird/flybird-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { ref, computed } from 'vue';\nimport VueGridLayout from 'vue-grid-layout';\nimport { ArrowUp, ArrowDown, Delete, Plus } from '@element-plus/icons-vue';\nimport ComponentRenderer from '../widgets/ComponentRenderer.vue';\nexport default {\n  __name: 'EditorCanvas',\n  props: {\n    modelValue: {\n      type: Array,\n      required: true\n    },\n    components: {\n      type: Object,\n      required: true\n    },\n    styles: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  emits: ['update:modelValue', 'select', 'add-component'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const GridLayout = VueGridLayout.GridLayout;\n    const GridItem = VueGridLayout.GridItem;\n    const props = __props;\n    const emit = __emit;\n\n    // 布局数据\n    const layoutModel = computed({\n      get: () => props.modelValue,\n      set: value => emit('update:modelValue', value)\n    });\n\n    // 选中的组件ID\n    const selectedId = ref(null);\n\n    // 容器样式\n    const containerStyle = computed(() => _objectSpread({\n      width: '210mm',\n      // A4 宽度\n      height: '297mm',\n      // A4 高度\n      margin: '0 auto',\n      background: '#fff',\n      boxShadow: '0 0 10px rgba(0, 0, 0, 0.1)'\n    }, props.styles));\n\n    // 拖放状态\n    const isDragOver = ref(false);\n\n    // 处理拖动经过\n    const handleDragOver = event => {\n      event.preventDefault();\n      isDragOver.value = true;\n    };\n\n    // 处理拖动离开\n    const handleDragLeave = event => {\n      event.preventDefault();\n      isDragOver.value = false;\n    };\n\n    // 处理组件拖放\n    const handleDrop = event => {\n      event.preventDefault();\n      isDragOver.value = false;\n      try {\n        const componentData = JSON.parse(event.dataTransfer.getData('text/plain'));\n        const rect = event.currentTarget.getBoundingClientRect();\n        const x = Math.floor((event.clientX - rect.left) / (rect.width / 12));\n        const y = Math.floor((event.clientY - rect.top) / 30);\n        console.log('Dropping component:', componentData, 'at position:', {\n          x,\n          y\n        });\n        emit('add-component', _objectSpread(_objectSpread({}, componentData), {}, {\n          position: {\n            x,\n            y\n          }\n        }));\n      } catch (error) {\n        console.error('Drop error:', error);\n      }\n    };\n\n    // 处理布局更新\n    const handleLayoutUpdate = layout => {\n      emit('update:modelValue', layout);\n    };\n\n    // 处理组件调整大小\n    const handleResize = (i, newH, newW) => {\n      const index = layoutModel.value.findIndex(item => item.id === i);\n      if (index > -1) {\n        layoutModel.value[index].h = newH;\n        layoutModel.value[index].w = newW;\n      }\n    };\n\n    // 处理组件移动\n    const handleMoved = (i, newX, newY) => {\n      const index = layoutModel.value.findIndex(item => item.id === i);\n      if (index > -1) {\n        layoutModel.value[index].x = newX;\n        layoutModel.value[index].y = newY;\n      }\n    };\n\n    // 处理组件上移\n    const handleMoveUp = id => {\n      const index = layoutModel.value.findIndex(item => item.id === id);\n      if (index > 0) {\n        const temp = _objectSpread({}, layoutModel.value[index - 1]);\n        layoutModel.value[index - 1] = _objectSpread({}, layoutModel.value[index]);\n        layoutModel.value[index] = temp;\n      }\n    };\n\n    // 处理组件下移\n    const handleMoveDown = id => {\n      const index = layoutModel.value.findIndex(item => item.id === id);\n      if (index < layoutModel.value.length - 1) {\n        const temp = _objectSpread({}, layoutModel.value[index + 1]);\n        layoutModel.value[index + 1] = _objectSpread({}, layoutModel.value[index]);\n        layoutModel.value[index] = temp;\n      }\n    };\n\n    // 处理组件删除\n    const handleDelete = id => {\n      const index = layoutModel.value.findIndex(item => item.id === id);\n      layoutModel.value.splice(index, 1);\n      selectedId.value = null;\n    };\n    const __returned__ = {\n      GridLayout,\n      GridItem,\n      props,\n      emit,\n      layoutModel,\n      selectedId,\n      containerStyle,\n      isDragOver,\n      handleDragOver,\n      handleDragLeave,\n      handleDrop,\n      handleLayoutUpdate,\n      handleResize,\n      handleMoved,\n      handleMoveUp,\n      handleMoveDown,\n      handleDelete,\n      ref,\n      computed,\n      get VueGridLayout() {\n        return VueGridLayout;\n      },\n      get ArrowUp() {\n        return ArrowUp;\n      },\n      get ArrowDown() {\n        return ArrowDown;\n      },\n      get Delete() {\n        return Delete;\n      },\n      get Plus() {\n        return Plus;\n      },\n      ComponentRenderer\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","VueGridLayout","ArrowUp","ArrowDown","Delete","Plus","ComponentRenderer","GridLayout","GridItem","props","__props","emit","__emit","layoutModel","get","modelValue","set","value","selectedId","containerStyle","_objectSpread","width","height","margin","background","boxShadow","styles","isDragOver","handleDragOver","event","preventDefault","handleDragLeave","handleDrop","componentData","JSON","parse","dataTransfer","getData","rect","currentTarget","getBoundingClientRect","x","Math","floor","clientX","left","y","clientY","top","console","log","position","error","handleLayoutUpdate","layout","handleResize","i","newH","newW","index","findIndex","item","id","h","w","handleMoved","newX","newY","handleMoveUp","temp","handleMoveDown","length","handleDelete","splice"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/template-editor/components/canvas/EditorCanvas.vue"],"sourcesContent":["<template>\n  <div \n    class=\"editor-canvas\"\n    @dragover=\"handleDragOver\"\n    @dragleave=\"handleDragLeave\"\n    @drop=\"handleDrop\"\n    :class=\"{ 'drag-over': isDragOver }\"\n  >\n    <div \n      class=\"canvas-container\"\n      :style=\"containerStyle\"\n    >\n      <div v-if=\"isDragOver\" class=\"drop-indicator\">\n        <el-icon class=\"text-3xl\"><Plus /></el-icon>\n        <span>释放鼠标添加组件</span>\n      </div>\n      \n      <grid-layout\n        v-model:layout=\"layoutModel\"\n        :col-num=\"12\"\n        :row-height=\"30\"\n        :is-draggable=\"true\"\n        :is-resizable=\"true\"\n        :vertical-compact=\"true\"\n        :use-css-transforms=\"true\"\n        :margin=\"[10, 10]\"\n        @layout-updated=\"handleLayoutUpdate\"\n      >\n        <grid-item\n          v-for=\"item in layoutModel\"\n          :key=\"item.id\"\n          :x=\"item.x\"\n          :y=\"item.y\"\n          :w=\"item.w\"\n          :h=\"item.h\"\n          :i=\"item.id\"\n          :min-w=\"3\"\n          :min-h=\"3\"\n          :is-draggable=\"true\"\n          :is-resizable=\"true\"\n          :class=\"{ active: selectedId === item.id }\"\n          @click=\"handleSelect(item.id)\"\n          @resize=\"handleResize\"\n          @moved=\"handleMoved\"\n        >\n          <component-renderer\n            :type=\"components[item.id].type\"\n            :data=\"components[item.id].data\"\n            :styles=\"components[item.id].styles\"\n          />\n          <div class=\"component-actions\" v-if=\"selectedId === item.id\">\n            <el-button-group>\n              <el-button size=\"small\" @click=\"handleMoveUp(item.id)\">\n                <el-icon><ArrowUp /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleMoveDown(item.id)\">\n                <el-icon><ArrowDown /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleDelete(item.id)\">\n                <el-icon><Delete /></el-icon>\n              </el-button>\n            </el-button-group>\n          </div>\n        </grid-item>\n      </grid-layout>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport VueGridLayout from 'vue-grid-layout'\nimport { ArrowUp, ArrowDown, Delete, Plus } from '@element-plus/icons-vue'\nimport ComponentRenderer from '../widgets/ComponentRenderer.vue'\n\nconst GridLayout = VueGridLayout.GridLayout\nconst GridItem = VueGridLayout.GridItem\n\nconst props = defineProps({\n  modelValue: {\n    type: Array,\n    required: true\n  },\n  components: {\n    type: Object,\n    required: true\n  },\n  styles: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'select', 'add-component'])\n\n// 布局数据\nconst layoutModel = computed({\n  get: () => props.modelValue,\n  set: (value) => emit('update:modelValue', value)\n})\n\n// 选中的组件ID\nconst selectedId = ref(null)\n\n// 容器样式\nconst containerStyle = computed(() => ({\n  width: '210mm', // A4 宽度\n  height: '297mm', // A4 高度\n  margin: '0 auto',\n  background: '#fff',\n  boxShadow: '0 0 10px rgba(0, 0, 0, 0.1)',\n  ...props.styles\n}))\n\n// 拖放状态\nconst isDragOver = ref(false)\n\n// 处理拖动经过\nconst handleDragOver = (event) => {\n  event.preventDefault()\n  isDragOver.value = true\n}\n\n// 处理拖动离开\nconst handleDragLeave = (event) => {\n  event.preventDefault()\n  isDragOver.value = false\n}\n\n// 处理组件拖放\nconst handleDrop = (event) => {\n  event.preventDefault()\n  isDragOver.value = false\n  \n  try {\n    const componentData = JSON.parse(event.dataTransfer.getData('text/plain'))\n    const rect = event.currentTarget.getBoundingClientRect()\n    const x = Math.floor((event.clientX - rect.left) / (rect.width / 12))\n    const y = Math.floor((event.clientY - rect.top) / 30)\n    \n    console.log('Dropping component:', componentData, 'at position:', { x, y })\n    \n    emit('add-component', {\n      ...componentData,\n      position: { x, y }\n    })\n  } catch (error) {\n    console.error('Drop error:', error)\n  }\n}\n\n// 处理布局更新\nconst handleLayoutUpdate = (layout) => {\n  emit('update:modelValue', layout)\n}\n\n// 处理组件调整大小\nconst handleResize = (i, newH, newW) => {\n  const index = layoutModel.value.findIndex(item => item.id === i)\n  if (index > -1) {\n    layoutModel.value[index].h = newH\n    layoutModel.value[index].w = newW\n  }\n}\n\n// 处理组件移动\nconst handleMoved = (i, newX, newY) => {\n  const index = layoutModel.value.findIndex(item => item.id === i)\n  if (index > -1) {\n    layoutModel.value[index].x = newX\n    layoutModel.value[index].y = newY\n  }\n}\n\n// 处理组件上移\nconst handleMoveUp = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  if (index > 0) {\n    const temp = { ...layoutModel.value[index - 1] }\n    layoutModel.value[index - 1] = { ...layoutModel.value[index] }\n    layoutModel.value[index] = temp\n  }\n}\n\n// 处理组件下移\nconst handleMoveDown = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  if (index < layoutModel.value.length - 1) {\n    const temp = { ...layoutModel.value[index + 1] }\n    layoutModel.value[index + 1] = { ...layoutModel.value[index] }\n    layoutModel.value[index] = temp\n  }\n}\n\n// 处理组件删除\nconst handleDelete = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  layoutModel.value.splice(index, 1)\n  selectedId.value = null\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.editor-canvas {\n  @apply flex-1 overflow-y-auto bg-gray-100 p-8;\n  \n  &.drag-over .canvas-container {\n    @apply ring-2 ring-blue-500 ring-opacity-50;\n  }\n  \n  .canvas-container {\n    @apply shadow-lg relative;\n    transform-origin: top center;\n    \n    // 拖放提示\n    .drop-indicator {\n      @apply absolute inset-0 flex flex-col items-center justify-center\n             bg-blue-50 bg-opacity-50 text-blue-500 pointer-events-none;\n      z-index: 100;\n    }\n    \n    // 添加页面参考线\n    &::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      border: 1px solid #e0e0e0;\n      pointer-events: none;\n    }\n  }\n  \n  .grid-item {\n    @apply relative border border-transparent;\n    \n    &.active {\n      @apply border-blue-500;\n    }\n    \n    .component-actions {\n      @apply absolute top-2 right-2 z-10;\n    }\n  }\n}\n\n// 网格布局样式\n.vue-grid-layout {\n  @apply bg-white;\n  min-height: 297mm !important;\n}\n\n.vue-grid-item {\n  @apply touch-none;\n  \n  &.vue-grid-placeholder {\n    @apply bg-blue-100 border-2 border-blue-300 border-dashed;\n  }\n  \n  &.vue-draggable-dragging {\n    @apply z-50;\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}