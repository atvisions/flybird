{"ast":null,"code":"import { ref, watch } from 'vue';\nimport VueCropper from 'vue-cropperjs';\nimport 'cropperjs/dist/cropper.css';\nimport { Dialog, DialogPanel, DialogTitle, TransitionChild, TransitionRoot } from '@headlessui/vue';\nimport { InformationCircleIcon } from '@heroicons/vue/24/outline';\nimport { showToast } from '@/components/ToastMessage';\nexport default {\n  __name: 'ProfileAvatarCropper',\n  props: {\n    modelValue: {\n      type: Boolean,\n      required: true\n    }\n  },\n  emits: ['update:modelValue', 'upload'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const cropperRef = ref(null);\n    const imageUrl = ref('');\n    const hasImage = ref(false);\n\n    // 处理文件选择\n    const handleFileChange = event => {\n      const file = event.target.files[0];\n      if (!file) return;\n\n      // 验证文件类型\n      if (!file.type.startsWith('image/')) {\n        showToast('请选择图片文件', 'error');\n        return;\n      }\n\n      // 验证文件大小（2MB）\n      const maxSize = 2 * 1024 * 1024;\n      if (file.size > maxSize) {\n        showToast('图片大小不能超过 2MB', 'error');\n        return;\n      }\n\n      // 创建预览\n      const reader = new FileReader();\n      reader.onload = e => {\n        imageUrl.value = e.target.result;\n        hasImage.value = true;\n      };\n      reader.readAsDataURL(file);\n    };\n\n    // 处理裁剪\n    const handleCrop = async () => {\n      if (!cropperRef.value || !hasImage.value) return;\n      try {\n        // 获取裁剪后的图片 blob\n        const canvas = cropperRef.value.getCroppedCanvas({\n          width: 200,\n          height: 200,\n          imageSmoothingEnabled: true,\n          imageSmoothingQuality: 'high'\n        });\n        canvas.toBlob(async blob => {\n          // 创建文件对象\n          const file = new File([blob], 'profile_avatar.png', {\n            type: 'image/png'\n          });\n\n          // 触发上传事件\n          await emit('upload', file);\n\n          // 清理\n          clearImage();\n        }, 'image/png');\n      } catch (error) {\n        console.error('裁剪失败:', error);\n        showToast('图片处理失败，请重试', 'error');\n      }\n    };\n\n    // 关闭对话框\n    const closeDialog = () => {\n      emit('update:modelValue', false);\n      clearImage();\n    };\n\n    // 清理图片\n    const clearImage = () => {\n      imageUrl.value = '';\n      hasImage.value = false;\n    };\n\n    // 监听对话框关闭\n    watch(() => props.modelValue, newVal => {\n      if (!newVal) {\n        clearImage();\n      }\n    });\n    const __returned__ = {\n      props,\n      emit,\n      cropperRef,\n      imageUrl,\n      hasImage,\n      handleFileChange,\n      handleCrop,\n      closeDialog,\n      clearImage,\n      ref,\n      watch,\n      get VueCropper() {\n        return VueCropper;\n      },\n      get Dialog() {\n        return Dialog;\n      },\n      get DialogPanel() {\n        return DialogPanel;\n      },\n      get DialogTitle() {\n        return DialogTitle;\n      },\n      get TransitionChild() {\n        return TransitionChild;\n      },\n      get TransitionRoot() {\n        return TransitionRoot;\n      },\n      get InformationCircleIcon() {\n        return InformationCircleIcon;\n      },\n      get showToast() {\n        return showToast;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","VueCropper","Dialog","DialogPanel","DialogTitle","TransitionChild","TransitionRoot","InformationCircleIcon","showToast","props","__props","emit","__emit","cropperRef","imageUrl","hasImage","handleFileChange","event","file","target","files","type","startsWith","maxSize","size","reader","FileReader","onload","e","value","result","readAsDataURL","handleCrop","canvas","getCroppedCanvas","width","height","imageSmoothingEnabled","imageSmoothingQuality","toBlob","blob","File","clearImage","error","console","closeDialog","modelValue","newVal"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/components/ProfileAvatarCropper.vue"],"sourcesContent":["<template>\n  <TransitionRoot appear :show=\"modelValue\" as=\"template\">\n    <Dialog as=\"div\" class=\"relative z-50\" @close=\"closeDialog\">\n      <TransitionChild\n        as=\"template\"\n        enter=\"duration-300 ease-out\"\n        enter-from=\"opacity-0\"\n        enter-to=\"opacity-100\"\n        leave=\"duration-200 ease-in\"\n        leave-from=\"opacity-100\"\n        leave-to=\"opacity-0\"\n      >\n        <div class=\"fixed inset-0 bg-black/25\" />\n      </TransitionChild>\n\n      <div class=\"fixed inset-0 overflow-y-auto\">\n        <div class=\"flex min-h-full items-center justify-center p-4 text-center\">\n          <TransitionChild\n            as=\"template\"\n            enter=\"duration-300 ease-out\"\n            enter-from=\"opacity-0 scale-95\"\n            enter-to=\"opacity-100 scale-100\"\n            leave=\"duration-200 ease-in\"\n            leave-from=\"opacity-100 scale-100\"\n            leave-to=\"opacity-0 scale-95\"\n          >\n            <DialogPanel class=\"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all\">\n              <DialogTitle as=\"h3\" class=\"text-lg font-medium leading-6 text-gray-900\">\n                上传职业头像\n              </DialogTitle>\n\n              <!-- 提示信息 -->\n              <div class=\"mt-2 p-4 bg-blue-50 rounded-lg\">\n                <div class=\"flex\">\n                  <div class=\"flex-shrink-0\">\n                    <InformationCircleIcon class=\"h-5 w-5 text-blue-400\" />\n                  </div>\n                  <div class=\"ml-3\">\n                    <p class=\"text-sm text-blue-700\">\n                      一张专业的职业头像能让您的简历更加出众：\n                    </p>\n                    <ul class=\"mt-2 text-sm text-blue-600 list-disc list-inside\">\n                      <li>建议使用正面照，保持微笑</li>\n                      <li>着装整洁得体，背景简单</li>\n                      <li>光线充足，图片清晰</li>\n                    </ul>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"mt-4\">\n                <div class=\"flex flex-col items-center\">\n                  <!-- 裁剪区域 -->\n                  <div class=\"relative w-full h-64 mb-4 bg-gray-100 rounded-lg overflow-hidden\">\n                    <vue-cropper\n                      ref=\"cropperRef\"\n                      :src=\"imageUrl\"\n                      :aspect-ratio=\"1\"\n                      :view-mode=\"1\"\n                      :guide-lines=\"true\"\n                      :background=\"true\"\n                      :rotatable=\"false\"\n                      :zoomable=\"true\"\n                      :movable=\"true\"\n                      :auto-crop-area=\"0.8\"\n                      drag-mode=\"move\"\n                      preview=\".preview\"\n                    />\n                  </div>\n\n                  <!-- 预览区域 -->\n                  <div class=\"preview w-24 h-24 rounded-full overflow-hidden border-2 border-gray-200 mb-4\"></div>\n\n                  <!-- 上传按钮 -->\n                  <label class=\"cursor-pointer inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\">\n                    <input\n                      type=\"file\"\n                      class=\"hidden\"\n                      accept=\"image/*\"\n                      @change=\"handleFileChange\"\n                    >\n                    选择图片\n                  </label>\n                </div>\n              </div>\n\n              <div class=\"mt-6 flex justify-end space-x-3\">\n                <button\n                  type=\"button\"\n                  class=\"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50\"\n                  @click=\"closeDialog\"\n                >\n                  取消\n                </button>\n                <button\n                  type=\"button\"\n                  class=\"inline-flex justify-center rounded-md border border-transparent bg-primary-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primary-700\"\n                  :disabled=\"!hasImage\"\n                  @click=\"handleCrop\"\n                >\n                  确认上传\n                </button>\n              </div>\n            </DialogPanel>\n          </TransitionChild>\n        </div>\n      </div>\n    </Dialog>\n  </TransitionRoot>\n</template>\n\n<script setup>\nimport { ref, watch } from 'vue'\nimport VueCropper from 'vue-cropperjs'\nimport 'cropperjs/dist/cropper.css'\nimport {\n  Dialog,\n  DialogPanel,\n  DialogTitle,\n  TransitionChild,\n  TransitionRoot,\n} from '@headlessui/vue'\nimport { InformationCircleIcon } from '@heroicons/vue/24/outline'\nimport { showToast } from '@/components/ToastMessage'\n\nconst props = defineProps({\n  modelValue: {\n    type: Boolean,\n    required: true\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'upload'])\n\nconst cropperRef = ref(null)\nconst imageUrl = ref('')\nconst hasImage = ref(false)\n\n// 处理文件选择\nconst handleFileChange = (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n\n  // 验证文件类型\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return\n  }\n\n  // 验证文件大小（2MB）\n  const maxSize = 2 * 1024 * 1024\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过 2MB', 'error')\n    return\n  }\n\n  // 创建预览\n  const reader = new FileReader()\n  reader.onload = (e) => {\n    imageUrl.value = e.target.result\n    hasImage.value = true\n  }\n  reader.readAsDataURL(file)\n}\n\n// 处理裁剪\nconst handleCrop = async () => {\n  if (!cropperRef.value || !hasImage.value) return\n  \n  try {\n    // 获取裁剪后的图片 blob\n    const canvas = cropperRef.value.getCroppedCanvas({\n      width: 200,\n      height: 200,\n      imageSmoothingEnabled: true,\n      imageSmoothingQuality: 'high'\n    })\n\n    canvas.toBlob(async (blob) => {\n      // 创建文件对象\n      const file = new File([blob], 'profile_avatar.png', { type: 'image/png' })\n      \n      // 触发上传事件\n      await emit('upload', file)\n      \n      // 清理\n      clearImage()\n    }, 'image/png')\n  } catch (error) {\n    console.error('裁剪失败:', error)\n    showToast('图片处理失败，请重试', 'error')\n  }\n}\n\n// 关闭对话框\nconst closeDialog = () => {\n  emit('update:modelValue', false)\n  clearImage()\n}\n\n// 清理图片\nconst clearImage = () => {\n  imageUrl.value = ''\n  hasImage.value = false\n}\n\n// 监听对话框关闭\nwatch(() => props.modelValue, (newVal) => {\n  if (!newVal) {\n    clearImage()\n  }\n})\n</script>\n\n<style>\n.preview {\n  overflow: hidden;\n  box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1);\n}\n</style> "],"mappings":"AAgHA,SAASA,GAAG,EAAEC,KAAK,QAAQ,KAAI;AAC/B,OAAOC,UAAU,MAAM,eAAc;AACrC,OAAO,4BAA2B;AAClC,SACEC,MAAM,EACNC,WAAW,EACXC,WAAW,EACXC,eAAe,EACfC,cAAc,QACT,iBAAgB;AACvB,SAASC,qBAAqB,QAAQ,2BAA0B;AAChE,SAASC,SAAS,QAAQ,2BAA0B;;;;;;;;;;;;;;;IAEpD,MAAMC,KAAK,GAAGC,OAAA;IAOd,MAAMC,IAAI,GAAGC,MAAA;IAEb,MAAMC,UAAU,GAAGd,GAAG,CAAC,IAAI;IAC3B,MAAMe,QAAQ,GAAGf,GAAG,CAAC,EAAE;IACvB,MAAMgB,QAAQ,GAAGhB,GAAG,CAAC,KAAK;;IAE1B;IACA,MAAMiB,gBAAgB,GAAIC,KAAK,IAAK;MAClC,MAAMC,IAAI,GAAGD,KAAK,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC;MACjC,IAAI,CAACF,IAAI,EAAE;;MAEX;MACA,IAAI,CAACA,IAAI,CAACG,IAAI,CAACC,UAAU,CAAC,QAAQ,CAAC,EAAE;QACnCd,SAAS,CAAC,SAAS,EAAE,OAAO;QAC5B;MACF;;MAEA;MACA,MAAMe,OAAO,GAAG,CAAC,GAAG,IAAI,GAAG,IAAG;MAC9B,IAAIL,IAAI,CAACM,IAAI,GAAGD,OAAO,EAAE;QACvBf,SAAS,CAAC,cAAc,EAAE,OAAO;QACjC;MACF;;MAEA;MACA,MAAMiB,MAAM,GAAG,IAAIC,UAAU,CAAC;MAC9BD,MAAM,CAACE,MAAM,GAAIC,CAAC,IAAK;QACrBd,QAAQ,CAACe,KAAK,GAAGD,CAAC,CAACT,MAAM,CAACW,MAAK;QAC/Bf,QAAQ,CAACc,KAAK,GAAG,IAAG;MACtB;MACAJ,MAAM,CAACM,aAAa,CAACb,IAAI;IAC3B;;IAEA;IACA,MAAMc,UAAU,GAAG,MAAAA,CAAA,KAAY;MAC7B,IAAI,CAACnB,UAAU,CAACgB,KAAK,IAAI,CAACd,QAAQ,CAACc,KAAK,EAAE;MAE1C,IAAI;QACF;QACA,MAAMI,MAAM,GAAGpB,UAAU,CAACgB,KAAK,CAACK,gBAAgB,CAAC;UAC/CC,KAAK,EAAE,GAAG;UACVC,MAAM,EAAE,GAAG;UACXC,qBAAqB,EAAE,IAAI;UAC3BC,qBAAqB,EAAE;QACzB,CAAC;QAEDL,MAAM,CAACM,MAAM,CAAC,MAAOC,IAAI,IAAK;UAC5B;UACA,MAAMtB,IAAI,GAAG,IAAIuB,IAAI,CAAC,CAACD,IAAI,CAAC,EAAE,oBAAoB,EAAE;YAAEnB,IAAI,EAAE;UAAY,CAAC;;UAEzE;UACA,MAAMV,IAAI,CAAC,QAAQ,EAAEO,IAAI;;UAEzB;UACAwB,UAAU,CAAC;QACb,CAAC,EAAE,WAAW;MAChB,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,OAAO,EAAEA,KAAK;QAC5BnC,SAAS,CAAC,YAAY,EAAE,OAAO;MACjC;IACF;;IAEA;IACA,MAAMqC,WAAW,GAAGA,CAAA,KAAM;MACxBlC,IAAI,CAAC,mBAAmB,EAAE,KAAK;MAC/B+B,UAAU,CAAC;IACb;;IAEA;IACA,MAAMA,UAAU,GAAGA,CAAA,KAAM;MACvB5B,QAAQ,CAACe,KAAK,GAAG,EAAC;MAClBd,QAAQ,CAACc,KAAK,GAAG,KAAI;IACvB;;IAEA;IACA7B,KAAK,CAAC,MAAMS,KAAK,CAACqC,UAAU,EAAGC,MAAM,IAAK;MACxC,IAAI,CAACA,MAAM,EAAE;QACXL,UAAU,CAAC;MACb;IACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}