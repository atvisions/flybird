{"ast":null,"code":"import _objectSpread from \"/Users/liuzhao/Documents/Projects/flybird/flybird-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { defineStore } from 'pinia';\nimport profile from '@/api/profile';\nimport { ref, computed } from 'vue';\nexport const useProfileStore = defineStore('profile', () => {\n  const basicInfo = ref(null);\n  const avatarUpdateTime = ref(null);\n  const profileAvatar = computed(() => basicInfo.value?.avatar || null);\n\n  // 更新档案头像\n  function updateProfileAvatar(avatarUrl) {\n    if (basicInfo.value) {\n      basicInfo.value = _objectSpread(_objectSpread({}, basicInfo.value), {}, {\n        avatar: avatarUrl\n      });\n      avatarUpdateTime.value = Date.now();\n    }\n  }\n\n  // 获取档案基本信息\n  async function fetchBasicInfo() {\n    try {\n      console.log('Fetching basic info...');\n      const response = await profile.getData();\n      console.log('Full response:', response);\n      console.log('Response data structure:', {\n        code: response.data.code,\n        data: response.data.data,\n        basic_info: response.data.data.basic_info\n      });\n      if (response?.data?.code === 200 && response?.data?.data?.basic_info) {\n        console.log('Previous basicInfo:', basicInfo.value);\n        const newBasicInfo = _objectSpread(_objectSpread({}, response.data.data.basic_info), {}, {\n          avatar: response.data.data.basic_info.avatar ? `${import.meta.env.VITE_API_URL}${response.data.data.basic_info.avatar}` : null\n        });\n        console.log('Raw new basic info:', newBasicInfo);\n        basicInfo.value = newBasicInfo;\n        console.log('New basicInfo after update:', basicInfo.value);\n        avatarUpdateTime.value = Date.now();\n        console.log('Updated timestamp:', avatarUpdateTime.value);\n        console.log('Store state after update:', {\n          basicInfo: basicInfo.value,\n          avatarUpdateTime: avatarUpdateTime.value,\n          profileAvatar: profileAvatar.value\n        });\n        window.dispatchEvent(new CustomEvent('profile-updated'));\n        return basicInfo.value;\n      }\n      return null;\n    } catch (error) {\n      console.error('获取档案基本信息失败:', error);\n      throw error;\n    }\n  }\n  return {\n    basicInfo,\n    avatarUpdateTime,\n    profileAvatar,\n    updateProfileAvatar,\n    fetchBasicInfo\n  };\n});","map":{"version":3,"names":["defineStore","profile","ref","computed","useProfileStore","basicInfo","avatarUpdateTime","profileAvatar","value","avatar","updateProfileAvatar","avatarUrl","_objectSpread","Date","now","fetchBasicInfo","console","log","response","getData","code","data","basic_info","newBasicInfo","import","meta","env","VITE_API_URL","window","dispatchEvent","CustomEvent","error"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/profile.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport profile from '@/api/profile'\nimport { ref, computed } from 'vue'\n\nexport const useProfileStore = defineStore('profile', () => {\n  const basicInfo = ref(null)\n  const avatarUpdateTime = ref(null)\n\n  const profileAvatar = computed(() => basicInfo.value?.avatar || null)\n\n  // 更新档案头像\n  function updateProfileAvatar(avatarUrl) {\n    if (basicInfo.value) {\n      basicInfo.value = {\n        ...basicInfo.value,\n        avatar: avatarUrl\n      }\n      avatarUpdateTime.value = Date.now()\n    }\n  }\n\n  // 获取档案基本信息\n  async function fetchBasicInfo() {\n    try {\n      console.log('Fetching basic info...')\n      const response = await profile.getData()\n      console.log('Full response:', response)\n      console.log('Response data structure:', {\n        code: response.data.code,\n        data: response.data.data,\n        basic_info: response.data.data.basic_info\n      })\n      if (response?.data?.code === 200 && response?.data?.data?.basic_info) {\n        console.log('Previous basicInfo:', basicInfo.value)\n        const newBasicInfo = {\n          ...response.data.data.basic_info,\n          avatar: response.data.data.basic_info.avatar ? \n            `${import.meta.env.VITE_API_URL}${response.data.data.basic_info.avatar}` : null\n        }\n        console.log('Raw new basic info:', newBasicInfo)\n        \n        basicInfo.value = newBasicInfo\n        \n        console.log('New basicInfo after update:', basicInfo.value)\n        avatarUpdateTime.value = Date.now()\n        console.log('Updated timestamp:', avatarUpdateTime.value)\n        console.log('Store state after update:', {\n          basicInfo: basicInfo.value,\n          avatarUpdateTime: avatarUpdateTime.value,\n          profileAvatar: profileAvatar.value\n        })\n        \n        window.dispatchEvent(new CustomEvent('profile-updated'))\n        \n        return basicInfo.value\n      }\n      return null\n    } catch (error) {\n      console.error('获取档案基本信息失败:', error)\n      throw error\n    }\n  }\n\n  return {\n    basicInfo,\n    avatarUpdateTime,\n    profileAvatar,\n    updateProfileAvatar,\n    fetchBasicInfo\n  }\n}) "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}