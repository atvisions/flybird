{"ast":null,"code":"import { ref, computed, onMounted, onUnmounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { showToast } from '@/components/ToastMessage';\nimport { useDeleteAccount } from '@/composables/useDeleteAccount';\nimport { usePhone } from '@/composables/usePhone';\nimport { useEmail } from '@/composables/useEmail';\nimport { useChangePassword } from '@/composables/useChangePassword';\nimport { ElMessageBox } from 'element-plus';\nimport { account } from '@/api/account';\nimport { useAuthStore } from '@/stores/auth';\nimport { useUserStore } from '@/stores/user';\nexport default {\n  __name: 'AccountSettings',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const authStore = useAuthStore();\n    const userStore = useUserStore();\n\n    // No changes to passwordFormState, maskPhone, phone, email, showEmailModal, showPhoneModal, showPasswordModal, showDeleteConfirm, showPassword, openEmailModal, closeEmailModal, openPhoneModal, closePhoneModal, openPasswordModal, closePasswordModal, openDeleteConfirm, closeDeleteConfirm, emailManager, phoneManager, { validatePassword }, { loading }, isRequestingCode, isCodeButtonDisabled, emailRegex, startEmailCountdown, onUnmounted, userInfo, userInfoLoading, fetchUserInfo, validateForm, isPhoneFormValid, showUnbindEmailModal, unbindEmailLoading, unbindEmailForm, handleUnbindEmail, closeUnbindEmailModal, confirmUnbindEmail, strengthText, strengthTextClass, strengthColorClass, handlePasswordUpdate, isEmailFormValid, handleEmailUpdate\n\n    // 处理邮箱更新的验证码发送\n    const handleEmailSendCode = async () => {\n      console.log('Current state:', {\n        email: emailManager.state.value,\n        password: emailManager.state.password,\n        loading: emailManager.state.loading,\n        countdown: emailManager.state.countdown\n      });\n      if (!emailManager.state.value) {\n        showToast('请输入新邮箱', 'warning');\n        return;\n      }\n      if (!emailManager.state.password) {\n        showToast('请输入登录密码', 'warning');\n        return;\n      }\n\n      // 验证邮箱格式\n      if (!emailRegex.test(emailManager.state.value)) {\n        showToast('请输入正确的邮箱格式', 'warning');\n        return;\n      }\n      try {\n        emailManager.state.loading = true;\n        const response = await account.sendEmailCode({\n          email: emailManager.state.value,\n          password: emailManager.state.password.trim()\n        });\n        if (response?.data?.message) {\n          showToast(response.data.message, 'success');\n          emailManager.state.countdown = 60;\n          startEmailCountdown();\n        }\n      } catch (error) {\n        const errorMsg = error.response?.data?.detail || error.message || '发送验证码失败';\n        showToast(errorMsg, 'error');\n      } finally {\n        emailManager.state.loading = false;\n      }\n    };\n\n    // No changes to rest of the script section\n\n    const __returned__ = {\n      router,\n      authStore,\n      userStore,\n      handleEmailSendCode,\n      ref,\n      computed,\n      onMounted,\n      onUnmounted,\n      get useRouter() {\n        return useRouter;\n      },\n      get showToast() {\n        return showToast;\n      },\n      get useDeleteAccount() {\n        return useDeleteAccount;\n      },\n      get usePhone() {\n        return usePhone;\n      },\n      get useEmail() {\n        return useEmail;\n      },\n      get useChangePassword() {\n        return useChangePassword;\n      },\n      get ElMessageBox() {\n        return ElMessageBox;\n      },\n      get account() {\n        return account;\n      },\n      get useAuthStore() {\n        return useAuthStore;\n      },\n      get useUserStore() {\n        return useUserStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","onUnmounted","useRouter","showToast","useDeleteAccount","usePhone","useEmail","useChangePassword","ElMessageBox","account","useAuthStore","useUserStore","router","authStore","userStore","handleEmailSendCode","console","log","email","emailManager","state","value","password","loading","countdown","emailRegex","test","response","sendEmailCode","trim","data","message","startEmailCountdown","error","errorMsg","detail"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/AccountSettings.vue"],"sourcesContent":["<template>\n  <!-- No changes to template section -->\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, onUnmounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { showToast } from '@/components/ToastMessage'\nimport { useDeleteAccount } from '@/composables/useDeleteAccount'\nimport { usePhone } from '@/composables/usePhone'\nimport { useEmail } from '@/composables/useEmail'\nimport { useChangePassword } from '@/composables/useChangePassword'\nimport { ElMessageBox } from 'element-plus'\nimport { account } from '@/api/account'\nimport { useAuthStore } from '@/stores/auth'\nimport { useUserStore } from '@/stores/user'\n\nconst router = useRouter()\nconst authStore = useAuthStore()\nconst userStore = useUserStore()\n\n// No changes to passwordFormState, maskPhone, phone, email, showEmailModal, showPhoneModal, showPasswordModal, showDeleteConfirm, showPassword, openEmailModal, closeEmailModal, openPhoneModal, closePhoneModal, openPasswordModal, closePasswordModal, openDeleteConfirm, closeDeleteConfirm, emailManager, phoneManager, { validatePassword }, { loading }, isRequestingCode, isCodeButtonDisabled, emailRegex, startEmailCountdown, onUnmounted, userInfo, userInfoLoading, fetchUserInfo, validateForm, isPhoneFormValid, showUnbindEmailModal, unbindEmailLoading, unbindEmailForm, handleUnbindEmail, closeUnbindEmailModal, confirmUnbindEmail, strengthText, strengthTextClass, strengthColorClass, handlePasswordUpdate, isEmailFormValid, handleEmailUpdate\n\n// 处理邮箱更新的验证码发送\nconst handleEmailSendCode = async () => {\n  console.log('Current state:', {\n    email: emailManager.state.value,\n    password: emailManager.state.password,\n    loading: emailManager.state.loading,\n    countdown: emailManager.state.countdown\n  })\n\n  if (!emailManager.state.value) {\n    showToast('请输入新邮箱', 'warning')\n    return\n  }\n  \n  if (!emailManager.state.password) {\n    showToast('请输入登录密码', 'warning')\n    return\n  }\n  \n  // 验证邮箱格式\n  if (!emailRegex.test(emailManager.state.value)) {\n    showToast('请输入正确的邮箱格式', 'warning')\n    return\n  }\n  \n  try {\n    emailManager.state.loading = true\n    const response = await account.sendEmailCode({\n      email: emailManager.state.value,\n      password: emailManager.state.password.trim()\n    })\n    \n    if (response?.data?.message) {\n      showToast(response.data.message, 'success')\n      emailManager.state.countdown = 60\n      startEmailCountdown()\n    }\n  } catch (error) {\n    const errorMsg = error.response?.data?.detail || \n                    error.message || \n                    '发送验证码失败'\n    showToast(errorMsg, 'error')\n  } finally {\n    emailManager.state.loading = false\n  }\n}\n\n// No changes to rest of the script section\n</script>\n\n<style scoped>\n/* No changes to style section */\n</style>"],"mappings":"AAKA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,SAAS,EAAEC,WAAW,QAAQ,KAAI;AAC1D,SAASC,SAAS,QAAQ,YAAW;AACrC,SAASC,SAAS,QAAQ,2BAA0B;AACpD,SAASC,gBAAgB,QAAQ,gCAA+B;AAChE,SAASC,QAAQ,QAAQ,wBAAuB;AAChD,SAASC,QAAQ,QAAQ,wBAAuB;AAChD,SAASC,iBAAiB,QAAQ,iCAAgC;AAClE,SAASC,YAAY,QAAQ,cAAa;AAC1C,SAASC,OAAO,QAAQ,eAAc;AACtC,SAASC,YAAY,QAAQ,eAAc;AAC3C,SAASC,YAAY,QAAQ,eAAc;;;;;;;IAE3C,MAAMC,MAAM,GAAGV,SAAS,CAAC;IACzB,MAAMW,SAAS,GAAGH,YAAY,CAAC;IAC/B,MAAMI,SAAS,GAAGH,YAAY,CAAC;;IAE/B;;IAEA;IACA,MAAMI,mBAAmB,GAAG,MAAAA,CAAA,KAAY;MACtCC,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAE;QAC5BC,KAAK,EAAEC,YAAY,CAACC,KAAK,CAACC,KAAK;QAC/BC,QAAQ,EAAEH,YAAY,CAACC,KAAK,CAACE,QAAQ;QACrCC,OAAO,EAAEJ,YAAY,CAACC,KAAK,CAACG,OAAO;QACnCC,SAAS,EAAEL,YAAY,CAACC,KAAK,CAACI;MAChC,CAAC;MAED,IAAI,CAACL,YAAY,CAACC,KAAK,CAACC,KAAK,EAAE;QAC7BlB,SAAS,CAAC,QAAQ,EAAE,SAAS;QAC7B;MACF;MAEA,IAAI,CAACgB,YAAY,CAACC,KAAK,CAACE,QAAQ,EAAE;QAChCnB,SAAS,CAAC,SAAS,EAAE,SAAS;QAC9B;MACF;;MAEA;MACA,IAAI,CAACsB,UAAU,CAACC,IAAI,CAACP,YAAY,CAACC,KAAK,CAACC,KAAK,CAAC,EAAE;QAC9ClB,SAAS,CAAC,YAAY,EAAE,SAAS;QACjC;MACF;MAEA,IAAI;QACFgB,YAAY,CAACC,KAAK,CAACG,OAAO,GAAG,IAAG;QAChC,MAAMI,QAAQ,GAAG,MAAMlB,OAAO,CAACmB,aAAa,CAAC;UAC3CV,KAAK,EAAEC,YAAY,CAACC,KAAK,CAACC,KAAK;UAC/BC,QAAQ,EAAEH,YAAY,CAACC,KAAK,CAACE,QAAQ,CAACO,IAAI,CAAC;QAC7C,CAAC;QAED,IAAIF,QAAQ,EAAEG,IAAI,EAAEC,OAAO,EAAE;UAC3B5B,SAAS,CAACwB,QAAQ,CAACG,IAAI,CAACC,OAAO,EAAE,SAAS;UAC1CZ,YAAY,CAACC,KAAK,CAACI,SAAS,GAAG,EAAC;UAChCQ,mBAAmB,CAAC;QACtB;MACF,CAAC,CAAC,OAAOC,KAAK,EAAE;QACd,MAAMC,QAAQ,GAAGD,KAAK,CAACN,QAAQ,EAAEG,IAAI,EAAEK,MAAM,IAC7BF,KAAK,CAACF,OAAO,IACb,SAAQ;QACxB5B,SAAS,CAAC+B,QAAQ,EAAE,OAAO;MAC7B,CAAC,SAAS;QACRf,YAAY,CAACC,KAAK,CAACG,OAAO,GAAG,KAAI;MACnC;IACF;;IAEA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}