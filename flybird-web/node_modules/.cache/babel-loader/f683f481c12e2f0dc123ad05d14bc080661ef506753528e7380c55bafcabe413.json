{"ast":null,"code":"import { ref } from 'vue';\nimport { CameraIcon, XMarkIcon, InformationCircleIcon } from '@heroicons/vue/24/outline';\nimport { Cropper } from 'vue-advanced-cropper';\nimport 'vue-advanced-cropper/dist/style.css';\nexport default {\n  __name: 'AvatarUploadDialog',\n  props: {\n    modelValue: Boolean,\n    loading: Boolean\n  },\n  emits: ['update:modelValue', 'upload'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const fileInput = ref(null);\n    const selectedFile = ref(null);\n    const previewUrl = ref(null);\n    const cropperRef = ref(null);\n    const createPreview = file => {\n      if (previewUrl.value) {\n        URL.revokeObjectURL(previewUrl.value);\n      }\n      if (file) {\n        previewUrl.value = URL.createObjectURL(file);\n      }\n    };\n    const triggerFileInput = () => {\n      fileInput.value?.click();\n    };\n    const handleFileChange = event => {\n      const file = event.target.files[0];\n      if (file && file.type.startsWith('image/')) {\n        selectedFile.value = file;\n        createPreview(file);\n      } else {\n        console.error('无效的文件类型:', file?.type);\n      }\n    };\n    const handleDrop = event => {\n      const file = event.dataTransfer.files[0];\n      if (file && file.type.startsWith('image/')) {\n        selectedFile.value = file;\n        createPreview(file);\n      }\n    };\n    const resetFile = () => {\n      selectedFile.value = null;\n      if (previewUrl.value) {\n        URL.revokeObjectURL(previewUrl.value);\n        previewUrl.value = null;\n      }\n      if (fileInput.value) {\n        fileInput.value.value = '';\n      }\n    };\n    const handleCropUpload = async () => {\n      if (!cropperRef.value || !selectedFile.value) return;\n      try {\n        const {\n          canvas\n        } = cropperRef.value.getResult();\n\n        // 将 canvas 转换为 blob\n        const blob = await new Promise(resolve => {\n          canvas.toBlob(resolve, 'image/png');\n        });\n        if (!blob) throw new Error('Failed to create blob');\n\n        // 创建文件对象\n        const fileName = selectedFile.value.name.replace(/\\.[^/.]+$/, '') + '.png';\n        const croppedFile = new File([blob], fileName, {\n          type: 'image/png'\n        });\n\n        // 发送文件\n        emit('upload', croppedFile);\n      } catch (error) {\n        console.error('裁切失败:', error);\n      }\n    };\n    const close = () => {\n      selectedFile.value = null;\n      if (previewUrl.value) {\n        URL.revokeObjectURL(previewUrl.value);\n        previewUrl.value = null;\n      }\n      emit('update:modelValue', false);\n    };\n    const __returned__ = {\n      props,\n      emit,\n      fileInput,\n      selectedFile,\n      previewUrl,\n      cropperRef,\n      createPreview,\n      triggerFileInput,\n      handleFileChange,\n      handleDrop,\n      resetFile,\n      handleCropUpload,\n      close,\n      ref,\n      get CameraIcon() {\n        return CameraIcon;\n      },\n      get XMarkIcon() {\n        return XMarkIcon;\n      },\n      get InformationCircleIcon() {\n        return InformationCircleIcon;\n      },\n      get Cropper() {\n        return Cropper;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","CameraIcon","XMarkIcon","InformationCircleIcon","Cropper","props","__props","emit","__emit","fileInput","selectedFile","previewUrl","cropperRef","createPreview","file","value","URL","revokeObjectURL","createObjectURL","triggerFileInput","click","handleFileChange","event","target","files","type","startsWith","console","error","handleDrop","dataTransfer","resetFile","handleCropUpload","canvas","getResult","blob","Promise","resolve","toBlob","Error","fileName","name","replace","croppedFile","File","close"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/dialogs/AvatarUploadDialog.vue"],"sourcesContent":["<template>\n  <div v-if=\"modelValue\" class=\"modal-overlay\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h3>上传头像</h3>\n        <button class=\"close-btn\" @click=\"close\">\n          <XMarkIcon class=\"w-5 h-5\" />\n        </button>\n      </div>\n      \n      <div class=\"modal-body\">\n        <!-- 提示信息 -->\n        <div class=\"tips-box mb-4\">\n          <div class=\"flex items-start space-x-2\">\n            <InformationCircleIcon class=\"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5\" />\n            <div class=\"text-sm text-gray-600\">\n              <p class=\"font-medium text-gray-900 mb-1\">上传要求：</p>\n              <ul class=\"list-disc list-inside space-y-1\">\n                <li>请上传您的真实证件照</li>\n                <li>照片需要清晰、正面、免冠</li>\n                <li>建议尺寸 400x400 像素</li>\n                <li>支持 jpg、png 格式</li>\n              </ul>\n            </div>\n          </div>\n        </div>\n\n        <!-- 文件选择区域 -->\n        <div v-if=\"!selectedFile\" class=\"upload-area\">\n          <input\n            ref=\"fileInput\"\n            type=\"file\"\n            accept=\"image/*\"\n            class=\"hidden\"\n            @change=\"handleFileChange\"\n          />\n          <div\n            class=\"drop-zone\"\n            @click=\"triggerFileInput\"\n            @drop.prevent=\"handleDrop\"\n            @dragover.prevent\n          >\n            <div class=\"text-center\">\n              <CameraIcon class=\"w-8 h-8 mx-auto text-gray-400\" />\n              <p class=\"mt-2 text-sm text-gray-500\">点击或拖拽图片到此处上传</p>\n            </div>\n          </div>\n        </div>\n\n        <!-- 裁切区域 -->\n        <div v-else class=\"cropper-container\">\n          <Cropper\n            ref=\"cropperRef\"\n            class=\"cropper\"\n            :src=\"previewUrl\"\n            :stencil-props=\"{\n              aspectRatio: 1,\n              minWidth: 400,\n              minHeight: 400\n            }\"\n            :default-size=\"{\n              width: 400,\n              height: 400\n            }\"\n            image-restriction=\"stencil\"\n            :default-boundaries=\"{ width: '100%', height: 400 }\"\n          />\n          <!-- 重新选择按钮 -->\n          <button \n            @click=\"resetFile\"\n            class=\"absolute top-2 right-2 px-2 py-1 text-xs bg-white/80 hover:bg-white text-gray-700 rounded shadow-sm transition-colors\"\n          >\n            重新选择\n          </button>\n        </div>\n      </div>\n\n      <div class=\"modal-footer\">\n        <button \n          class=\"btn btn-default\" \n          @click=\"close\"\n          :disabled=\"loading\"\n        >\n          取消\n        </button>\n        <button \n          class=\"btn btn-primary\" \n          @click=\"handleCropUpload\"\n          :disabled=\"!selectedFile || loading\"\n        >\n          {{ loading ? '上传中...' : '确认' }}\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { CameraIcon, XMarkIcon, InformationCircleIcon } from '@heroicons/vue/24/outline'\nimport { Cropper } from 'vue-advanced-cropper'\nimport 'vue-advanced-cropper/dist/style.css'\n\nconst props = defineProps({\n  modelValue: Boolean,\n  loading: Boolean\n})\n\nconst emit = defineEmits(['update:modelValue', 'upload'])\n\nconst fileInput = ref(null)\nconst selectedFile = ref(null)\nconst previewUrl = ref(null)\nconst cropperRef = ref(null)\n\nconst createPreview = (file) => {\n  if (previewUrl.value) {\n    URL.revokeObjectURL(previewUrl.value)\n  }\n  if (file) {\n    previewUrl.value = URL.createObjectURL(file)\n  }\n}\n\nconst triggerFileInput = () => {\n  fileInput.value?.click()\n}\n\nconst handleFileChange = (event) => {\n  const file = event.target.files[0]\n  if (file && file.type.startsWith('image/')) {\n    selectedFile.value = file\n    createPreview(file)\n  } else {\n    console.error('无效的文件类型:', file?.type)\n  }\n}\n\nconst handleDrop = (event) => {\n  const file = event.dataTransfer.files[0]\n  if (file && file.type.startsWith('image/')) {\n    selectedFile.value = file\n    createPreview(file)\n  }\n}\n\nconst resetFile = () => {\n  selectedFile.value = null\n  if (previewUrl.value) {\n    URL.revokeObjectURL(previewUrl.value)\n    previewUrl.value = null\n  }\n  if (fileInput.value) {\n    fileInput.value.value = ''\n  }\n}\n\nconst handleCropUpload = async () => {\n  if (!cropperRef.value || !selectedFile.value) return\n  \n  try {\n    const { canvas } = cropperRef.value.getResult()\n    \n    // 将 canvas 转换为 blob\n    const blob = await new Promise(resolve => {\n      canvas.toBlob(resolve, 'image/png')\n    })\n    \n    if (!blob) throw new Error('Failed to create blob')\n    \n    // 创建文件对象\n    const fileName = selectedFile.value.name.replace(/\\.[^/.]+$/, '') + '.png'\n    const croppedFile = new File([blob], fileName, { type: 'image/png' })\n    \n    // 发送文件\n    emit('upload', croppedFile)\n    \n  } catch (error) {\n    console.error('裁切失败:', error)\n  }\n}\n\nconst close = () => {\n  selectedFile.value = null\n  if (previewUrl.value) {\n    URL.revokeObjectURL(previewUrl.value)\n    previewUrl.value = null\n  }\n  emit('update:modelValue', false)\n}\n</script>\n\n<style scoped>\n.modal-overlay {\n  position: fixed;\n  inset: 0;\n  background-color: rgba(0, 0, 0, 0.3);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 50;\n}\n\n.modal-content {\n  position: relative;\n  width: 91.666667%;\n  max-width: 28rem;\n  background-color: white;\n  border-radius: 0.5rem;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n}\n\n.modal-header {\n  padding: 1rem 1.5rem;\n  background-color: #f9fafb;\n  border-bottom: 1px solid #e5e7eb;\n  border-top-left-radius: 0.5rem;\n  border-top-right-radius: 0.5rem;\n}\n\n.modal-header h3 {\n  margin: 0;\n  color: #111827;\n  font-size: 1.125rem;\n  font-weight: 500;\n}\n\n.modal-body {\n  padding: 1.5rem;\n}\n\n.modal-footer {\n  padding: 1rem 1.5rem;\n  background-color: #f9fafb;\n  border-top: 1px solid #e5e7eb;\n  border-bottom-left-radius: 0.5rem;\n  border-bottom-right-radius: 0.5rem;\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.75rem;\n}\n\n.btn {\n  padding: 0.5rem 1rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  border-radius: 0.375rem;\n  transition: all 0.15s ease-in-out;\n}\n\n.btn-default {\n  color: #374151;\n  background-color: white;\n  border: 1px solid #d1d5db;\n}\n\n.btn-default:not(:disabled):hover {\n  background-color: #f9fafb;\n}\n\n.btn-primary {\n  color: white;\n  background-color: #6366f1;\n  border: 1px solid transparent;\n}\n\n.btn-primary:not(:disabled):hover {\n  background-color: #4f46e5;\n}\n\n.btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.close-btn {\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  padding: 0.25rem;\n  color: #6b7280;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  transition: color 0.15s ease-in-out;\n}\n\n.close-btn:hover {\n  color: #374151;\n}\n\n.drop-zone {\n  border: 2px dashed #e5e7eb;\n  border-radius: 0.5rem;\n  padding: 2rem;\n  cursor: pointer;\n  transition: all 0.2s;\n  min-height: 200px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.drop-zone:hover {\n  border-color: #6366f1;\n  background-color: #f9fafb;\n}\n\n.cropper-container {\n  position: relative;\n  width: 100%;\n  height: 400px;\n  background-color: #f3f4f6;\n  border-radius: 0.5rem;\n  overflow: hidden;\n}\n\n.tips-box {\n  background-color: #f8fafc;\n  border: 1px solid #e2e8f0;\n  border-radius: 0.5rem;\n  padding: 1rem;\n}\n\n/* vue-advanced-cropper 样式 */\n.cropper {\n  height: 400px;\n  background-color: #f3f4f6;\n}\n\n/* 确保裁切区域正常显示 */\n:deep(.vue-advanced-cropper) {\n  background-color: #f3f4f6;\n}\n\n:deep(.vue-advanced-cropper__background) {\n  background-color: #f3f4f6;\n}\n\n:deep(.vue-advanced-cropper__foreground) {\n  border-radius: 0.5rem;\n  overflow: hidden;\n}\n\n:deep(.vue-advanced-cropper__stencil-wrapper) {\n  outline: none !important;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}