{"ast":null,"code":"import { ref, watch } from 'vue';\nimport { Dialog, DialogPanel, DialogTitle, TransitionChild, TransitionRoot } from '@headlessui/vue';\nimport { UserIcon } from '@heroicons/vue/24/outline';\nimport { showToast } from '@/components/ToastMessage';\nexport default {\n  __name: 'ProfileAvatarUpload',\n  props: {\n    modelValue: {\n      type: Boolean,\n      required: true\n    }\n  },\n  emits: ['update:modelValue', 'upload'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const selectedFile = ref(null);\n    const previewUrl = ref(null);\n\n    // 处理文件选择\n    const handleFileChange = event => {\n      const file = event.target.files[0];\n      if (!file) return;\n\n      // 验证文件类型\n      if (!file.type.startsWith('image/')) {\n        showToast('请选择图片文件', 'error');\n        return;\n      }\n\n      // 验证文件大小（例如限制为 2MB）\n      const maxSize = 2 * 1024 * 1024;\n      if (file.size > maxSize) {\n        showToast('图片大小不能超过 2MB', 'error');\n        return;\n      }\n      selectedFile.value = file;\n      previewUrl.value = URL.createObjectURL(file);\n    };\n\n    // 处理上传\n    const handleUpload = async () => {\n      if (!selectedFile.value) return;\n      try {\n        // 触发上传事件\n        await emit('upload', selectedFile.value);\n        // 清理预览\n        clearPreview();\n        // 关闭对话框\n        closeDialog();\n      } catch (error) {\n        console.error('上传失败:', error);\n        // 保持对话框打开，让用户可以重试\n      }\n    };\n\n    // 关闭对话框\n    const closeDialog = () => {\n      emit('update:modelValue', false);\n      clearPreview();\n    };\n\n    // 清理预览\n    const clearPreview = () => {\n      if (previewUrl.value) {\n        URL.revokeObjectURL(previewUrl.value);\n      }\n      selectedFile.value = null;\n      previewUrl.value = null;\n    };\n\n    // 监听对话框关闭\n    watch(() => props.modelValue, newVal => {\n      if (!newVal) {\n        clearPreview();\n      }\n    });\n    const __returned__ = {\n      props,\n      emit,\n      selectedFile,\n      previewUrl,\n      handleFileChange,\n      handleUpload,\n      closeDialog,\n      clearPreview,\n      ref,\n      watch,\n      get Dialog() {\n        return Dialog;\n      },\n      get DialogPanel() {\n        return DialogPanel;\n      },\n      get DialogTitle() {\n        return DialogTitle;\n      },\n      get TransitionChild() {\n        return TransitionChild;\n      },\n      get TransitionRoot() {\n        return TransitionRoot;\n      },\n      get UserIcon() {\n        return UserIcon;\n      },\n      get showToast() {\n        return showToast;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","Dialog","DialogPanel","DialogTitle","TransitionChild","TransitionRoot","UserIcon","showToast","props","__props","emit","__emit","selectedFile","previewUrl","handleFileChange","event","file","target","files","type","startsWith","maxSize","size","value","URL","createObjectURL","handleUpload","clearPreview","closeDialog","error","console","revokeObjectURL","modelValue","newVal"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/components/ProfileAvatarUpload.vue"],"sourcesContent":["<template>\n  <TransitionRoot appear :show=\"modelValue\" as=\"template\">\n    <Dialog as=\"div\" class=\"relative z-50\" @close=\"closeDialog\">\n      <TransitionChild\n        as=\"template\"\n        enter=\"duration-300 ease-out\"\n        enter-from=\"opacity-0\"\n        enter-to=\"opacity-100\"\n        leave=\"duration-200 ease-in\"\n        leave-from=\"opacity-100\"\n        leave-to=\"opacity-0\"\n      >\n        <div class=\"fixed inset-0 bg-black/25\" />\n      </TransitionChild>\n\n      <div class=\"fixed inset-0 overflow-y-auto\">\n        <div class=\"flex min-h-full items-center justify-center p-4 text-center\">\n          <TransitionChild\n            as=\"template\"\n            enter=\"duration-300 ease-out\"\n            enter-from=\"opacity-0 scale-95\"\n            enter-to=\"opacity-100 scale-100\"\n            leave=\"duration-200 ease-in\"\n            leave-from=\"opacity-100 scale-100\"\n            leave-to=\"opacity-0 scale-95\"\n          >\n            <DialogPanel class=\"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all\">\n              <DialogTitle as=\"h3\" class=\"text-lg font-medium leading-6 text-gray-900\">\n                上传职业头像\n              </DialogTitle>\n\n              <div class=\"mt-4\">\n                <div class=\"flex flex-col items-center\">\n                  <!-- 预览区域 -->\n                  <div class=\"relative w-48 h-48 mb-4 overflow-hidden rounded-full\">\n                    <img\n                      v-if=\"previewUrl\"\n                      :src=\"previewUrl\"\n                      class=\"w-full h-full object-cover\"\n                      alt=\"头像预览\"\n                    />\n                    <div v-else class=\"w-full h-full bg-gray-100 flex items-center justify-center\">\n                      <UserIcon class=\"w-12 h-12 text-gray-400\" />\n                    </div>\n                  </div>\n\n                  <!-- 上传按钮 -->\n                  <label class=\"cursor-pointer inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\">\n                    <input\n                      type=\"file\"\n                      class=\"hidden\"\n                      accept=\"image/*\"\n                      @change=\"handleFileChange\"\n                    >\n                    选择图片\n                  </label>\n\n                  <p class=\"mt-2 text-sm text-gray-500\">\n                    支持 JPG、PNG 格式，建议尺寸 200x200 像素\n                  </p>\n                </div>\n              </div>\n\n              <div class=\"mt-6 flex justify-end space-x-3\">\n                <button\n                  type=\"button\"\n                  class=\"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n                  @click=\"closeDialog\"\n                >\n                  取消\n                </button>\n                <button\n                  type=\"button\"\n                  class=\"inline-flex justify-center rounded-md border border-transparent bg-primary-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n                  :disabled=\"!selectedFile\"\n                  @click=\"handleUpload\"\n                >\n                  确认上传\n                </button>\n              </div>\n            </DialogPanel>\n          </TransitionChild>\n        </div>\n      </div>\n    </Dialog>\n  </TransitionRoot>\n</template>\n\n<script setup>\nimport { ref, watch } from 'vue'\nimport {\n  Dialog,\n  DialogPanel,\n  DialogTitle,\n  TransitionChild,\n  TransitionRoot,\n} from '@headlessui/vue'\nimport { UserIcon } from '@heroicons/vue/24/outline'\nimport { showToast } from '@/components/ToastMessage'\n\nconst props = defineProps({\n  modelValue: {\n    type: Boolean,\n    required: true\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'upload'])\n\nconst selectedFile = ref(null)\nconst previewUrl = ref(null)\n\n// 处理文件选择\nconst handleFileChange = (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n\n  // 验证文件类型\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return\n  }\n\n  // 验证文件大小（例如限制为 2MB）\n  const maxSize = 2 * 1024 * 1024\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过 2MB', 'error')\n    return\n  }\n\n  selectedFile.value = file\n  previewUrl.value = URL.createObjectURL(file)\n}\n\n// 处理上传\nconst handleUpload = async () => {\n  if (!selectedFile.value) return\n  \n  try {\n    // 触发上传事件\n    await emit('upload', selectedFile.value)\n    // 清理预览\n    clearPreview()\n    // 关闭对话框\n    closeDialog()\n  } catch (error) {\n    console.error('上传失败:', error)\n    // 保持对话框打开，让用户可以重试\n  }\n}\n\n// 关闭对话框\nconst closeDialog = () => {\n  emit('update:modelValue', false)\n  clearPreview()\n}\n\n// 清理预览\nconst clearPreview = () => {\n  if (previewUrl.value) {\n    URL.revokeObjectURL(previewUrl.value)\n  }\n  selectedFile.value = null\n  previewUrl.value = null\n}\n\n// 监听对话框关闭\nwatch(() => props.modelValue, (newVal) => {\n  if (!newVal) {\n    clearPreview()\n  }\n})\n</script> "],"mappings":"AAyFA,SAASA,GAAG,EAAEC,KAAK,QAAQ,KAAI;AAC/B,SACEC,MAAM,EACNC,WAAW,EACXC,WAAW,EACXC,eAAe,EACfC,cAAc,QACT,iBAAgB;AACvB,SAASC,QAAQ,QAAQ,2BAA0B;AACnD,SAASC,SAAS,QAAQ,2BAA0B;;;;;;;;;;;;;;;IAEpD,MAAMC,KAAK,GAAGC,OAAA;IAOd,MAAMC,IAAI,GAAGC,MAAA;IAEb,MAAMC,YAAY,GAAGb,GAAG,CAAC,IAAI;IAC7B,MAAMc,UAAU,GAAGd,GAAG,CAAC,IAAI;;IAE3B;IACA,MAAMe,gBAAgB,GAAIC,KAAK,IAAK;MAClC,MAAMC,IAAI,GAAGD,KAAK,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC;MACjC,IAAI,CAACF,IAAI,EAAE;;MAEX;MACA,IAAI,CAACA,IAAI,CAACG,IAAI,CAACC,UAAU,CAAC,QAAQ,CAAC,EAAE;QACnCb,SAAS,CAAC,SAAS,EAAE,OAAO;QAC5B;MACF;;MAEA;MACA,MAAMc,OAAO,GAAG,CAAC,GAAG,IAAI,GAAG,IAAG;MAC9B,IAAIL,IAAI,CAACM,IAAI,GAAGD,OAAO,EAAE;QACvBd,SAAS,CAAC,cAAc,EAAE,OAAO;QACjC;MACF;MAEAK,YAAY,CAACW,KAAK,GAAGP,IAAG;MACxBH,UAAU,CAACU,KAAK,GAAGC,GAAG,CAACC,eAAe,CAACT,IAAI;IAC7C;;IAEA;IACA,MAAMU,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI,CAACd,YAAY,CAACW,KAAK,EAAE;MAEzB,IAAI;QACF;QACA,MAAMb,IAAI,CAAC,QAAQ,EAAEE,YAAY,CAACW,KAAK;QACvC;QACAI,YAAY,CAAC;QACb;QACAC,WAAW,CAAC;MACd,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,OAAO,EAAEA,KAAK;QAC5B;MACF;IACF;;IAEA;IACA,MAAMD,WAAW,GAAGA,CAAA,KAAM;MACxBlB,IAAI,CAAC,mBAAmB,EAAE,KAAK;MAC/BiB,YAAY,CAAC;IACf;;IAEA;IACA,MAAMA,YAAY,GAAGA,CAAA,KAAM;MACzB,IAAId,UAAU,CAACU,KAAK,EAAE;QACpBC,GAAG,CAACO,eAAe,CAAClB,UAAU,CAACU,KAAK;MACtC;MACAX,YAAY,CAACW,KAAK,GAAG,IAAG;MACxBV,UAAU,CAACU,KAAK,GAAG,IAAG;IACxB;;IAEA;IACAvB,KAAK,CAAC,MAAMQ,KAAK,CAACwB,UAAU,EAAGC,MAAM,IAAK;MACxC,IAAI,CAACA,MAAM,EAAE;QACXN,YAAY,CAAC;MACf;IACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}