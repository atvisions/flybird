{"ast":null,"code":"import { defineStore } from 'pinia';\nimport { user } from '@/api/user';\nexport const useUserStore = defineStore('user', {\n  state: () => ({\n    userInfo: null,\n    isLoadingUserInfo: false,\n    lastUserInfoFetch: null\n  }),\n  getters: {\n    userId: state => state.userInfo?.id,\n    username: state => state.userInfo?.username,\n    phone: state => state.userInfo?.phone,\n    email: state => state.userInfo?.email\n  },\n  actions: {\n    async getUserInfo() {\n      if (this.isLoadingUserInfo) return;\n      const now = Date.now();\n      if (this.userInfo && this.lastUserInfoFetch && now - this.lastUserInfoFetch < 5 * 60 * 1000) {\n        return this.userInfo;\n      }\n      try {\n        this.isLoadingUserInfo = true;\n        const response = await user.getUserInfo();\n        if (response?.data?.code === 200) {\n          this.userInfo = response.data.data;\n          this.lastUserInfoFetch = now;\n          return this.userInfo;\n        }\n        return null;\n      } catch (error) {\n        console.error('Get user info failed:', error);\n        throw error;\n      } finally {\n        this.isLoadingUserInfo = false;\n      }\n    },\n    clearUserInfo() {\n      this.userInfo = null;\n      this.lastUserInfoFetch = null;\n      // 清除相关的 localStorage 数据\n      localStorage.removeItem('userInfo');\n      localStorage.removeItem('lastUserInfoFetch');\n    }\n  }\n});","map":{"version":3,"names":["defineStore","user","useUserStore","state","userInfo","isLoadingUserInfo","lastUserInfoFetch","getters","userId","id","username","phone","email","actions","getUserInfo","now","Date","response","data","code","error","console","clearUserInfo","localStorage","removeItem"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/user.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { user } from '@/api/user'\n\nexport const useUserStore = defineStore('user', {\n  state: () => ({\n    userInfo: null,\n    isLoadingUserInfo: false,\n    lastUserInfoFetch: null\n  }),\n\n  getters: {\n    userId: (state) => state.userInfo?.id,\n    username: (state) => state.userInfo?.username,\n    phone: (state) => state.userInfo?.phone,\n    email: (state) => state.userInfo?.email\n  },\n\n  actions: {\n    async getUserInfo() {\n      if (this.isLoadingUserInfo) return\n      \n      const now = Date.now()\n      if (this.userInfo && this.lastUserInfoFetch && \n          (now - this.lastUserInfoFetch) < 5 * 60 * 1000) {\n        return this.userInfo\n      }\n\n      try {\n        this.isLoadingUserInfo = true\n        const response = await user.getUserInfo()\n        if (response?.data?.code === 200) {\n          this.userInfo = response.data.data\n          this.lastUserInfoFetch = now\n          return this.userInfo\n        }\n        return null\n      } catch (error) {\n        console.error('Get user info failed:', error)\n        throw error\n      } finally {\n        this.isLoadingUserInfo = false\n      }\n    },\n\n    clearUserInfo() {\n      this.userInfo = null\n      this.lastUserInfoFetch = null\n      // 清除相关的 localStorage 数据\n      localStorage.removeItem('userInfo')\n      localStorage.removeItem('lastUserInfoFetch')\n    }\n  }\n}) "],"mappings":"AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,SAASC,IAAI,QAAQ,YAAY;AAEjC,OAAO,MAAMC,YAAY,GAAGF,WAAW,CAAC,MAAM,EAAE;EAC9CG,KAAK,EAAEA,CAAA,MAAO;IACZC,QAAQ,EAAE,IAAI;IACdC,iBAAiB,EAAE,KAAK;IACxBC,iBAAiB,EAAE;EACrB,CAAC,CAAC;EAEFC,OAAO,EAAE;IACPC,MAAM,EAAGL,KAAK,IAAKA,KAAK,CAACC,QAAQ,EAAEK,EAAE;IACrCC,QAAQ,EAAGP,KAAK,IAAKA,KAAK,CAACC,QAAQ,EAAEM,QAAQ;IAC7CC,KAAK,EAAGR,KAAK,IAAKA,KAAK,CAACC,QAAQ,EAAEO,KAAK;IACvCC,KAAK,EAAGT,KAAK,IAAKA,KAAK,CAACC,QAAQ,EAAEQ;EACpC,CAAC;EAEDC,OAAO,EAAE;IACP,MAAMC,WAAWA,CAAA,EAAG;MAClB,IAAI,IAAI,CAACT,iBAAiB,EAAE;MAE5B,MAAMU,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;MACtB,IAAI,IAAI,CAACX,QAAQ,IAAI,IAAI,CAACE,iBAAiB,IACtCS,GAAG,GAAG,IAAI,CAACT,iBAAiB,GAAI,CAAC,GAAG,EAAE,GAAG,IAAI,EAAE;QAClD,OAAO,IAAI,CAACF,QAAQ;MACtB;MAEA,IAAI;QACF,IAAI,CAACC,iBAAiB,GAAG,IAAI;QAC7B,MAAMY,QAAQ,GAAG,MAAMhB,IAAI,CAACa,WAAW,CAAC,CAAC;QACzC,IAAIG,QAAQ,EAAEC,IAAI,EAAEC,IAAI,KAAK,GAAG,EAAE;UAChC,IAAI,CAACf,QAAQ,GAAGa,QAAQ,CAACC,IAAI,CAACA,IAAI;UAClC,IAAI,CAACZ,iBAAiB,GAAGS,GAAG;UAC5B,OAAO,IAAI,CAACX,QAAQ;QACtB;QACA,OAAO,IAAI;MACb,CAAC,CAAC,OAAOgB,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;QAC7C,MAAMA,KAAK;MACb,CAAC,SAAS;QACR,IAAI,CAACf,iBAAiB,GAAG,KAAK;MAChC;IACF,CAAC;IAEDiB,aAAaA,CAAA,EAAG;MACd,IAAI,CAAClB,QAAQ,GAAG,IAAI;MACpB,IAAI,CAACE,iBAAiB,GAAG,IAAI;MAC7B;MACAiB,YAAY,CAACC,UAAU,CAAC,UAAU,CAAC;MACnCD,YAAY,CAACC,UAAU,CAAC,mBAAmB,CAAC;IAC9C;EACF;AACF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}