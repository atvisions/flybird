{"ast":null,"code":"import _objectSpread from \"/Users/liuzhao/Documents/Projects/flybird/flybird-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { createStore } from 'vuex';\nimport { STORAGE_KEYS } from '@/utils/storage';\nimport profile from '@/api/profile';\nimport request from '@/utils/request';\nimport router from '../router';\nimport { storage } from '@/utils/storage';\nimport { getExpirationInfo } from '@/utils/auth';\nimport defaultAvatar from '@/assets/images/default-avatar.png';\nimport { useUserStore } from '@/stores/user';\nexport default createStore({\n  state: {\n    basicInfo: null,\n    completeness: null,\n    isLoadingUserInfo: false,\n    lastUserInfoFetch: null\n  },\n  mutations: {\n    SET_AUTH(state, isAuthenticated) {\n      state.isAuthenticated = isAuthenticated;\n    },\n    SET_USER_INFO(state, userInfo) {\n      // 深度合并更新\n      if (state.userInfo) {\n        state.userInfo = _objectSpread(_objectSpread({}, state.userInfo), {}, {\n          code: userInfo.code,\n          message: userInfo.message,\n          data: _objectSpread(_objectSpread({}, state.userInfo.data), {}, {\n            user: _objectSpread(_objectSpread({}, state.userInfo.data?.user), userInfo.data?.user)\n          }, userInfo.data)\n        });\n      } else {\n        state.userInfo = userInfo;\n      }\n    },\n    SET_BASIC_INFO(state, basicInfo) {\n      state.basicInfo = _objectSpread(_objectSpread({}, state.basicInfo), basicInfo);\n    },\n    SET_COMPLETENESS(state, completeness) {\n      state.completeness = completeness;\n    },\n    SET_AVATAR_UPDATE_TIME(state, timestamp) {\n      state.avatarUpdateTime = timestamp;\n    },\n    SET_TOKEN(state, token) {\n      state.token = token;\n      state.isAuthenticated = !!token;\n    },\n    SET_REFRESH_TOKEN(state, refreshToken) {\n      state.refreshToken = refreshToken;\n    },\n    SET_USER(state, user) {\n      state.userInfo = user;\n    },\n    SET_LOGGED_IN(state, status) {\n      state.isAuthenticated = status;\n    },\n    SET_AUTHENTICATED(state, isAuthenticated) {\n      state.isAuthenticated = isAuthenticated;\n    },\n    CLEAR_USER_INFO(state) {\n      state.userInfo = null;\n    },\n    CLEAR_BASIC_INFO(state) {\n      state.basicInfo = null;\n    },\n    UPDATE_BASIC_INFO(state, basicInfo) {\n      if (state.userInfo?.data) {\n        state.userInfo.data.basic_info = _objectSpread(_objectSpread({}, state.userInfo.data.basic_info), basicInfo);\n      }\n    },\n    UPDATE_AVATAR(state, avatarUrl) {\n      if (state.userInfo?.data?.basic_info) {\n        state.userInfo.data.basic_info.avatar = avatarUrl;\n      }\n    },\n    UPDATE_BACKGROUND(state, backgroundUrl) {\n      if (state.userInfo?.data?.basic_info) {\n        state.userInfo.data.basic_info.background = backgroundUrl;\n      }\n    },\n    SET_LOADING_USER_INFO(state, isLoading) {\n      state.isLoadingUserInfo = isLoading;\n    },\n    SET_LAST_USER_INFO_FETCH(state, timestamp) {\n      state.lastUserInfoFetch = timestamp;\n    }\n  },\n  getters: {\n    userAvatar: state => {\n      return state.userInfo?.data?.basic_info?.avatar || defaultAvatar;\n    },\n    userName: state => {\n      return state.userInfo?.data?.basic_info?.nickname || '未设置昵称';\n    },\n    userNickname: state => {\n      return state.userInfo?.data?.basic_info?.nickname || '未设置昵称';\n    },\n    userPhone: state => {\n      return state.userInfo?.data?.basic_info?.phone;\n    },\n    profileCompleteness: state => {\n      return state.completeness || 0;\n    }\n  },\n  actions: {\n    async checkAuth({\n      commit,\n      dispatch\n    }) {\n      try {\n        const userStore = useUserStore();\n        const token = localStorage.getItem(STORAGE_KEYS.TOKEN);\n        if (!token) {\n          return false;\n        }\n        request.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        try {\n          await userStore.getUserInfo();\n          userStore.isLoggedIn = true;\n          return true;\n        } catch (error) {\n          if (error.response?.status === 401) {\n            // token 无效，尝试刷新\n            const refreshSuccess = await dispatch('refreshToken');\n            if (refreshSuccess) {\n              await userStore.getUserInfo();\n              userStore.isLoggedIn = true;\n              return true;\n            }\n          }\n          return false;\n        }\n      } catch (error) {\n        console.error('Auth check failed:', error);\n        return false;\n      }\n    },\n    async fetchUserInfo({\n      commit,\n      state\n    }) {\n      // 如果正在加载，返回\n      if (state.isLoadingUserInfo) {\n        return;\n      }\n\n      // 如果数据已经存在且在5分钟内获取过，直接返回\n      const now = Date.now();\n      if (state.userInfo && state.lastUserInfoFetch && now - state.lastUserInfoFetch < 5 * 60 * 1000) {\n        return state.userInfo;\n      }\n      try {\n        commit('SET_LOADING_USER_INFO', true);\n        const response = await user.getUserInfo();\n        if (response.data?.code === 200) {\n          commit('SET_USER_INFO', response.data);\n          commit('SET_LAST_USER_INFO_FETCH', now);\n          return response.data;\n        }\n      } catch (error) {\n        console.error('获取用户信息失败:', error);\n        throw error;\n      } finally {\n        commit('SET_LOADING_USER_INFO', false);\n      }\n    },\n    async updateBasicInfo({\n      commit\n    }, {\n      type,\n      data\n    }) {\n      try {\n        let response;\n        if (type === 'avatar') {\n          response = await profile.uploadAvatar(data);\n        } else if (type === 'background') {\n          response = await profile.uploadBackground(data);\n        } else if (type === 'basic') {\n          response = await profile.updateModule('basic_info', data);\n        } else {\n          throw new Error('未知的更新类型');\n        }\n        if (response?.data?.code === 200) {\n          if (type === 'avatar' || type === 'background') {\n            commit('SET_AVATAR_UPDATE_TIME', Date.now());\n          }\n          if (type === 'basic') {\n            commit('UPDATE_BASIC_INFO', response.data.data);\n          } else {\n            const {\n              user,\n              basic_info\n            } = response.data.data;\n            if (user) {\n              commit('SET_USER_INFO', user);\n            }\n            if (basic_info) {\n              commit('SET_BASIC_INFO', basic_info);\n            }\n          }\n          return response;\n        }\n        throw new Error(response?.data?.message || '更新失败');\n      } catch (error) {\n        console.error('Failed to update basic info:', error);\n        throw error;\n      }\n    },\n    async logout({\n      commit\n    }) {\n      try {\n        await auth.logout();\n      } catch (error) {\n        console.error('Logout failed:', error);\n      } finally {\n        // 清理状态\n        commit('SET_TOKEN', null);\n        commit('SET_REFRESH_TOKEN', null);\n        commit('SET_USER', null);\n        commit('SET_LOGGED_IN', false);\n        commit('CLEAR_USER_INFO');\n        commit('CLEAR_BASIC_INFO');\n\n        // 使用 storage 服务清除认证信息\n        storage.clearAuth();\n\n        // 清除请求头\n        delete request.defaults.headers.common['Authorization'];\n\n        // 跳转到登录页\n        router.push('/login');\n      }\n    },\n    async fetchCompleteness({\n      commit\n    }) {\n      try {\n        const response = await profile.getCompleteness();\n        if (response.data?.code === 200) {\n          commit('SET_COMPLETENESS', response.data);\n          return response.data;\n        }\n      } catch (error) {\n        console.error('获取完整度失败:', error);\n      }\n    },\n    async login({\n      commit\n    }, {\n      access,\n      refresh,\n      rememberMe = false\n    }) {\n      try {\n        // 使用 storage 服务保存认证信息，它会处理过期时间\n        storage.saveAuth({\n          access,\n          refresh\n        }, rememberMe);\n\n        // 设置请求头\n        request.defaults.headers.common['Authorization'] = `Bearer ${access}`;\n\n        // 更新 store 状态\n        commit('SET_TOKEN', access);\n        commit('SET_REFRESH_TOKEN', refresh);\n        commit('SET_LOGGED_IN', true);\n\n        // 获取用户信息\n        try {\n          const userInfoResponse = await this.dispatch('fetchUserInfo');\n          if (userInfoResponse?.data?.user && rememberMe) {\n            storage.savePhone(userInfoResponse.data.user.phone, true);\n          }\n        } catch (error) {\n          console.warn('获取用户信息失败，但不影响登录状态:', error);\n        }\n      } catch (error) {\n        console.error('登录失败:', error);\n        throw error;\n      }\n    },\n    async refreshToken({\n      commit,\n      state\n    }) {\n      try {\n        const refreshToken = localStorage.getItem(STORAGE_KEYS.REFRESH_TOKEN);\n        if (!refreshToken) {\n          throw new Error('No refresh token');\n        }\n        const response = await auth.refreshToken({\n          refresh: refreshToken\n        });\n        if (response.data?.code === 200) {\n          const {\n            access\n          } = response.data.data;\n\n          // 使用 storage 服务保存认证信息\n          // 保持原有的记住我状态\n          const rememberMe = localStorage.getItem(STORAGE_KEYS.REMEMBER_ME) === 'true';\n          storage.saveAuth({\n            access,\n            refresh: refreshToken // 保持原有的 refresh token\n          }, rememberMe);\n\n          // 更新 store 状态\n          commit('SET_TOKEN', access);\n          return true;\n        }\n        return false;\n      } catch (error) {\n        console.error('Token refresh failed:', error);\n        // 清除所有认证状态\n        commit('SET_TOKEN', null);\n        commit('SET_REFRESH_TOKEN', null);\n        commit('SET_USER', null);\n        commit('SET_LOGGED_IN', false);\n\n        // 使用 storage 服务清除认证信息\n        storage.clearAuth();\n        return false;\n      }\n    },\n    async updateAvatar({\n      commit\n    }, formData) {\n      try {\n        const response = await profile.uploadAvatar(formData);\n        if (response.data?.code === 200) {\n          const avatarUrl = response.data.data.avatar;\n          commit('UPDATE_AVATAR', avatarUrl);\n          return avatarUrl;\n        }\n        throw new Error(response.data?.message || '更新头像失败');\n      } catch (error) {\n        console.error('Failed to update avatar:', error);\n        throw error;\n      }\n    },\n    async updateBackground({\n      commit\n    }, formData) {\n      try {\n        const response = await profile.uploadBackground(formData);\n        if (response.data?.code === 200) {\n          const backgroundUrl = response.data.data.background;\n          commit('UPDATE_BACKGROUND', backgroundUrl);\n          return backgroundUrl;\n        }\n        throw new Error(response.data?.message || '更新背景图失败');\n      } catch (error) {\n        console.error('Failed to update background:', error);\n        throw error;\n      }\n    },\n    async getUserInfo({\n      commit\n    }) {\n      try {\n        const response = await user.getUserInfo();\n        if (response.data?.code === 200) {\n          commit('SET_USER_INFO', response.data);\n        }\n        return response;\n      } catch (error) {\n        console.error('获取用户信息失败:', error);\n        throw error;\n      }\n    }\n  }\n});","map":{"version":3,"names":["createStore","STORAGE_KEYS","profile","request","router","storage","getExpirationInfo","defaultAvatar","useUserStore","state","basicInfo","completeness","isLoadingUserInfo","lastUserInfoFetch","mutations","SET_AUTH","isAuthenticated","SET_USER_INFO","userInfo","_objectSpread","code","message","data","user","SET_BASIC_INFO","SET_COMPLETENESS","SET_AVATAR_UPDATE_TIME","timestamp","avatarUpdateTime","SET_TOKEN","token","SET_REFRESH_TOKEN","refreshToken","SET_USER","SET_LOGGED_IN","status","SET_AUTHENTICATED","CLEAR_USER_INFO","CLEAR_BASIC_INFO","UPDATE_BASIC_INFO","basic_info","UPDATE_AVATAR","avatarUrl","avatar","UPDATE_BACKGROUND","backgroundUrl","background","SET_LOADING_USER_INFO","isLoading","SET_LAST_USER_INFO_FETCH","getters","userAvatar","userName","nickname","userNickname","userPhone","phone","profileCompleteness","actions","checkAuth","commit","dispatch","userStore","localStorage","getItem","TOKEN","defaults","headers","common","getUserInfo","isLoggedIn","error","response","refreshSuccess","console","fetchUserInfo","now","Date","updateBasicInfo","type","uploadAvatar","uploadBackground","updateModule","Error","logout","auth","clearAuth","push","fetchCompleteness","getCompleteness","login","access","refresh","rememberMe","saveAuth","userInfoResponse","savePhone","warn","REFRESH_TOKEN","REMEMBER_ME","updateAvatar","formData","updateBackground"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/store/index.js"],"sourcesContent":["import { createStore } from 'vuex'\nimport { STORAGE_KEYS } from '@/utils/storage'\nimport profile from '@/api/profile'\nimport request from '@/utils/request'\nimport router from '../router'\nimport { storage } from '@/utils/storage'\nimport { getExpirationInfo } from '@/utils/auth'\nimport defaultAvatar from '@/assets/images/default-avatar.png'\nimport { useUserStore } from '@/stores/user'\n\nexport default createStore({\n  state: {\n    basicInfo: null,\n    completeness: null,\n    isLoadingUserInfo: false,\n    lastUserInfoFetch: null\n  },\n\n  mutations: {\n    SET_AUTH(state, isAuthenticated) {\n      state.isAuthenticated = isAuthenticated\n    },\n\n    SET_USER_INFO(state, userInfo) {\n      // 深度合并更新\n      if (state.userInfo) {\n        state.userInfo = {\n          ...state.userInfo,\n          code: userInfo.code,\n          message: userInfo.message,\n          data: {\n            ...state.userInfo.data,\n            user: {\n              ...state.userInfo.data?.user,\n              ...userInfo.data?.user\n            },\n            ...userInfo.data\n          }\n        }\n      } else {\n        state.userInfo = userInfo\n      }\n    },\n\n    SET_BASIC_INFO(state, basicInfo) {\n      state.basicInfo = {\n        ...state.basicInfo,\n        ...basicInfo\n      }\n    },\n\n    SET_COMPLETENESS(state, completeness) {\n      state.completeness = completeness\n    },\n\n    SET_AVATAR_UPDATE_TIME(state, timestamp) {\n      state.avatarUpdateTime = timestamp\n    },\n\n    SET_TOKEN(state, token) {\n      state.token = token\n      state.isAuthenticated = !!token\n    },\n\n    SET_REFRESH_TOKEN(state, refreshToken) {\n      state.refreshToken = refreshToken\n    },\n\n    SET_USER(state, user) {\n      state.userInfo = user\n    },\n\n    SET_LOGGED_IN(state, status) {\n      state.isAuthenticated = status\n    },\n\n    SET_AUTHENTICATED(state, isAuthenticated) {\n      state.isAuthenticated = isAuthenticated\n    },\n\n    CLEAR_USER_INFO(state) {\n      state.userInfo = null\n    },\n\n    CLEAR_BASIC_INFO(state) {\n      state.basicInfo = null\n    },\n\n    UPDATE_BASIC_INFO(state, basicInfo) {\n      if (state.userInfo?.data) {\n        state.userInfo.data.basic_info = {\n          ...state.userInfo.data.basic_info,\n          ...basicInfo\n        }\n      }\n    },\n\n    UPDATE_AVATAR(state, avatarUrl) {\n      if (state.userInfo?.data?.basic_info) {\n        state.userInfo.data.basic_info.avatar = avatarUrl\n      }\n    },\n\n    UPDATE_BACKGROUND(state, backgroundUrl) {\n      if (state.userInfo?.data?.basic_info) {\n        state.userInfo.data.basic_info.background = backgroundUrl\n      }\n    },\n\n    SET_LOADING_USER_INFO(state, isLoading) {\n      state.isLoadingUserInfo = isLoading\n    },\n\n    SET_LAST_USER_INFO_FETCH(state, timestamp) {\n      state.lastUserInfoFetch = timestamp\n    }\n  },\n\n  getters: {\n    userAvatar: state => {\n      return state.userInfo?.data?.basic_info?.avatar || defaultAvatar\n    },\n\n    userName: state => {\n      return state.userInfo?.data?.basic_info?.nickname || '未设置昵称'\n    },\n\n    userNickname: state => {\n      return state.userInfo?.data?.basic_info?.nickname || '未设置昵称'\n    },\n\n    userPhone: state => {\n      return state.userInfo?.data?.basic_info?.phone\n    },\n\n    profileCompleteness: state => {\n      return state.completeness || 0\n    }\n  },\n\n  actions: {\n    async checkAuth({ commit, dispatch }) {\n      try {\n        const userStore = useUserStore()\n        const token = localStorage.getItem(STORAGE_KEYS.TOKEN)\n        if (!token) {\n          return false\n        }\n\n        request.defaults.headers.common['Authorization'] = `Bearer ${token}`\n        \n        try {\n          await userStore.getUserInfo()\n          userStore.isLoggedIn = true\n          return true\n        } catch (error) {\n          if (error.response?.status === 401) {\n            // token 无效，尝试刷新\n            const refreshSuccess = await dispatch('refreshToken')\n            if (refreshSuccess) {\n              await userStore.getUserInfo()\n              userStore.isLoggedIn = true\n              return true\n            }\n          }\n          return false\n        }\n      } catch (error) {\n        console.error('Auth check failed:', error)\n        return false\n      }\n    },\n\n    async fetchUserInfo({ commit, state }) {\n      // 如果正在加载，返回\n      if (state.isLoadingUserInfo) {\n        return\n      }\n      \n      // 如果数据已经存在且在5分钟内获取过，直接返回\n      const now = Date.now()\n      if (state.userInfo && state.lastUserInfoFetch && \n          (now - state.lastUserInfoFetch) < 5 * 60 * 1000) {\n        return state.userInfo\n      }\n\n      try {\n        commit('SET_LOADING_USER_INFO', true)\n        const response = await user.getUserInfo()\n        \n        if (response.data?.code === 200) {\n          commit('SET_USER_INFO', response.data)\n          commit('SET_LAST_USER_INFO_FETCH', now)\n          return response.data\n        }\n      } catch (error) {\n        console.error('获取用户信息失败:', error)\n        throw error\n      } finally {\n        commit('SET_LOADING_USER_INFO', false)\n      }\n    },\n\n    async updateBasicInfo({ commit }, { type, data }) {\n      try {\n        let response\n        if (type === 'avatar') {\n          response = await profile.uploadAvatar(data)\n        } else if (type === 'background') {\n          response = await profile.uploadBackground(data)\n        } else if (type === 'basic') {\n          response = await profile.updateModule('basic_info', data)\n        } else {\n          throw new Error('未知的更新类型')\n        }\n\n        if (response?.data?.code === 200) {\n          if (type === 'avatar' || type === 'background') {\n            commit('SET_AVATAR_UPDATE_TIME', Date.now())\n          }\n          if (type === 'basic') {\n            commit('UPDATE_BASIC_INFO', response.data.data)\n          } else {\n            const { user, basic_info } = response.data.data\n            if (user) {\n              commit('SET_USER_INFO', user)\n            }\n            if (basic_info) {\n              commit('SET_BASIC_INFO', basic_info)\n            }\n          }\n          return response\n        }\n        throw new Error(response?.data?.message || '更新失败')\n      } catch (error) {\n        console.error('Failed to update basic info:', error)\n        throw error\n      }\n    },\n\n    async logout({ commit }) {\n      try {\n        await auth.logout()\n      } catch (error) {\n        console.error('Logout failed:', error)\n      } finally {\n        // 清理状态\n        commit('SET_TOKEN', null)\n        commit('SET_REFRESH_TOKEN', null)\n        commit('SET_USER', null)\n        commit('SET_LOGGED_IN', false)\n        commit('CLEAR_USER_INFO')\n        commit('CLEAR_BASIC_INFO')\n        \n        // 使用 storage 服务清除认证信息\n        storage.clearAuth()\n        \n        // 清除请求头\n        delete request.defaults.headers.common['Authorization']\n        \n        // 跳转到登录页\n        router.push('/login')\n      }\n    },\n\n    async fetchCompleteness({ commit }) {\n      try {\n        const response = await profile.getCompleteness()\n        if (response.data?.code === 200) {\n          commit('SET_COMPLETENESS', response.data)\n          return response.data\n        }\n      } catch (error) {\n        console.error('获取完整度失败:', error)\n      }\n    },\n\n    async login({ commit }, { access, refresh, rememberMe = false }) {\n      try {\n        // 使用 storage 服务保存认证信息，它会处理过期时间\n        storage.saveAuth({ access, refresh }, rememberMe)\n        \n        // 设置请求头\n        request.defaults.headers.common['Authorization'] = `Bearer ${access}`\n        \n        // 更新 store 状态\n        commit('SET_TOKEN', access)\n        commit('SET_REFRESH_TOKEN', refresh)\n        commit('SET_LOGGED_IN', true)\n\n        // 获取用户信息\n        try {\n          const userInfoResponse = await this.dispatch('fetchUserInfo')\n          if (userInfoResponse?.data?.user && rememberMe) {\n            storage.savePhone(userInfoResponse.data.user.phone, true)\n          }\n        } catch (error) {\n          console.warn('获取用户信息失败，但不影响登录状态:', error)\n        }\n      } catch (error) {\n        console.error('登录失败:', error)\n        throw error\n      }\n    },\n\n    async refreshToken({ commit, state }) {\n      try {\n        const refreshToken = localStorage.getItem(STORAGE_KEYS.REFRESH_TOKEN)\n        if (!refreshToken) {\n          throw new Error('No refresh token')\n        }\n\n        const response = await auth.refreshToken({ refresh: refreshToken })\n        \n        if (response.data?.code === 200) {\n          const { access } = response.data.data\n          \n          // 使用 storage 服务保存认证信息\n          // 保持原有的记住我状态\n          const rememberMe = localStorage.getItem(STORAGE_KEYS.REMEMBER_ME) === 'true'\n          storage.saveAuth({ \n            access, \n            refresh: refreshToken  // 保持原有的 refresh token\n          }, rememberMe)\n          \n          // 更新 store 状态\n          commit('SET_TOKEN', access)\n          \n          return true\n        }\n        return false\n      } catch (error) {\n        console.error('Token refresh failed:', error)\n        // 清除所有认证状态\n        commit('SET_TOKEN', null)\n        commit('SET_REFRESH_TOKEN', null)\n        commit('SET_USER', null)\n        commit('SET_LOGGED_IN', false)\n        \n        // 使用 storage 服务清除认证信息\n        storage.clearAuth()\n        \n        return false\n      }\n    },\n\n    async updateAvatar({ commit }, formData) {\n      try {\n        const response = await profile.uploadAvatar(formData)\n        if (response.data?.code === 200) {\n          const avatarUrl = response.data.data.avatar\n          commit('UPDATE_AVATAR', avatarUrl)\n          return avatarUrl\n        }\n        throw new Error(response.data?.message || '更新头像失败')\n      } catch (error) {\n        console.error('Failed to update avatar:', error)\n        throw error\n      }\n    },\n\n    async updateBackground({ commit }, formData) {\n      try {\n        const response = await profile.uploadBackground(formData)\n        if (response.data?.code === 200) {\n          const backgroundUrl = response.data.data.background\n          commit('UPDATE_BACKGROUND', backgroundUrl)\n          return backgroundUrl\n        }\n        throw new Error(response.data?.message || '更新背景图失败')\n      } catch (error) {\n        console.error('Failed to update background:', error)\n        throw error\n      }\n    },\n\n    async getUserInfo({ commit }) {\n      try {\n        const response = await user.getUserInfo()\n        if (response.data?.code === 200) {\n          commit('SET_USER_INFO', response.data)\n        }\n        return response\n      } catch (error) {\n        console.error('获取用户信息失败:', error)\n        throw error\n      }\n    }\n  }\n})"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}