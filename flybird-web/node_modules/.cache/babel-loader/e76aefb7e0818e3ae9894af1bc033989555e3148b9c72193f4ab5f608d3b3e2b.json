{"ast":null,"code":"import request from '@/utils/request';\nexport const auth = {\n  // 密码登录\n  loginWithPassword: async data => {\n    try {\n      const response = await request.post('/api/v1/users/auth/login/password/', data);\n      if (response.data?.code === 200) {\n        // 立即设置 token\n        const token = response.data.data.access;\n        if (token) {\n          request.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        }\n      }\n      return response;\n    } catch (error) {\n      console.error('Login request failed:', error);\n      throw error;\n    }\n  },\n  // 获取用户信息\n  getUserInfo() {\n    return request.get('/api/v1/users/profile/data/').then(response => {\n      // 重新组织数据结构\n      const processedData = {\n        code: response.data.code,\n        message: response.data.message,\n        data: response.data.data\n      };\n      return processedData;\n    });\n  },\n  // 退出登录\n  logout: async () => {\n    const refreshToken = localStorage.getItem('refresh_token');\n    if (!refreshToken) return;\n    try {\n      await request.post('/api/v1/users/auth/logout/', {\n        refresh: refreshToken\n      });\n    } finally {\n      // 无论请求是否成功，都清除本地存储\n      localStorage.clear();\n    }\n  },\n  // 刷新 token\n  refreshToken: data => {\n    return request.post('/api/v1/users/auth/token/refresh/', data);\n  },\n  // 更新用户名（昵称）\n  updateUsername: data => {\n    return request.post('/api/v1/users/account/username/', data);\n  },\n  // 更新密码\n  updatePassword: data => {\n    return request({\n      url: '/api/v1/users/account/password/',\n      method: 'post',\n      data\n    });\n  },\n  // 发送验证码\n  sendVerifyCode: data => {\n    return request({\n      url: '/api/v1/users/auth/sms/send/',\n      method: 'post',\n      data: {\n        phone: data.phone,\n        scene: data.scene\n      }\n    });\n  },\n  // 更换手机号\n  changePhone: data => {\n    return request.post('/api/v1/users/account/phone/', data);\n  },\n  // 删除账户\n  deleteAccount: data => {\n    return request({\n      url: '/api/v1/users/account/delete/',\n      method: 'POST',\n      data,\n      headers: {\n        'Authorization': `Bearer ${localStorage.getItem('token')}`\n      }\n    });\n  },\n  // 发送重置密码验证码\n  sendResetCode: phone => {\n    return request.post('/api/v1/users/auth/sms/send/', {\n      phone,\n      scene: 'reset_password'\n    });\n  },\n  // 重置密码\n  resetPassword: async data => {\n    return request.post('/api/v1/users/auth/password/reset/', {\n      phone: data.phone,\n      code: data.code,\n      new_password: data.new_password,\n      confirm_password: data.confirm_password\n    });\n  },\n  // 注册\n  register: async data => {\n    return request.post('/api/v1/users/auth/register/', {\n      phone: data.phone,\n      code: data.code,\n      password: data.password,\n      confirm_password: data.confirm_password\n    });\n  },\n  // 密码登录\n  passwordLogin(data) {\n    return request({\n      url: '/api/v1/users/auth/login/password/',\n      method: 'post',\n      data: {\n        account: data.account,\n        password: data.password\n      }\n    });\n  }\n};\nexport default auth;","map":{"version":3,"names":["request","auth","loginWithPassword","data","response","post","code","token","access","defaults","headers","common","error","console","getUserInfo","get","then","processedData","message","logout","refreshToken","localStorage","getItem","refresh","clear","updateUsername","updatePassword","url","method","sendVerifyCode","phone","scene","changePhone","deleteAccount","sendResetCode","resetPassword","new_password","confirm_password","register","password","passwordLogin","account"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/api/auth.js"],"sourcesContent":["import request from '@/utils/request'\n\nexport const auth = {\n  // 密码登录\n  loginWithPassword: async (data) => {\n    try {\n      const response = await request.post('/api/v1/users/auth/login/password/', data)\n      if (response.data?.code === 200) {\n        // 立即设置 token\n        const token = response.data.data.access\n        if (token) {\n          request.defaults.headers.common['Authorization'] = `Bearer ${token}`\n        }\n      }\n      return response\n    } catch (error) {\n      console.error('Login request failed:', error)\n      throw error\n    }\n  },\n  \n  // 获取用户信息\n  getUserInfo() {\n    return request.get('/api/v1/users/profile/data/')\n      .then(response => {\n        // 重新组织数据结构\n        const processedData = {\n          code: response.data.code,\n          message: response.data.message,\n          data: response.data.data\n        }\n        return processedData\n      })\n  },\n  \n  // 退出登录\n  logout: async () => {\n    const refreshToken = localStorage.getItem('refresh_token')\n    if (!refreshToken) return\n    try {\n      await request.post('/api/v1/users/auth/logout/', { refresh: refreshToken })\n    } finally {\n      // 无论请求是否成功，都清除本地存储\n      localStorage.clear()\n    }\n  },\n  \n  // 刷新 token\n  refreshToken: (data) => {\n    return request.post('/api/v1/users/auth/token/refresh/', data)\n  },\n  \n  // 更新用户名（昵称）\n  updateUsername: (data) => {\n    return request.post('/api/v1/users/account/username/', data)\n  },\n  \n  // 更新密码\n  updatePassword: (data) => {\n    return request({\n      url: '/api/v1/users/account/password/',\n      method: 'post',\n      data\n    })\n  },\n  \n  // 发送验证码\n  sendVerifyCode: (data) => {\n    return request({\n      url: '/api/v1/users/auth/sms/send/',\n      method: 'post',\n      data: {\n        phone: data.phone,\n        scene: data.scene\n      }\n    })\n  },\n  \n  // 更换手机号\n  changePhone: (data) => {\n    return request.post('/api/v1/users/account/phone/', data)\n  },\n  \n  // 删除账户\n  deleteAccount: (data) => {\n    return request({\n      url: '/api/v1/users/account/delete/',\n      method: 'POST',\n      data,\n      headers: {\n        'Authorization': `Bearer ${localStorage.getItem('token')}`\n      }\n    })\n  },\n  \n  // 发送重置密码验证码\n  sendResetCode: (phone) => {\n    return request.post('/api/v1/users/auth/sms/send/', {\n      phone,\n      scene: 'reset_password'\n    })\n  },\n  \n  // 重置密码\n  resetPassword: async (data) => {\n    return request.post('/api/v1/users/auth/password/reset/', {\n      phone: data.phone,\n      code: data.code,\n      new_password: data.new_password,\n      confirm_password: data.confirm_password\n    })\n  },\n  \n  // 注册\n  register: async (data) => {\n    return request.post('/api/v1/users/auth/register/', {\n      phone: data.phone,\n      code: data.code,\n      password: data.password,\n      confirm_password: data.confirm_password\n    })\n  },\n  \n  // 密码登录\n  passwordLogin(data) {\n    return request({\n      url: '/api/v1/users/auth/login/password/',\n      method: 'post',\n      data: {\n        account: data.account,\n        password: data.password\n      }\n    })\n  }\n}\n\nexport default auth "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}