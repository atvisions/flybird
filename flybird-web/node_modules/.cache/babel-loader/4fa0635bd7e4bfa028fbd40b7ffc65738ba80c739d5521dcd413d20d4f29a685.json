{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, resolveDynamicComponent as _resolveDynamicComponent, createTextVNode as _createTextVNode, withCtx as _withCtx, normalizeClass as _normalizeClass, withModifiers as _withModifiers, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = {\n  class: \"canvas-container\"\n};\nconst _hoisted_2 = {\n  class: \"canvas-wrapper\"\n};\nconst _hoisted_3 = {\n  class: \"layout-wrapper\"\n};\nconst _hoisted_4 = {\n  class: \"layout-actions\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"placeholder\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_v_btn = _resolveComponent(\"v-btn\");\n  const _component_v_icon = _resolveComponent(\"v-icon\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", {\n    class: \"canvas-content\",\n    style: _normalizeStyle({\n      transform: `scale(${$props.scale})`\n    }),\n    onDragover: _cache[1] || (_cache[1] = _withModifiers(() => {}, [\"prevent\"])),\n    onDrop: _withModifiers($setup.handleElementDrop, [\"prevent\"]),\n    onDragenter: _withModifiers($setup.handleDragEnter, [\"prevent\"]),\n    onDragleave: _withModifiers($setup.handleDragLeave, [\"prevent\"]),\n    onClick: _withModifiers($setup.handleCanvasClick, [\"self\"])\n  }, [_createCommentVNode(\" 设计元素列表 \"), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.elements, element => {\n    return _openBlock(), _createBlock($setup[\"DesignElement\"], {\n      key: element.id,\n      element: element,\n      \"is-selected\": $setup.selectedElement?.id === element.id,\n      scale: $props.scale,\n      onSelect: $setup.handleElementSelect,\n      onUpdate: $setup.handleElementUpdate\n    }, null, 8 /* PROPS */, [\"element\", \"is-selected\", \"scale\"]);\n  }), 128 /* KEYED_FRAGMENT */)), _createCommentVNode(\" 布局列表 \"), _createVNode($setup[\"draggable\"], {\n    modelValue: $setup.layouts,\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.layouts = $event),\n    group: {\n      name: 'layouts',\n      pull: false,\n      put: true\n    },\n    \"item-key\": \"id\",\n    class: _normalizeClass([\"canvas-drop-area\", {\n      'drag-over': $setup.isDragOver\n    }]),\n    animation: 200,\n    \"ghost-class\": \"ghost\",\n    onStart: $setup.handleDragStart,\n    onEnd: $setup.handleDragEnd,\n    onChange: $setup.handleChange\n  }, {\n    item: _withCtx(({\n      element\n    }) => [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_v_btn, {\n      icon: \"mdi-delete\",\n      size: \"small\",\n      color: \"error\",\n      variant: \"text\",\n      onClick: $event => $setup.removeLayout(element)\n    }, null, 8 /* PROPS */, [\"onClick\"])]), (_openBlock(), _createBlock(_resolveDynamicComponent($setup.getLayoutComponent(element)), {\n      config: element.config\n    }, null, 8 /* PROPS */, [\"config\"]))])]),\n    header: _withCtx(() => [$setup.layouts.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createVNode(_component_v_icon, {\n      size: \"32\",\n      class: \"mb-2\"\n    }, {\n      default: _withCtx(() => _cache[2] || (_cache[2] = [_createTextVNode(\"mdi-plus\")])),\n      _: 1 /* STABLE */\n    }), _cache[3] || (_cache[3] = _createElementVNode(\"span\", null, \"拖拽布局到此处\", -1 /* HOISTED */))])) : _createCommentVNode(\"v-if\", true)]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\", \"class\"])], 36 /* STYLE, NEED_HYDRATION */)])]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","style","_normalizeStyle","transform","$props","scale","onDragover","_cache","_withModifiers","onDrop","$setup","handleElementDrop","onDragenter","handleDragEnter","onDragleave","handleDragLeave","onClick","handleCanvasClick","_createCommentVNode","_Fragment","_renderList","elements","element","_createBlock","id","selectedElement","onSelect","handleElementSelect","onUpdate","handleElementUpdate","_createVNode","modelValue","layouts","$event","group","name","pull","put","_normalizeClass","isDragOver","animation","onStart","handleDragStart","onEnd","handleDragEnd","onChange","handleChange","item","_withCtx","_hoisted_3","_hoisted_4","_component_v_btn","icon","size","color","variant","removeLayout","_resolveDynamicComponent","getLayoutComponent","config","header","length","_hoisted_5","_component_v_icon","default","_createTextVNode","_"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/resume-editor/components/Canvas.vue"],"sourcesContent":["<template>\n  <div class=\"canvas-container\">\n    <div class=\"canvas-wrapper\">\n      <div \n        class=\"canvas-content\" \n        :style=\"{ transform: `scale(${scale})` }\"\n        @dragover.prevent\n        @drop.prevent=\"handleElementDrop\"\n        @dragenter.prevent=\"handleDragEnter\"\n        @dragleave.prevent=\"handleDragLeave\"\n        @click.self=\"handleCanvasClick\"\n      >\n        <!-- 设计元素列表 -->\n        <template v-for=\"element in elements\" :key=\"element.id\">\n          <DesignElement\n            :element=\"element\"\n            :is-selected=\"selectedElement?.id === element.id\"\n            :scale=\"scale\"\n            @select=\"handleElementSelect\"\n            @update=\"handleElementUpdate\"\n          />\n        </template>\n\n        <!-- 布局列表 -->\n        <draggable\n          v-model=\"layouts\"\n          :group=\"{ name: 'layouts', pull: false, put: true }\"\n          item-key=\"id\"\n          class=\"canvas-drop-area\"\n          :class=\"{ 'drag-over': isDragOver }\"\n          :animation=\"200\"\n          ghost-class=\"ghost\"\n          @start=\"handleDragStart\"\n          @end=\"handleDragEnd\"\n          @change=\"handleChange\"\n        >\n          <template #item=\"{ element }\">\n            <div class=\"layout-wrapper\">\n              <div class=\"layout-actions\">\n                <v-btn\n                  icon=\"mdi-delete\"\n                  size=\"small\"\n                  color=\"error\"\n                  variant=\"text\"\n                  @click=\"removeLayout(element)\"\n                ></v-btn>\n              </div>\n              <component\n                :is=\"getLayoutComponent(element)\"\n                :config=\"element.config\"\n              ></component>\n            </div>\n          </template>\n\n          <template #header>\n            <div v-if=\"layouts.length === 0\" class=\"placeholder\">\n              <v-icon size=\"32\" class=\"mb-2\">mdi-plus</v-icon>\n              <span>拖拽布局到此处</span>\n            </div>\n          </template>\n        </draggable>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport draggable from 'vuedraggable'\nimport SingleLayout from '../layouts/SingleLayout.vue'\nimport DoubleLayout from '../layouts/DoubleLayout.vue'\nimport TripleLayout from '../layouts/TripleLayout.vue'\nimport DesignElement from './DesignElement.vue'\n\nconst props = defineProps({\n  scale: {\n    type: Number,\n    default: 1\n  }\n})\n\nconst emit = defineEmits(['element-select'])\n\n// 状态\nconst layouts = ref([])\nconst isDragOver = ref(false)\nconst isDragging = ref(false)\nconst elements = ref([])\nconst selectedElement = ref(null)\n\n// 处理画布点击\nconst handleCanvasClick = (e) => {\n  if (e.target === e.currentTarget) {\n    selectedElement.value = null\n    emit('element-select', null)\n  }\n}\n\n// 处理元素选择\nconst handleElementSelect = (element) => {\n  selectedElement.value = element\n  emit('element-select', element)\n}\n\n// 处理元素更新\nconst handleElementUpdate = (updatedElement) => {\n  const index = elements.value.findIndex(el => el.id === updatedElement.id)\n  if (index > -1) {\n    elements.value[index] = { ...updatedElement }\n    if (selectedElement.value?.id === updatedElement.id) {\n      selectedElement.value = { ...updatedElement }\n    }\n  }\n}\n\n// 处理元素拖拽\nconst handleElementDrop = (event) => {\n  const elementType = event.dataTransfer.getData('element-type')\n  if (!elementType) return\n\n  try {\n    const elementConfig = JSON.parse(event.dataTransfer.getData('element-config'))\n    const rect = event.currentTarget.getBoundingClientRect()\n    const x = (event.clientX - rect.left) / props.scale\n    const y = (event.clientY - rect.top) / props.scale\n    \n    const newElement = {\n      id: Date.now().toString(),\n      type: elementType,\n      x,\n      y,\n      width: elementConfig.width || 100,\n      height: elementConfig.height || 100,\n      rotation: 0,\n      content: elementConfig.content,\n      placeholder: elementConfig.placeholder,\n      styles: elementConfig.styles || {}\n    }\n    \n    elements.value.push(newElement)\n    // 自动选中新添加的元素\n    selectedElement.value = newElement\n    emit('element-select', newElement)\n    isDragOver.value = false\n  } catch (error) {\n    console.error('处理元素拖放时出错:', error)\n  }\n}\n\n// 处理拖拽开始\nconst handleDragStart = () => {\n  isDragging.value = true\n}\n\n// 处理拖拽结束\nconst handleDragEnd = () => {\n  isDragging.value = false\n  isDragOver.value = false\n}\n\n// 处理拖拽进入\nconst handleDragEnter = (event) => {\n  event.preventDefault()\n  if (!isDragging.value) {\n    isDragOver.value = true\n  }\n}\n\n// 处理拖拽离开\nconst handleDragLeave = (event) => {\n  event.preventDefault()\n  isDragOver.value = false\n}\n\n// 处理组件变化\nconst handleChange = (event) => {\n  isDragOver.value = false\n  if (event.added) {\n    try {\n      const component = event.added.element\n      if (component.type === 'layout') {\n        const newLayout = processComponentData(component)\n        layouts.value.splice(event.added.newIndex, 1, newLayout)\n      }\n    } catch (error) {\n      console.error('Canvas - 处理组件时出错:', error)\n    }\n  } else if (event.removed) {\n    isDragOver.value = false\n  }\n}\n\n// 获取布局组件\nconst getLayoutComponent = (layout) => {\n  const layoutMap = {\n    'grid': layout.config.columns === 12 ? SingleLayout : \n           layout.config.areas.length === 2 ? DoubleLayout : TripleLayout,\n    'single': SingleLayout,\n    'double': DoubleLayout,\n    'triple': TripleLayout\n  }\n  return layoutMap[layout.config.type] || SingleLayout\n}\n\n// 处理组件数据\nconst processComponentData = (component) => {\n  return {\n    id: Date.now(),\n    type: component.type,\n    name: component.name,\n    config: {\n      ...component.config,\n      type: component.name === '单栏布局' ? 'single' : \n            component.name === '双栏布局' ? 'double' : 'triple',\n      layout: component.name === '单栏布局' ? 1 : \n             component.name === '双栏布局' ? 2 : 3,\n      styles: component.styles || {},\n      components: []\n    }\n  }\n}\n\n// 移除布局\nconst removeLayout = (layout) => {\n  const index = layouts.value.findIndex(l => l.id === layout.id)\n  if (index > -1) {\n    layouts.value.splice(index, 1)\n    isDragOver.value = false\n  }\n}\n\n// 更新布局配置\nconst updateLayoutConfig = (layoutId, config) => {\n  const layout = layouts.value.find(l => l.id === layoutId)\n  if (layout) {\n    layout.config = {\n      ...layout.config,\n      ...config\n    }\n  }\n}\n\n// 添加组件到布局\nconst addComponentToLayout = (layoutId, component, column) => {\n  const layout = layouts.value.find(l => l.id === layoutId)\n  if (layout) {\n    if (!layout.config.components) {\n      layout.config.components = []\n    }\n    layout.config.components.push({\n      id: Date.now(),\n      type: component.type,\n      name: component.name,\n      column,\n      config: component.config || {}\n    })\n  }\n}\n\n// 导出布局数据\nconst exportLayoutData = () => {\n  return {\n    layouts: layouts.value.map(layout => ({\n      id: layout.id,\n      type: layout.type,\n      name: layout.name,\n      config: layout.config\n    })),\n    elements: elements.value.map(element => ({\n      ...element,\n      dataBinding: element.dataBinding\n    }))\n  }\n}\n\n// 加载模板\nconst loadTemplate = (template, profileData) => {\n  // 加载布局\n  layouts.value = template.layouts || []\n  \n  // 加载设计元素\n  elements.value = (template.elements || []).map(element => {\n    // 如果元素有数据绑定,注入实际数据\n    if (element.dataBinding) {\n      const { field } = element.dataBinding\n      \n      // 根据元素类型设置实际内容\n      switch (element.type) {\n        case 'image':\n          element.content = profileData?.[field]\n          break\n        case 'text':\n          element.content = profileData?.[field]\n          break\n      }\n    }\n    return element\n  })\n}\n\n// 计算内边距\nconst padding = computed(() => {\n  return props.scale < 1 ? `${Math.round(38 * props.scale)}px` : '38px'\n})\n\n// 更新元素\nconst updateElement = (updatedElement) => {\n  const index = elements.value.findIndex(el => el.id === updatedElement.id)\n  if (index > -1) {\n    elements.value[index] = updatedElement\n  }\n}\n\n// 更新元素数据绑定\nconst updateElementDataBinding = (elementId, binding) => {\n  const element = elements.value.find(el => el.id === elementId)\n  if (element) {\n    element.dataBinding = binding\n    // 更新选中元素的状态\n    if (selectedElement.value?.id === elementId) {\n      selectedElement.value = { ...element }\n    }\n  }\n}\n\n// 暴露方法给父组件\ndefineExpose({\n  loadTemplate,\n  exportLayoutData,\n  updateLayoutConfig,\n  addComponentToLayout,\n  removeLayout,\n  updateElementDataBinding\n})\n</script>\n\n<style scoped>\n.canvas-container {\n  flex: 1;\n  overflow: hidden;\n  background: #f5f5f5;\n  position: relative;\n}\n\n.canvas-wrapper {\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  display: flex;\n  justify-content: center;\n  align-items: flex-start;\n  padding: 20px;\n}\n\n.canvas-content {\n  width: 794px; /* A4 纸宽度 */\n  min-height: 1123px; /* A4 纸高度 */\n  background: #ffffff;\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\n  position: relative;\n  transform-origin: top center;\n}\n\n.canvas-drop-area {\n  min-height: 100px;\n  padding: 20px;\n  border: 2px dashed #dcdfe6;\n  border-radius: 4px;\n  margin: 10px;\n  transition: all 0.3s;\n}\n\n.canvas-drop-area.drag-over {\n  border-color: #409eff;\n  background: rgba(64, 158, 255, 0.1);\n}\n\n.placeholder {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #909399;\n  font-size: 14px;\n  height: 100px;\n}\n\n.layout-wrapper {\n  position: relative;\n  margin-bottom: 10px;\n}\n\n.layout-actions {\n  position: absolute;\n  top: 4px;\n  right: 4px;\n  z-index: 1;\n  opacity: 0;\n  transition: opacity 0.3s;\n}\n\n.layout-wrapper:hover .layout-actions {\n  opacity: 1;\n}\n\n.ghost {\n  opacity: 0.5;\n  background: #c8ebfb;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}