{"ast":null,"code":"import { ref, computed, nextTick, watch, onMounted } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport defaultAvatarImage from '@/assets/images/default-avatar.png';\nimport { useStore } from 'vuex';\nimport { MEDIA_URL } from '@/config';\nimport { showToast } from '@/components/ToastMessage';\nimport { PencilIcon, PhoneIcon, EnvelopeIcon, MapPinIcon, BriefcaseIcon, ClockIcon, CurrencyYenIcon, DocumentTextIcon, CameraIcon, UserIcon, CalendarIcon, ChevronDownIcon, ChevronUpIcon, CakeIcon, PencilSquareIcon } from '@heroicons/vue/24/outline';\nimport profile from '@/api/profile';\nimport { eventBus } from '@/utils/eventBus';\nimport { Dialog, DialogPanel, DialogTitle, TransitionChild, TransitionRoot } from '@headlessui/vue';\nimport ProfileAvatarUpload from '@/components/ProfileAvatarUpload.vue';\nimport { useAccountStore } from '@/stores/account';\n\n// 1. 首先声明 props\n\nexport default {\n  __name: 'BasicInfo',\n  props: {\n    resumeData: {\n      type: Object,\n      default: () => ({})\n    },\n    loading: {\n      type: Boolean,\n      default: false\n    },\n    bioExpanded: {\n      type: Boolean,\n      default: false\n    },\n    showBioExpandButton: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: ['update', 'edit', 'toggleBioExpand'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n\n    // 2. 声明 emits\n    const emit = __emit;\n\n    // 3. 导入和初始化其他变量\n    const store = useStore();\n    const pageLoading = ref(true);\n    const basicInfo = ref({});\n\n    // 4. 计算属性\n    const formatBasicInfo = computed(() => {\n      // 优先使用父组件传入的 resumeData\n      const info = props.resumeData || {};\n      return {\n        name: info.name || info.username || '未填写',\n        // 添加 username 作为备选\n        gender: formatGender(info.gender),\n        phone: info.phone || '未填写',\n        email: info.email || '未填写',\n        location: info.location || '未填写',\n        age: calculateAge(info.birth_date) || '未填写',\n        personal_summary: info.personal_summary || '未填写'\n      };\n    });\n\n    // 添加一个 ref 来存储完整的头像 URL\n    const avatarUrl = ref('');\n\n    // 修改计算属性\n    const userAvatar = computed(() => {\n      const avatar = props.resumeData?.avatar;\n      console.log('Computing userAvatar:', {\n        avatar,\n        resumeData: props.resumeData,\n        currentUrl: avatarUrl.value\n      });\n      if (!avatar) {\n        avatarUrl.value = defaultAvatarImage;\n        return defaultAvatarImage;\n      }\n\n      // 使用 ref 来存储和返回完整的 URL\n      const fullUrl = avatar.startsWith('http') || avatar.startsWith('data:') ? avatar : `${MEDIA_URL}${avatar}`;\n      avatarUrl.value = fullUrl;\n      return avatarUrl.value;\n    });\n    const currentGender = computed(() => {\n      return props.resumeData?.gender;\n    });\n\n    // 5. 监听器\n    watch(() => props.resumeData, newVal => {\n      if (newVal && Object.keys(newVal).length > 0) {\n        pageLoading.value = false;\n      }\n    }, {\n      immediate: true\n    });\n\n    // 6. 生命周期钩子\n    onMounted(async () => {\n      try {\n        pageLoading.value = true;\n        // 不需要在这里获取数据，因为父组件会处理\n      } catch (error) {\n        console.error('初始化失败:', error);\n      } finally {\n        pageLoading.value = false;\n      }\n    });\n    onMounted(async () => {\n      try {\n        await store.dispatch('fetchCompleteness');\n      } catch (error) {\n        console.error('Failed to fetch completeness:', error);\n      }\n    });\n\n    // 7. 方法定义\n    const handleFileChange = async event => {\n      const file = event.target.files[0];\n      if (!file) return;\n\n      // 验证文件\n      if (!validateFile(file)) {\n        return;\n      }\n      await handleAvatarUpload(file);\n\n      // 清空文件选择器，以便能够选择同一个文件\n      event.target.value = '';\n    };\n    const handleEdit = () => {\n      console.log('BasicInfo handleEdit - 当前数据:', props.resumeData);\n      // 确保传递正确的数据结构\n      const editData = {\n        name: props.resumeData.name,\n        gender: props.resumeData.gender,\n        birth_date: props.resumeData.birth_date,\n        phone: props.resumeData.phone,\n        email: props.resumeData.email,\n        location: props.resumeData.location,\n        personal_summary: props.resumeData.personal_summary\n      };\n      emit('edit', 'basic_info', editData);\n    };\n    const toggleBioExpand = () => {\n      emit('toggleBioExpand');\n    };\n\n    // 8. 工具函数\n    const calculateAge = birthDate => {\n      if (!birthDate) return '';\n      const birth = new Date(birthDate);\n      const today = new Date();\n      let age = today.getFullYear() - birth.getFullYear();\n      const monthDiff = today.getMonth() - birth.getMonth();\n      if (monthDiff < 0 || monthDiff === 0 && today.getDate() < birth.getDate()) {\n        age--;\n      }\n      return `${age}岁`;\n    };\n    const formatGender = gender => {\n      const genderMap = {\n        male: '男',\n        female: '女',\n        other: '其他'\n      };\n      return genderMap[gender] || '未填写';\n    };\n    const formatDate = dateString => {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleDateString('zh-CN', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      });\n    };\n\n    // 修改头像上传处理函数\n    const handleAvatarUpload = async file => {\n      try {\n        loading.value = true;\n        console.log('开始上传职业头像:', {\n          file,\n          size: file.size,\n          type: file.type\n        });\n        const response = await profile.uploadAvatar(file);\n        console.log('职业头像上传响应:', response);\n        if (response?.data?.code === 200) {\n          const newAvatarUrl = response.data.data.avatar;\n          showToast('职业头像上传成功', 'success');\n\n          // 更新本地数据\n          if (props.resumeData) {\n            props.resumeData.avatar = newAvatarUrl;\n\n            // 触发父组件更新\n            emit('update', {\n              type: 'avatar',\n              value: newAvatarUrl\n            });\n\n            // 强制刷新图片\n            nextTick(() => {\n              // 直接更新 ref 的值，添加时间戳避免缓存\n              avatarUrl.value = `${MEDIA_URL}${newAvatarUrl}?t=${Date.now()}`;\n\n              // 预加载新图片\n              const img = new Image();\n              img.src = avatarUrl.value;\n\n              // 更新 key 强制重新渲染\n              avatarKey.value += 1;\n            });\n          }\n        } else {\n          throw new Error(response.data?.message || '上传失败');\n        }\n      } catch (error) {\n        console.error('职业头像上传失败:', error);\n        showToast(error.message || '职业头像上传失败，请稍后重试', 'error');\n      } finally {\n        loading.value = false;\n        showAvatarCropper.value = false;\n      }\n    };\n\n    // 添加图片加载错误处理\n    const handleImageError = e => {\n      e.target.src = defaultAvatarImage;\n    };\n\n    // 添加文件验证\n    const validateFile = file => {\n      // 验证文件类型\n      if (!file.type.startsWith('image/')) {\n        showToast('请选择图片文件', 'error');\n        return false;\n      }\n\n      // 验证文件大小（例如限制为 2MB）\n      const maxSize = 20 * 1024 * 1024; // 2MB\n      if (file.size > maxSize) {\n        showToast('图片大小不能超过 2MB', 'error');\n        return false;\n      }\n      return true;\n    };\n\n    // 添加状态\n    const showAvatarCropper = ref(false);\n    const avatarUploadRef = ref(null);\n    const loading = ref(false);\n\n    // 监听 resumeData 变化\n    watch(() => props.resumeData, newVal => {\n      if (newVal) {\n        // 强制更新组件\n        nextTick(() => {\n          if (props.resumeData?.avatar) {\n            const img = new Image();\n            img.src = userAvatar.value;\n          }\n        });\n      }\n    }, {\n      deep: true\n    });\n    const __returned__ = {\n      props,\n      emit,\n      store,\n      pageLoading,\n      basicInfo,\n      formatBasicInfo,\n      avatarUrl,\n      userAvatar,\n      currentGender,\n      handleFileChange,\n      handleEdit,\n      toggleBioExpand,\n      calculateAge,\n      formatGender,\n      formatDate,\n      handleAvatarUpload,\n      handleImageError,\n      validateFile,\n      showAvatarCropper,\n      avatarUploadRef,\n      loading,\n      ref,\n      computed,\n      nextTick,\n      watch,\n      onMounted,\n      get ElMessage() {\n        return ElMessage;\n      },\n      get defaultAvatarImage() {\n        return defaultAvatarImage;\n      },\n      get useStore() {\n        return useStore;\n      },\n      get MEDIA_URL() {\n        return MEDIA_URL;\n      },\n      get showToast() {\n        return showToast;\n      },\n      get PencilIcon() {\n        return PencilIcon;\n      },\n      get PhoneIcon() {\n        return PhoneIcon;\n      },\n      get EnvelopeIcon() {\n        return EnvelopeIcon;\n      },\n      get MapPinIcon() {\n        return MapPinIcon;\n      },\n      get BriefcaseIcon() {\n        return BriefcaseIcon;\n      },\n      get ClockIcon() {\n        return ClockIcon;\n      },\n      get CurrencyYenIcon() {\n        return CurrencyYenIcon;\n      },\n      get DocumentTextIcon() {\n        return DocumentTextIcon;\n      },\n      get CameraIcon() {\n        return CameraIcon;\n      },\n      get UserIcon() {\n        return UserIcon;\n      },\n      get CalendarIcon() {\n        return CalendarIcon;\n      },\n      get ChevronDownIcon() {\n        return ChevronDownIcon;\n      },\n      get ChevronUpIcon() {\n        return ChevronUpIcon;\n      },\n      get CakeIcon() {\n        return CakeIcon;\n      },\n      get PencilSquareIcon() {\n        return PencilSquareIcon;\n      },\n      get profile() {\n        return profile;\n      },\n      get eventBus() {\n        return eventBus;\n      },\n      get Dialog() {\n        return Dialog;\n      },\n      get DialogPanel() {\n        return DialogPanel;\n      },\n      get DialogTitle() {\n        return DialogTitle;\n      },\n      get TransitionChild() {\n        return TransitionChild;\n      },\n      get TransitionRoot() {\n        return TransitionRoot;\n      },\n      ProfileAvatarUpload,\n      get useAccountStore() {\n        return useAccountStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","nextTick","watch","onMounted","ElMessage","defaultAvatarImage","useStore","MEDIA_URL","showToast","PencilIcon","PhoneIcon","EnvelopeIcon","MapPinIcon","BriefcaseIcon","ClockIcon","CurrencyYenIcon","DocumentTextIcon","CameraIcon","UserIcon","CalendarIcon","ChevronDownIcon","ChevronUpIcon","CakeIcon","PencilSquareIcon","profile","eventBus","Dialog","DialogPanel","DialogTitle","TransitionChild","TransitionRoot","ProfileAvatarUpload","useAccountStore","props","__props","emit","__emit","store","pageLoading","basicInfo","formatBasicInfo","info","resumeData","name","username","gender","formatGender","phone","email","location","age","calculateAge","birth_date","personal_summary","avatarUrl","userAvatar","avatar","console","log","currentUrl","value","fullUrl","startsWith","currentGender","newVal","Object","keys","length","immediate","error","dispatch","handleFileChange","event","file","target","files","validateFile","handleAvatarUpload","handleEdit","editData","toggleBioExpand","birthDate","birth","Date","today","getFullYear","monthDiff","getMonth","getDate","genderMap","male","female","other","formatDate","dateString","date","toLocaleDateString","year","month","day","loading","size","type","response","uploadAvatar","data","code","newAvatarUrl","now","img","Image","src","avatarKey","Error","message","showAvatarCropper","handleImageError","e","maxSize","avatarUploadRef","deep"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/components/BasicInfo.vue"],"sourcesContent":["<!-- src/views/user/MyProfile/components/BasicInfo.vue -->\n<template>\n  <div class=\"bg-white rounded-lg shadow\">\n    <!-- 个人信息卡片 -->\n    <div class=\"px-6 py-6\">\n      <!-- 标题 -->\n      <div class=\"flex items-center mb-6\">\n        <UserIcon class=\"w-5 h-5 text-gray-900 mr-2\" />\n        <h2 class=\"text-base font-medium text-gray-900\">基本信息</h2>\n      </div>\n\n      <!-- 头像和基本信息 -->\n      <div class=\"flex items-start space-x-6 mb-8\">\n        <!-- 头像部分 -->\n        <div class=\"relative group\">\n          <img \n            :src=\"userAvatar\"\n            :key=\"avatarKey\"\n            class=\"w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg user-avatar\"\n            alt=\"用户头像\"\n            @error=\"handleImageError\"\n          />\n          <div \n            @click=\"showAvatarCropper = true\"\n            class=\"absolute inset-0 flex items-center justify-center rounded-full bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity duration-200\"\n          >\n            <CameraIcon class=\"w-8 h-8 text-white\" />\n          </div>\n          <!-- 性别标识 -->\n          <div class=\"absolute bottom-0 right-0 bg-white rounded-full p-1.5 shadow\">\n            <!-- 男性图标 -->\n            <svg \n              v-if=\"currentGender === 'male'\" \n              class=\"w-5 h-5 text-blue-500\" \n              viewBox=\"0 0 24 24\" \n              fill=\"none\" \n              stroke=\"currentColor\"\n            >\n              <circle cx=\"12\" cy=\"12\" r=\"5\" stroke-width=\"2\"/>\n              <path d=\"M16 8L21 3\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n              <path d=\"M21 3H16M21 3V8\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n            <!-- 女性图标 -->\n            <svg \n              v-else-if=\"currentGender === 'female'\" \n              class=\"w-5 h-5 text-pink-500\" \n              viewBox=\"0 0 24 24\" \n              fill=\"none\" \n              stroke=\"currentColor\"\n            >\n              <circle cx=\"12\" cy=\"10\" r=\"5\" stroke-width=\"2\"/>\n              <path d=\"M12 15V21\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n              <path d=\"M9 18H15\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n          </div>\n        </div>\n\n        <!-- 名字和简介 -->\n        <div class=\"flex-1\">\n          <div class=\"flex items-center justify-between\">\n            <h1 class=\"text-xl font-bold text-gray-900\">{{ formatBasicInfo.name }}</h1>\n            <button\n              @click=\"handleEdit\"\n              class=\"p-1.5 rounded-full hover:bg-gray-100 transition-colors\"\n            >\n              <PencilSquareIcon class=\"w-4 h-4 text-gray-500\" />\n            </button>\n          </div>\n          <p class=\"mt-2 text-sm text-gray-600\">{{ formatBasicInfo.personal_summary || '这个人很懒，还没有填写个人简介' }}</p>\n        </div>\n      </div>\n\n      <!-- 基本信息部分 -->\n      <div>\n        <!-- 信息网格 -->\n        <div class=\"grid grid-cols-2 gap-x-12 gap-y-4 border-t border-gray-100 pt-6\">\n          <!-- 联系方式 -->\n          <div>\n            <h2 class=\"text-xs font-medium text-gray-500 mb-3\">联系方式</h2>\n            <div class=\"flex items-center space-x-2\">\n              <PhoneIcon class=\"w-4 h-4 text-gray-400\" />\n              <span class=\"text-sm text-gray-900\">{{ formatBasicInfo.phone }}</span>\n            </div>\n            <div class=\"flex items-center space-x-2 mt-2\">\n              <EnvelopeIcon class=\"w-4 h-4 text-gray-400\" />\n              <span class=\"text-sm text-gray-900\">{{ formatBasicInfo.email }}</span>\n            </div>\n          </div>\n\n          <!-- 基本资料 -->\n          <div>\n            <h2 class=\"text-xs font-medium text-gray-500 mb-3\">基本资料</h2>\n            <div class=\"flex items-center space-x-2\">\n              <MapPinIcon class=\"w-4 h-4 text-gray-400\" />\n              <span class=\"text-sm text-gray-900\">{{ formatBasicInfo.location }}</span>\n            </div>\n            <div class=\"flex items-center space-x-2 mt-2\">\n              <CakeIcon class=\"w-4 h-4 text-gray-400\" />\n              <span class=\"text-sm text-gray-900\">{{ formatBasicInfo.age }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- 新的头像裁剪组件 -->\n  <ProfileAvatarUpload\n    ref=\"avatarUploadRef\"\n    v-model=\"showAvatarCropper\"\n    @upload=\"handleAvatarUpload\"\n  />\n\n  <div v-if=\"pageLoading\" class=\"loading-state\">\n    <!-- loading 内容 -->\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, nextTick, watch, onMounted } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport defaultAvatarImage from '@/assets/images/default-avatar.png'\nimport { useStore } from 'vuex'\nimport { MEDIA_URL } from '@/config'\nimport { showToast } from '@/components/ToastMessage'\nimport {\n  PencilIcon,\n  PhoneIcon,\n  EnvelopeIcon,\n  MapPinIcon,\n  BriefcaseIcon,\n  ClockIcon,\n  CurrencyYenIcon,\n  DocumentTextIcon,\n  CameraIcon,\n  UserIcon,\n  CalendarIcon,\n  ChevronDownIcon,\n  ChevronUpIcon,\n  CakeIcon,\n  PencilSquareIcon\n} from '@heroicons/vue/24/outline'\nimport profile from '@/api/profile'\nimport { eventBus } from '@/utils/eventBus'\nimport {\n  Dialog,\n  DialogPanel,\n  DialogTitle,\n  TransitionChild,\n  TransitionRoot\n} from '@headlessui/vue'\nimport ProfileAvatarUpload from '@/components/ProfileAvatarUpload.vue'\nimport { useAccountStore } from '@/stores/account'\n\n// 1. 首先声明 props\nconst props = defineProps({\n  resumeData: {\n    type: Object,\n    default: () => ({})\n  },\n  loading: {\n    type: Boolean,\n    default: false\n  },\n  bioExpanded: {\n    type: Boolean,\n    default: false\n  },\n  showBioExpandButton: {\n    type: Boolean,\n    default: false\n  }\n})\n\n// 2. 声明 emits\nconst emit = defineEmits(['update', 'edit', 'toggleBioExpand'])\n\n// 3. 导入和初始化其他变量\nconst store = useStore()\nconst pageLoading = ref(true)\nconst basicInfo = ref({})\n\n// 4. 计算属性\nconst formatBasicInfo = computed(() => {\n  // 优先使用父组件传入的 resumeData\n  const info = props.resumeData || {}\n  \n  return {\n    name: info.name || info.username || '未填写',  // 添加 username 作为备选\n    gender: formatGender(info.gender),\n    phone: info.phone || '未填写',\n    email: info.email || '未填写',\n    location: info.location || '未填写',\n    age: calculateAge(info.birth_date) || '未填写',\n    personal_summary: info.personal_summary || '未填写'\n  }\n})\n\n// 添加一个 ref 来存储完整的头像 URL\nconst avatarUrl = ref('')\n\n// 修改计算属性\nconst userAvatar = computed(() => {\n  const avatar = props.resumeData?.avatar\n  \n  console.log('Computing userAvatar:', {\n    avatar,\n    resumeData: props.resumeData,\n    currentUrl: avatarUrl.value\n  })\n\n  if (!avatar) {\n    avatarUrl.value = defaultAvatarImage\n    return defaultAvatarImage\n  }\n  \n  // 使用 ref 来存储和返回完整的 URL\n  const fullUrl = avatar.startsWith('http') || avatar.startsWith('data:') \n    ? avatar \n    : `${MEDIA_URL}${avatar}`\n    \n  avatarUrl.value = fullUrl\n  return avatarUrl.value\n})\n\nconst currentGender = computed(() => {\n  return props.resumeData?.gender\n})\n\n// 5. 监听器\nwatch(\n  () => props.resumeData,\n  (newVal) => {\n    if (newVal && Object.keys(newVal).length > 0) {\n      pageLoading.value = false\n    }\n  },\n  { immediate: true }\n)\n\n// 6. 生命周期钩子\nonMounted(async () => {\n  try {\n    pageLoading.value = true\n    // 不需要在这里获取数据，因为父组件会处理\n  } catch (error) {\n    console.error('初始化失败:', error)\n  } finally {\n    pageLoading.value = false\n  }\n})\n\nonMounted(async () => {\n  try {\n    await store.dispatch('fetchCompleteness')\n  } catch (error) {\n    console.error('Failed to fetch completeness:', error)\n  }\n})\n\n// 7. 方法定义\nconst handleFileChange = async (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n\n  // 验证文件\n  if (!validateFile(file)) {\n    return\n  }\n\n  await handleAvatarUpload(file)\n  \n  // 清空文件选择器，以便能够选择同一个文件\n  event.target.value = ''\n}\n\nconst handleEdit = () => {\n  console.log('BasicInfo handleEdit - 当前数据:', props.resumeData)\n  // 确保传递正确的数据结构\n  const editData = {\n    name: props.resumeData.name,\n    gender: props.resumeData.gender,\n    birth_date: props.resumeData.birth_date,\n    phone: props.resumeData.phone,\n    email: props.resumeData.email,\n    location: props.resumeData.location,\n    personal_summary: props.resumeData.personal_summary\n  }\n  emit('edit', 'basic_info', editData)\n}\n\nconst toggleBioExpand = () => {\n  emit('toggleBioExpand')\n}\n\n// 8. 工具函数\nconst calculateAge = (birthDate) => {\n  if (!birthDate) return ''\n  \n  const birth = new Date(birthDate)\n  const today = new Date()\n  \n  let age = today.getFullYear() - birth.getFullYear()\n  const monthDiff = today.getMonth() - birth.getMonth()\n  \n  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n    age--\n  }\n  \n  return `${age}岁`\n}\n\nconst formatGender = (gender) => {\n  const genderMap = {\n    male: '男',\n    female: '女',\n    other: '其他'\n  }\n  return genderMap[gender] || '未填写'\n}\n\nconst formatDate = (dateString) => {\n  if (!dateString) return ''\n  const date = new Date(dateString)\n  return date.toLocaleDateString('zh-CN', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  })\n}\n\n// 修改头像上传处理函数\nconst handleAvatarUpload = async (file) => {\n  try {\n    loading.value = true\n    console.log('开始上传职业头像:', {\n      file,\n      size: file.size,\n      type: file.type\n    })\n\n    const response = await profile.uploadAvatar(file)\n    console.log('职业头像上传响应:', response)\n\n    if (response?.data?.code === 200) {\n      const newAvatarUrl = response.data.data.avatar\n      showToast('职业头像上传成功', 'success')\n      \n      // 更新本地数据\n      if (props.resumeData) {\n        props.resumeData.avatar = newAvatarUrl\n        \n        // 触发父组件更新\n        emit('update', {\n          type: 'avatar',\n          value: newAvatarUrl\n        })\n\n        // 强制刷新图片\n        nextTick(() => {\n          // 直接更新 ref 的值，添加时间戳避免缓存\n          avatarUrl.value = `${MEDIA_URL}${newAvatarUrl}?t=${Date.now()}`\n          \n          // 预加载新图片\n          const img = new Image()\n          img.src = avatarUrl.value\n          \n          // 更新 key 强制重新渲染\n          avatarKey.value += 1\n        })\n      }\n    } else {\n      throw new Error(response.data?.message || '上传失败')\n    }\n  } catch (error) {\n    console.error('职业头像上传失败:', error)\n    showToast(error.message || '职业头像上传失败，请稍后重试', 'error')\n  } finally {\n    loading.value = false\n    showAvatarCropper.value = false\n  }\n}\n\n// 添加图片加载错误处理\nconst handleImageError = (e) => {\n  e.target.src = defaultAvatarImage\n}\n\n// 添加文件验证\nconst validateFile = (file) => {\n  // 验证文件类型\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return false\n  }\n\n  // 验证文件大小（例如限制为 2MB）\n  const maxSize = 20 * 1024 * 1024 // 2MB\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过 2MB', 'error')\n    return false\n  }\n\n  return true\n}\n\n// 添加状态\nconst showAvatarCropper = ref(false)\nconst avatarUploadRef = ref(null)\nconst loading = ref(false)\n\n// 监听 resumeData 变化\nwatch(\n  () => props.resumeData,\n  (newVal) => {\n    if (newVal) {\n      // 强制更新组件\n      nextTick(() => {\n        if (props.resumeData?.avatar) {\n          const img = new Image()\n          img.src = userAvatar.value\n        }\n      })\n    }\n  },\n  { deep: true }\n)\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}