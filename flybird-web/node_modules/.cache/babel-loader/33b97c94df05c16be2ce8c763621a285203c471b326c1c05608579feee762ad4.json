{"ast":null,"code":"import { defineStore } from 'pinia';\nimport { auth } from '@/api/auth';\nimport { account } from '@/api/account';\nexport const useUserStore = defineStore('user', {\n  state: () => ({\n    isLoggedIn: false,\n    userInfo: null,\n    rememberMe: false // 添加记住我状态\n  }),\n  actions: {\n    async login(credentials, rememberMe = false) {\n      try {\n        const response = await auth.loginWithPassword(credentials);\n        if (response?.data?.code === 200) {\n          const {\n            access,\n            refresh\n          } = response.data.data;\n\n          // 根据记住我选项设置不同的过期时间\n          const expiresIn = rememberMe ? 7 * 24 * 60 * 60 * 1000 : 24 * 60 * 60 * 1000;\n          const expiresAt = new Date().getTime() + expiresIn;\n\n          // 存储 token 和过期时间\n          localStorage.setItem('token', access);\n          localStorage.setItem('refresh_token', refresh);\n          localStorage.setItem('token_expires_at', expiresAt);\n          localStorage.setItem('remember_me', rememberMe);\n          this.isLoggedIn = true;\n          this.rememberMe = rememberMe;\n\n          // 获取用户信息\n          await this.getUserInfo();\n          return true;\n        }\n        return false;\n      } catch (error) {\n        console.error('Login failed:', error);\n        throw error;\n      }\n    },\n    async logout() {\n      try {\n        await auth.logout();\n      } finally {\n        this.clearUserData();\n      }\n    },\n    clearUserData() {\n      localStorage.removeItem('token');\n      localStorage.removeItem('refresh_token');\n      localStorage.removeItem('token_expires_at');\n      localStorage.removeItem('remember_me');\n      this.isLoggedIn = false;\n      this.userInfo = null;\n      this.rememberMe = false;\n    },\n    async getUserInfo() {\n      try {\n        const response = await account.getUserInfo();\n        if (response?.data?.code === 200) {\n          this.userInfo = response.data.data;\n          return this.userInfo;\n        }\n        return null;\n      } catch (error) {\n        console.error('Get user info failed:', error);\n        throw error;\n      }\n    },\n    // 检查 token 是否过期\n    isTokenExpired() {\n      const expiresAt = localStorage.getItem('token_expires_at');\n      if (!expiresAt) return true;\n      return new Date().getTime() > parseInt(expiresAt);\n    }\n  }\n});","map":{"version":3,"names":["defineStore","auth","account","useUserStore","state","isLoggedIn","userInfo","rememberMe","actions","login","credentials","response","loginWithPassword","data","code","access","refresh","expiresIn","expiresAt","Date","getTime","localStorage","setItem","getUserInfo","error","console","logout","clearUserData","removeItem","isTokenExpired","getItem","parseInt"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/user.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { auth } from '@/api/auth'\nimport { account } from '@/api/account'\n\nexport const useUserStore = defineStore('user', {\n  state: () => ({\n    isLoggedIn: false,\n    userInfo: null,\n    rememberMe: false  // 添加记住我状态\n  }),\n\n  actions: {\n    async login(credentials, rememberMe = false) {\n      try {\n        const response = await auth.loginWithPassword(credentials)\n        if (response?.data?.code === 200) {\n          const { access, refresh } = response.data.data\n          \n          // 根据记住我选项设置不同的过期时间\n          const expiresIn = rememberMe ? 7 * 24 * 60 * 60 * 1000 : 24 * 60 * 60 * 1000\n          const expiresAt = new Date().getTime() + expiresIn\n          \n          // 存储 token 和过期时间\n          localStorage.setItem('token', access)\n          localStorage.setItem('refresh_token', refresh)\n          localStorage.setItem('token_expires_at', expiresAt)\n          localStorage.setItem('remember_me', rememberMe)\n          \n          this.isLoggedIn = true\n          this.rememberMe = rememberMe\n          \n          // 获取用户信息\n          await this.getUserInfo()\n          return true\n        }\n        return false\n      } catch (error) {\n        console.error('Login failed:', error)\n        throw error\n      }\n    },\n\n    async logout() {\n      try {\n        await auth.logout()\n      } finally {\n        this.clearUserData()\n      }\n    },\n\n    clearUserData() {\n      localStorage.removeItem('token')\n      localStorage.removeItem('refresh_token')\n      localStorage.removeItem('token_expires_at')\n      localStorage.removeItem('remember_me')\n      this.isLoggedIn = false\n      this.userInfo = null\n      this.rememberMe = false\n    },\n\n    async getUserInfo() {\n      try {\n        const response = await account.getUserInfo()\n        if (response?.data?.code === 200) {\n          this.userInfo = response.data.data\n          return this.userInfo\n        }\n        return null\n      } catch (error) {\n        console.error('Get user info failed:', error)\n        throw error\n      }\n    },\n\n    // 检查 token 是否过期\n    isTokenExpired() {\n      const expiresAt = localStorage.getItem('token_expires_at')\n      if (!expiresAt) return true\n      return new Date().getTime() > parseInt(expiresAt)\n    }\n  }\n}) "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}