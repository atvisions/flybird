{"ast":null,"code":"import { createVNode as _createVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createBlock as _createBlock, normalizeClass as _normalizeClass, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"drop-indicator\"\n};\nconst _hoisted_2 = {\n  key: 1,\n  class: \"empty-component\"\n};\nconst _hoisted_3 = {\n  key: 2,\n  class: \"component-actions\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_button_group = _resolveComponent(\"el-button-group\");\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: _normalizeClass([\"editor-canvas\", {\n      'drag-over': $setup.isDragOver\n    }]),\n    onDragover: $setup.handleDragOver,\n    onDragleave: $setup.handleDragLeave,\n    onDrop: $setup.handleDrop\n  }, [_createElementVNode(\"div\", {\n    class: \"canvas-container\",\n    style: _normalizeStyle($setup.containerStyle)\n  }, [$setup.isDragOver ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_icon, {\n    class: \"text-3xl\"\n  }, {\n    default: _withCtx(() => [_createVNode($setup[\"Plus\"])]),\n    _: 1 /* STABLE */\n  }), _cache[1] || (_cache[1] = _createElementVNode(\"span\", null, \"释放鼠标添加组件\", -1 /* HOISTED */))])) : _createCommentVNode(\"v-if\", true), _createVNode($setup[\"GridLayout\"], {\n    layout: $setup.layoutModel,\n    \"onUpdate:layout\": _cache[0] || (_cache[0] = $event => $setup.layoutModel = $event),\n    \"col-num\": 12,\n    \"row-height\": 30,\n    \"is-draggable\": true,\n    \"is-resizable\": true,\n    \"vertical-compact\": true,\n    \"use-css-transforms\": true,\n    margin: [10, 10],\n    onLayoutUpdated: $setup.handleLayoutUpdate\n  }, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.layoutModel, item => {\n      return _openBlock(), _createBlock($setup[\"GridItem\"], {\n        key: item.i,\n        x: item.x,\n        y: item.y,\n        w: item.w,\n        h: item.h,\n        i: item.i,\n        \"min-w\": 3,\n        \"min-h\": 3,\n        \"is-draggable\": true,\n        \"is-resizable\": true,\n        class: _normalizeClass({\n          active: $setup.selectedId === item.i\n        }),\n        onClick: $event => $setup.handleSelect(item.i),\n        onResize: $setup.handleResize,\n        onMoved: $setup.handleMoved\n      }, {\n        default: _withCtx(() => [item && item.type ? (_openBlock(), _createBlock($setup[\"ComponentRenderer\"], {\n          key: 0,\n          type: item.type,\n          data: item.data,\n          styles: item.styles\n        }, null, 8 /* PROPS */, [\"type\", \"data\", \"styles\"])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createVNode(_component_el_icon, null, {\n          default: _withCtx(() => [_createVNode($setup[\"Warning\"])]),\n          _: 1 /* STABLE */\n        }), _cache[2] || (_cache[2] = _createElementVNode(\"span\", null, \"组件加载失败\", -1 /* HOISTED */))])), $setup.selectedId === item.i ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createVNode(_component_el_button_group, null, {\n          default: _withCtx(() => [_createVNode(_component_el_button, {\n            size: \"small\",\n            onClick: $event => $setup.handleMoveUp(item.i)\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n              default: _withCtx(() => [_createVNode($setup[\"ArrowUp\"])]),\n              _: 1 /* STABLE */\n            })]),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]), _createVNode(_component_el_button, {\n            size: \"small\",\n            onClick: $event => $setup.handleMoveDown(item.i)\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n              default: _withCtx(() => [_createVNode($setup[\"ArrowDown\"])]),\n              _: 1 /* STABLE */\n            })]),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]), _createVNode(_component_el_button, {\n            size: \"small\",\n            onClick: $event => $setup.handleDelete(item.i)\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n              default: _withCtx(() => [_createVNode($setup[\"Delete\"])]),\n              _: 1 /* STABLE */\n            })]),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])]),\n          _: 2 /* DYNAMIC */\n        }, 1024 /* DYNAMIC_SLOTS */)])) : _createCommentVNode(\"v-if\", true)]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"x\", \"y\", \"w\", \"h\", \"i\", \"class\", \"onClick\"]);\n    }), 128 /* KEYED_FRAGMENT */))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"layout\"])], 4 /* STYLE */)], 34 /* CLASS, NEED_HYDRATION */);\n}","map":{"version":3,"names":["key","class","_createElementBlock","_normalizeClass","$setup","isDragOver","onDragover","handleDragOver","onDragleave","handleDragLeave","onDrop","handleDrop","_createElementVNode","style","_normalizeStyle","containerStyle","_hoisted_1","_createVNode","_component_el_icon","default","_withCtx","_","_createCommentVNode","layout","layoutModel","_cache","$event","margin","onLayoutUpdated","handleLayoutUpdate","_Fragment","_renderList","item","_createBlock","i","x","y","w","h","active","selectedId","onClick","handleSelect","onResize","handleResize","onMoved","handleMoved","type","data","styles","_hoisted_2","_hoisted_3","_component_el_button_group","_component_el_button","size","handleMoveUp","handleMoveDown","handleDelete"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/template-editor/components/canvas/EditorCanvas.vue"],"sourcesContent":["<template>\n  <div \n    class=\"editor-canvas\"\n    @dragover=\"handleDragOver\"\n    @dragleave=\"handleDragLeave\"\n    @drop=\"handleDrop\"\n    :class=\"{ 'drag-over': isDragOver }\"\n  >\n    <div \n      class=\"canvas-container\"\n      :style=\"containerStyle\"\n    >\n      <div v-if=\"isDragOver\" class=\"drop-indicator\">\n        <el-icon class=\"text-3xl\"><Plus /></el-icon>\n        <span>释放鼠标添加组件</span>\n      </div>\n      \n      <GridLayout\n        v-model:layout=\"layoutModel\"\n        :col-num=\"12\"\n        :row-height=\"30\"\n        :is-draggable=\"true\"\n        :is-resizable=\"true\"\n        :vertical-compact=\"true\"\n        :use-css-transforms=\"true\"\n        :margin=\"[10, 10]\"\n        @layout-updated=\"handleLayoutUpdate\"\n      >\n        <GridItem\n          v-for=\"item in layoutModel\"\n          :key=\"item.i\"\n          :x=\"item.x\"\n          :y=\"item.y\"\n          :w=\"item.w\"\n          :h=\"item.h\"\n          :i=\"item.i\"\n          :min-w=\"3\"\n          :min-h=\"3\"\n          :is-draggable=\"true\"\n          :is-resizable=\"true\"\n          :class=\"{ active: selectedId === item.i }\"\n          @click=\"handleSelect(item.i)\"\n          @resize=\"handleResize\"\n          @moved=\"handleMoved\"\n        >\n          <template v-if=\"item && item.type\">\n            <ComponentRenderer\n              :type=\"item.type\"\n              :data=\"item.data\"\n              :styles=\"item.styles\"\n            />\n          </template>\n          <template v-else>\n            <div class=\"empty-component\">\n              <el-icon><Warning /></el-icon>\n              <span>组件加载失败</span>\n            </div>\n          </template>\n          <div class=\"component-actions\" v-if=\"selectedId === item.i\">\n            <el-button-group>\n              <el-button size=\"small\" @click=\"handleMoveUp(item.i)\">\n                <el-icon><ArrowUp /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleMoveDown(item.i)\">\n                <el-icon><ArrowDown /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleDelete(item.i)\">\n                <el-icon><Delete /></el-icon>\n              </el-button>\n            </el-button-group>\n          </div>\n        </GridItem>\n      </GridLayout>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport { GridLayout, GridItem } from 'vue-grid-layout'\nimport { ArrowUp, ArrowDown, Delete, Plus, Warning } from '@element-plus/icons-vue'\nimport ComponentRenderer from '@/template-editor/components/widgets/ComponentRenderer.vue'\n\n// 选中的组件ID\nconst selectedId = ref(null)\n\nconst props = defineProps({\n  modelValue: {\n    type: Array,\n    required: true\n  },\n  styles: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'select', 'add-component'])\n\n// 布局数据\nconst layoutModel = computed({\n  get: () => {\n    console.log('Layout model value:', props.modelValue)\n    return Array.isArray(props.modelValue) ? props.modelValue : []\n  },\n  set: (value) => {\n    console.log('Setting layout model:', value)\n    emit('update:modelValue', value)\n  }\n})\n\n// 容器样式\nconst containerStyle = computed(() => ({\n  width: '210mm', // A4 宽度\n  height: '297mm', // A4 高度\n  margin: '0 auto',\n  background: '#fff',\n  boxShadow: '0 0 10px rgba(0, 0, 0, 0.1)',\n  ...props.styles\n}))\n\n// 拖放状态\nconst isDragOver = ref(false)\n\n// 处理拖动经过\nconst handleDragOver = (event) => {\n  event.preventDefault()\n  isDragOver.value = true\n}\n\n// 处理拖动离开\nconst handleDragLeave = (event) => {\n  event.preventDefault()\n  isDragOver.value = false\n}\n\n// 处理组件拖放\nconst handleDrop = (event) => {\n  event.preventDefault()\n  isDragOver.value = false\n  \n  try {\n    const componentData = JSON.parse(event.dataTransfer.getData('text/plain'))\n    const rect = event.currentTarget.getBoundingClientRect()\n    const x = Math.floor((event.clientX - rect.left) / (rect.width / 12))\n    const y = Math.floor((event.clientY - rect.top) / 30)\n    \n    console.log('Dropping component:', componentData, 'at position:', { x, y })\n    \n    emit('add-component', {\n      ...componentData,\n      position: { x, y }\n    })\n  } catch (error) {\n    console.error('Drop error:', error)\n  }\n}\n\n// 处理组件选中\nconst handleSelect = (id) => {\n  console.log('Selecting component:', id)\n  selectedId.value = id\n  emit('select', id)\n}\n\n// 处理布局更新\nconst handleLayoutUpdate = (layout) => {\n  console.log('Layout updated:', layout)\n  emit('update:modelValue', layout)\n}\n\n// 处理组件调整大小\nconst handleResize = (i, newH, newW) => {\n  const index = layoutModel.value.findIndex(item => item.i === i)\n  if (index > -1) {\n    const updatedLayout = [...layoutModel.value]\n    updatedLayout[index] = {\n      ...updatedLayout[index],\n      h: newH,\n      w: newW\n    }\n    emit('update:modelValue', updatedLayout)\n  }\n}\n\n// 处理组件移动\nconst handleMoved = (i, newX, newY) => {\n  const index = layoutModel.value.findIndex(item => item.i === i)\n  if (index > -1) {\n    const updatedLayout = [...layoutModel.value]\n    updatedLayout[index] = {\n      ...updatedLayout[index],\n      x: newX,\n      y: newY\n    }\n    emit('update:modelValue', updatedLayout)\n  }\n}\n\n// 处理组件上移\nconst handleMoveUp = (id) => {\n  const index = layoutModel.value.findIndex(item => item.i === id)\n  if (index > 0) {\n    const updatedLayout = [...layoutModel.value]\n    const temp = { ...updatedLayout[index - 1] }\n    updatedLayout[index - 1] = { ...updatedLayout[index] }\n    updatedLayout[index] = temp\n    emit('update:modelValue', updatedLayout)\n  }\n}\n\n// 处理组件下移\nconst handleMoveDown = (id) => {\n  const index = layoutModel.value.findIndex(item => item.i === id)\n  if (index < layoutModel.value.length - 1) {\n    const updatedLayout = [...layoutModel.value]\n    const temp = { ...updatedLayout[index + 1] }\n    updatedLayout[index + 1] = { ...updatedLayout[index] }\n    updatedLayout[index] = temp\n    emit('update:modelValue', updatedLayout)\n  }\n}\n\n// 处理组件删除\nconst handleDelete = (id) => {\n  const index = layoutModel.value.findIndex(item => item.i === id)\n  if (index > -1) {\n    const updatedLayout = [...layoutModel.value]\n    updatedLayout.splice(index, 1)\n    selectedId.value = null\n    emit('update:modelValue', updatedLayout)\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.editor-canvas {\n  @apply flex-1 overflow-y-auto bg-gray-100 p-8;\n  \n  &.drag-over .canvas-container {\n    @apply ring-2 ring-blue-500 ring-opacity-50;\n  }\n  \n  .canvas-container {\n    @apply shadow-lg relative;\n    transform-origin: top center;\n    \n    // 拖放提示\n    .drop-indicator {\n      @apply absolute inset-0 flex flex-col items-center justify-center\n             bg-blue-50 bg-opacity-50 text-blue-500 pointer-events-none;\n      z-index: 100;\n    }\n  }\n  \n  .empty-component {\n    @apply flex flex-col items-center justify-center h-full\n           bg-gray-50 text-gray-400 space-y-2;\n  }\n  \n  .component-actions {\n    @apply absolute top-2 right-2 opacity-0 transition-opacity;\n  }\n  \n  .vue-grid-item {\n    &:hover .component-actions {\n      @apply opacity-100;\n    }\n    \n    &.active {\n      @apply ring-2 ring-blue-500;\n    }\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}