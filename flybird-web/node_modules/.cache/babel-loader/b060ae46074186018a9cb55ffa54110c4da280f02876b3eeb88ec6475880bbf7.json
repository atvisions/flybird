{"ast":null,"code":"import \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.some.js\";\n// frontend/src/main.js\nimport { createApp } from 'vue';\nimport { createPinia } from 'pinia';\nimport App from './App.vue';\nimport router from './router';\nimport './assets/css/input.css';\nimport { showToast } from '@/components/ToastMessage';\nimport ElementPlus from 'element-plus';\nimport 'element-plus/dist/index.css';\nimport { eventBus } from '@/utils/eventBus';\nimport VueCropper from 'vue-cropper';\nimport 'vue-cropper/dist/index.css';\nimport { useAuthStore } from '@/stores/auth';\nimport store from './store';\nimport config from './config';\nconst app = createApp(App);\nconst pinia = createPinia();\napp.use(pinia);\napp.use(ElementPlus);\napp.use(VueCropper);\napp.use(store);\n\n// 添加路由守卫\nrouter.beforeEach(async (to, from, next) => {\n  const authStore = useAuthStore();\n\n  // 检查是否需要认证\n  const requiresAuth = to.matched.some(record => record.meta.requiresAuth);\n\n  // 如果路由不需要认证，直接放行\n  if (!requiresAuth) {\n    next();\n    return;\n  }\n\n  // 如果需要认证，检查登录状态\n  if (!authStore.isLoggedIn && localStorage.getItem('token')) {\n    try {\n      await authStore.initialize();\n    } catch (error) {\n      console.error('Failed to initialize auth:', error);\n    }\n  }\n\n  // 再次检查登录状态\n  if (!authStore.isAuthenticated && requiresAuth) {\n    next({\n      path: '/login',\n      query: {\n        redirect: to.fullPath\n      }\n    });\n    return;\n  }\n  next();\n});\napp.use(router);\n\n// 添加全局配置\napp.config.globalProperties.$toast = showToast;\nwindow.$toast = showToast;\napp.config.globalProperties.eventBus = eventBus;\napp.config.globalProperties.$config = config;\n\n// 挂载应用\napp.mount('#app');","map":{"version":3,"names":["createApp","createPinia","App","router","showToast","ElementPlus","eventBus","VueCropper","useAuthStore","store","config","app","pinia","use","beforeEach","to","from","next","authStore","requiresAuth","matched","some","record","meta","isLoggedIn","localStorage","getItem","initialize","error","console","isAuthenticated","path","query","redirect","fullPath","globalProperties","$toast","window","$config","mount"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/main.js"],"sourcesContent":["// frontend/src/main.js\nimport { createApp } from 'vue'\nimport { createPinia } from 'pinia'\nimport App from './App.vue'\nimport router from './router'\nimport './assets/css/input.css'\nimport { showToast } from '@/components/ToastMessage'\nimport ElementPlus from 'element-plus'\nimport 'element-plus/dist/index.css'\nimport { eventBus } from '@/utils/eventBus'\nimport VueCropper from 'vue-cropper'\nimport 'vue-cropper/dist/index.css'\nimport { useAuthStore } from '@/stores/auth'\nimport store from './store'\nimport config from './config'\n\nconst app = createApp(App)\nconst pinia = createPinia()\napp.use(pinia)\napp.use(ElementPlus)\napp.use(VueCropper)\napp.use(store)\n\n// 添加路由守卫\nrouter.beforeEach(async (to, from, next) => {\n  const authStore = useAuthStore()\n  \n  // 检查是否需要认证\n  const requiresAuth = to.matched.some(record => record.meta.requiresAuth)\n  \n  // 如果路由不需要认证，直接放行\n  if (!requiresAuth) {\n    next()\n    return\n  }\n  \n  // 如果需要认证，检查登录状态\n  if (!authStore.isLoggedIn && localStorage.getItem('token')) {\n    try {\n      await authStore.initialize()\n    } catch (error) {\n      console.error('Failed to initialize auth:', error)\n    }\n  }\n  \n  // 再次检查登录状态\n  if (!authStore.isAuthenticated && requiresAuth) {\n    next({\n      path: '/login',\n      query: { redirect: to.fullPath }\n    })\n    return\n  }\n  \n  next()\n})\n\napp.use(router)\n\n// 添加全局配置\napp.config.globalProperties.$toast = showToast\nwindow.$toast = showToast\napp.config.globalProperties.eventBus = eventBus\napp.config.globalProperties.$config = config\n\n// 挂载应用\napp.mount('#app')"],"mappings":";;AAAA;AACA,SAASA,SAAS,QAAQ,KAAK;AAC/B,SAASC,WAAW,QAAQ,OAAO;AACnC,OAAOC,GAAG,MAAM,WAAW;AAC3B,OAAOC,MAAM,MAAM,UAAU;AAC7B,OAAO,wBAAwB;AAC/B,SAASC,SAAS,QAAQ,2BAA2B;AACrD,OAAOC,WAAW,MAAM,cAAc;AACtC,OAAO,6BAA6B;AACpC,SAASC,QAAQ,QAAQ,kBAAkB;AAC3C,OAAOC,UAAU,MAAM,aAAa;AACpC,OAAO,4BAA4B;AACnC,SAASC,YAAY,QAAQ,eAAe;AAC5C,OAAOC,KAAK,MAAM,SAAS;AAC3B,OAAOC,MAAM,MAAM,UAAU;AAE7B,MAAMC,GAAG,GAAGX,SAAS,CAACE,GAAG,CAAC;AAC1B,MAAMU,KAAK,GAAGX,WAAW,CAAC,CAAC;AAC3BU,GAAG,CAACE,GAAG,CAACD,KAAK,CAAC;AACdD,GAAG,CAACE,GAAG,CAACR,WAAW,CAAC;AACpBM,GAAG,CAACE,GAAG,CAACN,UAAU,CAAC;AACnBI,GAAG,CAACE,GAAG,CAACJ,KAAK,CAAC;;AAEd;AACAN,MAAM,CAACW,UAAU,CAAC,OAAOC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EAC1C,MAAMC,SAAS,GAAGV,YAAY,CAAC,CAAC;;EAEhC;EACA,MAAMW,YAAY,GAAGJ,EAAE,CAACK,OAAO,CAACC,IAAI,CAACC,MAAM,IAAIA,MAAM,CAACC,IAAI,CAACJ,YAAY,CAAC;;EAExE;EACA,IAAI,CAACA,YAAY,EAAE;IACjBF,IAAI,CAAC,CAAC;IACN;EACF;;EAEA;EACA,IAAI,CAACC,SAAS,CAACM,UAAU,IAAIC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,EAAE;IAC1D,IAAI;MACF,MAAMR,SAAS,CAACS,UAAU,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;IACpD;EACF;;EAEA;EACA,IAAI,CAACV,SAAS,CAACY,eAAe,IAAIX,YAAY,EAAE;IAC9CF,IAAI,CAAC;MACHc,IAAI,EAAE,QAAQ;MACdC,KAAK,EAAE;QAAEC,QAAQ,EAAElB,EAAE,CAACmB;MAAS;IACjC,CAAC,CAAC;IACF;EACF;EAEAjB,IAAI,CAAC,CAAC;AACR,CAAC,CAAC;AAEFN,GAAG,CAACE,GAAG,CAACV,MAAM,CAAC;;AAEf;AACAQ,GAAG,CAACD,MAAM,CAACyB,gBAAgB,CAACC,MAAM,GAAGhC,SAAS;AAC9CiC,MAAM,CAACD,MAAM,GAAGhC,SAAS;AACzBO,GAAG,CAACD,MAAM,CAACyB,gBAAgB,CAAC7B,QAAQ,GAAGA,QAAQ;AAC/CK,GAAG,CAACD,MAAM,CAACyB,gBAAgB,CAACG,OAAO,GAAG5B,MAAM;;AAE5C;AACAC,GAAG,CAAC4B,KAAK,CAAC,MAAM,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}