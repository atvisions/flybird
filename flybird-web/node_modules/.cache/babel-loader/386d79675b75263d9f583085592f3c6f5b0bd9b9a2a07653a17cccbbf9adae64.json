{"ast":null,"code":"import { ref, computed, nextTick, watch, onMounted } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport defaultAvatarImage from '@/assets/images/default-avatar.png';\nimport defaultBackground from '@/assets/images/default-background.jpg';\nimport { useStore } from 'vuex';\nimport { MEDIA_URL } from '@/config';\nimport { showToast } from '@/components/ToastMessage';\nimport { PencilIcon, PhoneIcon, EnvelopeIcon, MapPinIcon, BriefcaseIcon, ClockIcon, CurrencyYenIcon, DocumentTextIcon, CameraIcon, UserIcon, CalendarIcon, ChevronDownIcon, ChevronUpIcon, CakeIcon, PencilSquareIcon } from '@heroicons/vue/24/outline';\nimport profile from '@/api/profile';\nimport { eventBus } from '@/utils/eventBus';\nimport { Dialog, DialogPanel, DialogTitle, TransitionChild, TransitionRoot } from '@headlessui/vue';\nimport AvatarUploadDialog from '../dialogs/AvatarUploadDialog.vue';\n\n// 1. 首先声明 props\n\nexport default {\n  __name: 'BasicInfo',\n  props: {\n    resumeData: {\n      type: Object,\n      default: () => ({})\n    },\n    loading: {\n      type: Boolean,\n      default: false\n    },\n    bioExpanded: {\n      type: Boolean,\n      default: false\n    },\n    showBioExpandButton: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: ['update', 'edit', 'toggleBioExpand'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n\n    // 2. 声明 emits\n    const emit = __emit;\n\n    // 3. 导入和初始化其他变量\n    const store = useStore();\n    const loading = ref(true);\n    const basicInfo = ref({});\n\n    // 4. 计算属性\n    const formatBasicInfo = computed(() => {\n      // 优先使用父组件传入的 resumeData\n      const info = props.resumeData || {};\n      return {\n        name: info.name || info.username || '未填写',\n        // 添加 username 作为备选\n        gender: formatGender(info.gender),\n        phone: info.phone || '未填写',\n        email: info.email || '未填写',\n        location: info.location || '未填写',\n        age: calculateAge(info.birth_date) || '未填写',\n        personal_summary: info.personal_summary || '未填写'\n      };\n    });\n    const userAvatar = computed(() => {\n      const avatar = props.resumeData?.avatar;\n      if (!avatar) return defaultAvatarImage;\n      return avatar.startsWith('http') || avatar.startsWith('data:') ? avatar : `${MEDIA_URL}${avatar}`;\n    });\n    const currentGender = computed(() => {\n      return props.resumeData?.gender;\n    });\n\n    // 5. 监听器\n    watch(() => props.resumeData, newVal => {\n      if (newVal && Object.keys(newVal).length > 0) {\n        loading.value = false;\n      }\n    }, {\n      immediate: true\n    });\n\n    // 6. 生命周期钩子\n    onMounted(async () => {\n      try {\n        loading.value = true;\n        // 不需要在这里获取数据，因为父组件会处理\n      } catch (error) {\n        console.error('初始化失败:', error);\n      } finally {\n        loading.value = false;\n      }\n    });\n    onMounted(async () => {\n      try {\n        await store.dispatch('fetchCompleteness');\n      } catch (error) {\n        console.error('Failed to fetch completeness:', error);\n      }\n    });\n\n    // 7. 方法定义\n    const handleFileChange = async event => {\n      const file = event.target.files[0];\n      if (!file) return;\n\n      // 验证文件\n      if (!validateFile(file)) {\n        return;\n      }\n      await handleAvatarUpload(file);\n\n      // 清空文件选择器，以便能够选择同一个文件\n      event.target.value = '';\n    };\n    const handleEdit = () => {\n      console.log('BasicInfo handleEdit - 当前数据:', props.resumeData);\n      // 确保传递正确的数据结构\n      const editData = {\n        name: props.resumeData.name,\n        gender: props.resumeData.gender,\n        birth_date: props.resumeData.birth_date,\n        phone: props.resumeData.phone,\n        email: props.resumeData.email,\n        location: props.resumeData.location,\n        personal_summary: props.resumeData.personal_summary\n      };\n      emit('edit', 'basic_info', editData);\n    };\n    const toggleBioExpand = () => {\n      emit('toggleBioExpand');\n    };\n\n    // 8. 工具函数\n    const calculateAge = birthDate => {\n      if (!birthDate) return '';\n      const birth = new Date(birthDate);\n      const today = new Date();\n      let age = today.getFullYear() - birth.getFullYear();\n      const monthDiff = today.getMonth() - birth.getMonth();\n      if (monthDiff < 0 || monthDiff === 0 && today.getDate() < birth.getDate()) {\n        age--;\n      }\n      return `${age}岁`;\n    };\n    const formatGender = gender => {\n      const genderMap = {\n        male: '男',\n        female: '女',\n        other: '其他'\n      };\n      return genderMap[gender] || '未填写';\n    };\n    const formatDate = dateString => {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleDateString('zh-CN', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      });\n    };\n\n    // 调试辅助函数\n    const logResumeData = () => {\n      const plainData = {\n        name: props.resumeData.name,\n        gender: props.resumeData.gender,\n        phone: props.resumeData.phone,\n        email: props.resumeData.email,\n        location: props.resumeData.location,\n        birth_date: props.resumeData.birth_date,\n        personal_summary: props.resumeData.personal_summary,\n        created_at: props.resumeData.created_at,\n        updated_at: props.resumeData.updated_at\n      };\n      console.log('BasicInfo data:', plainData);\n    };\n\n    // 添加头像上传处理函数\n    const handleAvatarUpload = async file => {\n      try {\n        loading.value = true;\n        const formData = new FormData();\n        formData.append('avatar', file);\n        const response = await profile.uploadAvatar(formData);\n        if (response.data?.code === 200) {\n          showToast('头像上传成功', 'success');\n          emit('update');\n          const avatarUrl = response.data.data.avatar;\n          eventBus.emit('avatar-updated', avatarUrl);\n          if (props.resumeData) {\n            props.resumeData.avatar = avatarUrl;\n          }\n          showAvatarUpload.value = false; // 关闭弹窗\n        } else {\n          throw new Error(response.data?.message || '上传失败');\n        }\n      } catch (error) {\n        console.error('头像上传失败:', error);\n        showToast(error.message || '头像上传失败，请稍后重试', 'error');\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 添加触发文件选择的方法\n    const triggerUpload = () => {\n      showAvatarUpload.value = true;\n    };\n\n    // 添加图片加载错误处理\n    const handleImageError = e => {\n      e.target.src = defaultAvatarImage;\n    };\n\n    // 添加文件验证\n    const validateFile = file => {\n      // 验证文件类型\n      if (!file.type.startsWith('image/')) {\n        showToast('请选择图片文件', 'error');\n        return false;\n      }\n\n      // 验证文件大小（例如限制为 2MB）\n      const maxSize = 20 * 1024 * 1024; // 2MB\n      if (file.size > maxSize) {\n        showToast('图片大小不能超过 2MB', 'error');\n        return false;\n      }\n      return true;\n    };\n\n    // 背景图相关\n    const backgroundInput = ref(null);\n    const backgroundUrl = computed(() => {\n      const background = store.state.userInfo?.data?.basic_info?.background;\n      if (!background) return defaultBackground;\n      return background.startsWith('http') ? background : `${MEDIA_URL}${background}`;\n    });\n    const triggerBackgroundUpload = () => {\n      backgroundInput.value.click();\n    };\n    const handleBackgroundChange = async event => {\n      const file = event.target.files[0];\n      if (!file) return;\n      if (!validateFile(file)) {\n        return;\n      }\n      const formData = new FormData();\n      formData.append('background', file);\n      try {\n        loading.value = true;\n        const response = await profile.uploadBackground(formData);\n        if (response.data?.code === 200) {\n          showToast('背景图更新成功', 'success');\n          emit('update'); // 通知父组件更新\n          const backgroundUrl = response.data.data.background;\n          // 更新本地数据\n          if (props.resumeData && props.resumeData.basic_info) {\n            props.resumeData.basic_info.background = backgroundUrl;\n          }\n          // 更新 store\n          store.commit('UPDATE_BACKGROUND', backgroundUrl);\n        }\n      } catch (error) {\n        console.error('Failed to update background:', error);\n        showToast('背景图更新失败', 'error');\n      } finally {\n        loading.value = false;\n        event.target.value = '';\n      }\n    };\n    const handleBackgroundError = e => {\n      e.target.src = defaultBackground;\n    };\n\n    // 添加状态\n    const showAvatarUpload = ref(false);\n    const __returned__ = {\n      props,\n      emit,\n      store,\n      loading,\n      basicInfo,\n      formatBasicInfo,\n      userAvatar,\n      currentGender,\n      handleFileChange,\n      handleEdit,\n      toggleBioExpand,\n      calculateAge,\n      formatGender,\n      formatDate,\n      logResumeData,\n      handleAvatarUpload,\n      triggerUpload,\n      handleImageError,\n      validateFile,\n      backgroundInput,\n      backgroundUrl,\n      triggerBackgroundUpload,\n      handleBackgroundChange,\n      handleBackgroundError,\n      showAvatarUpload,\n      ref,\n      computed,\n      nextTick,\n      watch,\n      onMounted,\n      get ElMessage() {\n        return ElMessage;\n      },\n      get defaultAvatarImage() {\n        return defaultAvatarImage;\n      },\n      get defaultBackground() {\n        return defaultBackground;\n      },\n      get useStore() {\n        return useStore;\n      },\n      get MEDIA_URL() {\n        return MEDIA_URL;\n      },\n      get showToast() {\n        return showToast;\n      },\n      get PencilIcon() {\n        return PencilIcon;\n      },\n      get PhoneIcon() {\n        return PhoneIcon;\n      },\n      get EnvelopeIcon() {\n        return EnvelopeIcon;\n      },\n      get MapPinIcon() {\n        return MapPinIcon;\n      },\n      get BriefcaseIcon() {\n        return BriefcaseIcon;\n      },\n      get ClockIcon() {\n        return ClockIcon;\n      },\n      get CurrencyYenIcon() {\n        return CurrencyYenIcon;\n      },\n      get DocumentTextIcon() {\n        return DocumentTextIcon;\n      },\n      get CameraIcon() {\n        return CameraIcon;\n      },\n      get UserIcon() {\n        return UserIcon;\n      },\n      get CalendarIcon() {\n        return CalendarIcon;\n      },\n      get ChevronDownIcon() {\n        return ChevronDownIcon;\n      },\n      get ChevronUpIcon() {\n        return ChevronUpIcon;\n      },\n      get CakeIcon() {\n        return CakeIcon;\n      },\n      get PencilSquareIcon() {\n        return PencilSquareIcon;\n      },\n      get profile() {\n        return profile;\n      },\n      get eventBus() {\n        return eventBus;\n      },\n      get Dialog() {\n        return Dialog;\n      },\n      get DialogPanel() {\n        return DialogPanel;\n      },\n      get DialogTitle() {\n        return DialogTitle;\n      },\n      get TransitionChild() {\n        return TransitionChild;\n      },\n      get TransitionRoot() {\n        return TransitionRoot;\n      },\n      AvatarUploadDialog\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","nextTick","watch","onMounted","ElMessage","defaultAvatarImage","defaultBackground","useStore","MEDIA_URL","showToast","PencilIcon","PhoneIcon","EnvelopeIcon","MapPinIcon","BriefcaseIcon","ClockIcon","CurrencyYenIcon","DocumentTextIcon","CameraIcon","UserIcon","CalendarIcon","ChevronDownIcon","ChevronUpIcon","CakeIcon","PencilSquareIcon","profile","eventBus","Dialog","DialogPanel","DialogTitle","TransitionChild","TransitionRoot","AvatarUploadDialog","props","__props","emit","__emit","store","loading","basicInfo","formatBasicInfo","info","resumeData","name","username","gender","formatGender","phone","email","location","age","calculateAge","birth_date","personal_summary","userAvatar","avatar","startsWith","currentGender","newVal","Object","keys","length","value","immediate","error","console","dispatch","handleFileChange","event","file","target","files","validateFile","handleAvatarUpload","handleEdit","log","editData","toggleBioExpand","birthDate","birth","Date","today","getFullYear","monthDiff","getMonth","getDate","genderMap","male","female","other","formatDate","dateString","date","toLocaleDateString","year","month","day","logResumeData","plainData","created_at","updated_at","formData","FormData","append","response","uploadAvatar","data","code","avatarUrl","showAvatarUpload","Error","message","triggerUpload","handleImageError","e","src","type","maxSize","size","backgroundInput","backgroundUrl","background","state","userInfo","basic_info","triggerBackgroundUpload","click","handleBackgroundChange","uploadBackground","commit","handleBackgroundError"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/components/BasicInfo.vue"],"sourcesContent":["<!-- src/views/user/MyProfile/components/BasicInfo.vue -->\n<template>\n  <div class=\"bg-white rounded-lg shadow\">\n    <!-- 背景图部分 -->\n    <div class=\"relative h-48 overflow-hidden rounded-t-lg\">\n      <img \n        :src=\"backgroundUrl\" \n        class=\"w-full h-full object-cover\"\n        @error=\"handleBackgroundError\"\n      >\n      <div class=\"absolute top-4 right-4\">\n        <button\n          @click=\"triggerBackgroundUpload\"\n          class=\"flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-white bg-opacity-90 rounded-lg hover:bg-opacity-100 transition-all shadow-sm\"\n        >\n          <svg \n            class=\"w-4 h-4 mr-1.5 text-gray-600\" \n            fill=\"none\" \n            stroke=\"currentColor\" \n            viewBox=\"0 0 24 24\"\n          >\n            <path \n              stroke-linecap=\"round\" \n              stroke-linejoin=\"round\" \n              stroke-width=\"2\" \n              d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\n            />\n          </svg>\n          更换背景\n        </button>\n      </div>\n      <input\n        ref=\"backgroundInput\"\n        type=\"file\"\n        accept=\"image/*\"\n        class=\"hidden\"\n        @change=\"handleBackgroundChange\"\n      >\n    </div>\n\n    <!-- 个人信息卡片 -->\n    <div class=\"relative px-6 pb-6\">\n      <!-- 头像部分 - 上移到背景图上 -->\n      <div class=\"absolute -top-16 left-6\">\n        <div class=\"relative group\">\n          <img \n            :src=\"userAvatar\" \n            class=\"w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg\"\n            alt=\"用户头像\"\n            @error=\"handleImageError\"\n          />\n          <div \n            @click=\"triggerUpload\"\n            class=\"absolute inset-0 flex items-center justify-center rounded-full bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity duration-200\"\n          >\n            <CameraIcon class=\"w-8 h-8 text-white\" />\n          </div>\n          <!-- 性别标识 -->\n          <div class=\"absolute bottom-0 right-0 bg-white rounded-full p-2 shadow\">\n            <!-- 男性图标 -->\n            <svg \n              v-if=\"currentGender === 'male'\" \n              class=\"w-6 h-6 text-blue-500\" \n              viewBox=\"0 0 24 24\" \n              fill=\"none\" \n              stroke=\"currentColor\"\n            >\n              <circle cx=\"12\" cy=\"12\" r=\"5\" stroke-width=\"2\"/>\n              <path d=\"M16 8L21 3\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n              <path d=\"M21 3H16M21 3V8\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n            <!-- 女性图标 -->\n            <svg \n              v-else-if=\"currentGender === 'female'\" \n              class=\"w-6 h-6 text-pink-500\" \n              viewBox=\"0 0 24 24\" \n              fill=\"none\" \n              stroke=\"currentColor\"\n            >\n              <circle cx=\"12\" cy=\"10\" r=\"5\" stroke-width=\"2\"/>\n              <path d=\"M12 15V21\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n              <path d=\"M9 18H15\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n          </div>\n        </div>\n      </div>\n\n      <!-- 基本信息部分 -->\n      <div class=\"pt-20\">\n        <!-- 名字和编辑按钮 -->\n        <div class=\"flex items-center justify-between mb-4\">\n          <h1 class=\"text-2xl font-bold text-gray-900\">{{ formatBasicInfo.name }}</h1>\n          <button\n            @click=\"handleEdit\"\n            class=\"p-2 rounded-full hover:bg-gray-100 transition-colors\"\n          >\n            <PencilSquareIcon class=\"w-5 h-5 text-gray-500\" />\n          </button>\n        </div>\n\n        <!-- 个人简介 -->\n        <p class=\"text-gray-600 mb-6\">{{ formatBasicInfo.personal_summary || '这个人很懒，还没有填写个人简介' }}</p>\n\n        <!-- 信息网格 -->\n        <div class=\"grid grid-cols-2 gap-6 mb-6\">\n          <!-- 联系方式 -->\n          <div class=\"space-y-3\">\n            <h2 class=\"text-sm font-semibold text-gray-900 mb-2\">联系方式</h2>\n            <div class=\"flex items-center space-x-2\">\n              <PhoneIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ formatBasicInfo.phone }}</span>\n            </div>\n            <div class=\"flex items-center space-x-2\">\n              <EnvelopeIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ formatBasicInfo.email }}</span>\n            </div>\n          </div>\n\n          <!-- 基本资料 -->\n          <div class=\"space-y-3\">\n            <h2 class=\"text-sm font-semibold text-gray-900 mb-2\">基本资料</h2>\n            <div class=\"flex items-center space-x-2\">\n              <MapPinIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ formatBasicInfo.location }}</span>\n            </div>\n            <div class=\"flex items-center space-x-2\">\n              <CakeIcon class=\"w-5 h-5 text-gray-400\" />\n              <span class=\"text-gray-600\">{{ formatBasicInfo.age }}</span>\n            </div>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n\n  <!-- 添加头像上传弹窗 -->\n  <AvatarUploadDialog\n    v-model=\"showAvatarUpload\"\n    :loading=\"loading\"\n    @upload=\"handleAvatarUpload\"\n  />\n</template>\n\n<script setup>\nimport { ref, computed, nextTick, watch, onMounted } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport defaultAvatarImage from '@/assets/images/default-avatar.png'\nimport defaultBackground from '@/assets/images/default-background.jpg'\nimport { useStore } from 'vuex'\nimport { MEDIA_URL } from '@/config'\nimport { showToast } from '@/components/ToastMessage'\nimport {\n  PencilIcon,\n  PhoneIcon,\n  EnvelopeIcon,\n  MapPinIcon,\n  BriefcaseIcon,\n  ClockIcon,\n  CurrencyYenIcon,\n  DocumentTextIcon,\n  CameraIcon,\n  UserIcon,\n  CalendarIcon,\n  ChevronDownIcon,\n  ChevronUpIcon,\n  CakeIcon,\n  PencilSquareIcon\n} from '@heroicons/vue/24/outline'\nimport profile from '@/api/profile'\nimport { eventBus } from '@/utils/eventBus'\nimport {\n  Dialog,\n  DialogPanel,\n  DialogTitle,\n  TransitionChild,\n  TransitionRoot\n} from '@headlessui/vue'\nimport AvatarUploadDialog from '../dialogs/AvatarUploadDialog.vue'\n\n// 1. 首先声明 props\nconst props = defineProps({\n  resumeData: {\n    type: Object,\n    default: () => ({})\n  },\n  loading: {\n    type: Boolean,\n    default: false\n  },\n  bioExpanded: {\n    type: Boolean,\n    default: false\n  },\n  showBioExpandButton: {\n    type: Boolean,\n    default: false\n  }\n})\n\n// 2. 声明 emits\nconst emit = defineEmits(['update', 'edit', 'toggleBioExpand'])\n\n// 3. 导入和初始化其他变量\nconst store = useStore()\nconst loading = ref(true)\nconst basicInfo = ref({})\n\n// 4. 计算属性\nconst formatBasicInfo = computed(() => {\n  // 优先使用父组件传入的 resumeData\n  const info = props.resumeData || {}\n  \n  return {\n    name: info.name || info.username || '未填写',  // 添加 username 作为备选\n    gender: formatGender(info.gender),\n    phone: info.phone || '未填写',\n    email: info.email || '未填写',\n    location: info.location || '未填写',\n    age: calculateAge(info.birth_date) || '未填写',\n    personal_summary: info.personal_summary || '未填写'\n  }\n})\n\nconst userAvatar = computed(() => {\n  const avatar = props.resumeData?.avatar\n  if (!avatar) return defaultAvatarImage\n  return avatar.startsWith('http') || avatar.startsWith('data:') ? avatar : `${MEDIA_URL}${avatar}`\n})\n\nconst currentGender = computed(() => {\n  return props.resumeData?.gender\n})\n\n// 5. 监听器\nwatch(\n  () => props.resumeData,\n  (newVal) => {\n    if (newVal && Object.keys(newVal).length > 0) {\n      loading.value = false\n    }\n  },\n  { immediate: true }\n)\n\n// 6. 生命周期钩子\nonMounted(async () => {\n  try {\n    loading.value = true\n    // 不需要在这里获取数据，因为父组件会处理\n  } catch (error) {\n    console.error('初始化失败:', error)\n  } finally {\n    loading.value = false\n  }\n})\n\nonMounted(async () => {\n  try {\n    await store.dispatch('fetchCompleteness')\n  } catch (error) {\n    console.error('Failed to fetch completeness:', error)\n  }\n})\n\n// 7. 方法定义\nconst handleFileChange = async (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n\n  // 验证文件\n  if (!validateFile(file)) {\n    return\n  }\n\n  await handleAvatarUpload(file)\n  \n  // 清空文件选择器，以便能够选择同一个文件\n  event.target.value = ''\n}\n\nconst handleEdit = () => {\n  console.log('BasicInfo handleEdit - 当前数据:', props.resumeData)\n  // 确保传递正确的数据结构\n  const editData = {\n    name: props.resumeData.name,\n    gender: props.resumeData.gender,\n    birth_date: props.resumeData.birth_date,\n    phone: props.resumeData.phone,\n    email: props.resumeData.email,\n    location: props.resumeData.location,\n    personal_summary: props.resumeData.personal_summary\n  }\n  emit('edit', 'basic_info', editData)\n}\n\nconst toggleBioExpand = () => {\n  emit('toggleBioExpand')\n}\n\n// 8. 工具函数\nconst calculateAge = (birthDate) => {\n  if (!birthDate) return ''\n  \n  const birth = new Date(birthDate)\n  const today = new Date()\n  \n  let age = today.getFullYear() - birth.getFullYear()\n  const monthDiff = today.getMonth() - birth.getMonth()\n  \n  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n    age--\n  }\n  \n  return `${age}岁`\n}\n\nconst formatGender = (gender) => {\n  const genderMap = {\n    male: '男',\n    female: '女',\n    other: '其他'\n  }\n  return genderMap[gender] || '未填写'\n}\n\nconst formatDate = (dateString) => {\n  if (!dateString) return ''\n  const date = new Date(dateString)\n  return date.toLocaleDateString('zh-CN', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  })\n}\n\n// 调试辅助函数\nconst logResumeData = () => {\n  const plainData = {\n    name: props.resumeData.name,\n    gender: props.resumeData.gender,\n    phone: props.resumeData.phone,\n    email: props.resumeData.email,\n    location: props.resumeData.location,\n    birth_date: props.resumeData.birth_date,\n    personal_summary: props.resumeData.personal_summary,\n    created_at: props.resumeData.created_at,\n    updated_at: props.resumeData.updated_at\n  }\n  console.log('BasicInfo data:', plainData)\n}\n\n// 添加头像上传处理函数\nconst handleAvatarUpload = async (file) => {\n  try {\n    loading.value = true\n    const formData = new FormData()\n    formData.append('avatar', file)\n    \n    const response = await profile.uploadAvatar(formData)\n    if (response.data?.code === 200) {\n      showToast('头像上传成功', 'success')\n      emit('update')\n      const avatarUrl = response.data.data.avatar\n      eventBus.emit('avatar-updated', avatarUrl)\n      if (props.resumeData) {\n        props.resumeData.avatar = avatarUrl\n      }\n      showAvatarUpload.value = false // 关闭弹窗\n    } else {\n      throw new Error(response.data?.message || '上传失败')\n    }\n  } catch (error) {\n    console.error('头像上传失败:', error)\n    showToast(error.message || '头像上传失败，请稍后重试', 'error')\n  } finally {\n    loading.value = false\n  }\n}\n\n// 添加触发文件选择的方法\nconst triggerUpload = () => {\n  showAvatarUpload.value = true\n}\n\n// 添加图片加载错误处理\nconst handleImageError = (e) => {\n  e.target.src = defaultAvatarImage\n}\n\n// 添加文件验证\nconst validateFile = (file) => {\n  // 验证文件类型\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return false\n  }\n\n  // 验证文件大小（例如限制为 2MB）\n  const maxSize = 20 * 1024 * 1024 // 2MB\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过 2MB', 'error')\n    return false\n  }\n\n  return true\n}\n\n// 背景图相关\nconst backgroundInput = ref(null)\nconst backgroundUrl = computed(() => {\n  const background = store.state.userInfo?.data?.basic_info?.background\n  if (!background) return defaultBackground\n  return background.startsWith('http') ? background : `${MEDIA_URL}${background}`\n})\n\nconst triggerBackgroundUpload = () => {\n  backgroundInput.value.click()\n}\n\nconst handleBackgroundChange = async (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n  \n  if (!validateFile(file)) {\n    return\n  }\n  \n  const formData = new FormData()\n  formData.append('background', file)\n  \n  try {\n    loading.value = true\n    const response = await profile.uploadBackground(formData)\n    if (response.data?.code === 200) {\n      showToast('背景图更新成功', 'success')\n      emit('update')  // 通知父组件更新\n      const backgroundUrl = response.data.data.background\n      // 更新本地数据\n      if (props.resumeData && props.resumeData.basic_info) {\n        props.resumeData.basic_info.background = backgroundUrl\n      }\n      // 更新 store\n      store.commit('UPDATE_BACKGROUND', backgroundUrl)\n    }\n  } catch (error) {\n    console.error('Failed to update background:', error)\n    showToast('背景图更新失败', 'error')\n  } finally {\n    loading.value = false\n    event.target.value = ''\n  }\n}\n\nconst handleBackgroundError = (e) => {\n  e.target.src = defaultBackground\n}\n\n// 添加状态\nconst showAvatarUpload = ref(false)\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}