{"ast":null,"code":"import { defineStore } from 'pinia';\nimport profile from '@/api/profile';\nimport { MEDIA_URL } from '@/config/index';\nexport const useProfileStore = defineStore({\n  id: 'profile',\n  state: () => ({\n    basicInfo: null,\n    avatarUpdateTime: null,\n    completeness: null,\n    loading: false\n  }),\n  getters: {\n    // 获取职业头像的完整 URL\n    profileAvatarUrl: state => {\n      const avatar = state.basicInfo?.basic_info?.avatar;\n      if (!avatar) return null;\n      // 如果已经是完整的 URL，直接返回\n      if (avatar.startsWith('http')) return avatar;\n      // 如果是相对路径，需要去掉开头的 /media/\n      const cleanPath = avatar.replace(/^\\/media\\//, '');\n      return `${MEDIA_URL}/${cleanPath}`;\n    }\n  },\n  actions: {\n    // 设置基本信息\n    setBasicInfo(data) {\n      this.basicInfo = data;\n    },\n    // 更新基本信息\n    async updateBasicInfo(data) {\n      try {\n        const response = await profile.updateBasicInfo(data);\n        if (response?.data?.code === 200) {\n          // 如果 basicInfo 不存在，先初始化\n          if (!this.basicInfo) {\n            this.basicInfo = {};\n          }\n\n          // 直接更新 basic_info\n          this.basicInfo.basic_info = response.data.data;\n          return response;\n        }\n        throw new Error(response?.data?.message || '更新失败');\n      } catch (error) {\n        console.error('更新基本信息失败:', error);\n        throw error;\n      }\n    },\n    // 获取完整度数据\n    async fetchCompleteness() {\n      try {\n        const response = await profile.getCompleteness();\n        if (response?.data?.code === 200) {\n          this.completeness = response.data.data;\n          return response.data.data;\n        }\n        throw new Error(response?.data?.message || '获取完整度数据失败');\n      } catch (error) {\n        console.error('获取完整度数据失败:', error);\n        throw error;\n      }\n    },\n    // 更新头像\n    async updateAvatar(file) {\n      try {\n        const response = await profile.uploadAvatar(file);\n        if (response?.data?.code === 200) {\n          const avatarUrl = response.data.data.avatar;\n\n          // 更新 store 状态\n          if (!this.basicInfo) {\n            this.basicInfo = {};\n          }\n          if (!this.basicInfo.basic_info) {\n            this.basicInfo.basic_info = {};\n          }\n          this.basicInfo.basic_info.avatar = avatarUrl;\n          this.avatarUpdateTime = Date.now();\n          return response;\n        }\n        throw new Error(response?.data?.message || '上传失败');\n      } catch (error) {\n        console.error('职业头像上传失败:', error);\n        throw error;\n      }\n    },\n    // 获取档案数据\n    async fetchProfileData() {\n      try {\n        this.loading = true;\n        const response = await profile.getData();\n        if (response?.data?.code === 200) {\n          this.basicInfo = response.data.data;\n          return response.data.data;\n        }\n        throw new Error(response?.data?.message || '获取档案数据失败');\n      } catch (error) {\n        console.error('获取档案数据失败:', error);\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    }\n  }\n});","map":{"version":3,"names":["defineStore","profile","MEDIA_URL","useProfileStore","id","state","basicInfo","avatarUpdateTime","completeness","loading","getters","profileAvatarUrl","avatar","basic_info","startsWith","cleanPath","replace","actions","setBasicInfo","data","updateBasicInfo","response","code","Error","message","error","console","fetchCompleteness","getCompleteness","updateAvatar","file","uploadAvatar","avatarUrl","Date","now","fetchProfileData","getData"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/stores/profile.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport profile from '@/api/profile'\nimport { MEDIA_URL } from '@/config/index'\n\nexport const useProfileStore = defineStore({\n  id: 'profile',\n  state: () => ({\n    basicInfo: null,\n    avatarUpdateTime: null,\n    completeness: null,\n    loading: false\n  }),\n\n  getters: {\n    // 获取职业头像的完整 URL\n    profileAvatarUrl: (state) => {\n      const avatar = state.basicInfo?.basic_info?.avatar\n      if (!avatar) return null\n      // 如果已经是完整的 URL，直接返回\n      if (avatar.startsWith('http')) return avatar\n      // 如果是相对路径，需要去掉开头的 /media/\n      const cleanPath = avatar.replace(/^\\/media\\//, '')\n      return `${MEDIA_URL}/${cleanPath}`\n    }\n  },\n\n  actions: {\n    // 设置基本信息\n    setBasicInfo(data) {\n      this.basicInfo = data\n    },\n\n    // 更新基本信息\n    async updateBasicInfo(data) {\n      try {\n        const response = await profile.updateBasicInfo(data)\n        if (response?.data?.code === 200) {\n          // 如果 basicInfo 不存在，先初始化\n          if (!this.basicInfo) {\n            this.basicInfo = {}\n          }\n          \n          // 直接更新 basic_info\n          this.basicInfo.basic_info = response.data.data\n          \n          return response\n        }\n        throw new Error(response?.data?.message || '更新失败')\n      } catch (error) {\n        console.error('更新基本信息失败:', error)\n        throw error\n      }\n    },\n\n    // 获取完整度数据\n    async fetchCompleteness() {\n      try {\n        const response = await profile.getCompleteness()\n        if (response?.data?.code === 200) {\n          this.completeness = response.data.data\n          return response.data.data\n        }\n        throw new Error(response?.data?.message || '获取完整度数据失败')\n      } catch (error) {\n        console.error('获取完整度数据失败:', error)\n        throw error\n      }\n    },\n\n    // 更新头像\n    async updateAvatar(file) {\n      try {\n        const response = await profile.uploadAvatar(file)\n        if (response?.data?.code === 200) {\n          const avatarUrl = response.data.data.avatar\n          \n          // 更新 store 状态\n          if (!this.basicInfo) {\n            this.basicInfo = {}\n          }\n          if (!this.basicInfo.basic_info) {\n            this.basicInfo.basic_info = {}\n          }\n          \n          this.basicInfo.basic_info.avatar = avatarUrl\n          this.avatarUpdateTime = Date.now()\n          \n          return response\n        }\n        throw new Error(response?.data?.message || '上传失败')\n      } catch (error) {\n        console.error('职业头像上传失败:', error)\n        throw error\n      }\n    },\n\n    // 获取档案数据\n    async fetchProfileData() {\n      try {\n        this.loading = true\n        const response = await profile.getData()\n        if (response?.data?.code === 200) {\n          this.basicInfo = response.data.data\n          return response.data.data\n        }\n        throw new Error(response?.data?.message || '获取档案数据失败')\n      } catch (error) {\n        console.error('获取档案数据失败:', error)\n        throw error\n      } finally {\n        this.loading = false\n      }\n    }\n  }\n}) "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}