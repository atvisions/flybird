{"ast":null,"code":"import { ref, computed, nextTick, watch, onMounted } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport defaultAvatarImage from '@/assets/images/default-avatar.png';\nimport { useStore } from 'vuex';\nimport { MEDIA_URL } from '@/config';\nimport { showToast } from '@/components/ToastMessage';\nimport { PencilIcon, PhoneIcon, EnvelopeIcon, MapPinIcon, BriefcaseIcon, ClockIcon, CurrencyYenIcon, DocumentTextIcon, CameraIcon, UserIcon, CalendarIcon, ChevronDownIcon, ChevronUpIcon, CakeIcon, PencilSquareIcon } from '@heroicons/vue/24/outline';\nimport profile from '@/api/profile';\nimport { eventBus } from '@/utils/eventBus';\nimport { Dialog, DialogPanel, DialogTitle, TransitionChild, TransitionRoot } from '@headlessui/vue';\nimport ProfileAvatarCropper from '@/components/ProfileAvatarCropper.vue';\nimport { useAccountStore } from '@/stores/account';\nimport { useProfileStore } from '@/stores/profile';\n\n// 1. 首先声明 props\n\nexport default {\n  __name: 'BasicInfo',\n  props: {\n    resumeData: {\n      type: Object,\n      default: () => ({})\n    },\n    loading: {\n      type: Boolean,\n      default: false\n    },\n    bioExpanded: {\n      type: Boolean,\n      default: false\n    },\n    showBioExpandButton: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: ['update', 'edit', 'toggleBioExpand'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n\n    // 2. 声明 emits\n    const emit = __emit;\n\n    // 3. 导入和初始化其他变量\n    const store = useStore();\n    const pageLoading = ref(true);\n    const basicInfo = ref({});\n    const profileStore = useProfileStore();\n\n    // 4. 计算属性\n    const formatBasicInfo = computed(() => {\n      // 优先使用父组件传入的 resumeData\n      const info = props.resumeData || {};\n      return {\n        name: info.name || info.username || '未填写',\n        // 添加 username 作为备选\n        gender: formatGender(info.gender),\n        phone: info.phone || '未填写',\n        email: info.email || '未填写',\n        location: info.location || '未填写',\n        age: calculateAge(info.birth_date) || '未填写',\n        personal_summary: info.personal_summary || '未填写'\n      };\n    });\n\n    // 添加一个 ref 来存储完整的头像 URL\n    const avatarUrl = ref('');\n    const avatarUpdateTime = ref(Date.now());\n\n    // 修改计算属性\n    const userAvatar = computed(() => {\n      // 优先使用 store 中的头像\n      const avatar = profileStore.profileAvatarUrl || props.resumeData?.avatar;\n      console.log('Computing userAvatar:', {\n        storeAvatar: profileStore.profileAvatarUrl,\n        propsAvatar: props.resumeData?.avatar,\n        finalAvatar: avatar,\n        updateTime: avatarUpdateTime.value\n      });\n      if (!avatar) {\n        avatarUrl.value = defaultAvatarImage;\n        return defaultAvatarImage;\n      }\n\n      // 如果是完整的URL，直接使用\n      if (avatar.startsWith('http') || avatar.startsWith('data:image')) {\n        avatarUrl.value = avatar;\n        return avatar;\n      }\n\n      // 处理相对路径，移除可能的前导 /media/ 并确保路径正确\n      const cleanPath = avatar.replace(/^\\/?(media\\/)?/, '');\n      const fullUrl = `${config.mediaURL}/${cleanPath}`;\n\n      // 添加时间戳参数来避免缓存\n      avatarUrl.value = `${fullUrl}?t=${avatarUpdateTime.value}`;\n      return avatarUrl.value;\n    });\n    const currentGender = computed(() => {\n      return props.resumeData?.gender;\n    });\n\n    // 5. 监听器\n    watch(() => props.resumeData, newVal => {\n      if (newVal && Object.keys(newVal).length > 0) {\n        pageLoading.value = false;\n      }\n    }, {\n      immediate: true\n    });\n\n    // 6. 生命周期钩子\n    onMounted(async () => {\n      try {\n        pageLoading.value = true;\n        // 不需要在这里获取数据，因为父组件会处理\n      } catch (error) {\n        console.error('初始化失败:', error);\n      } finally {\n        pageLoading.value = false;\n      }\n    });\n    onMounted(async () => {\n      try {\n        await store.dispatch('fetchCompleteness');\n      } catch (error) {\n        console.error('Failed to fetch completeness:', error);\n      }\n    });\n\n    // 7. 方法定义\n    const handleFileChange = async event => {\n      const file = event.target.files[0];\n      if (!file) return;\n\n      // 验证文件\n      if (!validateFile(file)) {\n        return;\n      }\n      await handleAvatarUpload(file);\n\n      // 清空文件选择器，以便能够选择同一个文件\n      event.target.value = '';\n    };\n    const handleEdit = () => {\n      console.log('BasicInfo handleEdit - 当前数据:', props.resumeData);\n      // 确保传递正确的数据结构\n      const editData = {\n        name: props.resumeData.name,\n        gender: props.resumeData.gender,\n        birth_date: props.resumeData.birth_date,\n        phone: props.resumeData.phone,\n        email: props.resumeData.email,\n        location: props.resumeData.location,\n        personal_summary: props.resumeData.personal_summary\n      };\n      emit('edit', 'basic_info', editData);\n    };\n    const toggleBioExpand = () => {\n      emit('toggleBioExpand');\n    };\n\n    // 8. 工具函数\n    const calculateAge = birthDate => {\n      if (!birthDate) return '';\n      const birth = new Date(birthDate);\n      const today = new Date();\n      let age = today.getFullYear() - birth.getFullYear();\n      const monthDiff = today.getMonth() - birth.getMonth();\n      if (monthDiff < 0 || monthDiff === 0 && today.getDate() < birth.getDate()) {\n        age--;\n      }\n      return `${age}岁`;\n    };\n    const formatGender = gender => {\n      const genderMap = {\n        male: '男',\n        female: '女',\n        other: '其他'\n      };\n      return genderMap[gender] || '未填写';\n    };\n    const formatDate = dateString => {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleDateString('zh-CN', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      });\n    };\n\n    // 修改头像上传处理函数\n    const handleAvatarUpload = async file => {\n      try {\n        loading.value = true;\n        // 使用 profileStore 上传头像\n        await profileStore.updateAvatar(file);\n\n        // 触发头像更新事件\n        eventBus.emit('avatar-updated');\n\n        // 获取最新的完整度数据并触发更新事件\n        const completenessResponse = await profile.getCompleteness();\n        if (completenessResponse.data?.code === 200) {\n          eventBus.emit('completeness-updated');\n        }\n        showToast('头像上传成功', 'success');\n      } catch (error) {\n        console.error('头像上传失败:', error);\n        showToast(error.message || '头像上传失败，请重试', 'error');\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 添加图片加载错误处理\n    const handleImageError = e => {\n      e.target.src = defaultAvatarImage;\n    };\n\n    // 添加文件验证\n    const validateFile = file => {\n      // 验证文件类型\n      if (!file.type.startsWith('image/')) {\n        showToast('请选择图片文件', 'error');\n        return false;\n      }\n\n      // 验证文件大小（例如限制为 2MB）\n      const maxSize = 20 * 1024 * 1024; // 2MB\n      if (file.size > maxSize) {\n        showToast('图片大小不能超过 2MB', 'error');\n        return false;\n      }\n      return true;\n    };\n\n    // 添加状态\n    const showAvatarCropper = ref(false);\n    const avatarUploadRef = ref(null);\n    const loading = ref(false);\n\n    // 监听 resumeData 变化\n    watch(() => props.resumeData, newVal => {\n      if (newVal) {\n        // 强制更新组件\n        nextTick(() => {\n          if (props.resumeData?.avatar) {\n            const img = new Image();\n            img.src = userAvatar.value;\n          }\n        });\n      }\n    }, {\n      deep: true\n    });\n    const __returned__ = {\n      props,\n      emit,\n      store,\n      pageLoading,\n      basicInfo,\n      profileStore,\n      formatBasicInfo,\n      avatarUrl,\n      avatarUpdateTime,\n      userAvatar,\n      currentGender,\n      handleFileChange,\n      handleEdit,\n      toggleBioExpand,\n      calculateAge,\n      formatGender,\n      formatDate,\n      handleAvatarUpload,\n      handleImageError,\n      validateFile,\n      showAvatarCropper,\n      avatarUploadRef,\n      loading,\n      ref,\n      computed,\n      nextTick,\n      watch,\n      onMounted,\n      get ElMessage() {\n        return ElMessage;\n      },\n      get defaultAvatarImage() {\n        return defaultAvatarImage;\n      },\n      get useStore() {\n        return useStore;\n      },\n      get MEDIA_URL() {\n        return MEDIA_URL;\n      },\n      get showToast() {\n        return showToast;\n      },\n      get PencilIcon() {\n        return PencilIcon;\n      },\n      get PhoneIcon() {\n        return PhoneIcon;\n      },\n      get EnvelopeIcon() {\n        return EnvelopeIcon;\n      },\n      get MapPinIcon() {\n        return MapPinIcon;\n      },\n      get BriefcaseIcon() {\n        return BriefcaseIcon;\n      },\n      get ClockIcon() {\n        return ClockIcon;\n      },\n      get CurrencyYenIcon() {\n        return CurrencyYenIcon;\n      },\n      get DocumentTextIcon() {\n        return DocumentTextIcon;\n      },\n      get CameraIcon() {\n        return CameraIcon;\n      },\n      get UserIcon() {\n        return UserIcon;\n      },\n      get CalendarIcon() {\n        return CalendarIcon;\n      },\n      get ChevronDownIcon() {\n        return ChevronDownIcon;\n      },\n      get ChevronUpIcon() {\n        return ChevronUpIcon;\n      },\n      get CakeIcon() {\n        return CakeIcon;\n      },\n      get PencilSquareIcon() {\n        return PencilSquareIcon;\n      },\n      get profile() {\n        return profile;\n      },\n      get eventBus() {\n        return eventBus;\n      },\n      get Dialog() {\n        return Dialog;\n      },\n      get DialogPanel() {\n        return DialogPanel;\n      },\n      get DialogTitle() {\n        return DialogTitle;\n      },\n      get TransitionChild() {\n        return TransitionChild;\n      },\n      get TransitionRoot() {\n        return TransitionRoot;\n      },\n      ProfileAvatarCropper,\n      get useAccountStore() {\n        return useAccountStore;\n      },\n      get useProfileStore() {\n        return useProfileStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","nextTick","watch","onMounted","ElMessage","defaultAvatarImage","useStore","MEDIA_URL","showToast","PencilIcon","PhoneIcon","EnvelopeIcon","MapPinIcon","BriefcaseIcon","ClockIcon","CurrencyYenIcon","DocumentTextIcon","CameraIcon","UserIcon","CalendarIcon","ChevronDownIcon","ChevronUpIcon","CakeIcon","PencilSquareIcon","profile","eventBus","Dialog","DialogPanel","DialogTitle","TransitionChild","TransitionRoot","ProfileAvatarCropper","useAccountStore","useProfileStore","props","__props","emit","__emit","store","pageLoading","basicInfo","profileStore","formatBasicInfo","info","resumeData","name","username","gender","formatGender","phone","email","location","age","calculateAge","birth_date","personal_summary","avatarUrl","avatarUpdateTime","Date","now","userAvatar","avatar","profileAvatarUrl","console","log","storeAvatar","propsAvatar","finalAvatar","updateTime","value","startsWith","cleanPath","replace","fullUrl","config","mediaURL","currentGender","newVal","Object","keys","length","immediate","error","dispatch","handleFileChange","event","file","target","files","validateFile","handleAvatarUpload","handleEdit","editData","toggleBioExpand","birthDate","birth","today","getFullYear","monthDiff","getMonth","getDate","genderMap","male","female","other","formatDate","dateString","date","toLocaleDateString","year","month","day","loading","updateAvatar","completenessResponse","getCompleteness","data","code","message","handleImageError","e","src","type","maxSize","size","showAvatarCropper","avatarUploadRef","img","Image","deep"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/MyProfile/components/BasicInfo.vue"],"sourcesContent":["<!-- src/views/user/MyProfile/components/BasicInfo.vue -->\n<template>\n  <div class=\"bg-white rounded-lg shadow\">\n    <!-- 个人信息卡片 -->\n    <div class=\"px-6 py-6\">\n      <!-- 标题 -->\n      <div class=\"flex items-center mb-6\">\n        <UserIcon class=\"w-5 h-5 text-gray-900 mr-2\" />\n        <h2 class=\"text-base font-medium text-gray-900\">基本信息</h2>\n      </div>\n\n      <!-- 头像和基本信息 -->\n      <div class=\"flex items-start space-x-6 mb-8\">\n        <!-- 头像部分 -->\n        <div class=\"relative group\">\n          <img \n            :src=\"userAvatar\"\n            :key=\"avatarUpdateTime\"\n            class=\"w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg user-avatar\"\n            alt=\"用户头像\"\n            @error=\"handleImageError\"\n          />\n          <div \n            @click=\"showAvatarCropper = true\"\n            class=\"absolute inset-0 flex items-center justify-center rounded-full bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity duration-200\"\n          >\n            <CameraIcon class=\"w-8 h-8 text-white\" />\n          </div>\n          <!-- 性别标识 -->\n          <div class=\"absolute bottom-0 right-0 bg-white rounded-full p-1.5 shadow\">\n            <!-- 男性图标 -->\n            <svg \n              v-if=\"currentGender === 'male'\" \n              class=\"w-5 h-5 text-blue-500\" \n              viewBox=\"0 0 24 24\" \n              fill=\"none\" \n              stroke=\"currentColor\"\n            >\n              <circle cx=\"12\" cy=\"12\" r=\"5\" stroke-width=\"2\"/>\n              <path d=\"M16 8L21 3\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n              <path d=\"M21 3H16M21 3V8\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n            <!-- 女性图标 -->\n            <svg \n              v-else-if=\"currentGender === 'female'\" \n              class=\"w-5 h-5 text-pink-500\" \n              viewBox=\"0 0 24 24\" \n              fill=\"none\" \n              stroke=\"currentColor\"\n            >\n              <circle cx=\"12\" cy=\"10\" r=\"5\" stroke-width=\"2\"/>\n              <path d=\"M12 15V21\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n              <path d=\"M9 18H15\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n            </svg>\n          </div>\n        </div>\n\n        <!-- 名字和简介 -->\n        <div class=\"flex-1\">\n          <div class=\"flex items-center justify-between\">\n            <h1 class=\"text-xl font-bold text-gray-900\">{{ formatBasicInfo.name }}</h1>\n            <button\n              @click=\"handleEdit\"\n              class=\"p-1.5 rounded-full hover:bg-gray-100 transition-colors\"\n            >\n              <PencilSquareIcon class=\"w-4 h-4 text-gray-500\" />\n            </button>\n          </div>\n          <p class=\"mt-2 text-sm text-gray-600\">{{ formatBasicInfo.personal_summary || '这个人很懒，还没有填写个人简介' }}</p>\n        </div>\n      </div>\n\n      <!-- 基本信息部分 -->\n      <div>\n        <!-- 信息网格 -->\n        <div class=\"grid grid-cols-2 gap-x-12 gap-y-4 border-t border-gray-100 pt-6\">\n          <!-- 联系方式 -->\n          <div>\n            <h2 class=\"text-xs font-medium text-gray-500 mb-3\">联系方式</h2>\n            <div class=\"flex items-center space-x-2\">\n              <PhoneIcon class=\"w-4 h-4 text-gray-400\" />\n              <span class=\"text-sm text-gray-900\">{{ formatBasicInfo.phone }}</span>\n            </div>\n            <div class=\"flex items-center space-x-2 mt-2\">\n              <EnvelopeIcon class=\"w-4 h-4 text-gray-400\" />\n              <span class=\"text-sm text-gray-900\">{{ formatBasicInfo.email }}</span>\n            </div>\n          </div>\n\n          <!-- 基本资料 -->\n          <div>\n            <h2 class=\"text-xs font-medium text-gray-500 mb-3\">基本资料</h2>\n            <div class=\"flex items-center space-x-2\">\n              <MapPinIcon class=\"w-4 h-4 text-gray-400\" />\n              <span class=\"text-sm text-gray-900\">{{ formatBasicInfo.location }}</span>\n            </div>\n            <div class=\"flex items-center space-x-2 mt-2\">\n              <CakeIcon class=\"w-4 h-4 text-gray-400\" />\n              <span class=\"text-sm text-gray-900\">{{ formatBasicInfo.age }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- 新的头像裁剪组件 -->\n  <ProfileAvatarCropper\n    ref=\"avatarUploadRef\"\n    v-model=\"showAvatarCropper\"\n    @upload=\"handleAvatarUpload\"\n  />\n\n  <div v-if=\"pageLoading\" class=\"loading-state\">\n    <!-- loading 内容 -->\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, nextTick, watch, onMounted } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport defaultAvatarImage from '@/assets/images/default-avatar.png'\nimport { useStore } from 'vuex'\nimport { MEDIA_URL } from '@/config'\nimport { showToast } from '@/components/ToastMessage'\nimport {\n  PencilIcon,\n  PhoneIcon,\n  EnvelopeIcon,\n  MapPinIcon,\n  BriefcaseIcon,\n  ClockIcon,\n  CurrencyYenIcon,\n  DocumentTextIcon,\n  CameraIcon,\n  UserIcon,\n  CalendarIcon,\n  ChevronDownIcon,\n  ChevronUpIcon,\n  CakeIcon,\n  PencilSquareIcon\n} from '@heroicons/vue/24/outline'\nimport profile from '@/api/profile'\nimport { eventBus } from '@/utils/eventBus'\nimport {\n  Dialog,\n  DialogPanel,\n  DialogTitle,\n  TransitionChild,\n  TransitionRoot\n} from '@headlessui/vue'\nimport ProfileAvatarCropper from '@/components/ProfileAvatarCropper.vue'\nimport { useAccountStore } from '@/stores/account'\nimport { useProfileStore } from '@/stores/profile'\n\n// 1. 首先声明 props\nconst props = defineProps({\n  resumeData: {\n    type: Object,\n    default: () => ({})\n  },\n  loading: {\n    type: Boolean,\n    default: false\n  },\n  bioExpanded: {\n    type: Boolean,\n    default: false\n  },\n  showBioExpandButton: {\n    type: Boolean,\n    default: false\n  }\n})\n\n// 2. 声明 emits\nconst emit = defineEmits(['update', 'edit', 'toggleBioExpand'])\n\n// 3. 导入和初始化其他变量\nconst store = useStore()\nconst pageLoading = ref(true)\nconst basicInfo = ref({})\nconst profileStore = useProfileStore()\n\n// 4. 计算属性\nconst formatBasicInfo = computed(() => {\n  // 优先使用父组件传入的 resumeData\n  const info = props.resumeData || {}\n  \n  return {\n    name: info.name || info.username || '未填写',  // 添加 username 作为备选\n    gender: formatGender(info.gender),\n    phone: info.phone || '未填写',\n    email: info.email || '未填写',\n    location: info.location || '未填写',\n    age: calculateAge(info.birth_date) || '未填写',\n    personal_summary: info.personal_summary || '未填写'\n  }\n})\n\n// 添加一个 ref 来存储完整的头像 URL\nconst avatarUrl = ref('')\nconst avatarUpdateTime = ref(Date.now())\n\n// 修改计算属性\nconst userAvatar = computed(() => {\n  // 优先使用 store 中的头像\n  const avatar = profileStore.profileAvatarUrl || props.resumeData?.avatar\n  \n  console.log('Computing userAvatar:', {\n    storeAvatar: profileStore.profileAvatarUrl,\n    propsAvatar: props.resumeData?.avatar,\n    finalAvatar: avatar,\n    updateTime: avatarUpdateTime.value\n  })\n\n  if (!avatar) {\n    avatarUrl.value = defaultAvatarImage\n    return defaultAvatarImage\n  }\n  \n  // 如果是完整的URL，直接使用\n  if (avatar.startsWith('http') || avatar.startsWith('data:image')) {\n    avatarUrl.value = avatar\n    return avatar\n  }\n  \n  // 处理相对路径，移除可能的前导 /media/ 并确保路径正确\n  const cleanPath = avatar.replace(/^\\/?(media\\/)?/, '')\n  const fullUrl = `${config.mediaURL}/${cleanPath}`\n  \n  // 添加时间戳参数来避免缓存\n  avatarUrl.value = `${fullUrl}?t=${avatarUpdateTime.value}`\n  return avatarUrl.value\n})\n\nconst currentGender = computed(() => {\n  return props.resumeData?.gender\n})\n\n// 5. 监听器\nwatch(\n  () => props.resumeData,\n  (newVal) => {\n    if (newVal && Object.keys(newVal).length > 0) {\n      pageLoading.value = false\n    }\n  },\n  { immediate: true }\n)\n\n// 6. 生命周期钩子\nonMounted(async () => {\n  try {\n    pageLoading.value = true\n    // 不需要在这里获取数据，因为父组件会处理\n  } catch (error) {\n    console.error('初始化失败:', error)\n  } finally {\n    pageLoading.value = false\n  }\n})\n\nonMounted(async () => {\n  try {\n    await store.dispatch('fetchCompleteness')\n  } catch (error) {\n    console.error('Failed to fetch completeness:', error)\n  }\n})\n\n// 7. 方法定义\nconst handleFileChange = async (event) => {\n  const file = event.target.files[0]\n  if (!file) return\n\n  // 验证文件\n  if (!validateFile(file)) {\n    return\n  }\n\n  await handleAvatarUpload(file)\n  \n  // 清空文件选择器，以便能够选择同一个文件\n  event.target.value = ''\n}\n\nconst handleEdit = () => {\n  console.log('BasicInfo handleEdit - 当前数据:', props.resumeData)\n  // 确保传递正确的数据结构\n  const editData = {\n    name: props.resumeData.name,\n    gender: props.resumeData.gender,\n    birth_date: props.resumeData.birth_date,\n    phone: props.resumeData.phone,\n    email: props.resumeData.email,\n    location: props.resumeData.location,\n    personal_summary: props.resumeData.personal_summary\n  }\n  emit('edit', 'basic_info', editData)\n}\n\nconst toggleBioExpand = () => {\n  emit('toggleBioExpand')\n}\n\n// 8. 工具函数\nconst calculateAge = (birthDate) => {\n  if (!birthDate) return ''\n  \n  const birth = new Date(birthDate)\n  const today = new Date()\n  \n  let age = today.getFullYear() - birth.getFullYear()\n  const monthDiff = today.getMonth() - birth.getMonth()\n  \n  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n    age--\n  }\n  \n  return `${age}岁`\n}\n\nconst formatGender = (gender) => {\n  const genderMap = {\n    male: '男',\n    female: '女',\n    other: '其他'\n  }\n  return genderMap[gender] || '未填写'\n}\n\nconst formatDate = (dateString) => {\n  if (!dateString) return ''\n  const date = new Date(dateString)\n  return date.toLocaleDateString('zh-CN', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  })\n}\n\n// 修改头像上传处理函数\nconst handleAvatarUpload = async (file) => {\n  try {\n    loading.value = true\n    // 使用 profileStore 上传头像\n    await profileStore.updateAvatar(file)\n    \n    // 触发头像更新事件\n    eventBus.emit('avatar-updated')\n    \n    // 获取最新的完整度数据并触发更新事件\n    const completenessResponse = await profile.getCompleteness()\n    if (completenessResponse.data?.code === 200) {\n      eventBus.emit('completeness-updated')\n    }\n    \n    showToast('头像上传成功', 'success')\n  } catch (error) {\n    console.error('头像上传失败:', error)\n    showToast(error.message || '头像上传失败，请重试', 'error')\n  } finally {\n    loading.value = false\n  }\n}\n\n// 添加图片加载错误处理\nconst handleImageError = (e) => {\n  e.target.src = defaultAvatarImage\n}\n\n// 添加文件验证\nconst validateFile = (file) => {\n  // 验证文件类型\n  if (!file.type.startsWith('image/')) {\n    showToast('请选择图片文件', 'error')\n    return false\n  }\n\n  // 验证文件大小（例如限制为 2MB）\n  const maxSize = 20 * 1024 * 1024 // 2MB\n  if (file.size > maxSize) {\n    showToast('图片大小不能超过 2MB', 'error')\n    return false\n  }\n\n  return true\n}\n\n// 添加状态\nconst showAvatarCropper = ref(false)\nconst avatarUploadRef = ref(null)\nconst loading = ref(false)\n\n// 监听 resumeData 变化\nwatch(\n  () => props.resumeData,\n  (newVal) => {\n    if (newVal) {\n      // 强制更新组件\n      nextTick(() => {\n        if (props.resumeData?.avatar) {\n          const img = new Image()\n          img.src = userAvatar.value\n        }\n      })\n    }\n  },\n  { deep: true }\n)\n</script>"],"mappings":"AAuHA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,SAAS,QAAQ,KAAI;AAC9D,SAASC,SAAS,QAAQ,cAAa;AACvC,OAAOC,kBAAkB,MAAM,oCAAmC;AAClE,SAASC,QAAQ,QAAQ,MAAK;AAC9B,SAASC,SAAS,QAAQ,UAAS;AACnC,SAASC,SAAS,QAAQ,2BAA0B;AACpD,SACEC,UAAU,EACVC,SAAS,EACTC,YAAY,EACZC,UAAU,EACVC,aAAa,EACbC,SAAS,EACTC,eAAe,EACfC,gBAAgB,EAChBC,UAAU,EACVC,QAAQ,EACRC,YAAY,EACZC,eAAe,EACfC,aAAa,EACbC,QAAQ,EACRC,gBAAe,QACV,2BAA0B;AACjC,OAAOC,OAAO,MAAM,eAAc;AAClC,SAASC,QAAQ,QAAQ,kBAAiB;AAC1C,SACEC,MAAM,EACNC,WAAW,EACXC,WAAW,EACXC,eAAe,EACfC,cAAa,QACR,iBAAgB;AACvB,OAAOC,oBAAoB,MAAM,uCAAsC;AACvE,SAASC,eAAe,QAAQ,kBAAiB;AACjD,SAASC,eAAe,QAAQ,kBAAiB;;AAEjD;;;;;;;;;;;;;;;;;;;;;;;;;;;;IACA,MAAMC,KAAK,GAAGC,OAAA;;IAmBd;IACA,MAAMC,IAAI,GAAGC,MAAA;;IAEb;IACA,MAAMC,KAAK,GAAGhC,QAAQ,CAAC;IACvB,MAAMiC,WAAW,GAAGxC,GAAG,CAAC,IAAI;IAC5B,MAAMyC,SAAS,GAAGzC,GAAG,CAAC,CAAC,CAAC;IACxB,MAAM0C,YAAY,GAAGR,eAAe,CAAC;;IAErC;IACA,MAAMS,eAAe,GAAG1C,QAAQ,CAAC,MAAM;MACrC;MACA,MAAM2C,IAAI,GAAGT,KAAK,CAACU,UAAU,IAAI,CAAC;MAElC,OAAO;QACLC,IAAI,EAAEF,IAAI,CAACE,IAAI,IAAIF,IAAI,CAACG,QAAQ,IAAI,KAAK;QAAG;QAC5CC,MAAM,EAAEC,YAAY,CAACL,IAAI,CAACI,MAAM,CAAC;QACjCE,KAAK,EAAEN,IAAI,CAACM,KAAK,IAAI,KAAK;QAC1BC,KAAK,EAAEP,IAAI,CAACO,KAAK,IAAI,KAAK;QAC1BC,QAAQ,EAAER,IAAI,CAACQ,QAAQ,IAAI,KAAK;QAChCC,GAAG,EAAEC,YAAY,CAACV,IAAI,CAACW,UAAU,CAAC,IAAI,KAAK;QAC3CC,gBAAgB,EAAEZ,IAAI,CAACY,gBAAgB,IAAI;MAC7C;IACF,CAAC;;IAED;IACA,MAAMC,SAAS,GAAGzD,GAAG,CAAC,EAAE;IACxB,MAAM0D,gBAAgB,GAAG1D,GAAG,CAAC2D,IAAI,CAACC,GAAG,CAAC,CAAC;;IAEvC;IACA,MAAMC,UAAU,GAAG5D,QAAQ,CAAC,MAAM;MAChC;MACA,MAAM6D,MAAM,GAAGpB,YAAY,CAACqB,gBAAgB,IAAI5B,KAAK,CAACU,UAAU,EAAEiB,MAAK;MAEvEE,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAE;QACnCC,WAAW,EAAExB,YAAY,CAACqB,gBAAgB;QAC1CI,WAAW,EAAEhC,KAAK,CAACU,UAAU,EAAEiB,MAAM;QACrCM,WAAW,EAAEN,MAAM;QACnBO,UAAU,EAAEX,gBAAgB,CAACY;MAC/B,CAAC;MAED,IAAI,CAACR,MAAM,EAAE;QACXL,SAAS,CAACa,KAAK,GAAGhE,kBAAiB;QACnC,OAAOA,kBAAiB;MAC1B;;MAEA;MACA,IAAIwD,MAAM,CAACS,UAAU,CAAC,MAAM,CAAC,IAAIT,MAAM,CAACS,UAAU,CAAC,YAAY,CAAC,EAAE;QAChEd,SAAS,CAACa,KAAK,GAAGR,MAAK;QACvB,OAAOA,MAAK;MACd;;MAEA;MACA,MAAMU,SAAS,GAAGV,MAAM,CAACW,OAAO,CAAC,gBAAgB,EAAE,EAAE;MACrD,MAAMC,OAAO,GAAG,GAAGC,MAAM,CAACC,QAAQ,IAAIJ,SAAS,EAAC;;MAEhD;MACAf,SAAS,CAACa,KAAK,GAAG,GAAGI,OAAO,MAAMhB,gBAAgB,CAACY,KAAK,EAAC;MACzD,OAAOb,SAAS,CAACa,KAAI;IACvB,CAAC;IAED,MAAMO,aAAa,GAAG5E,QAAQ,CAAC,MAAM;MACnC,OAAOkC,KAAK,CAACU,UAAU,EAAEG,MAAK;IAChC,CAAC;;IAED;IACA7C,KAAK,CACH,MAAMgC,KAAK,CAACU,UAAU,EACrBiC,MAAM,IAAK;MACV,IAAIA,MAAM,IAAIC,MAAM,CAACC,IAAI,CAACF,MAAM,CAAC,CAACG,MAAM,GAAG,CAAC,EAAE;QAC5CzC,WAAW,CAAC8B,KAAK,GAAG,KAAI;MAC1B;IACF,CAAC,EACD;MAAEY,SAAS,EAAE;IAAK,CACpB;;IAEA;IACA9E,SAAS,CAAC,YAAY;MACpB,IAAI;QACFoC,WAAW,CAAC8B,KAAK,GAAG,IAAG;QACvB;MACF,CAAC,CAAC,OAAOa,KAAK,EAAE;QACdnB,OAAO,CAACmB,KAAK,CAAC,QAAQ,EAAEA,KAAK;MAC/B,CAAC,SAAS;QACR3C,WAAW,CAAC8B,KAAK,GAAG,KAAI;MAC1B;IACF,CAAC;IAEDlE,SAAS,CAAC,YAAY;MACpB,IAAI;QACF,MAAMmC,KAAK,CAAC6C,QAAQ,CAAC,mBAAmB;MAC1C,CAAC,CAAC,OAAOD,KAAK,EAAE;QACdnB,OAAO,CAACmB,KAAK,CAAC,+BAA+B,EAAEA,KAAK;MACtD;IACF,CAAC;;IAED;IACA,MAAME,gBAAgB,GAAG,MAAOC,KAAK,IAAK;MACxC,MAAMC,IAAI,GAAGD,KAAK,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC;MACjC,IAAI,CAACF,IAAI,EAAE;;MAEX;MACA,IAAI,CAACG,YAAY,CAACH,IAAI,CAAC,EAAE;QACvB;MACF;MAEA,MAAMI,kBAAkB,CAACJ,IAAI;;MAE7B;MACAD,KAAK,CAACE,MAAM,CAAClB,KAAK,GAAG,EAAC;IACxB;IAEA,MAAMsB,UAAU,GAAGA,CAAA,KAAM;MACvB5B,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAE9B,KAAK,CAACU,UAAU;MAC5D;MACA,MAAMgD,QAAQ,GAAG;QACf/C,IAAI,EAAEX,KAAK,CAACU,UAAU,CAACC,IAAI;QAC3BE,MAAM,EAAEb,KAAK,CAACU,UAAU,CAACG,MAAM;QAC/BO,UAAU,EAAEpB,KAAK,CAACU,UAAU,CAACU,UAAU;QACvCL,KAAK,EAAEf,KAAK,CAACU,UAAU,CAACK,KAAK;QAC7BC,KAAK,EAAEhB,KAAK,CAACU,UAAU,CAACM,KAAK;QAC7BC,QAAQ,EAAEjB,KAAK,CAACU,UAAU,CAACO,QAAQ;QACnCI,gBAAgB,EAAErB,KAAK,CAACU,UAAU,CAACW;MACrC;MACAnB,IAAI,CAAC,MAAM,EAAE,YAAY,EAAEwD,QAAQ;IACrC;IAEA,MAAMC,eAAe,GAAGA,CAAA,KAAM;MAC5BzD,IAAI,CAAC,iBAAiB;IACxB;;IAEA;IACA,MAAMiB,YAAY,GAAIyC,SAAS,IAAK;MAClC,IAAI,CAACA,SAAS,EAAE,OAAO,EAAC;MAExB,MAAMC,KAAK,GAAG,IAAIrC,IAAI,CAACoC,SAAS;MAChC,MAAME,KAAK,GAAG,IAAItC,IAAI,CAAC;MAEvB,IAAIN,GAAG,GAAG4C,KAAK,CAACC,WAAW,CAAC,CAAC,GAAGF,KAAK,CAACE,WAAW,CAAC;MAClD,MAAMC,SAAS,GAAGF,KAAK,CAACG,QAAQ,CAAC,CAAC,GAAGJ,KAAK,CAACI,QAAQ,CAAC;MAEpD,IAAID,SAAS,GAAG,CAAC,IAAKA,SAAS,KAAK,CAAC,IAAIF,KAAK,CAACI,OAAO,CAAC,CAAC,GAAGL,KAAK,CAACK,OAAO,CAAC,CAAE,EAAE;QAC3EhD,GAAG,EAAC;MACN;MAEA,OAAO,GAAGA,GAAG,GAAE;IACjB;IAEA,MAAMJ,YAAY,GAAID,MAAM,IAAK;MAC/B,MAAMsD,SAAS,GAAG;QAChBC,IAAI,EAAE,GAAG;QACTC,MAAM,EAAE,GAAG;QACXC,KAAK,EAAE;MACT;MACA,OAAOH,SAAS,CAACtD,MAAM,CAAC,IAAI,KAAI;IAClC;IAEA,MAAM0D,UAAU,GAAIC,UAAU,IAAK;MACjC,IAAI,CAACA,UAAU,EAAE,OAAO,EAAC;MACzB,MAAMC,IAAI,GAAG,IAAIjD,IAAI,CAACgD,UAAU;MAChC,OAAOC,IAAI,CAACC,kBAAkB,CAAC,OAAO,EAAE;QACtCC,IAAI,EAAE,SAAS;QACfC,KAAK,EAAE,MAAM;QACbC,GAAG,EAAE;MACP,CAAC;IACH;;IAEA;IACA,MAAMrB,kBAAkB,GAAG,MAAOJ,IAAI,IAAK;MACzC,IAAI;QACF0B,OAAO,CAAC3C,KAAK,GAAG,IAAG;QACnB;QACA,MAAM5B,YAAY,CAACwE,YAAY,CAAC3B,IAAI;;QAEpC;QACA7D,QAAQ,CAACW,IAAI,CAAC,gBAAgB;;QAE9B;QACA,MAAM8E,oBAAoB,GAAG,MAAM1F,OAAO,CAAC2F,eAAe,CAAC;QAC3D,IAAID,oBAAoB,CAACE,IAAI,EAAEC,IAAI,KAAK,GAAG,EAAE;UAC3C5F,QAAQ,CAACW,IAAI,CAAC,sBAAsB;QACtC;QAEA5B,SAAS,CAAC,QAAQ,EAAE,SAAS;MAC/B,CAAC,CAAC,OAAO0E,KAAK,EAAE;QACdnB,OAAO,CAACmB,KAAK,CAAC,SAAS,EAAEA,KAAK;QAC9B1E,SAAS,CAAC0E,KAAK,CAACoC,OAAO,IAAI,YAAY,EAAE,OAAO;MAClD,CAAC,SAAS;QACRN,OAAO,CAAC3C,KAAK,GAAG,KAAI;MACtB;IACF;;IAEA;IACA,MAAMkD,gBAAgB,GAAIC,CAAC,IAAK;MAC9BA,CAAC,CAACjC,MAAM,CAACkC,GAAG,GAAGpH,kBAAiB;IAClC;;IAEA;IACA,MAAMoF,YAAY,GAAIH,IAAI,IAAK;MAC7B;MACA,IAAI,CAACA,IAAI,CAACoC,IAAI,CAACpD,UAAU,CAAC,QAAQ,CAAC,EAAE;QACnC9D,SAAS,CAAC,SAAS,EAAE,OAAO;QAC5B,OAAO,KAAI;MACb;;MAEA;MACA,MAAMmH,OAAO,GAAG,EAAE,GAAG,IAAI,GAAG,IAAI,EAAC;MACjC,IAAIrC,IAAI,CAACsC,IAAI,GAAGD,OAAO,EAAE;QACvBnH,SAAS,CAAC,cAAc,EAAE,OAAO;QACjC,OAAO,KAAI;MACb;MAEA,OAAO,IAAG;IACZ;;IAEA;IACA,MAAMqH,iBAAiB,GAAG9H,GAAG,CAAC,KAAK;IACnC,MAAM+H,eAAe,GAAG/H,GAAG,CAAC,IAAI;IAChC,MAAMiH,OAAO,GAAGjH,GAAG,CAAC,KAAK;;IAEzB;IACAG,KAAK,CACH,MAAMgC,KAAK,CAACU,UAAU,EACrBiC,MAAM,IAAK;MACV,IAAIA,MAAM,EAAE;QACV;QACA5E,QAAQ,CAAC,MAAM;UACb,IAAIiC,KAAK,CAACU,UAAU,EAAEiB,MAAM,EAAE;YAC5B,MAAMkE,GAAG,GAAG,IAAIC,KAAK,CAAC;YACtBD,GAAG,CAACN,GAAG,GAAG7D,UAAU,CAACS,KAAI;UAC3B;QACF,CAAC;MACH;IACF,CAAC,EACD;MAAE4D,IAAI,EAAE;IAAK,CACf","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}