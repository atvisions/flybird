{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createVNode as _createVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, createBlock as _createBlock, normalizeStyle as _normalizeStyle, createElementVNode as _createElementVNode, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"component-actions\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_button_group = _resolveComponent(\"el-button-group\");\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: \"editor-canvas\",\n    onDragover: _cache[1] || (_cache[1] = _withModifiers(() => {}, [\"prevent\"])),\n    onDrop: $setup.handleDrop\n  }, [_createElementVNode(\"div\", {\n    class: \"canvas-container\",\n    style: _normalizeStyle($setup.containerStyle)\n  }, [_createVNode($setup[\"GridLayout\"], {\n    layout: $setup.layoutModel,\n    \"onUpdate:layout\": _cache[0] || (_cache[0] = $event => $setup.layoutModel = $event),\n    \"col-num\": 12,\n    \"row-height\": 30,\n    \"is-draggable\": true,\n    \"is-resizable\": true,\n    \"vertical-compact\": true,\n    \"use-css-transforms\": true,\n    margin: [10, 10],\n    onLayoutUpdated: $setup.handleLayoutUpdate\n  }, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.layoutModel, item => {\n      return _openBlock(), _createBlock($setup[\"GridItem\"], {\n        key: item.id,\n        x: item.x,\n        y: item.y,\n        w: item.w,\n        h: item.h,\n        i: item.id,\n        \"min-w\": 3,\n        \"min-h\": 3,\n        \"is-draggable\": true,\n        \"is-resizable\": true,\n        class: _normalizeClass({\n          active: $setup.selectedId === item.id\n        }),\n        onClick: $event => $setup.handleSelect(item.id),\n        onResize: $setup.handleResize,\n        onMoved: $setup.handleMoved\n      }, {\n        default: _withCtx(() => [_createVNode($setup[\"ComponentRenderer\"], {\n          type: $props.components[item.id].type,\n          data: $props.components[item.id].data,\n          styles: $props.components[item.id].styles\n        }, null, 8 /* PROPS */, [\"type\", \"data\", \"styles\"]), $setup.selectedId === item.id ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_button_group, null, {\n          default: _withCtx(() => [_createVNode(_component_el_button, {\n            size: \"small\",\n            onClick: $event => $setup.handleMoveUp(item.id)\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n              default: _withCtx(() => [_createVNode($setup[\"ArrowUp\"])]),\n              _: 1 /* STABLE */\n            })]),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]), _createVNode(_component_el_button, {\n            size: \"small\",\n            onClick: $event => $setup.handleMoveDown(item.id)\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n              default: _withCtx(() => [_createVNode($setup[\"ArrowDown\"])]),\n              _: 1 /* STABLE */\n            })]),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]), _createVNode(_component_el_button, {\n            size: \"small\",\n            onClick: $event => $setup.handleDelete(item.id)\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n              default: _withCtx(() => [_createVNode($setup[\"Delete\"])]),\n              _: 1 /* STABLE */\n            })]),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])]),\n          _: 2 /* DYNAMIC */\n        }, 1024 /* DYNAMIC_SLOTS */)])) : _createCommentVNode(\"v-if\", true)]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"x\", \"y\", \"w\", \"h\", \"i\", \"class\", \"onClick\"]);\n    }), 128 /* KEYED_FRAGMENT */))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"layout\"])], 4 /* STYLE */)], 32 /* NEED_HYDRATION */);\n}","map":{"version":3,"names":["key","class","_createElementBlock","onDragover","_cache","_withModifiers","onDrop","$setup","handleDrop","_createElementVNode","style","_normalizeStyle","containerStyle","_createVNode","layout","layoutModel","$event","margin","onLayoutUpdated","handleLayoutUpdate","default","_withCtx","_Fragment","_renderList","item","_createBlock","id","x","y","w","h","i","_normalizeClass","active","selectedId","onClick","handleSelect","onResize","handleResize","onMoved","handleMoved","type","$props","components","data","styles","_hoisted_1","_component_el_button_group","_component_el_button","size","handleMoveUp","_component_el_icon","_","handleMoveDown","handleDelete","_createCommentVNode"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/template-editor/components/canvas/EditorCanvas.vue"],"sourcesContent":["<template>\n  <div \n    class=\"editor-canvas\"\n    @dragover.prevent\n    @drop=\"handleDrop\"\n  >\n    <div \n      class=\"canvas-container\"\n      :style=\"containerStyle\"\n    >\n      <grid-layout\n        v-model:layout=\"layoutModel\"\n        :col-num=\"12\"\n        :row-height=\"30\"\n        :is-draggable=\"true\"\n        :is-resizable=\"true\"\n        :vertical-compact=\"true\"\n        :use-css-transforms=\"true\"\n        :margin=\"[10, 10]\"\n        @layout-updated=\"handleLayoutUpdate\"\n      >\n        <grid-item\n          v-for=\"item in layoutModel\"\n          :key=\"item.id\"\n          :x=\"item.x\"\n          :y=\"item.y\"\n          :w=\"item.w\"\n          :h=\"item.h\"\n          :i=\"item.id\"\n          :min-w=\"3\"\n          :min-h=\"3\"\n          :is-draggable=\"true\"\n          :is-resizable=\"true\"\n          :class=\"{ active: selectedId === item.id }\"\n          @click=\"handleSelect(item.id)\"\n          @resize=\"handleResize\"\n          @moved=\"handleMoved\"\n        >\n          <component-renderer\n            :type=\"components[item.id].type\"\n            :data=\"components[item.id].data\"\n            :styles=\"components[item.id].styles\"\n          />\n          <div class=\"component-actions\" v-if=\"selectedId === item.id\">\n            <el-button-group>\n              <el-button size=\"small\" @click=\"handleMoveUp(item.id)\">\n                <el-icon><ArrowUp /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleMoveDown(item.id)\">\n                <el-icon><ArrowDown /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleDelete(item.id)\">\n                <el-icon><Delete /></el-icon>\n              </el-button>\n            </el-button-group>\n          </div>\n        </grid-item>\n      </grid-layout>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport VueGridLayout from 'vue-grid-layout'\nimport { ArrowUp, ArrowDown, Delete } from '@element-plus/icons-vue'\nimport ComponentRenderer from '../widgets/ComponentRenderer.vue'\n\nconst GridLayout = VueGridLayout.GridLayout\nconst GridItem = VueGridLayout.GridItem\n\nconst props = defineProps({\n  modelValue: {\n    type: Array,\n    required: true\n  },\n  components: {\n    type: Object,\n    required: true\n  },\n  styles: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'select', 'add-component'])\n\n// 布局数据\nconst layoutModel = computed({\n  get: () => props.modelValue,\n  set: (value) => emit('update:modelValue', value)\n})\n\n// 选中的组件ID\nconst selectedId = ref(null)\n\n// 容器样式\nconst containerStyle = computed(() => ({\n  width: '210mm', // A4 宽度\n  height: '297mm', // A4 高度\n  margin: '0 auto',\n  background: '#fff',\n  boxShadow: '0 0 10px rgba(0, 0, 0, 0.1)',\n  ...props.styles\n}))\n\n// 处理组件选中\nconst handleSelect = (id) => {\n  selectedId.value = id\n  emit('select', id)\n}\n\n// 处理组件拖放\nconst handleDrop = (event) => {\n  event.preventDefault()\n  try {\n    const componentData = JSON.parse(event.dataTransfer.getData('application/json'))\n    const rect = event.currentTarget.getBoundingClientRect()\n    const x = Math.floor((event.clientX - rect.left) / (rect.width / 12))\n    const y = Math.floor((event.clientY - rect.top) / 30)\n    \n    emit('add-component', {\n      ...componentData,\n      position: { x, y }\n    })\n  } catch (error) {\n    console.error('Drop error:', error)\n  }\n}\n\n// 处理布局更新\nconst handleLayoutUpdate = (layout) => {\n  emit('update:modelValue', layout)\n}\n\n// 处理组件调整大小\nconst handleResize = (i, newH, newW) => {\n  const index = layoutModel.value.findIndex(item => item.id === i)\n  if (index > -1) {\n    layoutModel.value[index].h = newH\n    layoutModel.value[index].w = newW\n  }\n}\n\n// 处理组件移动\nconst handleMoved = (i, newX, newY) => {\n  const index = layoutModel.value.findIndex(item => item.id === i)\n  if (index > -1) {\n    layoutModel.value[index].x = newX\n    layoutModel.value[index].y = newY\n  }\n}\n\n// 处理组件上移\nconst handleMoveUp = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  if (index > 0) {\n    const temp = { ...layoutModel.value[index - 1] }\n    layoutModel.value[index - 1] = { ...layoutModel.value[index] }\n    layoutModel.value[index] = temp\n  }\n}\n\n// 处理组件下移\nconst handleMoveDown = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  if (index < layoutModel.value.length - 1) {\n    const temp = { ...layoutModel.value[index + 1] }\n    layoutModel.value[index + 1] = { ...layoutModel.value[index] }\n    layoutModel.value[index] = temp\n  }\n}\n\n// 处理组件删除\nconst handleDelete = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  layoutModel.value.splice(index, 1)\n  selectedId.value = null\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.editor-canvas {\n  @apply flex-1 overflow-y-auto bg-gray-100 p-8;\n  \n  .canvas-container {\n    @apply shadow-lg relative;\n    transform-origin: top center;\n    \n    // 添加页面参考线\n    &::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      border: 1px solid #e0e0e0;\n      pointer-events: none;\n    }\n  }\n  \n  .grid-item {\n    @apply relative border border-transparent;\n    \n    &.active {\n      @apply border-blue-500;\n    }\n    \n    .component-actions {\n      @apply absolute top-2 right-2 z-10;\n    }\n  }\n}\n\n// 网格布局样式\n.vue-grid-layout {\n  @apply bg-white;\n  min-height: 297mm !important;\n}\n\n.vue-grid-item {\n  @apply touch-none;\n  \n  &.vue-grid-placeholder {\n    @apply bg-blue-100 border-2 border-blue-300 border-dashed;\n  }\n  \n  &.vue-draggable-dragging {\n    @apply z-50;\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}