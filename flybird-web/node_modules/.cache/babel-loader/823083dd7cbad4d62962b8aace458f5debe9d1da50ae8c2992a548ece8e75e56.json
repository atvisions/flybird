{"ast":null,"code":"import _objectSpread from \"/Users/liuzhao/Documents/Projects/flybird/flybird-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport { ref, computed, onMounted } from 'vue';\nimport { useRoute } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport EditorToolbar from '../components/toolbar/EditorToolbar.vue';\nimport ComponentPanel from '../components/panels/ComponentPanel.vue';\nimport EditorCanvas from '../components/canvas/EditorCanvas.vue';\nimport PropertyPanel from '../components/panels/PropertyPanel.vue';\nimport { useTemplateStore } from '../store/template';\nimport { useComponentStore } from '../store/component';\n\n// 模板数据\n\nexport default {\n  __name: 'TemplateEditor',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const template = ref({\n      id: null,\n      name: '',\n      category: null,\n      layout: [],\n      components: {},\n      styles: {}\n    });\n\n    // 计算属性，确保数据的安全访问\n    const templateData = computed(() => ({\n      layout: template.value?.layout || [],\n      components: template.value?.components || {},\n      styles: template.value?.styles || {}\n    }));\n\n    // 选中的组件\n    const selectedComponent = ref(null);\n\n    // 获取可用组件列表\n    const componentStore = useComponentStore();\n    const availableComponents = computed(() => componentStore.components);\n\n    // 路由参数\n    const route = useRoute();\n    const templateStore = useTemplateStore();\n\n    // 初始化\n    onMounted(async () => {\n      // 如果有模板ID，加载模板数据\n      if (route.params.id) {\n        const data = await templateStore.getTemplate(route.params.id);\n        template.value = _objectSpread({}, data);\n      } else {\n        // 初始化一个空模板\n        template.value = {\n          id: null,\n          name: '新建模板',\n          category: null,\n          layout: [],\n          components: {},\n          styles: {}\n        };\n      }\n\n      // 加载可用组件\n      await componentStore.loadComponents();\n\n      // 添加默认组件\n      const defaultComponents = [{\n        type: 'basic_info',\n        position: {\n          x: 0,\n          y: 0\n        },\n        data: componentStore.components.find(c => c.type === 'basic_info')?.demo_data || {}\n      }, {\n        type: 'job_intention',\n        position: {\n          x: 0,\n          y: 4\n        },\n        data: componentStore.components.find(c => c.type === 'job_intention')?.demo_data || {}\n      }, {\n        type: 'education',\n        position: {\n          x: 0,\n          y: 8\n        },\n        data: componentStore.components.find(c => c.type === 'education')?.demo_data || {}\n      }];\n\n      // 如果是新建模板，添加默认组件\n      if (!route.params.id) {\n        defaultComponents.forEach(component => {\n          handleAddComponent(component);\n        });\n      }\n    });\n\n    // 处理添加组件\n    const handleAddComponent = component => {\n      console.log('Handling add component:', component);\n\n      // 确保模板数据存在\n      if (!template.value) {\n        template.value = {\n          id: null,\n          name: '新建模板',\n          category: null,\n          layout: [],\n          components: {},\n          styles: {}\n        };\n      }\n      const id = `component_${Date.now()}`;\n\n      // 创建新的组件数据\n      const newComponent = {\n        type: component.type,\n        data: component.data || {},\n        styles: component.styles || {}\n      };\n\n      // 创建新的布局项\n      const newLayoutItem = {\n        id,\n        x: component.position?.x || 0,\n        y: component.position?.y || template.value.layout.length * 4,\n        w: 12,\n        h: 4,\n        i: id // 确保 i 属性与 id 匹配\n      };\n      console.log('New component:', {\n        id,\n        component: newComponent,\n        layout: newLayoutItem\n      });\n\n      // 更新组件数据\n      template.value = _objectSpread(_objectSpread({}, template.value), {}, {\n        components: _objectSpread(_objectSpread({}, template.value.components), {}, {\n          [id]: newComponent\n        }),\n        layout: [...template.value.layout, newLayoutItem]\n      });\n\n      // 选中新添加的组件\n      selectedComponent.value = _objectSpread({\n        id\n      }, newComponent);\n      console.log('Updated template:', template.value);\n    };\n\n    // 处理选中组件\n    const handleSelectComponent = componentId => {\n      selectedComponent.value = template.value?.components?.[componentId] ? _objectSpread({\n        id: componentId\n      }, template.value.components[componentId]) : null;\n    };\n\n    // 处理组件更新\n    const handleComponentUpdate = (componentId, data) => {\n      if (template.value?.components) {\n        template.value.components[componentId] = _objectSpread(_objectSpread({}, template.value.components[componentId]), data);\n      }\n    };\n\n    // 处理布局更新\n    const handleLayoutUpdate = layout => {\n      if (template.value) {\n        template.value.layout = layout;\n      }\n    };\n\n    // 保存模板\n    const handleSave = async () => {\n      try {\n        await templateStore.saveTemplate(template.value);\n        ElMessage.success('保存成功');\n      } catch (error) {\n        ElMessage.error('保存失败');\n      }\n    };\n\n    // 预览模板\n    const handlePreview = () => {\n      // 实现预览逻辑\n    };\n\n    // 发布模板\n    const handlePublish = async () => {\n      try {\n        await templateStore.publishTemplate(template.value.id);\n        ElMessage.success('发布成功');\n      } catch (error) {\n        ElMessage.error('发布失败');\n      }\n    };\n    const __returned__ = {\n      template,\n      templateData,\n      selectedComponent,\n      componentStore,\n      availableComponents,\n      route,\n      templateStore,\n      handleAddComponent,\n      handleSelectComponent,\n      handleComponentUpdate,\n      handleLayoutUpdate,\n      handleSave,\n      handlePreview,\n      handlePublish,\n      ref,\n      computed,\n      onMounted,\n      get useRoute() {\n        return useRoute;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      EditorToolbar,\n      ComponentPanel,\n      EditorCanvas,\n      PropertyPanel,\n      get useTemplateStore() {\n        return useTemplateStore;\n      },\n      get useComponentStore() {\n        return useComponentStore;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useRoute","ElMessage","EditorToolbar","ComponentPanel","EditorCanvas","PropertyPanel","useTemplateStore","useComponentStore","template","id","name","category","layout","components","styles","templateData","value","selectedComponent","componentStore","availableComponents","route","templateStore","params","data","getTemplate","_objectSpread","loadComponents","defaultComponents","type","position","x","y","find","c","demo_data","forEach","component","handleAddComponent","console","log","Date","now","newComponent","newLayoutItem","length","w","h","i","handleSelectComponent","componentId","handleComponentUpdate","handleLayoutUpdate","handleSave","saveTemplate","success","error","handlePreview","handlePublish","publishTemplate"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/template-editor/views/TemplateEditor.vue"],"sourcesContent":["<!-- 模板编辑器主视图 -->\n<template>\n  <div class=\"template-editor\">\n    <!-- 顶部工具栏 -->\n    <editor-toolbar \n      :template=\"template.value || {}\"\n      @save=\"handleSave\"\n      @preview=\"handlePreview\"\n      @publish=\"handlePublish\"\n      @update:name=\"name => template.value.name = name\"\n    />\n    \n    <!-- 主要编辑区域 -->\n    <div class=\"editor-main\">\n      <!-- 左侧组件面板 -->\n      <component-panel\n        :components=\"availableComponents\"\n        @add-component=\"handleAddComponent\"\n      />\n      \n      <!-- 中间画布区域 -->\n      <editor-canvas\n        v-model=\"templateData.layout\"\n        :components=\"templateData.components\"\n        :styles=\"templateData.styles\"\n        @select=\"handleSelectComponent\"\n        @update:layout=\"handleLayoutUpdate\"\n      />\n      \n      <!-- 右侧属性面板 -->\n      <property-panel\n        v-if=\"selectedComponent\"\n        :component=\"selectedComponent\"\n        @update=\"handleComponentUpdate\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport EditorToolbar from '../components/toolbar/EditorToolbar.vue'\nimport ComponentPanel from '../components/panels/ComponentPanel.vue'\nimport EditorCanvas from '../components/canvas/EditorCanvas.vue'\nimport PropertyPanel from '../components/panels/PropertyPanel.vue'\nimport { useTemplateStore } from '../store/template'\nimport { useComponentStore } from '../store/component'\n\n// 模板数据\nconst template = ref({\n  id: null,\n  name: '',\n  category: null,\n  layout: [],\n  components: {},\n  styles: {}\n})\n\n// 计算属性，确保数据的安全访问\nconst templateData = computed(() => ({\n  layout: template.value?.layout || [],\n  components: template.value?.components || {},\n  styles: template.value?.styles || {}\n}))\n\n// 选中的组件\nconst selectedComponent = ref(null)\n\n// 获取可用组件列表\nconst componentStore = useComponentStore()\nconst availableComponents = computed(() => componentStore.components)\n\n// 路由参数\nconst route = useRoute()\nconst templateStore = useTemplateStore()\n\n// 初始化\nonMounted(async () => {\n  // 如果有模板ID，加载模板数据\n  if (route.params.id) {\n    const data = await templateStore.getTemplate(route.params.id)\n    template.value = { ...data }\n  } else {\n    // 初始化一个空模板\n    template.value = {\n      id: null,\n      name: '新建模板',\n      category: null,\n      layout: [],\n      components: {},\n      styles: {}\n    }\n  }\n  \n  // 加载可用组件\n  await componentStore.loadComponents()\n  \n  // 添加默认组件\n  const defaultComponents = [\n    {\n      type: 'basic_info',\n      position: { x: 0, y: 0 },\n      data: componentStore.components.find(c => c.type === 'basic_info')?.demo_data || {}\n    },\n    {\n      type: 'job_intention',\n      position: { x: 0, y: 4 },\n      data: componentStore.components.find(c => c.type === 'job_intention')?.demo_data || {}\n    },\n    {\n      type: 'education',\n      position: { x: 0, y: 8 },\n      data: componentStore.components.find(c => c.type === 'education')?.demo_data || {}\n    }\n  ]\n  \n  // 如果是新建模板，添加默认组件\n  if (!route.params.id) {\n    defaultComponents.forEach(component => {\n      handleAddComponent(component)\n    })\n  }\n})\n\n// 处理添加组件\nconst handleAddComponent = (component) => {\n  console.log('Handling add component:', component)\n  \n  // 确保模板数据存在\n  if (!template.value) {\n    template.value = {\n      id: null,\n      name: '新建模板',\n      category: null,\n      layout: [],\n      components: {},\n      styles: {}\n    }\n  }\n  \n  const id = `component_${Date.now()}`\n  \n  // 创建新的组件数据\n  const newComponent = {\n    type: component.type,\n    data: component.data || {},\n    styles: component.styles || {}\n  }\n  \n  // 创建新的布局项\n  const newLayoutItem = {\n    id,\n    x: component.position?.x || 0,\n    y: component.position?.y || template.value.layout.length * 4,\n    w: 12,\n    h: 4,\n    i: id  // 确保 i 属性与 id 匹配\n  }\n  \n  console.log('New component:', { id, component: newComponent, layout: newLayoutItem })\n  \n  // 更新组件数据\n  template.value = {\n    ...template.value,\n    components: {\n      ...template.value.components,\n      [id]: newComponent\n    },\n    layout: [...template.value.layout, newLayoutItem]\n  }\n  \n  // 选中新添加的组件\n  selectedComponent.value = {\n    id,\n    ...newComponent\n  }\n  \n  console.log('Updated template:', template.value)\n}\n\n// 处理选中组件\nconst handleSelectComponent = (componentId) => {\n  selectedComponent.value = template.value?.components?.[componentId]\n    ? {\n        id: componentId,\n        ...template.value.components[componentId]\n      }\n    : null\n}\n\n// 处理组件更新\nconst handleComponentUpdate = (componentId, data) => {\n  if (template.value?.components) {\n    template.value.components[componentId] = {\n      ...template.value.components[componentId],\n      ...data\n    }\n  }\n}\n\n// 处理布局更新\nconst handleLayoutUpdate = (layout) => {\n  if (template.value) {\n    template.value.layout = layout\n  }\n}\n\n// 保存模板\nconst handleSave = async () => {\n  try {\n    await templateStore.saveTemplate(template.value)\n    ElMessage.success('保存成功')\n  } catch (error) {\n    ElMessage.error('保存失败')\n  }\n}\n\n// 预览模板\nconst handlePreview = () => {\n  // 实现预览逻辑\n}\n\n// 发布模板\nconst handlePublish = async () => {\n  try {\n    await templateStore.publishTemplate(template.value.id)\n    ElMessage.success('发布成功')\n  } catch (error) {\n    ElMessage.error('发布失败')\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.template-editor {\n  @apply h-full flex flex-col;\n  \n  .editor-main {\n    @apply flex-1 flex;\n    height: calc(100vh - 64px); // 减去顶部工具栏高度\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}