{"ast":null,"code":"import _objectSpread from \"/Users/liuzhao/Documents/Projects/flybird/flybird-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { ref, computed } from 'vue';\nimport { VueGridLayout } from 'vue-grid-layout';\nimport { ArrowUp, ArrowDown, Delete } from '@element-plus/icons-vue';\nimport ComponentRenderer from '../widgets/ComponentRenderer.vue';\nexport default {\n  __name: 'EditorCanvas',\n  props: {\n    modelValue: {\n      type: Array,\n      required: true\n    },\n    components: {\n      type: Object,\n      required: true\n    },\n    styles: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  emits: ['update:modelValue', 'select'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const {\n      GridLayout,\n      GridItem\n    } = VueGridLayout;\n    const props = __props;\n    const emit = __emit;\n\n    // 布局数据\n    const layoutModel = computed({\n      get: () => props.modelValue,\n      set: value => emit('update:modelValue', value)\n    });\n\n    // 选中的组件ID\n    const selectedId = ref(null);\n\n    // 容器样式\n    const containerStyle = computed(() => _objectSpread({\n      width: '100%',\n      maxWidth: '1200px',\n      margin: '0 auto',\n      minHeight: '100%',\n      background: '#fff'\n    }, props.styles));\n\n    // 处理组件选中\n    const handleSelect = id => {\n      selectedId.value = id;\n      emit('select', id);\n    };\n\n    // 处理组件拖放\n    const handleDrop = event => {\n      const componentData = JSON.parse(event.dataTransfer.getData('component'));\n      emit('add-component', componentData);\n    };\n\n    // 处理组件上移\n    const handleMoveUp = id => {\n      const index = layoutModel.value.findIndex(item => item.id === id);\n      if (index > 0) {\n        const temp = _objectSpread({}, layoutModel.value[index - 1]);\n        layoutModel.value[index - 1] = _objectSpread({}, layoutModel.value[index]);\n        layoutModel.value[index] = temp;\n      }\n    };\n\n    // 处理组件下移\n    const handleMoveDown = id => {\n      const index = layoutModel.value.findIndex(item => item.id === id);\n      if (index < layoutModel.value.length - 1) {\n        const temp = _objectSpread({}, layoutModel.value[index + 1]);\n        layoutModel.value[index + 1] = _objectSpread({}, layoutModel.value[index]);\n        layoutModel.value[index] = temp;\n      }\n    };\n\n    // 处理组件删除\n    const handleDelete = id => {\n      const index = layoutModel.value.findIndex(item => item.id === id);\n      layoutModel.value.splice(index, 1);\n      selectedId.value = null;\n    };\n    const __returned__ = {\n      GridLayout,\n      GridItem,\n      props,\n      emit,\n      layoutModel,\n      selectedId,\n      containerStyle,\n      handleSelect,\n      handleDrop,\n      handleMoveUp,\n      handleMoveDown,\n      handleDelete,\n      ref,\n      computed,\n      get VueGridLayout() {\n        return VueGridLayout;\n      },\n      get ArrowUp() {\n        return ArrowUp;\n      },\n      get ArrowDown() {\n        return ArrowDown;\n      },\n      get Delete() {\n        return Delete;\n      },\n      ComponentRenderer\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","VueGridLayout","ArrowUp","ArrowDown","Delete","ComponentRenderer","GridLayout","GridItem","props","__props","emit","__emit","layoutModel","get","modelValue","set","value","selectedId","containerStyle","_objectSpread","width","maxWidth","margin","minHeight","background","styles","handleSelect","id","handleDrop","event","componentData","JSON","parse","dataTransfer","getData","handleMoveUp","index","findIndex","item","temp","handleMoveDown","length","handleDelete","splice"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/template-editor/components/canvas/EditorCanvas.vue"],"sourcesContent":["<template>\n  <div \n    class=\"editor-canvas\"\n    @dragover.prevent\n    @drop=\"handleDrop\"\n  >\n    <div \n      class=\"canvas-container\"\n      :style=\"containerStyle\"\n    >\n      <grid-layout\n        v-model:layout=\"layoutModel\"\n        :col-num=\"12\"\n        :row-height=\"30\"\n        :is-draggable=\"true\"\n        :is-resizable=\"true\"\n        :vertical-compact=\"true\"\n        :use-css-transforms=\"true\"\n      >\n        <grid-item\n          v-for=\"item in layoutModel\"\n          :key=\"item.id\"\n          :x=\"item.x\"\n          :y=\"item.y\"\n          :w=\"item.w\"\n          :h=\"item.h\"\n          :i=\"item.id\"\n          :class=\"{ active: selectedId === item.id }\"\n          @click=\"handleSelect(item.id)\"\n        >\n          <component-renderer\n            :component=\"components[item.id]\"\n            :data=\"components[item.id].data\"\n            :styles=\"components[item.id].styles\"\n          />\n          <div class=\"component-actions\" v-if=\"selectedId === item.id\">\n            <el-button-group>\n              <el-button size=\"small\" @click=\"handleMoveUp(item.id)\">\n                <el-icon><ArrowUp /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleMoveDown(item.id)\">\n                <el-icon><ArrowDown /></el-icon>\n              </el-button>\n              <el-button size=\"small\" @click=\"handleDelete(item.id)\">\n                <el-icon><Delete /></el-icon>\n              </el-button>\n            </el-button-group>\n          </div>\n        </grid-item>\n      </grid-layout>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue'\nimport { VueGridLayout } from 'vue-grid-layout'\nimport { ArrowUp, ArrowDown, Delete } from '@element-plus/icons-vue'\nimport ComponentRenderer from '../widgets/ComponentRenderer.vue'\n\nconst { GridLayout, GridItem } = VueGridLayout\n\nconst props = defineProps({\n  modelValue: {\n    type: Array,\n    required: true\n  },\n  components: {\n    type: Object,\n    required: true\n  },\n  styles: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'select'])\n\n// 布局数据\nconst layoutModel = computed({\n  get: () => props.modelValue,\n  set: (value) => emit('update:modelValue', value)\n})\n\n// 选中的组件ID\nconst selectedId = ref(null)\n\n// 容器样式\nconst containerStyle = computed(() => ({\n  width: '100%',\n  maxWidth: '1200px',\n  margin: '0 auto',\n  minHeight: '100%',\n  background: '#fff',\n  ...props.styles\n}))\n\n// 处理组件选中\nconst handleSelect = (id) => {\n  selectedId.value = id\n  emit('select', id)\n}\n\n// 处理组件拖放\nconst handleDrop = (event) => {\n  const componentData = JSON.parse(event.dataTransfer.getData('component'))\n  emit('add-component', componentData)\n}\n\n// 处理组件上移\nconst handleMoveUp = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  if (index > 0) {\n    const temp = { ...layoutModel.value[index - 1] }\n    layoutModel.value[index - 1] = { ...layoutModel.value[index] }\n    layoutModel.value[index] = temp\n  }\n}\n\n// 处理组件下移\nconst handleMoveDown = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  if (index < layoutModel.value.length - 1) {\n    const temp = { ...layoutModel.value[index + 1] }\n    layoutModel.value[index + 1] = { ...layoutModel.value[index] }\n    layoutModel.value[index] = temp\n  }\n}\n\n// 处理组件删除\nconst handleDelete = (id) => {\n  const index = layoutModel.value.findIndex(item => item.id === id)\n  layoutModel.value.splice(index, 1)\n  selectedId.value = null\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.editor-canvas {\n  @apply flex-1 overflow-y-auto bg-gray-100 p-4;\n  \n  .canvas-container {\n    @apply shadow-lg;\n  }\n  \n  .grid-item {\n    @apply relative border border-transparent;\n    \n    &.active {\n      @apply border-blue-500;\n    }\n    \n    .component-actions {\n      @apply absolute top-2 right-2 z-10;\n    }\n  }\n}\n\n// 网格布局样式\n.vue-grid-layout {\n  @apply bg-white;\n}\n\n.vue-grid-item {\n  @apply touch-none;\n  \n  &.vue-grid-placeholder {\n    @apply bg-blue-100 border-2 border-blue-300 border-dashed;\n  }\n  \n  &.vue-draggable-dragging {\n    @apply z-50;\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}