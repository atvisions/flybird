{"ast":null,"code":"import { createCommentVNode as _createCommentVNode } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _createCommentVNode(\" No changes to template section \");\n}","map":{"version":3,"names":["_createCommentVNode"],"sources":["/Users/liuzhao/Documents/Projects/flybird/flybird-web/src/views/user/AccountSettings.vue"],"sourcesContent":["<template>\n  <!-- No changes to template section -->\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { showToast } from '@/components/ToastMessage'\nimport { useDeleteAccount } from '@/composables/useDeleteAccount'\nimport { usePhone } from '@/composables/usePhone'\nimport { useEmail } from '@/composables/useEmail'\nimport { useChangePassword } from '@/composables/useChangePassword'\nimport { account } from '@/api/account'\nimport { useAuthStore } from '@/stores/auth'\nimport { useUserStore } from '@/stores/user'\nimport { useAccountStore } from '@/stores/account'\n\nconst router = useRouter()\nconst authStore = useAuthStore()\nconst userStore = useUserStore()\nconst accountStore = useAccountStore()\n\n// 从 accountStore 获取用户信息\nconst email = computed(() => accountStore.userInfo?.email)\nconst phone = computed(() => accountStore.userInfo?.phone)\n\n// 处理邮箱更新\nconst handleEmailUpdate = async () => {\n  if (!isEmailFormValid.value) {\n    showToast('请填写完整信息', 'warning')\n    return\n  }\n\n  try {\n    emailManager.state.loading = true\n    const response = await account.bindEmail({\n      email: emailManager.state.value,\n      code: emailManager.state.code,\n      password: emailManager.state.password\n    })\n\n    if (response?.data?.message) {\n      showToast(response.data.message, 'success')\n      closeEmailModal()\n      await accountStore.fetchUserInfo()\n    }\n  } catch (error) {\n    console.error('邮箱更新失败:', error)\n    const errorMsg = error.response?.data?.detail || \n                    error.message || \n                    '邮箱更新失败'\n    showToast(errorMsg, 'error')\n  } finally {\n    emailManager.state.loading = false\n  }\n}\n\n// 处理确认注销\nconst handleConfirmDelete = async () => {\n  if (!deleteFormState.value.password) {\n    showToast('请输入密码', 'warning')\n    return\n  }\n  \n  try {\n    deleteFormState.value.loading = true\n    const response = await account.deleteAccount({\n      password: deleteFormState.value.password\n    })\n    \n    if (response?.data?.code === 200) {\n      showToast('账号已注销', 'success')\n      // 使用 auth store 的 logout 方法清除所有状态\n      await authStore.logout()\n      // 清除其他可能的状态\n      localStorage.removeItem('isLoggedIn')\n      // 强制刷新页面以确保所有状态都被清除\n      window.location.href = '/login'\n    }\n  } catch (error) {\n    console.error('注销失败:', error)\n    const errorMsg = error.response?.data?.detail || \n                    error.response?.data?.message || \n                    error.message || \n                    '注销失败'\n    showToast(errorMsg, 'error')\n  } finally {\n    deleteFormState.value.loading = false\n  }\n}\n\n// No changes to rest of the script section\n</script>\n\n<style scoped>\n/* No changes to style section */\n</style>"],"mappings":";;SACEA,mBAAA,oCAAuC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}